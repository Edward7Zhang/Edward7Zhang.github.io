<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'true', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±» | EdwardZhang&#39;s Blog | Life starts at the end of your comfort zone. âš½ ğŸ‚ ğŸƒ ğŸš´ âŒ¨ï¸</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="TensorFlow">
    <meta name="description" content="CNNåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼ŒåŒæ—¶å®ƒå¯ä»¥åº”ç”¨åœ¨æ–‡æœ¬åˆ†ç±»ä¸Šé¢ï¼Œæ­¤æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨tensorflowå®ç°æ­¤ä»»åŠ¡ã€‚  CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†ä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨cnnè¿›è¡Œå¥å­åˆ†ç±»ã€‚è¾“å…¥æ˜¯ä¸€ä¸ªå¥å­ï¼Œä¸ºäº†ä½¿å…¶å¯ä»¥è¿›è¡Œå·ç§¯ï¼Œé¦–å…ˆéœ€è¦å°†å…¶è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºï¼Œé€šå¸¸ä½¿ç”¨word2vecå®ç°ã€‚d=5è¡¨ç¤ºæ¯ä¸ªè¯è½¬åŒ–ä¸º5ç»´çš„å‘é‡ï¼ŒçŸ©é˜µçš„å½¢çŠ¶æ˜¯[sentence_length Ã—Ã— 5]ï¼Œå³[7 Ã—Ã— 5]ã€‚6">
<meta name="keywords" content="TensorFlow">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»">
<meta property="og:url" content="https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/index.html">
<meta property="og:site_name" content="EdwardZhang&#39;s Blog">
<meta property="og:description" content="CNNåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼ŒåŒæ—¶å®ƒå¯ä»¥åº”ç”¨åœ¨æ–‡æœ¬åˆ†ç±»ä¸Šé¢ï¼Œæ­¤æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨tensorflowå®ç°æ­¤ä»»åŠ¡ã€‚  CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†ä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨cnnè¿›è¡Œå¥å­åˆ†ç±»ã€‚è¾“å…¥æ˜¯ä¸€ä¸ªå¥å­ï¼Œä¸ºäº†ä½¿å…¶å¯ä»¥è¿›è¡Œå·ç§¯ï¼Œé¦–å…ˆéœ€è¦å°†å…¶è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºï¼Œé€šå¸¸ä½¿ç”¨word2vecå®ç°ã€‚d=5è¡¨ç¤ºæ¯ä¸ªè¯è½¬åŒ–ä¸º5ç»´çš„å‘é‡ï¼ŒçŸ©é˜µçš„å½¢çŠ¶æ˜¯[sentence_length Ã—Ã— 5]ï¼Œå³[7 Ã—Ã— 5]ã€‚6">
<meta property="og:image" content="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-06-at-12.05.40-PM-1024x937.png">
<meta property="og:image" content="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-06-at-8.03.47-AM-1024x413.png">
<meta property="og:image" content="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-05-at-9.47.41-AM-1024x261.png">
<meta property="og:image" content="https://img-blog.csdn.net/20161218225721289?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1eXVlbWFpY2hh/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/12/Screen-Shot-2015-12-11-at-6.29.14-AM-1024x347.png">
<meta property="og:image" content="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/12/Screen-Shot-2015-12-11-at-6.27.48-AM-1024x350.png">
<meta property="og:updated_time" content="2018-05-20T10:50:21.054Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»">
<meta name="twitter:description" content="CNNåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼ŒåŒæ—¶å®ƒå¯ä»¥åº”ç”¨åœ¨æ–‡æœ¬åˆ†ç±»ä¸Šé¢ï¼Œæ­¤æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨tensorflowå®ç°æ­¤ä»»åŠ¡ã€‚  CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†ä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨cnnè¿›è¡Œå¥å­åˆ†ç±»ã€‚è¾“å…¥æ˜¯ä¸€ä¸ªå¥å­ï¼Œä¸ºäº†ä½¿å…¶å¯ä»¥è¿›è¡Œå·ç§¯ï¼Œé¦–å…ˆéœ€è¦å°†å…¶è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºï¼Œé€šå¸¸ä½¿ç”¨word2vecå®ç°ã€‚d=5è¡¨ç¤ºæ¯ä¸ªè¯è½¬åŒ–ä¸º5ç»´çš„å‘é‡ï¼ŒçŸ©é˜µçš„å½¢çŠ¶æ˜¯[sentence_length Ã—Ã— 5]ï¼Œå³[7 Ã—Ã— 5]ã€‚6">
<meta name="twitter:image" content="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-06-at-12.05.40-PM-1024x937.png">
    
        <link rel="alternate" type="application/atom+xml" title="EdwardZhang&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">EdwardZhang</h5>
          <a href="mailto:Super_Mr.Z@hotmail.com" title="Super_Mr.Z@hotmail.com" class="mail">Super_Mr.Z@hotmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Homepage
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/photo"  >
                <i class="icon icon-lg icon-photo"></i>
                Album
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Edward7Zhang" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://weibo.com/u/3100298257/home?wvr=5" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.instagram.com/major7edward/" target="_blank" >
                <i class="icon icon-lg icon-instagram"></i>
                Instagram
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/link"  >
                <i class="icon icon-lg icon-link"></i>
                Friends&#39; Link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="æ¤œç´¢">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-05-20T10:00:07.000Z" itemprop="datePublished" class="page-time">
  2018-05-20
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†"><span class="post-toc-number">1.</span> <span class="post-toc-text">CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹"><span class="post-toc-number">2.</span> <span class="post-toc-text">æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Input-placeholder"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">Input placeholder</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EMBEDDING-LAYER"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">EMBEDDING LAYER</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CONVOLUTION-AND-MAX-POOLING-LAYERS"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">CONVOLUTION AND MAX-POOLING LAYERS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#DROPOUT-LAYER"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">DROPOUT LAYER</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SCORES-AND-PREDICTIONS"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">SCORES AND PREDICTIONS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#LOSS-AND-ACCURACY"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">LOSS AND ACCURACY</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MINIMIZING-THE-LOSS"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">MINIMIZING THE LOSS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CHECKPOINTING"><span class="post-toc-number">2.8.</span> <span class="post-toc-text">CHECKPOINTING</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#DEFINING-A-SINGLE-TRAINING-STEP"><span class="post-toc-number">2.9.</span> <span class="post-toc-text">DEFINING A SINGLE TRAINING STEP</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TRAINING-LOOP"><span class="post-toc-number">2.10.</span> <span class="post-toc-text">TRAINING LOOP</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#VISUALIZING-RESULTS-IN-TENSORBOARD"><span class="post-toc-number">2.11.</span> <span class="post-toc-text">VISUALIZING RESULTS IN TENSORBOARD</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#å‚è€ƒï¼šhttp-www-wildml-com-2015-12-implementing-a-cnn-for-text-classification-in-tensorflow"><span class="post-toc-number">3.</span> <span class="post-toc-text">å‚è€ƒï¼šhttp://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/</span></a></li></ol>
        </nav>
    </aside>


<article id="post-åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-05-20 18:00:07" datetime="2018-05-20T10:00:07.000Z"  itemprop="datePublished">2018-05-20</time>

            


            
<span id="busuanzi_container_page_pv" title="æ–‡ç« æ€»é˜…è¯»é‡" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>CNNåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼ŒåŒæ—¶å®ƒå¯ä»¥åº”ç”¨åœ¨æ–‡æœ¬åˆ†ç±»ä¸Šé¢ï¼Œæ­¤æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨tensorflowå®ç°æ­¤ä»»åŠ¡ã€‚</p>
</blockquote>
<h1 id="CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†"><a href="#CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†" class="headerlink" title="CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†"></a>CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†</h1><p>ä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨cnnè¿›è¡Œå¥å­åˆ†ç±»ã€‚è¾“å…¥æ˜¯ä¸€ä¸ªå¥å­ï¼Œä¸ºäº†ä½¿å…¶å¯ä»¥è¿›è¡Œå·ç§¯ï¼Œé¦–å…ˆéœ€è¦å°†å…¶è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºï¼Œé€šå¸¸ä½¿ç”¨word2vecå®ç°ã€‚d=5è¡¨ç¤ºæ¯ä¸ªè¯è½¬åŒ–ä¸º5ç»´çš„å‘é‡ï¼ŒçŸ©é˜µçš„å½¢çŠ¶æ˜¯[sentence_length Ã—Ã— 5]ï¼Œå³[7 Ã—Ã— 5]ã€‚6ä¸ªfilterï¼ˆå·ç§¯æ ¸ï¼‰ï¼Œä¸å›¾åƒä¸­ä½¿ç”¨çš„å·ç§¯æ ¸ä¸åŒçš„æ˜¯ï¼Œnlpä½¿ç”¨çš„å·ç§¯æ ¸çš„å®½ä¸å¥å­çŸ©é˜µçš„å®½ç›¸åŒï¼Œåªæ˜¯é•¿åº¦ä¸åŒã€‚è¿™é‡Œæœ‰ï¼ˆ2ï¼Œ3ï¼Œ4ï¼‰ä¸‰ç§sizeï¼Œæ¯ç§sizeæœ‰ä¸¤ä¸ªfilterï¼Œä¸€å…±æœ‰6ä¸ªfilterã€‚ç„¶åå¼€å§‹å·ç§¯ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œstrideæ˜¯1ï¼Œå› ä¸ºå¯¹äºé«˜æ˜¯4çš„filterï¼Œæœ€åç”Ÿæˆ4ç»´çš„å‘é‡ï¼Œï¼ˆ7-4ï¼‰/1+1=4ã€‚å¯¹äºé«˜æ˜¯3çš„filterï¼Œæœ€åç”Ÿæˆ5ç»´çš„å‘é‡ï¼Œï¼ˆ7-3ï¼‰/1+1=5ã€‚å·ç§¯ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°å¥å­çš„ç‰¹å¾ï¼Œä½¿ç”¨activation functionå’Œ1-max-poolingå¾—åˆ°æœ€åçš„å€¼ï¼Œæ¯ä¸ªfilteræœ€åå¾—åˆ°ä¸¤ä¸ªç‰¹å¾ã€‚å°†æ‰€æœ‰ç‰¹å¾åˆå¹¶åï¼Œä½¿ç”¨softmaxè¿›è¡Œåˆ†ç±»ã€‚å›¾ä¸­æ²¡æœ‰ç”¨åˆ°chanel,ä¸‹æ–‡çš„å®éªŒå°†ä¼šä½¿ç”¨ä¸¤ä¸ªé€šé“ï¼Œstaticå’Œnon-staticï¼Œæœ‰ç›¸å…³çš„å…·ä½“è§£é‡Šã€‚<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-06-at-12.05.40-PM-1024x937.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">
                </div>
                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>
            </figure></p>
<h1 id="æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹"><a href="#æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹" class="headerlink" title="æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹"></a>æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-06-at-8.03.47-AM-1024x413.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">
                </div>
                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>
            </figure>
<p>ä¸»è¦åŒ…æ‹¬äº”å±‚ï¼Œç¬¬ä¸€å±‚æ˜¯embedding layer,ç¬¬äºŒå±‚æ˜¯convolutional layer,ç¬¬ä¸‰å±‚æ˜¯max-pooling layer,ç¬¬å››å±‚æ˜¯fully connected layerï¼Œæœ€åä¸€å±‚æ˜¯softmax layer.æ¥ä¸‹æ¥ä¾æ¬¡ä»‹ç»ç›¸å…³ä»£ç å®ç°ã€‚</p>
<h2 id="Input-placeholder"><a href="#Input-placeholder" class="headerlink" title="Input placeholder"></a>Input placeholder</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Placeholders for input, output and dropout</div><div class="line">self.input_x = tf.placeholder(tf.int32, [None, sequence_length], name=&quot;input_x&quot;)</div><div class="line">self.input_y = tf.placeholder(tf.float32, [None, num_classes], name=&quot;input_y&quot;)</div><div class="line">self.dropout_keep_prob = tf.placeholder(tf.float32, name=&quot;dropout_keep_prob&quot;)</div></pre></td></tr></table></figure>
<p><code>tf.placeholder</code> åˆ›å»ºä¸€ä¸ªå ä½ç¬¦å˜é‡ï¼Œåœ¨è®­ç»ƒæˆ–è€…æµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦å°†å ä½ç¬¦è¾“å…¥åˆ°ç½‘ç»œä¸­è¿›è¡Œè®¡ç®—ï¼Œå…¶ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¾“å…¥å¼ é‡çš„å½¢çŠ¶ã€‚None æ„å‘³ç€å®ƒå¯ä»¥æ˜¯ä»»ä½•ç»´åº¦çš„é•¿åº¦ï¼Œåœ¨æˆ‘ä»¬çš„å®éªŒä¸­å®ƒä»£è¡¨æ‰¹å¤„ç†çš„å¤§å°ï¼ŒNoneä½¿å¾—ç½‘ç»œå¯ä»¥å¤„ç†ä»»æ„é•¿åº¦çš„batchesã€‚<br>å¤±æ´»ç‡åŒæ ·ä¹Ÿæ˜¯è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è®­ç»ƒçš„æ—¶å€™ä½¿ç”¨dropout ï¼Œæµ‹è¯•çš„æ—¶å€™ä¸ä½¿ç”¨dropout ã€‚</p>
<h2 id="EMBEDDING-LAYER"><a href="#EMBEDDING-LAYER" class="headerlink" title="EMBEDDING LAYER"></a>EMBEDDING LAYER</h2><p>è¿™ä¸€å±‚å°†å•è¯ç´¢å¼•æ˜ å°„åˆ°ä½ç»´çš„å‘é‡è¡¨ç¤ºï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæŸ¥æ‰¾è¡¨ï¼Œæˆ‘ä»¬ä»æ•°æ®ä¸­é€šè¿‡å­¦ä¹ å¾—åˆ°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">with tf.device(&apos;/cpu:0&apos;), tf.name_scope(&quot;embedding&quot;):</div><div class="line">    W = tf.Variable(tf.random_uniform([vocab_size, embedding_size], -1.0, 1.0), name=&quot;W&quot;)</div><div class="line">    self.embedded_chars = tf.nn.embedding_lookup(W, self.input_x)</div><div class="line">    self.embedded_chars_expanded = tf.expand_dims(self.embedded_chars, -1)</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>W</code> æ˜¯ åœ¨è®­ç»ƒæ—¶å¾—åˆ°çš„embedding matrix.ï¼Œç”¨éšæœºå‡åŒ€åˆ†å¸ƒè¿›è¡Œåˆå§‹åŒ–ã€‚<a href="http://blog.csdn.net/u013713117/article/details/55048040" target="_blank" rel="external">tf.nn.embedding_lookup</a>å®ç°embeddingæ“ä½œï¼Œå¾—åˆ° ä¸€ä¸ª3-dimensional çš„å¼ é‡ï¼Œå½¢çŠ¶æ˜¯ <code>[None, sequence_length, embedding_size].</code> <code>sequence_length</code> æ˜¯æ•°æ®é›†ä¸­æœ€é•¿å¥å­çš„é•¿åº¦ï¼Œå…¶ä»–å¥å­éƒ½é€šè¿‡æ·»åŠ â€œPADâ€è¡¥å……åˆ°è¿™ä¸ªé•¿åº¦ã€‚<code>embedding_size</code> æ˜¯è¯å‘é‡çš„å¤§å°ã€‚</p>
<p>TensorFlowçš„å·ç§¯å‡½æ•°-<code>conv2d</code> éœ€è¦å››ä¸ªå‚æ•°ï¼Œ åˆ†åˆ«æ˜¯batch, width, height ä»¥åŠchannelã€‚ embeddingä¹‹åä¸åŒ…æ‹¬ channel, æ‰€ä»¥æˆ‘ä»¬äººä¸ºåœ°æ·»åŠ ä¸Šå®ƒï¼Œå¹¶è®¾ç½®ä¸º1ã€‚ç°åœ¨å°±æ˜¯<code>[None, sequence_length, embedding_size, 1]</code></p>
<h2 id="CONVOLUTION-AND-MAX-POOLING-LAYERS"><a href="#CONVOLUTION-AND-MAX-POOLING-LAYERS" class="headerlink" title="CONVOLUTION AND MAX-POOLING LAYERS"></a>CONVOLUTION AND MAX-POOLING LAYERS</h2><p>ç”±å›¾ä¸­å¯çŸ¥ï¼Œ æˆ‘ä»¬æœ‰ä¸åŒsizeçš„filtersã€‚å› ä¸ºæ¯æ¬¡å·ç§¯éƒ½ä¼šäº§ç”Ÿä¸åŒå½¢çŠ¶çš„å¼ é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦éå†æ¯ä¸ªfilterï¼Œç„¶åå°†ç»“æœåˆå¹¶æˆä¸€ä¸ªå¤§çš„ç‰¹å¾å‘é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">pooled_outputs = []</div><div class="line">for i, filter_size in enumerate(filter_sizes):</div><div class="line">    with tf.name_scope(&quot;conv-maxpool-%s&quot; % filter_size):</div><div class="line">        # Convolution Layer</div><div class="line">        filter_shape = [filter_size, embedding_size, 1, num_filters]</div><div class="line">        W = tf.Variable(tf.truncated_normal(filter_shape, stddev=0.1), name=&quot;W&quot;)</div><div class="line">        b = tf.Variable(tf.constant(0.1, shape=[num_filters]), name=&quot;b&quot;)</div><div class="line">        conv = tf.nn.conv2d(</div><div class="line">            self.embedded_chars_expanded,</div><div class="line">            W,</div><div class="line">            strides=[1, 1, 1, 1],</div><div class="line">            padding=&quot;VALID&quot;,</div><div class="line">            name=&quot;conv&quot;)</div><div class="line">        # Apply nonlinearity</div><div class="line">        h = tf.nn.relu(tf.nn.bias_add(conv, b), name=&quot;relu&quot;)</div><div class="line">        # Max-pooling over the outputs</div><div class="line">        pooled = tf.nn.max_pool(</div><div class="line">            h,</div><div class="line">            ksize=[1, sequence_length - filter_size + 1, 1, 1],</div><div class="line">            strides=[1, 1, 1, 1],</div><div class="line">            padding=&apos;VALID&apos;,</div><div class="line">            name=&quot;pool&quot;)</div><div class="line">        pooled_outputs.append(pooled)</div><div class="line"></div><div class="line"># Combine all the pooled features</div><div class="line">num_filters_total = num_filters * len(filter_sizes)</div><div class="line">self.h_pool = tf.concat(3, pooled_outputs)</div><div class="line">self.h_pool_flat = tf.reshape(self.h_pool, [-1, num_filters_total])</div></pre></td></tr></table></figure>
<p>è¿™é‡Œ<code>W</code> æ˜¯filter çŸ©é˜µï¼Œ<code>h</code> æ˜¯å¯¹å·ç§¯ç»“æœè¿›è¡Œéçº¿æ€§è½¬æ¢ä¹‹åçš„ç»“æœã€‚æ¯ä¸ª filteréƒ½ä»æ•´ä¸ªembeddingåˆ’è¿‡,ä¸åŒä¹‹å¤„åœ¨äºè¦†ç›–å¤šå°‘å•è¯ã€‚ â€œVALIDâ€ paddingæ„å‘³ç€æ²¡æœ‰å¯¹å¥å­çš„è¾¹ç¼˜è¿›è¡Œpadding,ä¹Ÿå°±æ˜¯ç”¨äº†narrow convolutionï¼Œè¾“å‡ºçš„å½¢çŠ¶æ˜¯ <code>[1, sequence_length - filter_size + 1, 1, 1]</code>ã€‚narrow convolutionä¸ wide convolutionçš„åŒºåˆ«æ˜¯æ˜¯å¦å¯¹è¾¹ç¼˜è¿›è¡Œå¡«å……ã€‚<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-05-at-9.47.41-AM-1024x261.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">
                </div>
                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>
            </figure><br><em>Narrow vs. Wide Convolution. Filter size 5, input size 7. Source: A Convolutional Neural Network for Modelling Sentences (2014)</em><br>å½“ä½ çš„filteræ¯”è¾“å…¥çš„sizeè¿˜å¤§æ—¶ï¼Œä½ å¯ä»¥çœ‹åˆ°wide convolutionæ˜¯å¤šä¹ˆçš„æœ‰ç”¨ï¼Œç”šè‡³è¯´æ˜¯å¿…é¡»çš„ã€‚å¦‚ä¸Šæ‰€ç¤ºï¼Œnarrow convolutionäº§å‡ºçš„å°ºå¯¸æ˜¯ï¼ˆ7-5ï¼‰+1=3ï¼Œè€Œwide convolutionäº§å‡ºå°ºå¯¸æ˜¯ï¼ˆ7+2*4-5ï¼‰+1=11ã€‚é€šå¸¸ï¼Œè¾“å‡ºå°ºå¯¸çš„è§„åˆ™è¡¨è¾¾å¼ä¸ºï¼š<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://img-blog.csdn.net/20161218225721289?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1eXVlbWFpY2hh/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">
                </div>
                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>
            </figure><br>å¯¹è¾“å‡ºè¿›è¡Œmax-poolingåå¾—åˆ°å½¢çŠ¶æ˜¯ <code>[batch_size, 1, 1, num_filters]</code> çš„å¼ é‡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œæœ€åä¸€ä¸ªç»´åº¦æ˜¯ç‰¹å¾ä»£è¡¨æ•°é‡ã€‚æŠŠæ¯ä¸€ä¸ªmax-poolingä¹‹åçš„å¼ é‡åˆå¹¶èµ·æ¥ä¹‹åå¾—åˆ°ä¸€ä¸ªé•¿å‘é‡ <code>[batch_size, num_filters_total]</code>. in <code>tf.reshape</code> ä¸­çš„ -1è¡¨ç¤ºTå°†å‘é‡å±•å¹³ã€‚</p>
<h2 id="DROPOUT-LAYER"><a href="#DROPOUT-LAYER" class="headerlink" title="DROPOUT LAYER"></a>DROPOUT LAYER</h2><p>Dropoutä¹Ÿè®¸æ˜¯cnnä¸­æœ€æµè¡Œçš„æ­£åˆ™åŒ–æ–¹æ³•ã€‚dropoutçš„æƒ³æ³•å¾ˆç®€å•ï¼Œdropout layeréšæœºåœ°é€‰æ‹©ä¸€äº›ç¥ç»å…ƒï¼Œä½¿å…¶å¤±æ´»ã€‚è¿™æ ·å¯ä»¥é˜»æ­¢co-adapting,è¿«ä½¿å®ƒä»¬æ¯ä¸€ä¸ªéƒ½å­¦ä¹ åˆ°æœ‰ç”¨çš„ç‰¹å¾ã€‚å¤±æ´»çš„ç¥ç»å•å…ƒä¸ªæ•°ç”±<code>dropout_keep_prob</code> å†³å®šã€‚åœ¨è®­ç»ƒçš„æ—¶å€™è®¾ä¸º 0.5 ,æµ‹è¯•çš„æ—¶å€™è®¾ä¸º 1 (disable dropout) .</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Add dropout</div><div class="line">with tf.name_scope(&quot;dropout&quot;):</div><div class="line">    self.h_drop = tf.nn.dropout(self.h_pool_flat, self.dropout_keep_prob)</div></pre></td></tr></table></figure>
<h2 id="SCORES-AND-PREDICTIONS"><a href="#SCORES-AND-PREDICTIONS" class="headerlink" title="SCORES AND PREDICTIONS"></a>SCORES AND PREDICTIONS</h2><p>åˆ©ç”¨ç‰¹å¾å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨çŸ©é˜µç›¸ä¹˜è®¡ç®—ä¸¤ç±»çš„å¾—åˆ†ï¼Œä¹Ÿå¯ä»¥ç”¨ softmaxå‡½æ•°è®¡ç®—ä¸¤ç±»çš„æ¦‚ç‡å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">with tf.name_scope(&quot;output&quot;):</div><div class="line">    W = tf.Variable(tf.truncated_normal([num_filters_total, num_classes], stddev=0.1), name=&quot;W&quot;)</div><div class="line">    b = tf.Variable(tf.constant(0.1, shape=[num_classes]), name=&quot;b&quot;)</div><div class="line">    self.scores = tf.nn.xw_plus_b(self.h_drop, W, b, name=&quot;scores&quot;)</div><div class="line">    self.predictions = tf.argmax(self.scores, 1, name=&quot;predictions&quot;)</div></pre></td></tr></table></figure>
<h2 id="LOSS-AND-ACCURACY"><a href="#LOSS-AND-ACCURACY" class="headerlink" title="LOSS AND ACCURACY"></a>LOSS AND ACCURACY</h2><p>å¯ä»¥ç”¨å¾—åˆ†å®šä¹‰æŸå¤±å€¼ã€‚æŸå¤±è®¡ç®—çš„æ˜¯ç½‘ç»œçš„è¯¯å·®ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†å…¶æœ€å°åŒ–ï¼Œåˆ†ç±»é—®é¢˜æ ‡å‡†çš„æŸå¤±å‡½æ•°æ˜¯äº¤å‰ç†µæŸå¤±ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Calculate mean cross-entropy loss</div><div class="line">with tf.name_scope(&quot;loss&quot;):</div><div class="line">    losses = tf.nn.softmax_cross_entropy_with_logits(self.scores, self.input_y)</div><div class="line">    self.loss = tf.reduce_mean(losses)</div></pre></td></tr></table></figure>
<p>è®¡ç®—æ­£ç¡®ç‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Calculate Accuracy</div><div class="line">with tf.name_scope(&quot;accuracy&quot;):</div><div class="line">    correct_predictions = tf.equal(self.predictions, tf.argmax(self.input_y, 1))</div><div class="line">    self.accuracy = tf.reduce_mean(tf.cast(correct_predictions, &quot;float&quot;), name=&quot;accuracy&quot;)</div></pre></td></tr></table></figure>
<h2 id="MINIMIZING-THE-LOSS"><a href="#MINIMIZING-THE-LOSS" class="headerlink" title="MINIMIZING THE LOSS"></a>MINIMIZING THE LOSS</h2><p>åˆ©ç”¨TensorFlow å†…ç½®çš„optimizersï¼Œä¾‹å¦‚ Adam optimizerï¼Œä¼˜åŒ–ç½‘ç»œæŸå¤±ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">global_step = tf.Variable(0, name=&quot;global_step&quot;, trainable=False)</div><div class="line">optimizer = tf.train.AdamOptimizer(1e-4)</div><div class="line">grads_and_vars = optimizer.compute_gradients(cnn.loss)</div><div class="line">train_op = optimizer.apply_gradients(grads_and_vars, global_step=global_step)</div></pre></td></tr></table></figure>
<p><code>train_op</code> æ˜¯ä¸€ä¸ªæ–°å»ºçš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‚æ•°ä¸Šè¿›è¡Œæ¢¯åº¦æ›´æ–°ã€‚æ¯æ‰§è¡Œä¸€æ¬¡ <code>train_op</code> å°±æ˜¯ä¸€æ¬¡è®­ç»ƒæ­¥éª¤ã€‚ TensorFlow å¯ä»¥è‡ªåŠ¨åœ°è®¡ç®—æ‰é‚£äº›å˜é‡æ˜¯â€œå¯è®­ç»ƒçš„â€ç„¶åè®¡ç®—ä»–ä»¬çš„æ¢¯åº¦ã€‚é€šè¿‡<code>global_step</code>è¿™ä¸ªå˜é‡å¯ä»¥è®¡ç®—è®­ç»ƒçš„æ­¥æ•°ï¼Œæ¯è®­ç»ƒä¸€æ¬¡è‡ªåŠ¨åŠ ä¸€ã€‚</p>
<h2 id="CHECKPOINTING"><a href="#CHECKPOINTING" class="headerlink" title="CHECKPOINTING"></a>CHECKPOINTING</h2><p>TensorFlow ä¸­å¯ä»¥ç”¨checkpointing ä¿å­˜æ¨¡å‹çš„å‚æ•°ã€‚checkpointingä¸­çš„å‚æ•°ä¹Ÿå¯ä»¥ç”¨æ¥ç»§ç»­è®­ç»ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># Checkpointing</div><div class="line">checkpoint_dir = os.path.abspath(os.path.join(out_dir, &quot;checkpoints&quot;))</div><div class="line">checkpoint_prefix = os.path.join(checkpoint_dir, &quot;model&quot;)</div><div class="line"># Tensorflow assumes this directory already exists so we need to create it</div><div class="line">if not os.path.exists(checkpoint_dir):</div><div class="line">    os.makedirs(checkpoint_dir)</div><div class="line">saver = tf.train.Saver(tf.all_variables())</div></pre></td></tr></table></figure>
<h2 id="DEFINING-A-SINGLE-TRAINING-STEP"><a href="#DEFINING-A-SINGLE-TRAINING-STEP" class="headerlink" title="DEFINING A SINGLE TRAINING STEP"></a>DEFINING A SINGLE TRAINING STEP</h2><p>ç”¨ä¸€ä¸ªbatchçš„æ•°æ®è¿›è¡Œä¸€æ¬¡è®­ç»ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">def train_step(x_batch, y_batch):</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    A single training step</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    feed_dict = &#123;</div><div class="line">      cnn.input_x: x_batch,</div><div class="line">      cnn.input_y: y_batch,</div><div class="line">      cnn.dropout_keep_prob: FLAGS.dropout_keep_prob</div><div class="line">    &#125;</div><div class="line">    _, step, summaries, loss, accuracy = sess.run(</div><div class="line">        [train_op, global_step, train_summary_op, cnn.loss, cnn.accuracy],</div><div class="line">        feed_dict)</div><div class="line">    time_str = datetime.datetime.now().isoformat()</div><div class="line">    print(&quot;&#123;&#125;: step &#123;&#125;, loss &#123;:g&#125;, acc &#123;:g&#125;&quot;.format(time_str, step, loss, accuracy))</div><div class="line">    train_summary_writer.add_summary(summaries, step)</div></pre></td></tr></table></figure>
<p><code>train_op</code> ä»€ä¹ˆä¹Ÿä¸è¿”å›ï¼Œåªæ˜¯æ›´æ–°ç½‘ç»œä¸­çš„å‚æ•°ã€‚æœ€ç»ˆï¼Œæ‰“å°å‡ºå½“å‰è®­ç»ƒçš„æŸå¤±å€¼ä¸æ­£ç¡®ç‡ã€‚å¦‚æœbatchçš„sizeå¾ˆå°çš„è¯ï¼Œè¿™ä¸¤è€…åœ¨ä¸åŒçš„batchä¸­å·®åˆ«å¾ˆå¤§ã€‚å› ä¸ºä½¿ç”¨äº†dropoutï¼Œè®­ç»ƒçš„metricså¯èƒ½è¦æ¯”æµ‹è¯•çš„metricsç³Ÿç³•ã€‚</p>
<p>åŒæ ·çš„å‡½æ•°ä¹Ÿå¯ä»¥ç”¨åœ¨æµ‹è¯•æ—¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">def dev_step(x_batch, y_batch, writer=None):</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    Evaluates model on a dev set</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    feed_dict = &#123;</div><div class="line">      cnn.input_x: x_batch,</div><div class="line">      cnn.input_y: y_batch,</div><div class="line">      cnn.dropout_keep_prob: 1.0</div><div class="line">    &#125;</div><div class="line">    step, summaries, loss, accuracy = sess.run(</div><div class="line">        [global_step, dev_summary_op, cnn.loss, cnn.accuracy],</div><div class="line">        feed_dict)</div><div class="line">    time_str = datetime.datetime.now().isoformat()</div><div class="line">    print(&quot;&#123;&#125;: step &#123;&#125;, loss &#123;:g&#125;, acc &#123;:g&#125;&quot;.format(time_str, step, loss, accuracy))</div><div class="line">    if writer:</div><div class="line">        writer.add_summary(summaries, step)</div></pre></td></tr></table></figure>
<h2 id="TRAINING-LOOP"><a href="#TRAINING-LOOP" class="headerlink" title="TRAINING LOOP"></a>TRAINING LOOP</h2><p>é€šè¿‡è¿­ä»£æ•°æ®è¿›è¡Œè®­ç»ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># Generate batches</div><div class="line">batches = data_helpers.batch_iter(</div><div class="line">    zip(x_train, y_train), FLAGS.batch_size, FLAGS.num_epochs)</div><div class="line"># Training loop. For each batch...</div><div class="line">for batch in batches:</div><div class="line">    x_batch, y_batch = zip(*batch)</div><div class="line">    train_step(x_batch, y_batch)</div><div class="line">    current_step = tf.train.global_step(sess, global_step)</div><div class="line">    if current_step % FLAGS.evaluate_every == 0:</div><div class="line">        print(&quot;\nEvaluation:&quot;)</div><div class="line">        dev_step(x_dev, y_dev, writer=dev_summary_writer)</div><div class="line">        print(&quot;&quot;)</div><div class="line">    if current_step % FLAGS.checkpoint_every == 0:</div><div class="line">        path = saver.save(sess, checkpoint_prefix, global_step=current_step)</div><div class="line">        print(&quot;Saved model checkpoint to &#123;&#125;\n&quot;.format(path))</div></pre></td></tr></table></figure>
<h2 id="VISUALIZING-RESULTS-IN-TENSORBOARD"><a href="#VISUALIZING-RESULTS-IN-TENSORBOARD" class="headerlink" title="VISUALIZING RESULTS IN TENSORBOARD"></a>VISUALIZING RESULTS IN TENSORBOARD</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/12/Screen-Shot-2015-12-11-at-6.29.14-AM-1024x347.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">
                </div>
                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/12/Screen-Shot-2015-12-11-at-6.27.48-AM-1024x350.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">
                </div>
                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>
            </figure>
<p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°:</p>
<ul>
<li>æˆ‘ä»¬çš„è®­ç»ƒ metricsä¸å¹³æ»‘ï¼Œå› ä¸ºç”¨çš„batch sizeså¾ˆå°ã€‚å¦‚æœç”¨å¤§çš„batches (æˆ–è€…åœ¨æ•´ä¸ªæµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°)ï¼Œä¼šå¾—åˆ°å¹³æ»‘çš„çº¿ã€‚</li>
<li>æµ‹è¯•é›†çš„ accuracyæ˜æ˜¾æ¯”è®­ç»ƒé›†çš„ä½ï¼Œè¯´æ˜ç½‘ç»œè¿‡æ‹Ÿåˆäº†ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨æ›´å¤§çš„æ•°æ®é›†ï¼Œæ›´å¼ºçš„æ­£åˆ™åŒ–ï¼Œæ›´å°‘çš„æ¨¡å‹å‚æ•°ã€‚</li>
<li>è®­ç»ƒé›†ä¸Šçš„ loss å’Œ accuracyæ¯”æµ‹è¯•é›†ä½çš„åŸå› æ˜¯ç”¨äº†dropout.</li>
</ul>
<h1 id="å‚è€ƒï¼šhttp-www-wildml-com-2015-12-implementing-a-cnn-for-text-classification-in-tensorflow"><a href="#å‚è€ƒï¼šhttp-www-wildml-com-2015-12-implementing-a-cnn-for-text-classification-in-tensorflow" class="headerlink" title="å‚è€ƒï¼šhttp://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/"></a>å‚è€ƒï¼š<a href="http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/" target="_blank" rel="external">http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/</a></h1>
        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    æœ€çµ‚æ›´æ–°ï¼š<time datetime="2018-05-20T10:50:21.054Z" itemprop="dateUpdated">2018-05-20 18:50:21</time>
</span><br>


        
        Original Linkï¼š<a href="/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/" target="_blank" rel="external">https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/</a>
        
    </div>
    
    <footer>
        <a href="https://edward7zhang.github.io">
            <img src="/img/avatar.jpg" alt="EdwardZhang">
            EdwardZhang
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TensorFlow/">TensorFlow</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/&title=ã€ŠåŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‹ â€” EdwardZhang's Blog&pic=https://edward7zhang.github.io/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/&title=ã€ŠåŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‹ â€” EdwardZhang's Blog&source=Life starts at the end of your comfort zone." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠåŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‹ â€” EdwardZhang's Blog&url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/&via=https://edward7zhang.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/08/27/å›ç¯ï¼Œæœªæ¥å¯æœŸ/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">å›ç¯ï¼Œæœªæ¥å¯æœŸ</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/05/08/å®éªŒå®¤æ‹›æ–°é¢˜ç›®(2)/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">å®éªŒå®¤æ‹›æ–°é¢˜ç›®â‘¡</h4>
      </a>
    </div>
  
</nav>



    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'EdwardZhang777';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>













</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        ç«™ç‚¹æ€»è®¿å®¢æ•°ï¼š<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        ç«™ç‚¹æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>ã“ã®ãƒ–ãƒ­ã‚°ã®å†…å®¹ç‰©ã¯<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja">ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»ã‚³ãƒ¢ãƒ³ã‚º è¡¨ç¤º - éå–¶åˆ© - ç¶™æ‰¿ 4.0 å›½éš›ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã«æä¾›ã•ã‚Œã¦ã„ã¾ã™</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>EdwardZhang &copy; 2016 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/&title=ã€ŠåŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‹ â€” EdwardZhang's Blog&pic=https://edward7zhang.github.io/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/&title=ã€ŠåŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‹ â€” EdwardZhang's Blog&source=Life starts at the end of your comfort zone." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠåŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»ã€‹ â€” EdwardZhang's Blog&url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/&via=https://edward7zhang.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtklEQVR42u3awW7bQAwEUP//T7vXFqmUGVJbp8DTKTBiaZ8C7DJDvl7x9f5y/f558t37e379zdmzhhceHh7eeulXt77/5GoR95/MeMma8fDw8E7z7jf0+035Hn//+Hdw5evBw8PD+5m8fCufldrJ7+Ph4eH977z7B+exwg89GPDw8PAWYcTspczuv7kzHh4e3mneppz91M9H+nt4eHh466560gzLS9v2KbNj5o/74OHh4R3gteVsO1IwG0HIhxKSVhweHh7eOd6mrXWu9ZUPbF1+Cw8PD+8YL1luW2rPtvj8hb42bwgPDw9vxGuXOGuPtVt529C6vD8eHh7eMd5s822PjbZcLormpwB4eHh4o5K6bVzlge9sEGHWirs8HvDw8PDWvHzjTjCzNOBElIyHh4d3jjcLVfeNrk3Um4TOeHh4eOd47ULbiGEW+G5iYjw8PLzTvHzLbhtawzNqVHYXRxceHh7eQ7x6AHQR7ybHTP7XKP5ieHh4eA/x8sfkA1htCDt7QdEneHh4eAd4eUNr1ujaHA/JeupWGR4eHt6al/x7vwle2zgjf3r0QvHw8PAO85Jm2OzAaMeq2nbX5R3w8PDwjvHaoDbf0DftsXaM4PJgwMPDw3uUNyuRk4W2iUgCqDt7eHh4eId5s8C0HZzKw99Zef2Xb+Hh4eEd482om3Z+En8My+jNtBceHh5ezGvL4jZWmL3cTaSLh4eH9yleO2pQt6keur7JqvHw8PAe4r3Lq93Qnx26qoex8PDw8A7wHjhV4qNl1vTahMh4eHh453ibUae2NZUX6PuIGQ8PD+80rw1wN4NQz55a0cGAh4eH91FefpC08cQmCin0eHh4eP+cl4Sns0I5CTLquBYPDw/vGG+zcSdxw2w0YR9S4OHh4Z3gtf/wJ7A9eFaOrya28PDw8L7n/QI/h8U6RL+vYAAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '42';
            clearTimeout(titleTime);
        } else {
            document.title = 'Donâ€˜t Panicï¼';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
