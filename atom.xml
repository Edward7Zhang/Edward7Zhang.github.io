<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>EdwardZhang&#39;s Blog</title>
  
  <subtitle>Life starts at the end of your comfort zone. âš½ ğŸ‚ ğŸƒ ğŸš´ âŒ¨ï¸</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://edward7zhang.github.io/"/>
  <updated>2019-07-31T06:14:25.995Z</updated>
  <id>https://edward7zhang.github.io/</id>
  
  <author>
    <name>EdwardZhang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Tensroflow XLA AOT æ¨¡å‹ä¼˜åŒ–</title>
    <link href="https://edward7zhang.github.io/2019/07/29/Tensorflow%20XLA%20AOT%20%E6%A8%A1%E5%9E%8B%E4%BC%98%E5%8C%96/"/>
    <id>https://edward7zhang.github.io/2019/07/29/Tensorflow XLA AOT æ¨¡å‹ä¼˜åŒ–/</id>
    <published>2019-07-29T12:24:12.000Z</published>
    <updated>2019-07-31T06:14:25.995Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘å›¢é˜Ÿåœ¨APMæ–¹å‘å‘åŠ›ï¼Œéœ€è¦åœ¨äº§å“çš„æ·±åº¦å­¦ä¹ æ¨¡å‹çš„é€Ÿåº¦å’Œå ç”¨ç©ºé—´å¤§å°ä¸¤ä¸ªç»´åº¦æ¥è¿›è¡Œæå‡</p><p>ç›®å‰ä½¿ç”¨çš„æ˜¯Tensorflow Liteçš„æ ¼å¼åœ¨è¿›è¡Œæ¨¡å‹è¿ç®—ï¼Œæƒ³é€šè¿‡Tensorflowå®˜æ–¹åœ¨2017å¹´æ¨å‡ºçš„é¢„ç ”é¡¹ç›®XLAå¯¹æ¨¡å‹è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨å®˜æ–¹ç¤ºä¾‹è¿‡ç¨‹çš„ç»“è®ºä¸­æ¨¡å‹ä½¿ç”¨XLA/AOTä¼˜åŒ–çš„æ¨¡å‹æ¯”ä¹‹å‰ä½¿ç”¨.pbæ ¼å¼çš„æ¨¡å‹è¿è¡Œé€Ÿåº¦ä¼šæå‡10%~200%ï¼ˆæœ‰ä¸ªåˆ«æƒ…å†µï¼‰ï¼Œå ç”¨ç©ºé—´ä¼šæœ‰4xçš„ç¼©å°</p><p>æœ¬æ–‡å°†é€ä¸€å±•ç¤ºå®Œæ•´ä¼˜åŒ–è¿‡ç¨‹åŠé‡åˆ°çš„å‘ï¼ˆè§£å†³æ–¹æ¡ˆï¼‰ã€‚</p></blockquote><h1 id="Step-1-ä½¿ç”¨XLAå°†æ¨¡å‹ç¼–è¯‘ä¸ºAOTï¼ˆahead-of-timeï¼‰ä»£ç çš„æ­¥éª¤"><a href="#Step-1-ä½¿ç”¨XLAå°†æ¨¡å‹ç¼–è¯‘ä¸ºAOTï¼ˆahead-of-timeï¼‰ä»£ç çš„æ­¥éª¤" class="headerlink" title="Step -1: ä½¿ç”¨XLAå°†æ¨¡å‹ç¼–è¯‘ä¸ºAOTï¼ˆahead-of-timeï¼‰ä»£ç çš„æ­¥éª¤"></a>Step -1: ä½¿ç”¨XLAå°†æ¨¡å‹ç¼–è¯‘ä¸ºAOTï¼ˆahead-of-timeï¼‰ä»£ç çš„æ­¥éª¤</h1><ol><li><p>ç¼–è¯‘tfcomfile</p></li><li><p>å›ºåŒ–æ¨¡å‹</p></li><li><p>graph.config.pbtxt</p></li><li><p>ç¼–å†™bazel BUILDè„šæœ¬</p></li><li><p>ç¼–è¯‘å¯¹åº”å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶ .o .h</p></li><li><p>ç¼–å†™ä»£ç è°ƒç”¨AOTæ¨¡å‹</p></li><li><p>ç¼–å†™BUILD</p></li><li><p>ç¼–è¯‘å¯¹åº”å¹³å°æœ€ç»ˆäº§ç‰© .so</p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>Ubuntu18.04</li><li>Bazel 0.24</li><li>jdk 8</li><li>NDK</li><li>SDK</li></ul><h2 id="æ–‡ä»¶ç›®å½•"><a href="#æ–‡ä»¶ç›®å½•" class="headerlink" title="æ–‡ä»¶ç›®å½•"></a>æ–‡ä»¶ç›®å½•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">//tensorflow/compiler/aot/</div><div class="line">â”‚  aot_only_var_handle_op.cc</div><div class="line">â”‚  benchmark.cc</div><div class="line">â”‚  benchmark.h</div><div class="line">â”‚  benchmark_main.template</div><div class="line">â”‚  benchmark_test.cc</div><div class="line">â”‚  BUILD</div><div class="line">â”‚  codegen.cc</div><div class="line">â”‚  codegen.h</div><div class="line">â”‚  codegen_test.cc</div><div class="line">â”‚  codegen_test_h.golden</div><div class="line">â”‚  codegen_test_o.golden</div><div class="line">â”‚  compile.cc</div><div class="line">â”‚  compile.h</div><div class="line">â”‚  embedded_protocol_buffers.cc</div><div class="line">â”‚  embedded_protocol_buffers.h</div><div class="line">â”‚  flags.cc</div><div class="line">â”‚  flags.h</div><div class="line">â”‚  test.cc</div><div class="line">â”‚  test_graph_tfadd.config.pbtxt</div><div class="line">â”‚  test_graph_tfadd.pbtxt</div><div class="line">â”‚  test_graph_tfunknownop.config.pbtxt</div><div class="line">â”‚  test_graph_tfunknownop.pbtxt</div><div class="line">â”‚  test_graph_tfunknownop2.config.pbtxt</div><div class="line">â”‚  test_graph_tfunknownop3.config.pbtxt</div><div class="line">â”‚  tfcompile.bzl</div><div class="line">â”‚  tfcompile_main.cc</div><div class="line">â”‚</div><div class="line">â”œâ”€custom</div><div class="line">â”‚  â”‚  BUILD</div><div class="line">â”‚  â”‚  com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.cc</div><div class="line">â”‚  â”‚  com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.h</div><div class="line">â”‚  â”‚  custom_interface.config.pbtxt</div><div class="line">â”‚  â”‚  custom_interface_lib.h</div><div class="line">â”‚  â”‚  custom_interface_tfcompile_function.o</div><div class="line">â”‚  â”‚  custom_interface_tfcompile_metadata.o</div><div class="line">â”‚  â”‚  debug.cc</div><div class="line">â”‚  â”‚  debug.h</div><div class="line">â”‚  â”‚  figure-65.png</div><div class="line">â”‚  â”‚  figure-66.jpg</div><div class="line">â”‚  â”‚  frozen_custom_010.pb</div><div class="line">â”‚  â”‚  input_image.py</div><div class="line">â”‚  â”‚  libcustom_interface.a</div><div class="line">â”‚  â”‚  libcustom_interface.pic.a</div><div class="line">â”‚  â”‚  libcustom_interface.so</div><div class="line">â”‚  â”‚  lib_custom_interface.so</div><div class="line">â”‚  â”‚  log.h</div><div class="line">â”‚  â”‚  log_stream.h</div><div class="line">â”‚  â”‚  out.h</div><div class="line">â”‚  â”‚  out_helper.o</div><div class="line">â”‚  â”‚  out_model.o</div><div class="line">â”‚  â”‚  predict_model.py</div><div class="line">â”‚  â”‚  Screenshot_67.jpg</div><div class="line">â”‚  â”‚  Screenshot_68.png</div><div class="line">â”‚  â”‚  tfcompile_h_o.py</div><div class="line">â”‚  â”‚  __init__.py</div><div class="line">â”‚  â”‚</div><div class="line">â”‚  â”œâ”€arm64-v8a</div><div class="line">â”‚  â”‚      libcustom_interface.so</div><div class="line">â”‚  â”‚      lib_custom_interface.so</div><div class="line">â”‚  â”‚</div><div class="line">â”‚  â””â”€armeabi-v7a</div><div class="line">â”‚          libcustom_interface.so</div><div class="line">â”‚          lib_custom_interface.so</div><div class="line">â”‚</div><div class="line">â””â”€tests</div><div class="line">        BUILD</div><div class="line">        make_test_graphs.py</div><div class="line">        test_graph_tfadd.config.pbtxt</div><div class="line">        test_graph_tfadd_with_ckpt.config.pbtxt</div><div class="line">        test_graph_tfassert_eq.config.pbtxt</div><div class="line">        test_graph_tfcond.config.pbtxt</div><div class="line">        test_graph_tffunction.config.pbtxt</div><div class="line">        test_graph_tfgather.config.pbtxt</div><div class="line">        test_graph_tfmatmul.config.pbtxt</div><div class="line">        test_graph_tfmatmulandadd.config.pbtxt</div><div class="line">        test_graph_tfsplits.config.pbtxt</div><div class="line">        test_graph_tftop_k.config.pbtxt</div><div class="line">        test_graph_tfvariable.config.pbtxt</div><div class="line">        test_graph_tfvariable_sequential_updates.config.pbtxt</div><div class="line">        tfcompile_test.cc</div></pre></td></tr></table></figure></li></ol><h1 id="Step-0-ç¼–è¯‘tfcomfile"><a href="#Step-0-ç¼–è¯‘tfcomfile" class="headerlink" title="Step 0: ç¼–è¯‘tfcomfile"></a>Step 0: ç¼–è¯‘tfcomfile</h1><ul><li><p>é¦–å…ˆç¼–è¯‘tfcomfileå…¶å®å°±æ˜¯ç¼–è¯‘tensorflowæºç ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä½†è¿™ä¸€éƒ¨åˆ†çš„ç¼–è¯‘å´éœ€è¦æ•´ä¸ªå·¥ç¨‹çš„ä¾èµ–</p><ol><li><p>ä¸‹è½½æºç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> --recurse-submodules https://github.com/tensorflow/tensorflow</div></pre></td></tr></table></figure><p>å…¶ä¸­<strong>â€“recurse-submodules</strong>å‚æ•°æ˜¯å¿…é¡»çš„ï¼Œç”¨äºè·å–TensorFlowä¾èµ–çš„protobufåº“.</p></li><li><p>é…ç½®TensorFlow</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~/tensorflow</div><div class="line">./configure</div></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„é…ç½®ç¼–è¯‘é¡¹çš„ä¸€äº›è§„åˆ™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">You have bazel 0.25.0 installed.</div><div class="line">Please specify the location of python. [Default is C:\ProgramData\Anaconda3\python.exe]: </div><div class="line"></div><div class="line"></div><div class="line">Found possible Python library paths:</div><div class="line">  C:\ProgramData\Anaconda3\lib\site-packages</div><div class="line">Please input the desired Python library path to use.  Default is [C:\ProgramData\Anaconda3\lib\site-packages]</div><div class="line"></div><div class="line">Do you wish to build TensorFlow with XLA JIT support? [y/N]: Y</div><div class="line">XLA JIT support will be enabled <span class="keyword">for</span> TensorFlow.</div><div class="line"></div><div class="line">Do you wish to build TensorFlow with ROCm support? [y/N]: N</div><div class="line">No ROCm support will be enabled <span class="keyword">for</span> TensorFlow.</div><div class="line"></div><div class="line">Do you wish to build TensorFlow with CUDA support? [y/N]: N</div><div class="line">No CUDA support will be enabled <span class="keyword">for</span> TensorFlow.</div><div class="line"></div><div class="line">Please specify optimization flags to use during compilation when bazel option <span class="string">"--config=opt"</span> is specified [Default is</div><div class="line">/arch:AVX]: </div><div class="line"></div><div class="line"></div><div class="line">Would you like to override eigen strong inline <span class="keyword">for</span> some C++ compilation to reduce the compilation time? [Y/n]: N</div><div class="line">Not overriding eigen strong inline, some compilations could take more than 20 mins.</div><div class="line"></div><div class="line">Preconfigured Bazel build configs. You can use any of the below by adding <span class="string">"--config=&lt;&gt;"</span> to your build <span class="built_in">command</span>. See .ba</div><div class="line">zelrc <span class="keyword">for</span> more details.</div><div class="line">        --config=mkl            <span class="comment"># Build with MKL support.</span></div><div class="line">        --config=monolithic     <span class="comment"># Config for mostly static monolithic build.</span></div><div class="line">        --config=gdr            <span class="comment"># Build with GDR support.</span></div><div class="line">        --config=verbs          <span class="comment"># Build with libverbs support.</span></div><div class="line">        --config=ngraph         <span class="comment"># Build with Intel nGraph support.</span></div><div class="line">        --config=numa           <span class="comment"># Build with NUMA support.</span></div><div class="line">        --config=dynamic_kernels        <span class="comment"># (Experimental) Build kernels into separate shared objects.</span></div><div class="line">        --config=v2             <span class="comment"># Build TensorFlow 2.x instead of 1.x.</span></div><div class="line">Preconfigured Bazel build configs to DISABLE default on features:</div><div class="line">        --config=noaws          <span class="comment"># Disable AWS S3 filesystem support.</span></div><div class="line">        --config=nogcp          <span class="comment"># Disable GCP support.</span></div><div class="line">        --config=nohdfs         <span class="comment"># Disable HDFS support.</span></div><div class="line">        --config=noignite       <span class="comment"># Disable Apache Ignite support.</span></div><div class="line">        --config=nokafka        <span class="comment"># Disable Apache Kafka support.</span></div><div class="line">        --config=nonccl         <span class="comment"># Disable NVIDIA NCCL support.</span></div><div class="line">Configuration finished</div></pre></td></tr></table></figure><p>æœ€éœ€è¦æ³¨æ„çš„æ˜¯å…¶ä¸­çš„ï¼š<code>Do you wish to build TensorFlow with XLA JIT support? [y/N]: Y</code>!!!è¿™æ˜¯ä½¿ç”¨XLAçš„å…³é”®</p></li><li><p>å¼€å§‹ç¼–è¯‘tfcompile</p><p>tfcompileçš„Bazelè„šæœ¬å…¥å£åœ¨<code>//tensorflow/compiler/aot:tfcompile</code></p><p>æ‰§è¡Œå‘½ä»¤è¿›è¡Œç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bazel build //tensorflow/compiler/aot:tfcompile</div></pre></td></tr></table></figure></li></ol><blockquote><p>è®²ä¸€ä¸‹è¿™ä¸€æ­¥éª¤ä¸­é‡åˆ°çš„å‘</p><ul><li>é¦–å…ˆç¼–è¯‘æºç çš„è¿‡ç¨‹ä¸­ä¸åŒèµ„æºæ˜¯å¼‚æ­¥ç¼–è¯‘çš„ç»å¸¸ä¼šå‡ºç°æ‰¾ä¸åˆ°åŒ…çš„é—®é¢˜ï¼Œå¯ä»¥å¤šå°è¯•æ‰§è¡Œä¸Šä¸€å‘½ä»¤é‡å¤è¿›è¡Œç¼–è¯‘å³å¯</li><li>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šé¦–å…ˆå»è¯·æ±‚ä¸‹è½½å„ç§ä¾èµ–ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸­ä¼šå‡ºç°ä¾èµ–æ–¹å·²å‡çº§ç‰ˆæœ¬ä½†æœ¬åœ°è¯·æ±‚éœ€è¦éªŒè¯SHA256ï¼ˆæœ¬åœ°SHA256æ˜¯åœ¨ä»£ç ä¸­å†™æ­»çš„ï¼‰ä¸åŒ¹é…è¿™ä¸€é—®é¢˜ï¼Œå¯ä»¥æ ¹æ®æ—¥å¿—å®šä½ä¾èµ–ä¸‹è½½è„šæœ¬ä½ç½®ä¿®æ”¹å¯¹åº”SHA256å€¼å³å¯</li><li>bazelç¼–è¯‘è¿‡ç¨‹åœ¨ä¸‹è½½ä¾èµ–åæ˜¯æœ‰ç¼“å­˜æœºåˆ¶çš„ä¸å¿…æ‹…å¿ƒä¸‹è½½åçš„ä¾èµ–ä¸¢å¤±ï¼ˆå‰ææ˜¯ä¸æ‰§è¡Œ<code>bazel clean</code>ï¼‰</li><li>åœ¨ç¼–è¯‘tfcompileè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°ä¸è®ºåœ¨ä»€ä¹ˆç½‘ç»œçŠ¶æ€åœ¨éƒ½æ— æ³•ç¼–è¯‘é€šè¿‡çš„é—®é¢˜å°è¯•<code>bazel clean</code>åé‡æ–°æ‰§è¡Œå‘½ä»¤æˆ–åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ<code>bazel build --config=opt //tensorflow/tools/pip_package:build_pip_package</code>è¿›è¡Œä¾èµ–ä¸‹è½½æ„å»ºä¾èµ–åŒ…æˆåŠŸåå†æ¬¡æ‰§è¡Œtfcompileç¼–è¯‘å‘½ä»¤å°±ä¼šé¡ºç•…å¾ˆå¤š</li></ul></blockquote></li></ul><h1 id="Step-1-å›ºåŒ–æ¨¡å‹"><a href="#Step-1-å›ºåŒ–æ¨¡å‹" class="headerlink" title="Step 1:  å›ºåŒ–æ¨¡å‹"></a>Step 1:  å›ºåŒ–æ¨¡å‹</h1><p>è¿™ä¸€æ­¥ä¸­éœ€è¦å°†graphä¸checkpointså†»ç»“å½¢æˆ.pbæ ¼å¼çš„å›ºåŒ–æ¨¡å‹è¿™æ˜¯ä¹‹åå½¢æˆäºŒè¿›åˆ¶æ–‡ä»¶çš„åŸæ–™</p><p>è¿™ä¸€æ­¥å¾ˆå®¹æ˜“æ²¡æœ‰ä»€ä¹ˆå‘ ï¼›)</p><h1 id="Step-2-graph-config-pbtxt"><a href="#Step-2-graph-config-pbtxt" class="headerlink" title="Step 2: graph.config.pbtxt"></a>Step 2: graph.config.pbtxt</h1><p>è¿™ä¸€æ­¥ä¸­ä¸»è¦æ˜¯ä¸ºäº†å½¢æˆgraphçš„æè¿°ï¼Œå³æ³¨æ˜è¯¥graphçš„è¾“å…¥èŠ‚ç‚¹çš„èŠ‚ç‚¹åã€å…¥å‚tensorå¤§å°ï¼Œè¾“å‡ºèŠ‚ç‚¹çš„èŠ‚ç‚¹åç­‰å‚æ•°</p><p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å½¢æˆè¯¥æè¿°</p><ol><li><p>ä½¿ç”¨æºç ä¸­çš„å·¥å…·è¿›è¡Œè‡ªåŠ¨åŒ–å½¢æˆï¼ˆéœ€è¦ç¼–å†™ä»£ç ï¼‰</p><p>ä½¿ç”¨æºç ä¸­çš„tf2xla_pb2.pyå¯è¿›è¡Œä¸€äº›æ“ä½œå½¢æˆè¯¥æè¿°</p><p>è¿™é‡Œä»‹ç»å¦ä¸€ç§ç›´è§‚ä¸”å¿«é€Ÿçš„æ–¹å¼</p></li><li><p>é€šè¿‡å¯è§†åŒ–å·¥å…·ç¡®å®šå…¥å£å‡ºå£</p><p><img src="https://i.loli.net/2019/07/30/5d3fb86bbc95b76560.jpg" alt="NETRON"></p><p>é€šè¿‡è¯¥å·¥å…·å°†æ¨¡å‹å¯¼å…¥åå¯æ‰©å±•å†…éƒ¨æ‰€æœ‰èŠ‚ç‚¹çš„æè¿°ï¼Œå³å¯ä»¥å¾—åˆ°è¾“å…¥èŠ‚ç‚¹ä¸è¾“å‡ºèŠ‚ç‚¹çš„æè¿°ï¼Œè¿›è¡Œå¯¹åº”èŠ‚ç‚¹æè¿°æ–‡ä»¶ç¼–å†™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Each feed is a positional input argument for the generated function.  The order</span></div><div class="line"><span class="comment"># of each entry matches the order of each input argument.  Here â€œx_holdâ€ and â€œy_holdâ€</span></div><div class="line"><span class="comment"># refer to the names of placeholder nodes defined in the graph.</span></div><div class="line">feed &#123;</div><div class="line">  id &#123; node_name: <span class="string">"input"</span> &#125;</div><div class="line">  shape &#123;</div><div class="line">    dim &#123; size: 1 &#125;</div><div class="line">    dim &#123; size: 160 &#125;</div><div class="line">    dim &#123; size: 160 &#125;</div><div class="line">    dim &#123; size: 3 &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment"># Each fetch is a positional output argument for the generated function.  The order</span></div><div class="line"><span class="comment"># of each entry matches the order of each output argument.  Here â€œx_y_prodâ€</span></div><div class="line"><span class="comment"># refers to the name of a matmul node defined in the graph.</span></div><div class="line">fetch &#123;</div><div class="line">  id &#123; node_name: <span class="string">"MobilenetV2/Predictions/Reshape_1"</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p>   å°†è¯¥æ–‡ä»¶ä¿å­˜ä¸º<code>graph.config.pbtxt</code></p><p>   è¯¥æ­¥éª¤å®Œæˆ</p><p>   <strong>WARNING:</strong> éœ€è¦æ³¨æ„åœ¨è¯¥æè¿°æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šæ—¶åªå¯ä½¿ç”¨<code>#</code>ä½œä¸ºæ ‡ç¤ºï¼Œå¦åˆ™ç¼–è¯‘ä¸è¿‡ä¸”å®šä½ä¸åˆ°é—®é¢˜ä½ç½®</p><h1 id="Step-3-ç¼–å†™bazel-BUILDè„šæœ¬"><a href="#Step-3-ç¼–å†™bazel-BUILDè„šæœ¬" class="headerlink" title="Step 3: ç¼–å†™bazel BUILDè„šæœ¬"></a>Step 3: ç¼–å†™bazel BUILDè„šæœ¬</h1><p>åœ¨è¿™ä¸€æ­¥éª¤ä¸­å°†è¿›è¡Œç¼–å†™ç¼–è¯‘è„šæœ¬å¾ˆç®€çŸ­çš„é…ç½®ä½†æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼š</p><ul><li><p>å»ºè®®åœ¨<code>//tensorflow/compiler/aot</code>ä¸‹å»ºç«‹è‡ªå·±çš„floderå°†ä»¥ä¸Šç”Ÿæˆçš„äº§ç‰©æ”¾å…¥å…¶ä¸­ï¼Œä»¥ä¸‹æ“ä½œé»˜è®¤æ“ä½œåœ¨<code>//tensorflow/compiler/aot/custom</code>ä¸‹è¿›è¡Œ</p></li><li><p>åœ¨customç›®å½•ä¸‹åˆ›å»ºBUILDè„šæœ¬æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">load(<span class="string">"//tensorflow/compiler/aot:tfcompile.bzl"</span>, <span class="string">"tf_library"</span>)</div><div class="line"></div><div class="line">tf_library(</div><div class="line">    name = <span class="string">"custom_interface"</span>,</div><div class="line"></div><div class="line">    cpp_class = <span class="string">"Classifier"</span>,</div><div class="line"></div><div class="line">    graph = <span class="string">"frozen_custom_010.pb"</span>,</div><div class="line"></div><div class="line">    config = <span class="string">"graph.config.pbtxt"</span>,</div><div class="line">)</div></pre></td></tr></table></figure><h3 id="å†…éƒ¨å‚æ•°è§£é‡Šï¼š"><a href="#å†…éƒ¨å‚æ•°è§£é‡Šï¼š" class="headerlink" title="å†…éƒ¨å‚æ•°è§£é‡Šï¼š"></a>å†…éƒ¨å‚æ•°è§£é‡Šï¼š</h3><ul><li><p><code>name</code>ï¼šå³æ‰§è¡Œç¼–è¯‘åå°†ç”Ÿæˆäº§ç‰©çš„åç§°</p></li><li><p><code>cpp_class</code>ï¼šå³ç”ŸæˆC++å¤´æ–‡ä»¶.hä¸­å¯¹è¯¥ç±»çš„å‘½åï¼Œå¯ä»¥åœ¨è¯¥ç±»åå‰æ·»åŠ ä½œç”¨åŸŸsuch asï¼š<code>foo::bar::Classifier</code>ç­‰è‡ªå®šä¹‰æ“ä½œ</p></li><li><p><code>graph</code>ï¼šå³ä¹‹å‰æ­¥éª¤ä¸­ç”Ÿæˆçš„å†»ç»“å›¾.pbäº§ç‰©</p></li><li><p><code>config</code>ï¼šå³ä¸Šä¸€æ­¥éª¤ä¸­äº§ç”Ÿçš„å›¾æè¿°æ–‡ä»¶</p><p><em>æ­¤æ­¥éª¤å®Œæˆ</em></p></li></ul></li></ul><h1 id="Step-4-ç¼–è¯‘å¯¹åº”å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶-o-h"><a href="#Step-4-ç¼–è¯‘å¯¹åº”å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶-o-h" class="headerlink" title="Step 4: ç¼–è¯‘å¯¹åº”å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶ .o .h"></a>Step 4: ç¼–è¯‘å¯¹åº”å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶ .o .h</h1><p>ä½¿ç”¨å‘½ä»¤ï¼š<code>bazel build --verbose_failures //tensorflow/compiler/aot/custom:custom_interface</code></p><p>å…¶ä¸­<code>custom_interface</code>å¯¹åº”ä¸Šä¸€æ­¥éª¤ä¸­çš„<code>name</code></p><p>é‰´äºä¹‹å‰ç¼–è¯‘è¿‡tfcompileï¼Œæ­¤æ­¥éª¤åªæ˜¯ä½¿ç”¨äº†è¯¥äº§ç‰©ä¸­çš„éƒ¨åˆ†èµ„æºè¿›è¡Œç¼–è¯‘æ‰€ä»¥ä¸ä¼šæœ‰ä»€ä¹ˆå‘</p><p>è¿™é‡Œä»‹ç»å¦ä¸€ç§ç¼–è¯‘æ­¤æ­¥éª¤äº§ç‰©çš„æ–¹å¼ï¼Œéœ€è¦åœ¨ç¼–è¯‘tfcompileæ­¥éª¤åäº§ç”Ÿçš„bazel-binæ–‡ä»¶ä¸­æ‰¾åˆ°tfcompileçš„runæ–‡ä»¶</p><p>é€šè¿‡å‘½ä»¤<code>tfcompile --graph=frozen_custom_010.pb --config=graph.config.pbtxt --cpp_class=&quot;Classifier&quot;</code></p><p>è¿™é‡Œè´´ä¸‹tfcompileçš„å…·ä½“ç”¨æ³•å…¶ä¸­å…·æœ‰ç¼–è¯‘å¯¹åº”å¹³å°ABIçš„å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">tfcompile performs ahead-of-time compilation of a TensorFlow graph,</div><div class="line">resulting <span class="keyword">in</span> an object file compiled <span class="keyword">for</span> your target architecture, and a</div><div class="line">header file that gives access to the functionality <span class="keyword">in</span> the object file.</div><div class="line">A typical invocation looks like this:</div><div class="line"></div><div class="line">   $ tfcompile --graph=mygraph.pb --config=myfile.pbtxt --cpp_class=<span class="string">"mynamespace::MyComputation"</span></div><div class="line"></div><div class="line">usage: ./tfcompile</div><div class="line">Flags:</div><div class="line">        --graph=<span class="string">""</span>                              string  Input GraphDef file.  If the file ends <span class="keyword">in</span> <span class="string">'.pbtxt'</span> it is expected to be <span class="keyword">in</span> the human-readable proto text format, otherwise it is expected to be <span class="keyword">in</span> the proto binary format.</div><div class="line">        --config=<span class="string">""</span>                             string  Input file containing Config proto.  If the file ends <span class="keyword">in</span> <span class="string">'.pbtxt'</span> it is expected to be <span class="keyword">in</span> the human-readable proto text format, otherwise it is expected to be <span class="keyword">in</span> the proto binary format.</div><div class="line">        --dump_fetch_nodes=<span class="literal">false</span>                bool    If <span class="built_in">set</span>, only flags related to fetches are processed, and the resulting fetch nodes will be dumped to stdout <span class="keyword">in</span> a comma-separated list.  Typically used to format arguments <span class="keyword">for</span> other tools, e.g. freeze_graph.</div><div class="line">        --target_triple=<span class="string">"x86_64-pc-linux"</span>       string  Target platform, similar to the clang -target flag.  The general format is &lt;arch&gt;&lt;sub&gt;-&lt;vendor&gt;-&lt;sys&gt;-&lt;abi&gt;.  http://clang.llvm.org/docs/CrossCompilation.html<span class="comment">#target-triple.</span></div><div class="line">        --target_cpu=<span class="string">""</span>                         string  Target cpu, similar to the clang -mcpu flag.  http://clang.llvm.org/docs/CrossCompilation.html<span class="comment">#cpu-fpu-abi</span></div><div class="line">        --target_features=<span class="string">""</span>                    string  Target features, e.g. +avx2, +neon, etc.</div><div class="line">        --entry_point=<span class="string">"entry"</span>                   string  Name of the generated <span class="keyword">function</span>.  If multiple generated object files will be linked into the same binary, each will need a unique entry point.</div><div class="line">        --cpp_class=<span class="string">""</span>                          string  Name of the generated C++ class, wrapping the generated <span class="keyword">function</span>.  The syntax of this flag is [[&lt;optional_namespace&gt;::],...]&lt;class_name&gt;.  This mirrors the C++ syntax <span class="keyword">for</span> referring to a class, <span class="built_in">where</span> multiple namespaces may precede the class name, separated by double-colons.  The class will be generated <span class="keyword">in</span> the given namespace(s), or <span class="keyword">if</span> no namespaces are given, within the global namespace.</div><div class="line">        --out_function_object=<span class="string">"out_model.o"</span>     string  Output object file containing the generated <span class="keyword">function</span> <span class="keyword">for</span> the TensorFlow model.</div><div class="line">        --out_header=<span class="string">"out.h"</span>                    string  Output header file name.</div><div class="line">        --out_metadata_object=<span class="string">"out_helper.o"</span>    string  Output object file name containing optional metadata <span class="keyword">for</span> the generated <span class="keyword">function</span>.</div><div class="line">        --out_session_module=<span class="string">""</span>                 string  Output session module proto.</div><div class="line">        --gen_name_to_index=<span class="literal">false</span>               bool    Generate name-to-index data <span class="keyword">for</span> Lookup&#123;Arg,Result&#125;Index methods.</div><div class="line">        --gen_program_shape=<span class="literal">false</span>               bool    Generate program shape data <span class="keyword">for</span> the ProgramShape method.</div><div class="line">        --xla_generate_hlo_graph=<span class="string">""</span>             string  HLO modules matching this regex will be dumped to a .dot file throughout various stages <span class="keyword">in</span> compilation.</div><div class="line">        --xla_hlo_graph_addresses=<span class="literal">false</span>         bool    With xla_generate_hlo_graph, show addresses of HLO ops <span class="keyword">in</span> graph dump.</div><div class="line">        --xla_hlo_graph_path=<span class="string">""</span>                 string  With xla_generate_hlo_graph, dump the graphs into this path.</div><div class="line">        --xla_hlo_dump_as_graphdef=<span class="literal">false</span>        bool    Dump HLO graphs as TensorFlow GraphDefs.</div><div class="line">        --xla_hlo_graph_sharding_color=<span class="literal">false</span>    bool    Assign colors based on sharding assignments when generating the HLO graphs.</div><div class="line">        --xla_hlo_tfgraph_device_scopes=<span class="literal">false</span>   bool    When generating TensorFlow HLO graphs, <span class="keyword">if</span> the HLO instructions are assigned to a specific device, prefix the name scope with <span class="string">"devX"</span> with X being the device ordinal.</div><div class="line">        --xla_log_hlo_text=<span class="string">""</span>                   string  HLO modules matching this regex will be dumped to LOG(INFO).</div><div class="line">        --xla_generate_hlo_text_to=<span class="string">""</span>           string  Dump all HLO modules as text into the provided directory path.</div><div class="line">        --xla_enable_fast_math=<span class="literal">true</span>             bool    Enable unsafe fast-math optimizations <span class="keyword">in</span> the compiler; this may produce faster code at the expense of some accuracy.</div><div class="line">        --xla_llvm_enable_alias_scope_metadata=<span class="literal">true</span>     bool    In LLVM-based backends, <span class="built_in">enable</span> the emission of !alias.scope metadata <span class="keyword">in</span> the generated IR.</div><div class="line">        --xla_llvm_enable_noalias_metadata=<span class="literal">true</span> bool    In LLVM-based backends, <span class="built_in">enable</span> the emission of !noalias metadata <span class="keyword">in</span> the generated IR.</div><div class="line">        --xla_llvm_enable_invariant_load_metadata=<span class="literal">true</span>  bool    In LLVM-based backends, <span class="built_in">enable</span> the emission of !invariant.load metadata <span class="keyword">in</span> the generated IR.</div><div class="line">        --xla_llvm_disable_expensive_passes=<span class="literal">false</span>       bool    In LLVM-based backends, <span class="built_in">disable</span> a custom <span class="built_in">set</span> of expensive optimization passes.</div><div class="line">        --xla_backend_optimization_level=3      int32   Numerical optimization level <span class="keyword">for</span> the XLA compiler backend.</div><div class="line">        --xla_disable_hlo_passes=<span class="string">""</span>             string  Comma-separated list of hlo passes to be disabled. These names must exactly match the passes<span class="string">' names; no whitespace around commas.</span></div><div class="line">        --xla_embed_ir_in_executable=false      bool    Embed the compiler IR as a string in the executable.</div><div class="line">        --xla_dump_ir_to=""                     string  Dump the compiler IR into this directory as individual files.</div><div class="line">        --xla_eliminate_hlo_implicit_broadcast=true     bool    Eliminate implicit broadcasts when lowering user computations to HLO instructions; use explicit broadcast instead.</div><div class="line">        --xla_cpu_multi_thread_eigen=true       bool    When generating calls to Eigen in the CPU backend, use multi-threaded Eigen mode.</div><div class="line">        --xla_gpu_cuda_data_dir="./cuda_sdk_lib"        string  If non-empty, speficies a local directory containing ptxas and nvvm libdevice files; otherwise we use those from runfile directories.</div><div class="line">        --xla_gpu_ftz=false                     bool    If true, flush-to-zero semantics are enabled in the code generated for GPUs.</div><div class="line">        --xla_gpu_disable_multi_streaming=false bool    If true, multi-streaming in the GPU backend is disabled.</div><div class="line">        --xla_gpu_max_kernel_unroll_factor=4    int32   Specify the maximum kernel unroll factor for the GPU backend.</div><div class="line">        --xla_dump_optimized_hlo_proto_to=""    string  Dump Hlo after all hlo passes are executed as proto binary into this directory.</div><div class="line">        --xla_dump_unoptimized_hlo_proto_to=""  string  Dump HLO before any hlo passes are executed as proto binary into this directory.</div><div class="line">        --xla_dump_per_pass_hlo_proto_to=""     string  Dump HLO after each pass as an HloProto in binary file format into this directory.</div><div class="line">        --xla_test_all_output_layouts=false     bool    Let ClientLibraryTestBase::ComputeAndCompare* test all permutations of output layouts. For example, with a 3D shape, all permutations of the set &#123;0, 1, 2&#125; are tried.</div><div class="line">        --xla_test_all_input_layouts=false      bool    Let ClientLibraryTestBase::ComputeAndCompare* test all permutations of *input* layouts. For example, for 2 input arguments with 2D shape and 4D shape, the computation will run 2! * 4! times for every possible layouts</div><div class="line">        --xla_hlo_profile=false                 bool    Instrument the computation to collect per-HLO cycle counts</div><div class="line">        --xla_dump_computations_to=""           string  Dump computations that XLA executes into the provided directory path</div><div class="line">        --xla_dump_executions_to=""             string  Dump parameters and results of computations that XLA executes into the provided directory path</div><div class="line">        --xla_backend_extra_options=""          string  Extra options to pass to a backend; comma-separated list of 'key=val<span class="string">' strings (=val may be omitted); no whitespace around commas.</span></div><div class="line">        --xla_reduce_precision=""               string  Directions for adding reduce-precision operations. Format is 'LOCATION=E,M:OPS;NAMES<span class="string">' where LOCATION is the class of locations in which to insert the operations (e.g., '</span>OP_OUTPUTS<span class="string">'), E and M are the exponent and matissa bit counts respectively, and OPS and NAMES are comma-separated (no spaces) lists of the operation types and names to which to attach the reduce-precision operations.  The NAMES string and its preceding '</span>;<span class="string">' may be omitted.  This option may be repeated to define multiple sets of added reduce-precision operations.</span></div><div class="line">        --xla_gpu_use_cudnn_batchnorm=false     bool    Allows the GPU backend to implement batchnorm HLOs using cudnn, rather than expanding them to a soup of HLOs.</div><div class="line">        --xla_cpu_use_mkl_dnn=false             bool    Generate calls to MKL-DNN in the CPU backend.</div></pre></td></tr></table></figure><p>æœ€ç»ˆç”Ÿæˆä¸‰ä¸ªäº§ç‰©:</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/07/30/5d3fcf560633657230.png" alt="äº§ç‰©" title="">                </div>                <div class="image-caption">äº§ç‰©</div>            </figure><ul><li><p><code>cat custom_interface_lib.h</code>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Generated by tfcompile, the TensorFlow graph compiler.  DO NOT EDIT!</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// This header was generated via ahead-of-time compilation of a TensorFlow</span></div><div class="line"><span class="comment">// graph.  An object file corresponding to this header was also generated.</span></div><div class="line"><span class="comment">// This header gives access to the functionality in that object file.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// clang-format off</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> TFCOMPILE_GENERATED___xla_tensorflow_compiler_aot_custom__custom_interface_H_  <span class="comment">// NOLINT(build/header_guard)</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TFCOMPILE_GENERATED___xla_tensorflow_compiler_aot_custom__custom_interface_H_  <span class="comment">// NOLINT(build/header_guard)</span></span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tensorflow/compiler/tf2xla/xla_compiled_cpu_function.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tensorflow/core/platform/types.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> Eigen &#123; <span class="class"><span class="keyword">struct</span> <span class="title">ThreadPoolDevice</span>;</span> &#125;</div><div class="line"><span class="keyword">namespace</span> xla &#123; <span class="class"><span class="keyword">class</span> <span class="title">ExecutableRunOptions</span>;</span> &#125;</div><div class="line"></div><div class="line"><span class="comment">// (Implementation detail) Entry point to the function in the object file.</span></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">void</span> __xla_tensorflow_compiler_aot_custom__custom_interface(</div><div class="line">    <span class="keyword">void</span>* result, <span class="keyword">const</span> ::xla::ExecutableRunOptions* run_options,</div><div class="line">    <span class="keyword">const</span> <span class="keyword">void</span>** args, <span class="keyword">void</span>** temps, tensorflow::int64* profile_counters);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Classifier represents a computation previously specified in a</span></div><div class="line"><span class="comment">// TensorFlow graph, now compiled into executable code. This extends the generic</span></div><div class="line"><span class="comment">// XlaCompiledCpuFunction class with statically type-safe arg and result</span></div><div class="line"><span class="comment">// methods. Usage example:</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//   Classifier computation;</span></div><div class="line"><span class="comment">//   // ...set args using computation.argN methods</span></div><div class="line"><span class="comment">//   CHECK(computation.Run());</span></div><div class="line"><span class="comment">//   // ...inspect results using computation.resultN methods</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// The Run method invokes the actual computation, with inputs read from arg</span></div><div class="line"><span class="comment">// buffers, and outputs written to result buffers. Each Run call may also use</span></div><div class="line"><span class="comment">// a set of temporary buffers for the computation.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// By default each instance of this class manages its own arg, result and temp</span></div><div class="line"><span class="comment">// buffers. The AllocMode constructor parameter may be used to modify the</span></div><div class="line"><span class="comment">// buffer allocation strategy.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Under the default allocation strategy, this class is thread-compatible:</span></div><div class="line"><span class="comment">// o Calls to non-const methods require exclusive access to the object.</span></div><div class="line"><span class="comment">// o Concurrent calls to const methods are OK, if those calls are made while it</span></div><div class="line"><span class="comment">//   is guaranteed that no thread may call a non-const method.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// The logical function signature is:</span></div><div class="line"><span class="comment">//   (arg0: f32[1,160,160,3]) -&gt; (f32[1,30])</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Memory stats:</span></div><div class="line"><span class="comment">//   arg bytes total:    307200</span></div><div class="line"><span class="comment">//   arg bytes aligned:  307200</span></div><div class="line"><span class="comment">//   temp bytes total:   4143008</span></div><div class="line"><span class="comment">//   temp bytes aligned: 4143104</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classifier</span> <span class="title">final</span> :</span> <span class="keyword">public</span> tensorflow::XlaCompiledCpuFunction &#123;</div><div class="line"> <span class="keyword">public</span>:</div><div class="line">  <span class="comment">// Number of input arguments for the compiled computation.</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">size_t</span> kNumArgs = <span class="number">1</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Byte size of each argument buffer. There are kNumArgs entries.</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> ::tensorflow::<span class="function">int64 <span class="title">ArgSize</span><span class="params">(::tensorflow::int32 index)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> BufferInfos()[ArgIndexToBufferIndex()[index]].size();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Returns static data used to create an XlaCompiledCpuFunction.</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> tensorflow::XlaCompiledCpuFunction::<span class="function">StaticData&amp; <span class="title">StaticData</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> XlaCompiledCpuFunction::StaticData* kStaticData = []()&#123;</div><div class="line">      XlaCompiledCpuFunction::StaticData* data =</div><div class="line">        <span class="keyword">new</span> XlaCompiledCpuFunction::StaticData;</div><div class="line">      set_static_data_raw_function(data, __xla_tensorflow_compiler_aot_custom__custom_interface);</div><div class="line">      set_static_data_buffer_infos(data, BufferInfos());</div><div class="line">      set_static_data_num_buffers(data, kNumBuffers);</div><div class="line">      set_static_data_arg_index_table(data, ArgIndexToBufferIndex());</div><div class="line">      set_static_data_num_args(data, kNumArgs);</div><div class="line">      set_static_data_result_index(data, kResultIndex);</div><div class="line">      set_static_data_arg_names(data, StaticArgNames());</div><div class="line">      set_static_data_result_names(data, StaticResultNames());</div><div class="line">      set_static_data_program_shape(data, StaticProgramShape());</div><div class="line">      set_static_data_hlo_profile_printer_data(</div><div class="line">          data, StaticHloProfilePrinterData());</div><div class="line"></div><div class="line">      <span class="keyword">return</span> data;</div><div class="line">    &#125;();</div><div class="line">    <span class="keyword">return</span> *kStaticData;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  Classifier(AllocMode alloc_mode =</div><div class="line">            AllocMode::ARGS_VARIABLES_RESULTS_PROFILES_AND_TEMPS)</div><div class="line">      : XlaCompiledCpuFunction(StaticData(), alloc_mode) &#123;&#125;</div><div class="line"></div><div class="line">  Classifier(<span class="keyword">const</span> Classifier&amp;) = <span class="keyword">delete</span>;</div><div class="line">  Classifier&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Classifier&amp;) = <span class="keyword">delete</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Arg methods for managing input buffers. Buffers are in row-major order.</span></div><div class="line">  <span class="comment">// There is a set of methods for each positional argument, with the following</span></div><div class="line">  <span class="comment">// general form:</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// void set_argN_data(void* data)</span></div><div class="line">  <span class="comment">//   Sets the buffer of type T for positional argument N. May be called in</span></div><div class="line">  <span class="comment">//   any AllocMode. Must be called before Run to have an affect. Must be</span></div><div class="line">  <span class="comment">//   called in AllocMode::RESULTS_PROFILES_AND_TEMPS_ONLY for each positional</span></div><div class="line">  <span class="comment">//   argument, to set the argument buffers.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// T* argN_data()</span></div><div class="line">  <span class="comment">//   Returns the buffer of type T for positional argument N.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// T&amp; argN(...dim indices...)</span></div><div class="line">  <span class="comment">//   Returns a reference to the value of type T for positional argument N,</span></div><div class="line">  <span class="comment">//   with dim indices specifying which value. No bounds checking is performed</span></div><div class="line">  <span class="comment">//   on dim indices.</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">set_arg0_data</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* data)</span> </span>&#123;</div><div class="line">    set_arg_data(<span class="number">0</span>, data);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">float</span>* <span class="title">arg0_data</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">float</span>*&gt;(arg_data(<span class="number">0</span>));</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">float</span>&amp; <span class="title">arg0</span><span class="params">(<span class="keyword">size_t</span> dim0, <span class="keyword">size_t</span> dim1, <span class="keyword">size_t</span> dim2, <span class="keyword">size_t</span> dim3)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (*<span class="keyword">static_cast</span>&lt;<span class="keyword">float</span>(*)[<span class="number">1</span>][<span class="number">160</span>][<span class="number">160</span>][<span class="number">3</span>]&gt;(</div><div class="line">        arg_data(<span class="number">0</span>)))[dim0][dim1][dim2][dim3];</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">float</span>* <span class="title">arg0_data</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt;(arg_data(<span class="number">0</span>));</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">float</span>&amp; <span class="title">arg0</span><span class="params">(<span class="keyword">size_t</span> dim0, <span class="keyword">size_t</span> dim1, <span class="keyword">size_t</span> dim2, <span class="keyword">size_t</span> dim3)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (*<span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>(*)[<span class="number">1</span>][<span class="number">160</span>][<span class="number">160</span>][<span class="number">3</span>]&gt;(</div><div class="line">        arg_data(<span class="number">0</span>)))[dim0][dim1][dim2][dim3];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Result methods for managing output buffers. Buffers are in row-major order.</span></div><div class="line">  <span class="comment">// Must only be called after a successful Run call. There is a set of methods</span></div><div class="line">  <span class="comment">// for each positional result, with the following general form:</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// T* resultN_data()</span></div><div class="line">  <span class="comment">//   Returns the buffer of type T for positional result N.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// T&amp; resultN(...dim indices...)</span></div><div class="line">  <span class="comment">//   Returns a reference to the value of type T for positional result N,</span></div><div class="line">  <span class="comment">//   with dim indices specifying which value. No bounds checking is performed</span></div><div class="line">  <span class="comment">//   on dim indices.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// Unlike the arg methods, there is no set_resultN_data method. The result</span></div><div class="line">  <span class="comment">// buffers are managed internally, and may change after each call to Run.</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">float</span>* <span class="title">result0_data</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">float</span>*&gt;(result_data(<span class="number">0</span>));</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">float</span>&amp; <span class="title">result0</span><span class="params">(<span class="keyword">size_t</span> dim0, <span class="keyword">size_t</span> dim1)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (*<span class="keyword">static_cast</span>&lt;<span class="keyword">float</span>(*)[<span class="number">1</span>][<span class="number">30</span>]&gt;(</div><div class="line">        result_data(<span class="number">0</span>)))[dim0][dim1];</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">float</span>* <span class="title">result0_data</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>*&gt;(result_data(<span class="number">0</span>));</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">float</span>&amp; <span class="title">result0</span><span class="params">(<span class="keyword">size_t</span> dim0, <span class="keyword">size_t</span> dim1)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (*<span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">float</span>(*)[<span class="number">1</span>][<span class="number">30</span>]&gt;(</div><div class="line">        result_data(<span class="number">0</span>)))[dim0][dim1];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Methods for managing variable buffers. Buffers are in row-major order.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// For read-write variables we generate the following methods:</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// void set_var_X_data(T* data)</span></div><div class="line">  <span class="comment">//   Sets the buffer for variable X.  Must be called before Run if the</span></div><div class="line">  <span class="comment">//   allocation mode is RESULTS_PROFILES_AND_TEMPS_ONLY.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// T* var_X_data()</span></div><div class="line">  <span class="comment">//   Returns the buffer of type T for variable X.  If the allocation mode is</span></div><div class="line">  <span class="comment">//   RESULTS_PROFILES_AND_TEMPS_ONLY then this buffer is the same as the</span></div><div class="line">  <span class="comment">//   buffer passed to set_var_X_data.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// T&amp; var_X(...dim indices...)</span></div><div class="line">  <span class="comment">//   Returns a reference to the value of type T for variable X,</span></div><div class="line">  <span class="comment">//   with dim indices specifying which value. No bounds checking is performed</span></div><div class="line">  <span class="comment">//   on dim indices.</span></div><div class="line">  <span class="comment">//</span></div><div class="line">  <span class="comment">// For readonly variables we generate the same set of methods, except that we</span></div><div class="line">  <span class="comment">// use `const T` instead of `T`.  We use `const T` to avoid erasing the</span></div><div class="line">  <span class="comment">// constness of the buffer passed to `set_var_X_data` but the underlying</span></div><div class="line">  <span class="comment">// buffer is not const (and thus the const can be safely const-cast'ed away)</span></div><div class="line">  <span class="comment">// unless `set_var_X_data` is called with a pointer to constant storage.</span></div><div class="line"></div><div class="line"> <span class="keyword">private</span>:</div><div class="line">  <span class="comment">// Number of buffers for the compiled computation.</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">size_t</span> kNumBuffers = <span class="number">50</span>;</div><div class="line"></div><div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> ::xla::cpu_function_runtime::<span class="function">BufferInfo* <span class="title">BufferInfos</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> ::xla::cpu_function_runtime::BufferInfo</div><div class="line">      kBufferInfos[kNumBuffers] = &#123;</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">2293760U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">1228802U</span>LL, <span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">614400U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">602112U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">301056U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">301056U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">301056U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">301056U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">301056U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">172032U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">98304U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">98304U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">98304U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">98304U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">98304U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">73728U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">55296U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">55296U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">55296U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">55296U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">55296U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">55296U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">55296U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">36864U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">24576U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">24576U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">24576U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">24576U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">24576U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">12288U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">6912U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">6144U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">6144U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">6144U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">6144U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">6144U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">2048U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">481U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">33U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">16U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">19U</span>LL, ~<span class="number">0U</span>LL&#125;),</div><div class="line">::xla::cpu_function_runtime::BufferInfo(&#123;<span class="number">16571521U</span>LL, ~<span class="number">0U</span>LL&#125;)</div><div class="line">      &#125;;</div><div class="line">    <span class="keyword">return</span> kBufferInfos;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> ::tensorflow::<span class="function">int32* <span class="title">ArgIndexToBufferIndex</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">constexpr</span> ::tensorflow::int32 kArgIndexToBufferIndex[kNumArgs] = &#123;</div><div class="line"><span class="number">1</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> kArgIndexToBufferIndex;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// The 0-based index of the result tuple in the temporary buffers.</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">size_t</span> kResultIndex = <span class="number">38</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Array of names of each positional argument, terminated by nullptr.</span></div><div class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span>** <span class="title">StaticArgNames</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Array of names of each positional result, terminated by nullptr.</span></div><div class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span>** <span class="title">StaticResultNames</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Shape of the args and results.</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> ::xla::<span class="function">ProgramShapeProto* <span class="title">StaticProgramShape</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> ::xla::ProgramShapeProto* kShape = <span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">return</span> kShape;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Metadata that can be used to pretty-print profile counters.</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> ::xla::<span class="function">HloProfilePrinterData* <span class="title">StaticHloProfilePrinterData</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> ::xla::HloProfilePrinterData* kHloProfilePrinterData =</div><div class="line">      <span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">return</span> kHloProfilePrinterData;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// TFCOMPILE_GENERATED___xla_tensorflow_compiler_aot_custom__custom_interface_H_</span></span></div><div class="line"></div><div class="line"><span class="comment">// clang-format on</span></div></pre></td></tr></table></figure></li></ul><p>å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„å…·ä½“å›¾å·²ç»è½¬æ¢ä¸ºå¯¹åº”è¿è¡Œæ—¶æŒ‡ä»¤ã€‚</p><p>  å…¶ä¸­çš„BufferInfoæ ‡è®°çš„æ˜¯ä¸º.oæ–‡ä»¶ä¸­çš„å…·ä½“è¿è¡Œæ—¶äºŒè¿›åˆ¶å­—å—</p><h1 id="Step-5-ç¼–å†™ä»£ç è°ƒç”¨AOTæ¨¡å‹"><a href="#Step-5-ç¼–å†™ä»£ç è°ƒç”¨AOTæ¨¡å‹" class="headerlink" title="Step 5: ç¼–å†™ä»£ç è°ƒç”¨AOTæ¨¡å‹"></a>Step 5: ç¼–å†™ä»£ç è°ƒç”¨AOTæ¨¡å‹</h1><blockquote><p>è¿™ä¸€æ­¥ä¸­éœ€è¦æ³¨æ„æœ€ç»ˆå½¢æˆçš„.soåœ¨ä»€ä¹ˆå¹³å°è¿›è¡Œä½¿ç”¨ï¼Œå½“æˆ‘ä»¬åœ¨ç§»åŠ¨ç«¯ï¼ˆAndroidï¼‰ä½¿ç”¨æ—¶ï¼Œä¸C++è¿›è¡Œé€šè®¯éœ€è¦JNIçš„æ”¯æŒæ‰€ä»¥åœ¨è¿™ä¸€æ­¥éœ€è¦é‡æ–°configure Tensorflowæºç é…ç½®SDKã€NDKæ”¯æŒï¼Œå…·ä½“SDK\NDKå¯¹åº”targetè‡ªè¡Œé€‰æ‹©</p><p>ä¸‹æ–‡ä¸­çš„è°ƒç”¨C++ä»£ç å°†é‡‡ç”¨å¤åˆJNIè§„èŒƒçš„ä»£ç ç¼–å†™</p></blockquote><h2 id="é¡¹ç›®Javaä¹¦å†™å¯¹åº”nativeæ–¹æ³•ç”Ÿæˆå¯¹åº”JNIå¤´æ–‡ä»¶ï¼š"><a href="#é¡¹ç›®Javaä¹¦å†™å¯¹åº”nativeæ–¹æ³•ç”Ÿæˆå¯¹åº”JNIå¤´æ–‡ä»¶ï¼š" class="headerlink" title="é¡¹ç›®Javaä¹¦å†™å¯¹åº”nativeæ–¹æ³•ç”Ÿæˆå¯¹åº”JNIå¤´æ–‡ä»¶ï¼š"></a>é¡¹ç›®Javaä¹¦å†™å¯¹åº”nativeæ–¹æ³•ç”Ÿæˆå¯¹åº”JNIå¤´æ–‡ä»¶ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.qihoo.cleandroid.sdk.imageclassfier.core.classfier.process;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by zhanghongxin on 2019/7/22.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomClassifier</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LIBNAME = <span class="string">"custom_interface"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">CustomClassifier</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Load the TensorFlowLite runtime C library.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            System.loadLibrary(LIBNAME);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125; <span class="keyword">catch</span> (UnsatisfiedLinkError e) &#123;</div><div class="line">            System.err.println(<span class="string">"custom_interface: failed to load native library: "</span> + e.getMessage());</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">getPredictResult</span><span class="params">(<span class="keyword">float</span>[][][][] input, <span class="keyword">float</span>[][] output, <span class="keyword">int</span> inputSize, <span class="keyword">int</span> outputSize)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="ç”Ÿæˆå¤´æ–‡ä»¶com-qihoo-cleandroid-sdk-imageclassfier-core-classfier-process-CustomClassifier-h"><a href="#ç”Ÿæˆå¤´æ–‡ä»¶com-qihoo-cleandroid-sdk-imageclassfier-core-classfier-process-CustomClassifier-h" class="headerlink" title="ç”Ÿæˆå¤´æ–‡ä»¶com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.h"></a>ç”Ÿæˆå¤´æ–‡ä»¶<code>com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.h</code></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="comment">/* Header for class com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier */</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier</div><div class="line"> * Method:    getPredictResult</div><div class="line"> * Signature: ([[[[F[[FII)V</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier_getPredictResult</span></span></div><div class="line">  <span class="params">(JNIEnv *, jclass, jobjectArray, jobjectArray, jint, jint)</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure><h2 id="ç¼–å†™C-ä»£ç å®ç°æ¨¡å‹è°ƒç”¨com-qihoo-cleandroid-sdk-imageclassfier-core-classfier-process-CustomClassifier-cc"><a href="#ç¼–å†™C-ä»£ç å®ç°æ¨¡å‹è°ƒç”¨com-qihoo-cleandroid-sdk-imageclassfier-core-classfier-process-CustomClassifier-cc" class="headerlink" title="ç¼–å†™C++ä»£ç å®ç°æ¨¡å‹è°ƒç”¨com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.cc"></a>ç¼–å†™C++ä»£ç å®ç°æ¨¡å‹è°ƒç”¨<code>com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.cc</code></h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line">#define EIGEN_USE_THREADS</div><div class="line">#define EIGEN_USE_CUSTOM_THREAD_POOL</div><div class="line"></div><div class="line">#include &lt;iostream&gt;</div><div class="line">#include &lt;cstdio&gt;</div><div class="line">#include &lt;jni.h&gt;</div><div class="line">#include &lt;android/log.h&gt;</div><div class="line">#include "custom_interface_lib.h"</div><div class="line">#include "third_party/eigen3/unsupported/Eigen/CXX11/Tensor"</div><div class="line"></div><div class="line">float* run(float* input, float* output, int input_size, int output_size)&#123;</div><div class="line">        std::cout &lt;&lt; "Load .so SUCCESS" &lt;&lt; std::endl;</div><div class="line">        Eigen::ThreadPool tp(std::thread::hardware_concurrency());</div><div class="line">        Eigen::ThreadPoolDevice device(&amp;tp, tp.NumThreads());</div><div class="line">        Classifier classifier;</div><div class="line">        classifier.set_thread_pool(&amp;device);</div><div class="line"></div><div class="line">        std::copy(input, input + input_size, classifier.arg0_data());</div><div class="line">        auto ok = classifier.Run();</div><div class="line">        if (not ok) std::cout &lt;&lt; "NOT OK" &lt;&lt; std::endl;</div><div class="line">//</div><div class="line">//        std::cout &lt;&lt; "input:";</div><div class="line">//        std::cout &lt;&lt; input &lt;&lt; std::endl;</div><div class="line">//</div><div class="line">//        std::cout &lt;&lt; "input_size:";</div><div class="line">//        std::cout &lt;&lt; input_size &lt;&lt; std::endl;</div><div class="line">//</div><div class="line">//        std::cout &lt;&lt; "classifier.arg0_data():";</div><div class="line">//        std::cout &lt;&lt; classifier.arg0_data() &lt;&lt; std::endl;</div><div class="line">//</div><div class="line">//        std::cout &lt;&lt; "output:";</div><div class="line">//        std::cout &lt;&lt; output &lt;&lt; std::endl;</div><div class="line">//</div><div class="line">//        std::cout &lt;&lt; "output_size:";</div><div class="line">//        std::cout &lt;&lt; output_size &lt;&lt; std::endl;</div><div class="line">//</div><div class="line">//        std::cout &lt;&lt; "result0_data():";</div><div class="line">//        std::cout &lt;&lt; classifier.result0_data() &lt;&lt; std::endl;</div><div class="line">//</div><div class="line">//        for(int i = 0; i &lt; 30; i++)&#123;</div><div class="line">//            std::cout &lt;&lt; "restul0_";</div><div class="line">//            std::cout &lt;&lt; i;</div><div class="line">//            std::cout &lt;&lt; " : ";</div><div class="line">//            std::cout &lt;&lt; classifier.result0(0,i) &lt;&lt; std::endl;</div><div class="line">//            __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~OUTPUT== %f~~~~~~~~~~~~~~~\n", classifier.result0(0,i));</div><div class="line">//        &#125;</div><div class="line"></div><div class="line">        std::copy(classifier.result0_data(), classifier.result0_data() + output_size, output);</div><div class="line"></div><div class="line">        return output;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">#ifndef _Included_com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier</div><div class="line">#define _Included_com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier</div><div class="line">#ifdef __cplusplus</div><div class="line">extern "C" &#123;</div><div class="line">#endif</div><div class="line">    JNIEXPORT void JNICALL Java_com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier_getPredictResult</div><div class="line">      (JNIEnv *env, jobject obj, jobjectArray inputArray, jobjectArray outputArray, jint inputSize, jint outputSize)&#123;</div><div class="line">        jboolean isCopy = JNI_FALSE;</div><div class="line"></div><div class="line">          jint rows = env-&gt;GetArrayLength(inputArray);</div><div class="line">//          __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~inputRows== %d~~~~~~~~~~~~~~~\n", rows);</div><div class="line">          jobjectArray tempInputArray = (jobjectArray)env-&gt;GetObjectArrayElement(inputArray, 0);</div><div class="line">//          __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~input: 1~~~~~~~~~~~~~~\n");</div><div class="line">          jobjectArray tTempInputArray = (jobjectArray)env-&gt;GetObjectArrayElement(tempInputArray, 0);</div><div class="line">//          __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~input: 2~~~~~~~~~~~~~~~\n");</div><div class="line">          jobjectArray tTTempInputArray = (jobjectArray)env-&gt;GetObjectArrayElement(tTempInputArray, 0);</div><div class="line">//          __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~input: 3~~~~~~~~~~~~~~~\n");</div><div class="line">          jfloat* input = env-&gt;GetFloatArrayElements((jfloatArray)tTTempInputArray, 0);</div><div class="line">//          __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~input: %f~~~~~~~~~~~~~~~\n", input);</div><div class="line"></div><div class="line"></div><div class="line">        jobjectArray tempOutputArray = (jobjectArray)env-&gt;GetObjectArrayElement(outputArray,0);</div><div class="line">//        __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~output: 1~~~~~~~~~~~~~~~\n");</div><div class="line">        jfloat* output = env-&gt;GetFloatArrayElements((jfloatArray)tempOutputArray, 0);</div><div class="line">//        __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~output: %f~~~~~~~~~~~~~~~\n", output);</div><div class="line"></div><div class="line">        jfloat* resultPointer = run(input, output, inputSize, outputSize);</div><div class="line"></div><div class="line">//        jclass floatArrayClz = env-&gt;FindClass("[[F");</div><div class="line">//        if(floatArrayClz == NULL) return NULL;</div><div class="line">//        outputArray = env-&gt;NewObjectArray(outputSize, floatArrayClz, NULL );</div><div class="line">//        if(outputArray == NULL) return NULL;</div><div class="line">        for(int i = 0; i &lt; 1; i++)&#123;</div><div class="line">            jfloat temp[outputSize];</div><div class="line">            jfloatArray floatArray = env-&gt;NewFloatArray(outputSize);</div><div class="line">//            if(floatArray == NULL) return NULL;</div><div class="line">            for(int j=0; j &lt; outputSize; j++)&#123;</div><div class="line">                temp[j] = *(resultPointer + j);</div><div class="line">            &#125;</div><div class="line">//            __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~output: 2~~~~~~~~~~~~~~~\n");</div><div class="line">            env-&gt;SetFloatArrayRegion(floatArray, 0, outputSize, temp);</div><div class="line">//            __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~output: 3~~~~~~~~~~~~~~~\n");</div><div class="line">            env-&gt;SetObjectArrayElement(outputArray, i, floatArray);</div><div class="line">//            __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~output: 4~~~~~~~~~~~~~~~\n");</div><div class="line">            env-&gt;DeleteLocalRef(floatArray);</div><div class="line">        &#125;</div><div class="line">//        __android_log_print(ANDROID_LOG_INFO, "NATIVE", "~~~~~~~~~output: %f~~~~~~~~~~~~~~~\n", outputArray[0]);</div><div class="line">      &#125;</div><div class="line">#ifdef __cplusplus</div><div class="line">&#125;</div><div class="line">#endif</div><div class="line">#endif</div></pre></td></tr></table></figure><p><em>æ­¤æ­¥éª¤ç»“æŸ</em></p><h1 id="Step-6-ç¼–å†™BUILD"><a href="#Step-6-ç¼–å†™BUILD" class="headerlink" title="Step 6: ç¼–å†™BUILD"></a>Step 6: ç¼–å†™BUILD</h1><blockquote><p>æ­¤æ­¥éª¤ä¸­æ‰€ç¼–å†™çš„BUILDæ–‡ä»¶ä¸Step 3ä¸­æ‰€ç¼–å†™æ–‡ä»¶ä¸ºåŒä¸€æ–‡ä»¶</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">cc_library(</div><div class="line">    name = <span class="string">"library"</span>,</div><div class="line">    hdrs = [<span class="string">"custom_interface_lib.h"</span>],</div><div class="line">    srcs = [<span class="string">"custom_interface_tfcompile_function.o"</span>,<span class="string">"custom_interface_tfcompile_metadata.o"</span>],</div><div class="line">)</div><div class="line"></div><div class="line">cc_binary(</div><div class="line">    name = <span class="string">"libcustom_interface.so"</span>,</div><div class="line"></div><div class="line">    srcs = [</div><div class="line">    <span class="string">"com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.h"</span>,</div><div class="line">    <span class="string">"com_qihoo_cleandroid_sdk_imageclassfier_core_classfier_process_CustomClassifier.cc"</span>,</div><div class="line">    ],</div><div class="line"></div><div class="line">    deps = [</div><div class="line">    <span class="string">":library"</span>,</div><div class="line">    <span class="string">"//tensorflow/compiler/tf2xla:xla_compiled_cpu_function"</span>,</div><div class="line">    <span class="string">"//tensorflow/core:framework_lite"</span>,</div><div class="line">    <span class="string">"//tensorflow/compiler/xla:cpu_function_runtime"</span>,</div><div class="line">    <span class="string">"//tensorflow/compiler/xla/service/cpu:runtime_conv2d"</span>,</div><div class="line">    <span class="string">"//tensorflow/compiler/xla/service/cpu:runtime_matmul"</span>,</div><div class="line">    <span class="string">"//third_party/eigen3"</span>,</div><div class="line">    ],</div><div class="line"></div><div class="line">    linkopts = [</div><div class="line">    <span class="string">"-landroid"</span>,</div><div class="line">    <span class="string">"-shared"</span>,</div><div class="line">    ],</div><div class="line"></div><div class="line">    linkshared = 1,</div><div class="line"></div><div class="line">    linkstatic = 1,</div><div class="line"></div><div class="line">    copts = [<span class="string">"-fPIC"</span>],</div><div class="line">)</div></pre></td></tr></table></figure><p>å…¶ä¸­cc_binaryä¸­çš„nameå³ä¸ºç”Ÿæˆ.soçš„åç§°è¯¥åç§°åº”ç¬¦åˆJNIè§„èŒƒ</p><p>æ³¨æ„ç”Ÿæˆ.soåŠ¨æ€é“¾æ¥åº“æ—¶éœ€é…ç½®<code>linkshared = 1</code> <code>linkstatic = 1</code> </p><h1 id="Step-7-ç¼–è¯‘å¯¹åº”å¹³å°æœ€ç»ˆäº§ç‰©-so"><a href="#Step-7-ç¼–è¯‘å¯¹åº”å¹³å°æœ€ç»ˆäº§ç‰©-so" class="headerlink" title="Step 7: ç¼–è¯‘å¯¹åº”å¹³å°æœ€ç»ˆäº§ç‰© .so"></a>Step 7: ç¼–è¯‘å¯¹åº”å¹³å°æœ€ç»ˆäº§ç‰© .so</h1><p>è¿è¡Œå‘½ä»¤ï¼š<code>bazel build -c opt //tensorflow/compiler/aot/custom:libcustom_interface.so \ --crosstool_top=//external:android/crosstool \ --host_crosstool_top=@bazel_tools//tools/cpp:toolchain \ --cpu=armeabi-v7a</code></p><p>é€šè¿‡<code>--cpu=xxx</code>æ¥æ§åˆ¶ç¼–è¯‘å¯¹åº”å¹³å°ABIçš„.so</p><p><em>è‡³æ­¤ç¼–è¯‘åæ‰€æœ‰æ­¥éª¤å®Œæˆ</em></p><h1 id="å®éªŒç»“è®º"><a href="#å®éªŒç»“è®º" class="headerlink" title="å®éªŒç»“è®º"></a>å®éªŒç»“è®º</h1><p>é€šè¿‡XLAåŠ é€Ÿæ¥å…¥ç§»åŠ¨ç«¯å¯¹æ¯”ï¼ˆå…¶å®å¹¶æ²¡æœ‰å¯æ¯”æ€§å› ä¸ºæ²¡æœ‰æ§åˆ¶å˜é‡ï¼‰</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/07/30/5d3fd9484d72823389.png" alt="å¯¹æ¯”" title="">                </div>                <div class="image-caption">å¯¹æ¯”</div>            </figure><p>ä¸Šå›¾ä¸­æ˜¾ç¤ºäº†åœ¨liteå’Œxlaä¸¤ç§æ–¹å¼ä¸‹ä½¿ç”¨åŒä¸€ç§æœºå‹é¢„æµ‹174å¼ å›¾ç‰‡çš„è€—æ—¶å¯¹æ¯”æ•°æ®</p><p>æ˜æ˜¾liteåœ¨è¿™ä¸€æ–¹é¢é€Ÿåº¦éå¸¸æœ‰ä¼˜åŠ¿ï¼Œä½†å¹¶ä¸ä»£è¡¨XLAä¸èµ·ä½œç”¨ï¼Œè€Œæ˜¯æ°å·§åœ¨æˆ‘ä»¬çš„è®¡ç®—å›¾ä¸­ä½¿ç”¨çš„å·ç§¯ç½‘ç»œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸é€‚ç”¨äºXLAè¿›è¡Œä¼˜åŒ–ï¼Œå®˜æ–¹ä½¿ç”¨JITçš„é€Ÿåº¦å¯¹æ¯”ï¼Œå…¶å®åœ¨JITçš„è®­ç»ƒæ—¶æ•°æ®å’ŒAOTçš„è¿è¡Œæ—¶æ•°æ®äº‹å®ä¸Šæ˜¯å¯¹åº”å…³ç³»æ°å·§ååº”äº†è¿™ä¸€å…³ç³»ã€‚</p><p>åé™„å‡ å¼ å®˜æ–¹æ¼”ç¤ºå›¾ï¼š</p><ul><li><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/07/30/5d3fdb4d90ce710040.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></li><li><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/07/30/5d3fd82750fad80574.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></li><li><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/07/30/5d3fd82760ed015529.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></li></ul><hr><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><p><a href="https://carlthome.github.io/posts/tfcompile /" target="_blank" rel="external">tfcompile | Carl ThomÃ©</a></p></li><li><p><a href="https://www.tensorflow.org/xla/tfcompile" target="_blank" rel="external">Using AOT compilation  |  XLA  |  TensorFlow</a></p></li><li><p><a href="https://github.com/rongjiecomputer/tensorflow-xla-aot-windows" target="_blank" rel="external">GitHub - rongjiecomputer/tensorflow-xla-aot-windows: Guide to build and use Tensorflow XLA/AOT on Windows</a></p></li><li><p><a href="https://stackoverflow.com/questions/43673380/tensorflow-cross-compile-xla-to-android" target="_blank" rel="external">c++ - TensorFlow: cross-compile XLA to Android - Stack Overflow</a></p></li><li><p><a href="https://danny270degree.blogspot.com/" target="_blank" rel="external">danny270degree.blogspot.com</a></p></li><li><p><a href="https://qiita.com/qiita_kuru/items/71660124b807c00ace31" target="_blank" rel="external">Tensorflow AOT (tfcompile)ã®ä½¿ã„æ–¹ - Qiita</a></p></li><li><p><a href="https://danny270degree.blogspot.com/2018/06/xla-how-to-use-xla-aot-compilation-in.html" target="_blank" rel="external">Dannyâ€™s tech notebook | ä¸¹å°¼æŠ€è¡“æ‰‹æœ­: [XLA ç ”ç©¶] How to use XLA AOT compilation in TensorFlow</a></p></li><li><p><a href="http://www.bnee.net/article/73899.html" target="_blank" rel="external">å­¦ä¹ ç¬”è®°TF062:TensorFlowçº¿æ€§ä»£æ•°ç¼–è¯‘æ¡†æ¶XLA / bnee.net</a></p></li><li><p><a href="https://www.wandouip.com/t5i207350/" target="_blank" rel="external">TFåŠ é€Ÿ-AOTä¹‹tfcompileè¶Ÿå‘ - è±Œè±†ipä»£ç†</a></p></li><li><p><a href="https://github.com/bazelbuild/bazel/issues/5164" target="_blank" rel="external">Issue #5164 Â· bazelbuild/bazel Â· GitHub</a></p></li><li><p><a href="https://barkeywolf.consulting/posts/tf-aot-rust/" target="_blank" rel="external">Barkey Wolf Consulting - Ahead-of-time compilation of a Tensorflow model for lightweight inclusion in a Rust program</a></p></li><li><p><a href="https://github.com/tensorflow/tensorflow/issues/7288" target="_blank" rel="external">Are linkopts propagated from copts and/or deps ? Â· Issue #7288 Â· tensorflow/tensorflow</a></p></li><li><p><a href="https://blog.csdn.net/zhuiqiuk/article/details/54428818" target="_blank" rel="external">Build TensorFlow for armeabi-v7a and arm64-v8a - zhuiqiukçš„ä¸“æ  - CSDNåšå®¢</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘å›¢é˜Ÿåœ¨APMæ–¹å‘å‘åŠ›ï¼Œéœ€è¦åœ¨äº§å“çš„æ·±åº¦å­¦ä¹ æ¨¡å‹çš„é€Ÿåº¦å’Œå ç”¨ç©ºé—´å¤§å°ä¸¤ä¸ªç»´åº¦æ¥è¿›è¡Œæå‡&lt;/p&gt;
&lt;p&gt;ç›®å‰ä½¿ç”¨çš„æ˜¯Tensorflow Liteçš„æ ¼å¼åœ¨è¿›è¡Œæ¨¡å‹è¿ç®—ï¼Œæƒ³é€šè¿‡Tensorflowå®˜æ–¹åœ¨2017å¹´æ¨å‡ºçš„é¢„ç ”é¡¹ç›®XLAå¯¹æ¨¡å‹è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨
      
    
    </summary>
    
    
      <category term="DeepLearning" scheme="https://edward7zhang.github.io/tags/DeepLearning/"/>
    
  </entry>
  
  <entry>
    <title>æƒ³è¯´å´è¿˜æ²¡è¯´çš„ä¹Ÿä¸å¿…å†è¯´äº†</title>
    <link href="https://edward7zhang.github.io/2019/06/01/%E6%83%B3%E8%AF%B4%E5%8D%B4%E8%BF%98%E6%B2%A1%E8%AF%B4%E7%9A%84%E4%B9%9F%E4%B8%8D%E5%BF%85%E5%86%8D%E8%AF%B4%E4%BA%86/"/>
    <id>https://edward7zhang.github.io/2019/06/01/æƒ³è¯´å´è¿˜æ²¡è¯´çš„ä¹Ÿä¸å¿…å†è¯´äº†/</id>
    <published>2019-06-01T14:42:07.000Z</published>
    <updated>2019-06-01T16:06:37.404Z</updated>
    
    <content type="html"><![CDATA[<iframe frameborder="no" marginwidth="0" marginheight="0" width="300" height="50" src="https://music.163.com/outchain/player?type=2&id=1218773&auto=0&height=32"></iframe><h1 id="æƒ³è¯´å´è¿˜æ²¡è¯´çš„è¿˜å¾ˆå¤š"><a href="#æƒ³è¯´å´è¿˜æ²¡è¯´çš„è¿˜å¾ˆå¤š" class="headerlink" title="æƒ³è¯´å´è¿˜æ²¡è¯´çš„è¿˜å¾ˆå¤š"></a>æƒ³è¯´å´è¿˜æ²¡è¯´çš„è¿˜å¾ˆå¤š</h1><ul><li>ä»ä¸€å¼€å§‹å¬å¤§å“¥çš„æ­Œâ€œæƒ³è¯´å´è¿˜æ²¡è¯´çš„è¿˜å¾ˆå¤šï¼Œæ”’ç€æ˜¯å› ä¸ºæƒ³å†™æˆæ­Œè®©äººè½»è½»åœ°å”±ç€ã€æ·¡æ·¡åœ°è®°ç€â€ï¼Œå¼€å§‹äº†å¤§å­¦å››å¹´çš„ä¿®è¡Œï¼Œåˆ°ä»Šå¤©æ‹å®Œæ¯•ä¸šç…§ã€ç»“æŸæ¯•ä¸šç­”è¾©æ‰æ„Ÿåˆ°æ‹”å‰‘å››é¡¾å¿ƒèŒ«ç„¶çš„æƒ†æ€…ã€‚</li><li>å››å¹´æ¥ï¼ŒåŒå­¦ä¹Ÿåªæ˜¯åŒå­¦äº†ï¼Œæˆ‘ä¹Ÿæ˜ç™½å¤šå°‘æ•…äº‹é‡Œçš„åŒå­¦å«åšåŒçª—ã€åŒé—¨çš„å«ä¹‰ï¼Œå†ä¹Ÿæ²¡æœ‰ 18 å²å‰é‚£ä»½åŒå­¦æƒ…è°Šçš„çœŸè¯šç‚™çƒ­ï¼Œå¤§å­¦å››å¹´æ²¡æœ‰å‡ºç”Ÿå…¥æ­»ã€æ²¡æœ‰çŸ¥å·±çŸ¥å½¼ã€æ²¡æœ‰æ‡‚æˆ‘å¿µæˆ‘ï¼ŒåŒå­¦é—´ä»…æœ‰çš„åªæœ‰åˆ©ç›Šçš„çº è‘›ã€å’Œèµ„æºçš„äº‰å¤ºï¼Œå°‘äº†äº›çº¯ç²¹ï¼Œå¤šäº†äº›å¸‚ä¾©ï¼Œç°åœ¨å›é¡¾è¿™ä¹Ÿå°±æ˜¯ä½çº§å­¦åºœçš„è¡¨è¾¾ï¼Œåªèƒ½æ€ªè‡ªå·±å‰ 18 å¹´æ²¡æœ‰è®©è‡ªå·±åˆ°è¾¾é«˜ç­‰çš„ levelã€‚</li><li>ä»Šå¤©æ˜¯æˆ‘åœ¨æ­¦æ±‰çš„æœ€åä¸€å¤©äº†ï¼ŒåŒç­åŒå­¦åˆç…§ç•™å¿µèšé¤çš„ä¾‹è¡Œå…¬äº‹çŸ›ç›¾åˆå’Œè°ï¼Œè¿™å››å¹´é‡Œæœ€å–œçˆ±çš„ä¸¤ä½è€å¸ˆä¹Ÿæ˜¯ç»™æˆ‘èµ„æºæœ€å¤šçš„ä¸¤ä½è€å¸ˆï¼ˆç°åœ¨å¯ä»¥ç§°ä¸ºé€šä¿—æ„ä¹‰ä¸Šçš„æ©å¸ˆï¼‰å¯¹äºæˆ‘çš„æ„ä¹‰ä¹‹é‡ä¸å¿…å¤šè¨€ï¼Œé—æ†¾åœ¨äºåªèƒ½ä¸å…¶ä¸€åˆå½±ï¼Œæ°å·§ä»Šå¤©æ­£å€¼å„¿ç«¥èŠ‚ï¼Œä¹Ÿä¸å¤ªå¥½æ„æ€æ‰“æ‰°è€å¸ˆé™ªä¼´å­©å­çš„æ—¶é—´ï¼Œå¯¹äºæˆ‘åªèƒ½ç®—æ˜¯é—æ†¾ã€‚</li><li>ä»Šå¹´æˆ‘ä»¬å­¦é™¢çš„å°±ä¸šè´¨é‡æŠ¥å‘Šä¼šæäº†ä¸€å¸®è€ƒç ”æˆåŠŸçš„ä¸Šå»è®²â€¦ä»Šå¹´æˆ‘ä»¬é™¢å°±ä¸šç‡å’Œè€ƒç ”ç‡éƒ½ç‰¹åˆ«ä½â€¦æä¸æ‡‚åœ¨å°±ä¸šåˆ†æçš„åœºåˆä¸ºä»€ä¹ˆè¦æå‡ ä¸ªè€ƒç ”æˆåŠŸçš„äººä¸Šå»ç»™å­¦å¼Ÿå­¦å¦¹æ‰“é¸¡è¡€â€¦æ¯å¹´è¿™æ ·éƒ½ä¼šè®©æ›´å¤šäººè’™è”½åŒçœ¼å†²å»è€ƒç ”ç„¶åé”™è¿‡å°±ä¸šçš„æ¡£å£ç»“æœä¹Ÿå¾ˆå¤±è´¥â€¦è¿™ç§åƒåœ¾ä¹¦è®°è¾…å¯¼å‘˜å°±åªèƒ½åšå‡ºè¿™æ ·çš„äº‹æƒ…â€¦æˆ‘ä»¬å­¦é™¢æ¯å¹´éƒ½æ¢å®¿èˆç„¶åå°±å¯¼è‡´ç°åœ¨å¤§å®¶å°±å®Œå…¨æ²¡æœ‰ä¸€ç‚¹æ¯•ä¸šçš„æ„Ÿè§‰â€¦å“€å…¶ä¸å¹¸â€¦äººå•Šâ€¦å¤§å¤šæ•°åªæƒ³åšå¥½è‡ªå·±çš„å·¥ä½œæ°¸è¿œæ²¡æœ‰å¤§å±€è§‚æ°¸è¿œç”¨åˆ«äººçš„è‹¦ä¹ä½œä¸ºè‡ªå·±çš„çœ‹ç‚¹â€¦æˆ‘ä¸ºæˆ‘é«˜ä¸­çš„ä¸åŠªåŠ›æ„Ÿåˆ°æ‚²å“€æˆ‘ä¸ºæˆ‘åœ¨è¿™æ ·çš„ç¯å¢ƒé‡Œå››å¹´æ„Ÿåˆ°ä¸å¹¸â€¦å¤§å­¦å››å¹´è¯´å®åœ¨çš„æ²¡æœ‰ä»»ä½•ä¸€ä¸ªäººçœŸçš„å½±å“åˆ°æˆ‘â€¦åŒé—¨ä¹‹é—´çš„æ–—äº‰å……æ–¥åœ¨æ•´ä¸ªå¤§å­¦ç”Ÿæ´»ä¸­â€¦æˆ‘ä¸æ¸…æ¥šæ˜¯æˆ‘çš„é—®é¢˜è¿˜æ˜¯è¿™ä¸ªç¯å¢ƒçš„é—®é¢˜â€¦æƒ‹æƒœæˆ‘é—å¤±çš„å››å¹´â€¦æˆ‘æ„Ÿè°¢è¿™å››å¹´çš„æ¯ä¸€ä¸ªäººçš„å¸®åŠ©â€¦æˆ‘ç—›æ¨è¿™å››å¹´çš„æ¯ä¸€ä¸ªäººçš„ä¸‘æ¶â€¦ä½†è¿˜å¥½åœ¨æœ€åé‡åˆ°äº†ä½ å¯ä»¥è®©æˆ‘ä¿¡ä»»å’Œå®ˆæŠ¤â€¦å¸Œæœ›æˆ‘ä»¬éƒ½èƒ½åœ¨æœ‰é™çš„æ—¶é—´é‡Œè¿½ä¸Šå‘½è¿å®ç°æˆ‘ä»¬çš„ä»·å€¼â€¦å¸Œæœ›è¿™ä¸ªç¤¾ä¼šåœ¨æœªæ¥èƒ½å¤Ÿå¾—ä»¥æ”¹å˜ä½†æˆ‘ä¹ŸçŸ¥é“è¿™æ˜¯ä¸å¯èƒ½çš„è‡³å°‘åœ¨æ‰€æœ‰äººçš„ä¼ªå–„ä¸­æ˜¯ä¸å¯èƒ½çš„ã€‚</li><li>ç”±äºæ›´æ¢å®¿èˆçš„åŸå› å¤§å®¶ä¹‹é—´çš„ç”Ÿç–ï¼Œå› æ­¤æƒ³åœ¨æœ€åçš„æ—¶åˆ»å’Œä»¥å¾€çš„å®¤å‹ä»¬ä¸€ä¸€é“åˆ«ï¼Œç»“æœå»äº†ä¸‰ä¸ªäººçš„å®¿èˆä¸€ä¸ªä¸åœ¨ä¸¤ä¸ªåœ¨ä¸“æ³¨æ¸¸æˆç”šè‡³æ²¡æœ‰å¯Ÿè§‰åˆ°æˆ‘ï¼ˆæˆ‘æ²¡æœ‰æŠŠè‡ªå·±æŠ¬é«˜çš„æ„æ€ï¼‰ï¼Œå”‰ï¼Œæƒ³å’Œå¤§å®¶èŠçš„è¿˜çœŸå¤šï¼Œä½†è¿™æ ·çš„åœºæ™¯è¿˜æœ‰è°èƒ½è¯´å¾—å‡ºå£å‘¢ï¼Ÿè¿˜ä¸å¦‚æŠŠè¿™äº›æ€ç»ªå…¨éƒ¨å°å­˜ï¼Œåœ¨è·¨è¶Šé•¿æ±Ÿçš„æ—¶å€™å…¨éƒ¨å€¾æ³»ï¼Œä¸è¦åœ¨æ„è¿‡å»çš„äººé™…å…³ç³»ã€ä¸è¦ä»‹æ„è¿™å››å¹´æ¥ä»–ä»¬çš„çœ‹æ³•ï¼Œè¿‡å»å°±è®©ä»–è¿‡å»ï¼Œæ¯ä¸ªäººéƒ½å­¤ç«‹ã€æ²¡æœ‰è°èƒ½å…¼æµå››ä¸‹ï¼Œæ›´ä¸è¦è¯´æ˜¯å…¼æµå¤©ä¸‹äº†ã€‚</li></ul><h1 id="è½¬èº«è·³è¿›è¥¿æ¹–"><a href="#è½¬èº«è·³è¿›è¥¿æ¹–" class="headerlink" title="è½¬èº«è·³è¿›è¥¿æ¹–"></a>è½¬èº«è·³è¿›è¥¿æ¹–</h1><ul><li>ä»è‰°éš¾çš„æ˜¥æ‹›èµ°è¿‡æ‰€å¹¸è¿˜å¾—åˆ°äº†ç¤¾ä¼šçš„ä¿¡èµ–ï¼Œç›®å‰åªå®ä¹ äº† 9 å¤©ï¼Œè¿™ 9 å¤©é‡Œæœ‰ä¸€è¯´ä¸€æ²¡æœ‰è‡ªæˆ‘ã€æ²¡æœ‰æƒ³è±¡çš„æ„Ÿè§‰ï¼Œå››ä¸‹çš„é™Œç”Ÿã€è·¨å¹´é¾„çš„ä»£æ²Ÿè®©æˆ‘ç–²å€¦ï¼Œæ‰¾ä¸åˆ°æˆ‘çš„é”æ°”â€¦å¯èƒ½è¿™ä¹Ÿæ˜¯çˆ¶äº²è¯´æŒ«æŒ«ä½ çš„é”æ°”çš„å®é™…ä½“ç°ã€‚</li><li>å¦‚æœæˆ‘æŒºä¸è¿‡æ¥æ›´ä¸è¦è¯´å®ç°è‡ªå·±çš„å¿—å‘äº†ï¼Œè™½ç„¶ç°åœ¨æ•´ä½“è¿˜æ²¡æœ‰è½®å»“ï¼Œä½†å·²ç»çœ‹åˆ°å®ƒå°±åœ¨é‚£äº†ã€‚</li><li>ä¸€æ¯é•¿å²›ä¸‹è‚šï¼Œè½¬èº«è·³è¿›è¥¿æ¹–ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;iframe frameborder=&quot;no&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;300&quot; height=&quot;50&quot; src=&quot;https://music.163.com/outchain/player?type=2&amp;id=12187
      
    
    </summary>
    
    
      <category term="Inspire" scheme="https://edward7zhang.github.io/tags/Inspire/"/>
    
  </entry>
  
  <entry>
    <title>è§£æSharePreferences</title>
    <link href="https://edward7zhang.github.io/2019/03/23/%E8%A7%A3%E6%9E%90SharePreferences/"/>
    <id>https://edward7zhang.github.io/2019/03/23/è§£æSharePreferences/</id>
    <published>2019-03-23T04:07:14.000Z</published>
    <updated>2019-03-23T13:08:40.971Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å½»åº•ææ‡‚-SharedPreferences"><a href="#å½»åº•ææ‡‚-SharedPreferences" class="headerlink" title="å½»åº•ææ‡‚ SharedPreferences"></a>å½»åº•ææ‡‚ SharedPreferences</h1><p>æˆ‘ä»¬çŸ¥é“ <code>SharedPreferences</code> ä¼šä»æ–‡ä»¶è¯»å– xml æ–‡ä»¶, å¹¶å°†å…¶ä»¥ <code>getXxx/putXxx</code> çš„å½¢å¼æä¾›è¯»å†™æœåŠ¡. å…¶ä¸­æ¶‰åŠåˆ°å¦‚ä¸‹å‡ ä¸ªé—®é¢˜:</p><ol><li>å¦‚ä½•ä»ç£ç›˜è¯»å–é…ç½®åˆ°å†…å­˜</li><li>getXxx å¦‚ä½•ä»å†…å­˜ä¸­è·å–é…ç½®</li><li>æœ€ç»ˆé…ç½®å¦‚ä½•ä»å†…å­˜å›å†™åˆ°ç£ç›˜</li><li>å¤šçº¿ç¨‹/å¤šè¿›ç¨‹æ˜¯å¦ä¼šæœ‰é—®é¢˜</li><li>æœ€ä½³å®è·µ</li></ol><h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><ul><li><code>SharedPreferences</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„. å†…éƒ¨ç”±å¤§é‡ <code>synchronized</code> å…³é”®å­—ä¿éšœ</li><li><code>SharedPreferences</code> <strong>ä¸æ˜¯è¿›ç¨‹å®‰å…¨çš„</strong></li><li>ç¬¬ä¸€æ¬¡ <code>getSharedPreferences</code> ä¼šè¯»å–ç£ç›˜æ–‡ä»¶, åç»­çš„ <code>getSharedPreferences</code> ä¼šä»å†…å­˜ç¼“å­˜ä¸­è·å–. å¦‚æœç¬¬ä¸€æ¬¡è°ƒç”¨ <code>getSharedPreferences</code> æ—¶è¿˜æ²¡ä»ç£ç›˜åŠ è½½å®Œæ¯•å°±è°ƒç”¨ getXxx/putXxx , åˆ™ getXxx/putXxx æ“ä½œä¼šå¡ä¸», ç›´åˆ°æ•°æ®ä»ç£ç›˜åŠ è½½å®Œæ¯•åè¿”å›</li><li>æ‰€æœ‰çš„ getXxx éƒ½æ˜¯ä»å†…å­˜ä¸­å–çš„æ•°æ®</li><li><code>apply</code> æ˜¯åŒæ­¥å›å†™å†…å­˜, ç„¶åæŠŠå¼‚æ­¥å›å†™ç£ç›˜çš„ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªå•çº¿ç¨‹çš„é˜Ÿåˆ—ä¸­ç­‰å¾…è°ƒåº¦. <code>commit</code> å’Œå‰è€…ä¸€æ ·, åªä¸è¿‡è¦ç­‰å¾…å¼‚æ­¥ç£ç›˜ä»»åŠ¡ç»“æŸåæ‰è¿”å›</li><li><code>MODE_MULTI_PROCESS</code> æ˜¯åœ¨æ¯æ¬¡ <code>getSharedPreferences</code> æ—¶æ£€æŸ¥ç£ç›˜ä¸Šé…ç½®æ–‡ä»¶ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´å’Œæ–‡ä»¶å¤§å°, ä¸€æ—¦æ‰€æœ‰ä¿®æ”¹åˆ™ä¼šé‡æ–°ä»ç£ç›˜åŠ è½½æ–‡ä»¶. æ‰€ä»¥å¹¶ä¸èƒ½ä¿è¯å¤šè¿›ç¨‹æ•°æ®çš„å®æ—¶åŒæ­¥</li><li>ä» Android N å¼€å§‹, ä¸å†æ”¯æŒ MODE_WORLD_READABLE &amp; MODE_WORLD_WRITEABLE. ä¸€æ—¦æŒ‡å®š, ä¼šæŠ›å¼‚å¸¸</li></ul><h1 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h1><ul><li>ä¸è¦å¤šè¿›ç¨‹ä½¿ç”¨, å¾ˆå°å‡ ç‡ä¼šé€ æˆæ•°æ®å…¨éƒ¨ä¸¢å¤±, ç°è±¡æ˜¯é…ç½®æ–‡ä»¶è¢«åˆ é™¤</li><li>ä¸è¦ä¾èµ– <code>MODE_MULTI_PROCESS</code>. è¿™ä¸ªæ ‡è®°å°±åƒ <code>MODE_WORLD_READABLE/MODE_WORLD_WRITEABLE</code> æœªæ¥ä¼šè¢«åºŸå¼ƒ</li><li>æ¯æ¬¡ <code>apply</code> / <code>commit</code> éƒ½ä¼šæŠŠå…¨éƒ¨çš„æ•°æ®ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜, æ‰€ä»¥å•ä¸ªçš„é…ç½®æ–‡ä»¶ä¸åº”è¯¥è¿‡å¤§, å½±å“æ•´ä½“æ€§èƒ½</li></ul><h1 id="æºç å…¨é¢åˆ†æ"><a href="#æºç å…¨é¢åˆ†æ" class="headerlink" title="æºç å…¨é¢åˆ†æ"></a>æºç å…¨é¢åˆ†æ</h1><p>ç°åœ¨æˆ‘ä»¬ä»æºç å…¥æ‰‹, å½»åº•ææ‡‚ <code>SharedPreferences</code> æœ‰å…³çš„æ‰€æœ‰é—®é¢˜. æœ¬æ–‡å¹¶ä¸æ˜¯å…¥é—¨æ•™ç¨‹, ä¸»è¦é¢å‘æœ‰ <code>SharedPreferences</code> åŸºç¡€çš„åŒå­¦</p><h3 id="SharedPreferences-å¯¹è±¡çš„è·å–"><a href="#SharedPreferences-å¯¹è±¡çš„è·å–" class="headerlink" title="SharedPreferences å¯¹è±¡çš„è·å–"></a>SharedPreferences å¯¹è±¡çš„è·å–</h3><p>ä¸€èˆ¬æ¥è¯´æœ‰å¦‚ä¸‹æ–¹å¼:<br>1. PreferenceManager.getDefaultSharedPreferences<br>2. ContextImpl.getSharedPreferences</p><p>æˆ‘ä»¬ä»¥ä¸Šè¿° [1] ä¸ºä¾‹æ¥çœ‹çœ‹æºç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// PreferenceManager.java</div><div class="line">public static SharedPreferences getDefaultSharedPreferences(Context context) &#123;</div><div class="line">    return context.getSharedPreferences(getDefaultSharedPreferencesName(context),</div><div class="line">            getDefaultSharedPreferencesMode());</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¸Šè¿°æ— è®ºé‚£ç§æ–¹æ³•, æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨åˆ°äº† <code>ContextImpl.getSharedPreferences</code>. æºç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// ContextImpl.java</div><div class="line">public SharedPreferences getSharedPreferences(File file, int mode) &#123;</div><div class="line">    checkMode(mode);</div><div class="line">    SharedPreferencesImpl sp;</div><div class="line">    synchronized (ContextImpl.class) &#123;</div><div class="line">        final ArrayMap&amp;lt;File, SharedPreferencesImpl&amp;gt; cache = getSharedPreferencesCacheLocked();</div><div class="line">        sp = cache.get(file);</div><div class="line">        if (sp == null) &#123;</div><div class="line">            sp = new SharedPreferencesImpl(file, mode);</div><div class="line">            cache.put(file, sp);</div><div class="line">            return sp;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    if ((mode &amp;amp; Context.MODE_MULTI_PROCESS) != 0 ||</div><div class="line">        getApplicationInfo().targetSdkVersion &amp;lt; android.os.Build.VERSION_CODES.HONEYCOMB) &#123;</div><div class="line">        // If somebody else (some other process) changed the prefs</div><div class="line">        // file behind our back, we reload it.  This has been the</div><div class="line">        // historical (if undocumented) behavior.</div><div class="line">        sp.startReloadIfChangedUnexpectedly();</div><div class="line">    &#125;</div><div class="line">    return sp;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¯è§ sdk æ˜¯å…ˆå–äº†ç¼“å­˜, å¦‚æœç¼“å­˜æœªå‘½ä¸­, æ‰æ„é€ å¯¹è±¡. ä¹Ÿå°±æ˜¯è¯´, <strong>å¤šæ¬¡ <code>getSharedPreferences</code> å‡ ä¹æ˜¯æ²¡æœ‰ä»£ä»·çš„</strong>. åŒæ—¶, å®ä¾‹çš„æ„é€ è¢« <code>synchronized</code> å…³é”®å­—åŒ…è£¹, å› æ­¤æ„é€ è¿‡ç¨‹æ˜¯å¤šçº¿ç¨‹å®‰å…¨çš„</p><h3 id="SharedPreferences-çš„æ„é€ "><a href="#SharedPreferences-çš„æ„é€ " class="headerlink" title="SharedPreferences çš„æ„é€ "></a>SharedPreferences çš„æ„é€ </h3><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ç¬¬ä¸€æ¬¡æ„å»ºå¯¹è±¡æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">SharedPreferencesImpl(File file, int mode) &#123;</div><div class="line">    mFile = file;</div><div class="line">    mBackupFile = makeBackupFile(file);</div><div class="line">    mMode = mode;</div><div class="line">    mLoaded = false;</div><div class="line">    mMap = null;</div><div class="line">    startLoadFromDisk();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æœ‰è¿™ä¹ˆå‡ ä¸ªå…³é”®ä¿¡æ¯:</p><ol><li><code>mFile</code> ä»£è¡¨æˆ‘ä»¬ç£ç›˜ä¸Šçš„é…ç½®æ–‡ä»¶</li><li><code>mBackupFile</code> æ˜¯ä¸€ä¸ªç¾å¤‡æ–‡ä»¶, ç”¨æˆ·å†™å…¥å¤±è´¥æ—¶è¿›è¡Œæ¢å¤, åé¢ä¼šå†è¯´. å…¶è·¯å¾„æ˜¯ <code>mFile</code> åŠ åç¼€ â€˜.bakâ€™</li><li><code>mMap</code> ç”¨äºåœ¨å†…å­˜ä¸­ç¼“å­˜æˆ‘ä»¬çš„é…ç½®æ•°æ®, ä¹Ÿå°±æ˜¯ <code>getXxx</code> æ•°æ®çš„æ¥æº</li></ol><p>è¿˜æ¶‰åŠåˆ°ä¸€ä¸ª <code>startLoadFromDisk</code>, æˆ‘ä»¬æ¥çœ‹çœ‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">private void startLoadFromDisk() &#123;</div><div class="line">    synchronized (this) &#123;</div><div class="line">        mLoaded = false;</div><div class="line">    &#125;</div><div class="line">    new Thread(&amp;quot;SharedPreferencesImpl-load&amp;quot;) &#123;</div><div class="line">        public void run() &#123;</div><div class="line">            loadFromDisk();</div><div class="line">        &#125;</div><div class="line">    &#125;.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¼€å¯äº†ä¸€ä¸ªçº¿ç¨‹ä»æ–‡ä»¶è¯»å–, å…¶æºç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">private void loadFromDisk() &#123;</div><div class="line">    synchronized (SharedPreferencesImpl.this) &#123;</div><div class="line">        if (mLoaded) &#123;</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        if (mBackupFile.exists()) &#123;</div><div class="line">            mFile.delete();</div><div class="line">            mBackupFile.renameTo(mFile);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ... ç•¥å»æ— å…³ä»£ç  ...</div><div class="line"></div><div class="line">    str = new BufferedInputStream(</div><div class="line">            new FileInputStream(mFile), 16*1024);</div><div class="line">    map = XmlUtils.readMapXml(str);</div><div class="line"></div><div class="line">    synchronized (SharedPreferencesImpl.this) &#123;</div><div class="line">        mLoaded = true;</div><div class="line">        if (map != null) &#123;</div><div class="line">            mMap = map;</div><div class="line">            mStatTimestamp = stat.st_mtime;</div><div class="line">            mStatSize = stat.st_size;</div><div class="line">        &#125; else &#123;</div><div class="line">            mMap = new HashMap&amp;lt;&amp;gt;();</div><div class="line">        &#125;</div><div class="line">        notifyAll();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><code>loadFromDisk</code> è¿™ä¸ªå‡½æ•°å¾ˆå…³é”®. å®ƒå°±æ˜¯å®é™…ä»ç£ç›˜è¯»å–é…ç½®æ–‡ä»¶çš„å‡½æ•°. å¯è§, å®ƒåšäº†å¦‚ä¸‹å‡ ä»¶äº‹:</p><ol><li>å¦‚æœæœ‰ â€˜ç¾å¤‡â€™ æ–‡ä»¶, åˆ™ç›´æ¥ä½¿ç”¨ç¾å¤‡æ–‡ä»¶å›æ»š.</li><li>æŠŠé…ç½®ä»ç£ç›˜è¯»å–åˆ°å†…å­˜çš„å¹¶ä¿å­˜åœ¨ <code>mMap</code> å­—æ®µä¸­(çœ‹ä»£ç æœ€å <code>mMap = map</code>)</li><li>æ ‡è®°è¯»å–å®Œæˆ, è¿™ä¸ªå­—æ®µåé¢ <code>awaitLoadedLocked</code> ä¼šç”¨åˆ°. è®°å½•è¯»å–æ–‡ä»¶çš„æ—¶é—´, åé¢ <code>MODE_MULTI_PROCESS</code> ä¸­ä¼šç”¨åˆ°</li><li>å‘ä¸€ä¸ª <code>notifyAll</code> é€šçŸ¥å·²ç»è¯»å–å®Œæ¯•, æ¿€æ´»æ‰€æœ‰ç­‰å¾…åŠ è½½çš„å…¶ä»–çº¿ç¨‹</li></ol><p>æ€»ç»“ä¸€ä¸‹:</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/23/5c962fa2af626.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="getXxx-çš„æµç¨‹"><a href="#getXxx-çš„æµç¨‹" class="headerlink" title="getXxx çš„æµç¨‹"></a>getXxx çš„æµç¨‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">public String getString(String key, @Nullable String defValue) &#123;</div><div class="line">    synchronized (this) &#123;</div><div class="line">        awaitLoadedLocked();</div><div class="line">        String v = (String)mMap.get(key);</div><div class="line">        return v != null ? v : defValue;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¯è§, æ‰€æœ‰çš„ <strong>get æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>. å¹¶ä¸” get ä»…ä»…æ˜¯ä»å†…å­˜ä¸­(<code>mMap</code>) è·å–æ•°æ®, æ‰€ä»¥<strong>æ— æ€§èƒ½é—®é¢˜</strong>.</p><p>è€ƒè™‘åˆ° <em>é…ç½®æ–‡ä»¶çš„åŠ è½½</em> æ˜¯åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¼‚æ­¥è¿›è¡Œçš„(å‚è€ƒ â€˜SharedPreferences çš„æ„é€ â€™), æ‰€ä»¥è¿™é‡Œçš„ <code>awaitLoadedLocked</code> æ˜¯åœ¨ç­‰å¾…é…ç½®æ–‡ä»¶åŠ è½½å®Œæ¯•. ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ„é€  SharedPreferences åå°±ç«‹åˆ»è°ƒç”¨ getXxx æ–¹æ³•, å¾ˆæœ‰å¯èƒ½è¯»å–é…ç½®æ–‡ä»¶çš„çº¿ç¨‹è¿˜æœªå®Œæˆ, æ‰€ä»¥è¿™é‡Œè¦ç­‰å¾…è¯¥çº¿ç¨‹åšå®Œç›¸åº”çš„åŠ è½½å·¥ä½œ. æ¥çœ‹çœ‹ <code>awaitLoadedLocked</code> çš„æºç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java private void awaitLoadedLocked() &#123; if (!mLoaded) &#123; // Raise an explicit StrictMode onReadFromDisk for this // thread, since the real read will be in a different // thread and otherwise ignored by StrictMode. BlockGuard.getThreadPolicy().onReadFromDisk();</div><div class="line">    &#125; while (!mLoaded) &#123; try &#123; wait(); &#125; catch (InterruptedException unused) &#123; &#125; &#125; &#125;</div></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾, å¦‚æœåŠ è½½è¿˜æœªå®Œæˆ(<code>mLoaded == false</code>), getXxx ä¼šå¡åœ¨ <code>awaitLoadedLocked</code>, ä¸€æ—¦åŠ è½½é…ç½®æ–‡ä»¶çš„çº¿ç¨‹å·¥ä½œå®Œæ¯•, åˆ™è¿™ä¸ªåŠ è½½çº¿ç¨‹ä¼šé€šè¿‡ <code>notifyAll</code> ä¼šé€šçŸ¥æ‰€æœ‰åœ¨ <code>awaitLoadedLocked</code> ä¸­ç­‰å¾…çš„çº¿ç¨‹, getXxx å°±èƒ½å¤Ÿè¿”å›äº†. ä¸è¿‡å¤§éƒ¨åˆ†æƒ…å†µä¸‹, <code>mLoaded == true</code>. è¿™æ ·çš„è¯ <code>awaitLoadedLocked</code> ä¼šç›´æ¥è¿”å›</p><h3 id="putXxx-çš„æµç¨‹"><a href="#putXxx-çš„æµç¨‹" class="headerlink" title="putXxx çš„æµç¨‹"></a>putXxx çš„æµç¨‹</h3><p>set æ¯” get ç¨å¾®éº»çƒ¦ä¸€ç‚¹å„¿, å› ä¸ºæ¶‰åŠåˆ° <code>Editor</code> å’Œ <code>MemoryCommitResult</code> å¯¹è±¡</p><p>å…ˆæ¥çœ‹çœ‹ <code>edit()</code> æ–¹æ³•çš„å®ç°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">public Editor edit() &#123;</div><div class="line">    // TODO: remove the need to call awaitLoadedLocked() when</div><div class="line">    // requesting an editor.  will require some work on the</div><div class="line">    // Editor, but then we should be able to do:</div><div class="line">    //</div><div class="line">    //      context.getSharedPreferences(..).edit().putString(..).apply()</div><div class="line">    //</div><div class="line">    // ... all without blocking.</div><div class="line">    synchronized (this) &#123;</div><div class="line">        awaitLoadedLocked();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return new EditorImpl();</div><div class="line">&#125;</div></pre></td></tr></table></figure><h6 id="Editor"><a href="#Editor" class="headerlink" title="Editor"></a>Editor</h6><p><code>Editor</code> æ²¡æœ‰æ„é€ å‡½æ•°, åªæœ‰ä¸¤ä¸ªå±æ€§è¢«åˆå§‹åŒ–:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">public final class EditorImpl implements Editor &#123;</div><div class="line">    private final Map&amp;lt;String, Object&amp;gt; mModified = Maps.newHashMap();</div><div class="line">    private boolean mClear = false;</div><div class="line"></div><div class="line">    ... ç•¥å»æ–¹æ³•å®šä¹‰ ...</div><div class="line">    public Editor putString(String key, @Nullable String value) &#123; ... &#125;</div><div class="line">    public boolean commit() &#123; ... &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><code>mModified</code> æ˜¯æˆ‘ä»¬æ¯æ¬¡ putXxx åæ‰€æ”¹å˜çš„é…ç½®é¡¹</li><li><code>mClear</code> æ ‡è¯†è¦æ¸…ç©ºé…ç½®é¡¹, ä½†æ˜¯åªæ¸…äº† <code>SharedPreferences.mMap</code>. æ‰€ä»¥ä¸è¦å†™è¿™æ ·çš„æ„šè ¢ä»£ç :</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sharedPreferences.edit()</div><div class="line">        .putBoolean(&amp;quot;foo&amp;quot;, true)        // foo æ— æ³•è¢« clear æ‰</div><div class="line">        .clear()</div><div class="line">        .putBoolean(&amp;quot;bar&amp;quot;, true)</div><div class="line">        .commit()</div></pre></td></tr></table></figure><p><code>edit()</code> ä¼šä¿éšœé…ç½®å·²ä»ç£ç›˜è¯»å–å®Œæ¯•, ç„¶åä»…ä»…åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡. æ¥ä¸‹æ¥çœ‹çœ‹ <code>putXxx</code> çš„çœŸèº«:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">public Editor putString(String key, @Nullable String value) &#123;</div><div class="line">    synchronized (this) &#123;</div><div class="line">        mModified.put(key, value);</div><div class="line">        return this;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¾ˆç®€å•, ä»…ä»…æ˜¯æŠŠæˆ‘ä»¬è®¾ç½®çš„é…ç½®é¡¹æ”¾åˆ°äº† <code>mModified</code> å±æ€§é‡Œä¿å­˜. ç­‰åˆ° <code>apply</code> æˆ–è€… <code>commit</code> çš„æ—¶å€™å›å†™åˆ°å†…å­˜å’Œç£ç›˜. å’±ä»¬åˆ†åˆ«æ¥çœ‹çœ‹</p><h6 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h6><p>apply æ˜¯å„ç§ â€˜æœ€ä½³å®è·µâ€™ æ¨èçš„æ–¹å¼, é‚£ä¹ˆå®ƒåˆ°åº•æ˜¯æ€ä¹ˆå¼‚æ­¥å·¥ä½œçš„å‘¢? æˆ‘ä»¬æ¥çœ‹ä¸ªç©¶ç«Ÿ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">public void apply() &#123;</div><div class="line">    final MemoryCommitResult mcr = commitToMemory();</div><div class="line">    final Runnable awaitCommit = new Runnable() &#123;</div><div class="line">            public void run() &#123;</div><div class="line">                try &#123;</div><div class="line">                    mcr.writtenToDiskLatch.await();</div><div class="line">                &#125; catch (InterruptedException ignored) &#123;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">    QueuedWork.add(awaitCommit);</div><div class="line"></div><div class="line">    Runnable postWriteRunnable = new Runnable() &#123;</div><div class="line">            public void run() &#123;</div><div class="line">                awaitCommit.run();</div><div class="line">                QueuedWork.remove(awaitCommit);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">    SharedPreferencesImpl.this.enqueueDiskWrite(mcr, postWriteRunnable);</div><div class="line"></div><div class="line">    // Okay to notify the listeners before it&amp;#039;s hit disk</div><div class="line">    // because the listeners should always get the same</div><div class="line">    // SharedPreferences instance back, which has the</div><div class="line">    // changes reflected in memory.</div><div class="line">    notifyListeners(mcr);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºå¤§è‡´çš„è„‰ç»œ:</p><ol><li><code>commitToMemory</code> åº”è¯¥æ˜¯æŠŠä¿®æ”¹çš„é…ç½®é¡¹å›å†™åˆ°å†…å­˜</li><li><code>QueuedWork.add(awaitCommit)</code> è²Œä¼¼æ²¡ä»€ä¹ˆåµç”¨</li><li><code>SharedPreferencesImpl.this.enqueueDiskWrite</code> æŠŠé…ç½®é¡¹åŠ å…¥åˆ°ä¸€ä¸ªå¼‚æ­¥é˜Ÿåˆ—ä¸­, ç­‰å¾…è°ƒåº¦</li></ol><p>æˆ‘ä»¬æ¥çœ‹çœ‹ <code>commitToMemory</code> çš„å®ç°(ç•¥å»å¤§é‡æ— å…³ä»£ç ):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">private MemoryCommitResult commitToMemory() &#123;</div><div class="line">    MemoryCommitResult mcr = new MemoryCommitResult();</div><div class="line">    synchronized (SharedPreferencesImpl.this) &#123;</div><div class="line"></div><div class="line">        ... ç•¥å»æ— å…³ ...</div><div class="line"></div><div class="line">        mcr.mapToWriteToDisk = mMap;</div><div class="line">        mDiskWritesInFlight++;</div><div class="line"></div><div class="line">        synchronized (this) &#123;</div><div class="line">            for (Map.Entry&amp;lt;String, Object&amp;gt; e : mModified.entrySet()) &#123;</div><div class="line">                String k = e.getKey();</div><div class="line">                Object v = e.getValue();</div><div class="line">                // &amp;quot;this&amp;quot; is the magic value for a removal mutation. In addition,</div><div class="line">                // setting a value to &amp;quot;null&amp;quot; for a given key is specified to be</div><div class="line">                // equivalent to calling remove on that key.</div><div class="line">                if (v == this || v == null) &#123;</div><div class="line">                    mMap.remove(k);</div><div class="line">                &#125; else &#123;</div><div class="line">                    mMap.put(k, v);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            mModified.clear();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return mcr;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>æ€»ç»“æ¥è¯´å°±ä¸¤ä»¶äº‹:<br>1. æŠŠ <code>Editor.mModified</code> ä¸­çš„é…ç½®é¡¹å›å†™åˆ° <code>SharedPreferences.mMap</code> ä¸­, å®Œæˆäº†å†…å­˜çš„åŒæ­¥<br>2. æŠŠ <code>SharedPreferences.mMap</code> ä¿å­˜åœ¨äº† <code>mcr.mapToWriteToDisk</code> ä¸­. è€Œåè€…å°±æ˜¯å³å°†è¦å›å†™åˆ°ç£ç›˜çš„æ•°æ®æº</p><p>æˆ‘ä»¬å†æ¥å›å¤´çœ‹çœ‹ <code>apply</code> æ–¹æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">public void apply() &#123;</div><div class="line">    final MemoryCommitResult mcr = commitToMemory();</div><div class="line"></div><div class="line">    ... ç•¥æ— å…³ ...</div><div class="line"></div><div class="line">    SharedPreferencesImpl.this.enqueueDiskWrite(mcr, postWriteRunnable);</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><code>commitToMemory</code> å®Œæˆäº†å†…å­˜çš„åŒæ­¥å›å†™</li><li><code>enqueueDiskWrite</code> å®Œæˆäº†ç¡¬ç›˜çš„å¼‚æ­¥å›å†™, æˆ‘ä»¬æ¥ä¸‹æ¥å…·ä½“çœ‹çœ‹</li></ul><h6 id="enqueueDiskWrite"><a href="#enqueueDiskWrite" class="headerlink" title="enqueueDiskWrite"></a>enqueueDiskWrite</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">private void enqueueDiskWrite(final MemoryCommitResult mcr,</div><div class="line">                                final Runnable postWriteRunnable) &#123;</div><div class="line">    final Runnable writeToDiskRunnable = new Runnable() &#123;</div><div class="line">            public void run() &#123;</div><div class="line">                synchronized (mWritingToDiskLock) &#123;</div><div class="line">                    writeToFile(mcr);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                ...</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    QueuedWork.singleThreadExecutor().execute(writeToDiskRunnable);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><code>QueuedWork.singleThreadExecutor</code> å®é™…ä¸Šå°±æ˜¯ â€˜ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± â€™, å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// QueuedWork.java</div><div class="line">public static ExecutorService singleThreadExecutor() &#123;</div><div class="line">    synchronized (QueuedWork.class) &#123;</div><div class="line">        if (sSingleThreadExecutor == null) &#123;</div><div class="line">            // TODO: can we give this single thread a thread name?</div><div class="line">            sSingleThreadExecutor = Executors.newSingleThreadExecutor();</div><div class="line">        &#125;</div><div class="line">        return sSingleThreadExecutor;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡º google å·¥ç¨‹å¸ˆè¿™é‡Œè¿˜ç•™äº†ä¸€ä¸ª todo, æƒ³è¦ç»™è¿™ä¸ªä¸“é—¨è´Ÿè´£å‘ç£ç›˜åŒæ­¥é…ç½®é¡¹çš„çº¿ç¨‹èµ·ä¸€ä¸ªåå­—. è¿™é‡Œåç­‰å¤§ç¥ä½ ç»™ google æä¸ª pr</p><p>å›åˆ° <code>enqueueDiskWrite</code> ä¸­, è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å‡½æ•°å«åš <code>writeToFile</code>:</p><h6 id="writeToFile"><a href="#writeToFile" class="headerlink" title="writeToFile"></a>writeToFile</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">private void writeToFile(MemoryCommitResult mcr) &#123;</div><div class="line">    // Rename the current file so it may be used as a backup during the next read</div><div class="line">    if (mFile.exists()) &#123;</div><div class="line">        if (!mBackupFile.exists()) &#123;</div><div class="line">            if (!mFile.renameTo(mBackupFile)) &#123;</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            mFile.delete();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // Attempt to write the file, delete the backup and return true as atomically as</div><div class="line">    // possible.  If any exception occurs, delete the new file; next time we will restore</div><div class="line">    // from the backup.</div><div class="line">    try &#123;</div><div class="line">        FileOutputStream str = createFileOutputStream(mFile);</div><div class="line">        XmlUtils.writeMapXml(mcr.mapToWriteToDisk, str);</div><div class="line">        ContextImpl.setFilePermissionsFromMode(mFile.getPath(), mMode, 0);</div><div class="line">        try &#123;</div><div class="line">            final StructStat stat = Os.stat(mFile.getPath());</div><div class="line">                mStatTimestamp = stat.st_mtime;</div><div class="line">                mStatSize = stat.st_size;</div><div class="line">        &#125;</div><div class="line">        // Writing was successful, delete the backup file if there is one.</div><div class="line">        mBackupFile.delete();</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // Clean up an unsuccessfully written file</div><div class="line">    mFile.delete();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä»£ç å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹:<br>1. å…ˆæŠŠå·²å­˜åœ¨çš„è€çš„é…ç½®æ–‡ä»¶é‡å‘½å(åŠ  â€˜.bakâ€™ åç¼€), ç„¶ååˆ é™¤è€çš„é…ç½®æ–‡ä»¶. è¿™ç›¸å½“äºåšäº†ç¾å¤‡<br>2. å‘ <code>mFile</code> ä¸­ä¸€æ¬¡æ€§å†™å…¥æ‰€æœ‰é…ç½®é¡¹. å³ <code>mcr.mapToWriteToDisk</code>(è¿™å°±æ˜¯ <code>commitToMemory</code> æ‰€è¯´çš„ä¿å­˜äº†æ‰€æœ‰é…ç½®é¡¹çš„å­—æ®µ) ä¸€æ¬¡æ€§å†™å…¥åˆ°ç£ç›˜. å¦‚æœå†™å…¥æˆåŠŸåˆ™åˆ é™¤ç¾å¤‡æ–‡ä»¶, åŒæ—¶è®°å½•äº†è¿™æ¬¡åŒæ­¥çš„æ—¶é—´<br>3. å¦‚æœä¸Šè¿°è¿‡ç¨‹ [2] å¤±è´¥, åˆ™åˆ é™¤è¿™ä¸ªåŠæˆå“çš„é…ç½®æ–‡ä»¶</p><p>å¥½äº†, æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ <code>apply</code>:<br>1. é€šè¿‡ <code>commitToMemory</code> å°†ä¿®æ”¹çš„é…ç½®é¡¹åŒæ­¥å›å†™åˆ°å†…å­˜ <code>SharedPreferences.mMap</code> ä¸­. æ­¤æ—¶, ä»»ä½•çš„ getXxx éƒ½å¯ä»¥è·å–åˆ°æœ€æ–°æ•°æ®äº†<br>2. é€šè¿‡ <code>enqueueDiskWrite</code> è°ƒç”¨ <code>writeToFile</code> å°†æ‰€æœ‰é…ç½®é¡¹ä¸€æ¬¡æ€§å¼‚æ­¥å›å†™åˆ°ç£ç›˜. è¿™æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± </p><p>æ¥çœ‹ä¸ªæ—¶åºå›¾å‹å‹æƒŠ(<a href="https://link.juejin.im/?target=http%3A%2F%2Fandroid.walfud.com%2Fwp-content%2Fuploads%2F2017%2F07%2Fapply.png" target="_blank" rel="external">ç‚¹å‡»å¤§å›¾</a>):</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://user-gold-cdn.xitu.io/2017/7/24/a1918098002429beac3c2c3f52d70fce?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h6 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h6><p>çœ‹è¿‡äº† <code>apply</code> å†çœ‹ <code>commit</code> å°±éå¸¸å®¹æ˜“äº†.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// SharedPreferencesImpl.java</div><div class="line">public boolean commit() &#123;</div><div class="line">    MemoryCommitResult mcr = commitToMemory();</div><div class="line">    SharedPreferencesImpl.this.enqueueDiskWrite(</div><div class="line">        mcr, null /* sync write on this thread okay */);</div><div class="line">    try &#123;</div><div class="line">        mcr.writtenToDiskLatch.await();</div><div class="line">    &#125; catch (InterruptedException e) &#123;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    notifyListeners(mcr);</div><div class="line">    return mcr.writeToDiskResult;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ç›´æ¥çœ‹æ—¶åºå›¾å§(<a href="https://link.juejin.im/?target=http%3A%2F%2Fandroid.walfud.com%2Fwp-content%2Fuploads%2F2017%2F07%2Fcommit.png" target="_blank" rel="external">ç‚¹å‡»å¤§å›¾</a>):</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://user-gold-cdn.xitu.io/2017/7/24/ab15dd8a3af142fe7c092903381c87e4?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>åªéœ€å…³æ³¨æœ€åä¸€æ¡ â€˜ç­‰å¾…å¼‚æ­¥ä»»åŠ¡è¿”å›â€™ çš„çº¿, å¯¹æ¯” <code>apply</code> çš„æ—¶åºå›¾, ä¸€çœ¼å°±çœ‹å‡ºå·®åˆ«</p><h6 id="registerOnSharedPreferenceChangeListener"><a href="#registerOnSharedPreferenceChangeListener" class="headerlink" title="registerOnSharedPreferenceChangeListener"></a>registerOnSharedPreferenceChangeListener</h6><p>æœ€åéœ€è¦æä¸€ä¸‹çš„å°±æ˜¯ listener:</p><ul><li>å¯¹äº <code>apply</code>, listener å›è°ƒæ—¶å†…å­˜å·²ç»å®ŒæˆåŒæ­¥, ä½†æ˜¯å¼‚æ­¥ç£ç›˜ä»»åŠ¡ä¸ä¿è¯æ˜¯å¦å®Œæˆ</li><li>å¯¹äº <code>commit</code>, listener å›è°ƒæ—¶å†…å­˜å’Œç£ç›˜éƒ½å·²ç»åŒæ­¥å®Œæ¯•</li></ul><h1 id="å„ç§æ ‡è®°çš„ä½œç”¨"><a href="#å„ç§æ ‡è®°çš„ä½œç”¨" class="headerlink" title="å„ç§æ ‡è®°çš„ä½œç”¨"></a>å„ç§æ ‡è®°çš„ä½œç”¨</h1><h3 id="MODE-PRIVATE-MODE-WORLD-READABLE-MODE-WORLD-WRITEABLE"><a href="#MODE-PRIVATE-MODE-WORLD-READABLE-MODE-WORLD-WRITEABLE" class="headerlink" title="MODE_PRIVATE/MODE_WORLD_READABLE/MODE_WORLD_WRITEABLE:"></a>MODE_PRIVATE/MODE_WORLD_READABLE/MODE_WORLD_WRITEABLE:</h3><p>æŒ‡çš„æ˜¯, åœ¨ä¿å­˜æ–‡ä»¶çš„æ—¶å€™è®¾ç½®çš„æ–‡ä»¶å±æ€§. PRIVATE å°±åªæœ‰è‡ªå·±å’Œæ‰€å±ç»„çš„è¯»å†™æƒé™, READABLE/WRITEABLE æ˜¯å¯¹ other ç”¨æˆ·å’Œç»„çš„è¯»å†™æƒé™. ä¸»è¦æºç ä½äº: FileUtils.setPermissions</p><h3 id="MODE-MULTI-PROCESS"><a href="#MODE-MULTI-PROCESS" class="headerlink" title="MODE_MULTI_PROCESS:"></a>MODE_MULTI_PROCESS:</h3><p>é˜…è¯»è¿‡æœ¬æ–‡çš„è¯ä½ ä¼šçŸ¥é“, ä¸€ä¸ª prefs å®ä¾‹é€šå¸¸æœ‰ä¸¤ç§è·å¾—é€”å¾„, ä¸€ä¸ªæ˜¯ç¬¬ä¸€æ¬¡è¢« new åˆ›å»ºå‡ºæ¥çš„, è¿™ç§æ–¹å¼ä¼šå®é™…çš„è¯»å–ç£ç›˜æ–‡ä»¶. è¿˜ä¸€ç§æ˜¯åç»­ä»ç¼“å­˜(sSharedPrefsCache) ä¸­å–å‡ºæ¥äº†.</p><p>è€Œè¿™ä¸ªæ ‡è®°çš„æ„æ€å°±æ˜¯: ä½¿ç”¨ getSharedPrefercences è·å–å®ä¾‹æ—¶, æ— è®ºæ˜¯ä»ç£ç›˜è¯»æ–‡ä»¶æ„é€ å¯¹è±¡è¿˜æ˜¯ä»ç¼“å­˜è·å–, éƒ½ä¼šæ£€æŸ¥å®ä¾‹çš„ â€˜å†…å­˜ä¸­ä¿å­˜çš„æ—¶é—´â€™ å’Œ â€˜ç£ç›˜ä¸Šæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´â€™, å¦‚æœå†…å­˜ä¸­ä¿å­˜çš„æ—¶é—´å’Œç£ç›˜ä¸Šæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´, åˆ™é‡æ–°åŠ è½½æ–‡ä»¶. å¯ä»¥è®¤ä¸ºå¦‚æœå®ä¾‹æ˜¯ä»ç£ç›˜è¯»å–æ„é€ å‡ºæ¥çš„, é‚£ä¹ˆä»–çš„ â€˜å†…å­˜ä¸­ä¿å­˜çš„æ—¶é—´â€™ å’Œ â€˜æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´â€™ ä¸€å®šæ˜¯ä¸€æ ·çš„, è€Œä»ç¼“å­˜ä¸­æ¥çš„å®ä¾‹å°±ä¸ä¸€æ ·äº†, å› ä¸ºå®ƒå¯èƒ½å¾ˆæ—©å°±è¢«åˆ›å»º(é‚£ä¸ªæ—¶å€™å°±å·²ç»è¯»å–äº†ç£ç›˜çš„æ–‡ä»¶å¹¶è®°å½•äº†å½“æ—¶æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´), åœ¨éšåçš„æœŸé—´é‡Œå…¶ä»–è¿›ç¨‹å¾ˆå¯èƒ½ä¿®æ”¹è¿‡ç£ç›˜ä¸Šçš„é…ç½®æ–‡ä»¶å¯¼è‡´æœ€åä¿®æ”¹æ—¶é—´å˜åŒ–, è¿™æ—¶å€™å½“æˆ‘ä»¬ä»ç¼“å­˜ä¸­å†æ¬¡è·å–è¿™ä¸ªå®ä¾‹çš„æ—¶å€™, ç³»ç»Ÿä¼šå¸®ä½ æ£€æŸ¥è¿™ä¸ªæ–‡ä»¶åœ¨è¿™æ®µæ—¶é—´æ˜¯å¦è¢«ä¿®æ”¹è¿‡(â€˜å†…å­˜ä¸­ä¿å­˜çš„æ—¶é—´â€™ å’Œ â€˜ç£ç›˜ä¸Šæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´â€™ æ˜¯å¦ä¸€è‡´), å¦‚æœè¢«ä¿®æ”¹è¿‡, åˆ™é‡æ–°ä»ç£ç›˜è¯»å–é…ç½®æ–‡ä»¶, ä¿è¯è·å–å®ä¾‹çš„å†…å®¹æ˜¯æœ€æ–°çš„.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å½»åº•ææ‡‚-SharedPreferences&quot;&gt;&lt;a href=&quot;#å½»åº•ææ‡‚-SharedPreferences&quot; class=&quot;headerlink&quot; title=&quot;å½»åº•ææ‡‚ SharedPreferences&quot;&gt;&lt;/a&gt;å½»åº•ææ‡‚ SharedPreferenc
      
    
    </summary>
    
    
      <category term="Android" scheme="https://edward7zhang.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>è¯´23ç§è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿè¯´ç®—æ³•ä¸æ•°æ®ç»“æ„</title>
    <link href="https://edward7zhang.github.io/2019/03/19/%E8%AF%B423%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%8C%E4%B9%9F%E8%AF%B4%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <id>https://edward7zhang.github.io/2019/03/19/è¯´23ç§è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿè¯´ç®—æ³•ä¸æ•°æ®ç»“æ„/</id>
    <published>2019-03-19T04:07:14.000Z</published>
    <updated>2019-03-20T08:26:56.490Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ</h1><p> è®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€‚ æ¯«æ— ç–‘é—®ï¼Œè®¾è®¡æ¨¡å¼äºå·±äºä»–äººäºç³»ç»Ÿéƒ½æ˜¯å¤šèµ¢çš„ï¼Œè®¾è®¡æ¨¡å¼ä½¿ä»£ç ç¼–åˆ¶çœŸæ­£å·¥ç¨‹åŒ–ï¼Œè®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹çš„åŸºçŸ³ï¼Œå¦‚åŒå¤§å¦çš„ä¸€å—å—ç –çŸ³ä¸€æ ·ã€‚é¡¹ç›®ä¸­åˆç†çš„è¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥å®Œç¾çš„è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯ç§æ¨¡å¼åœ¨ç°åœ¨ä¸­éƒ½æœ‰ç›¸åº”çš„åŸç†æ¥ä¸ä¹‹å¯¹åº”ï¼Œæ¯ä¸€ä¸ªæ¨¡å¼æè¿°äº†ä¸€ä¸ªåœ¨æˆ‘ä»¬å‘¨å›´ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯å®ƒèƒ½è¢«å¹¿æ³›åº”ç”¨çš„åŸå› ã€‚ç®€å•è¯´ï¼š</p><p><strong>æ¨¡å¼ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œé’ˆå¯¹æŸç±»é—®é¢˜çš„æŸç§é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</strong></p><p>åœºæ™¯ï¼šé¡¹ç›®æ‰€åœ¨çš„ç¯å¢ƒ</p><p>é—®é¢˜ï¼šçº¦æŸæ¡ä»¶ï¼Œé¡¹ç›®ç›®æ ‡ç­‰</p><p>è§£å†³æ–¹æ¡ˆï¼šé€šç”¨ã€å¯å¤ç”¨çš„è®¾è®¡ï¼Œè§£å†³çº¦æŸè¾¾åˆ°ç›®æ ‡ã€‚</p><h1 id="è®¾è®¡æ¨¡å¼çš„ä¸‰ä¸ªåˆ†ç±»"><a href="#è®¾è®¡æ¨¡å¼çš„ä¸‰ä¸ªåˆ†ç±»" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„ä¸‰ä¸ªåˆ†ç±»"></a>è®¾è®¡æ¨¡å¼çš„ä¸‰ä¸ªåˆ†ç±»</h1><p> <strong>åˆ›å»ºå‹æ¨¡å¼ï¼šå¯¹è±¡å®ä¾‹åŒ–çš„æ¨¡å¼ï¼Œåˆ›å»ºå‹æ¨¡å¼ç”¨äºè§£è€¦å¯¹è±¡çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€‚</strong></p><p><strong>ç»“æ„å‹æ¨¡å¼ï¼šæŠŠç±»æˆ–å¯¹è±¡ç»“åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªæ›´å¤§çš„ç»“æ„ã€‚</strong></p><p><strong>è¡Œä¸ºå‹æ¨¡å¼ï¼šç±»å’Œå¯¹è±¡å¦‚ä½•äº¤äº’ï¼ŒåŠåˆ’åˆ†è´£ä»»å’Œç®—æ³•ã€‚</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/19/5c9089a16c426.png" alt="è®¾è®¡æ¨¡å¼.png" title="">                </div>                <div class="image-caption">è®¾è®¡æ¨¡å¼.png</div>            </figure><h1 id="æ¦‚è¯´-23-ç§è®¾è®¡æ¨¡å¼"><a href="#æ¦‚è¯´-23-ç§è®¾è®¡æ¨¡å¼" class="headerlink" title="æ¦‚è¯´ 23 ç§è®¾è®¡æ¨¡å¼"></a>æ¦‚è¯´ 23 ç§è®¾è®¡æ¨¡å¼</h1><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p> å•ä¾‹æ¨¡å¼ï¼Œå®ƒçš„å®šä¹‰å°±æ˜¯ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</p><p>å•ä¾‹æ¨¡å¼å…·å¤‡å…¸å‹çš„ 3 ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ </li><li>è‡ªæˆ‘å®ä¾‹åŒ–ã€‚ </li><li>æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚</li></ol><p>å› æ­¤å½“ç³»ç»Ÿä¸­åªéœ€è¦ä¸€ä¸ªå®ä¾‹å¯¹è±¡æˆ–è€…ç³»ç»Ÿä¸­åªå…è®¸ä¸€ä¸ªå…¬å…±è®¿é—®ç‚¹ï¼Œé™¤äº†è¿™ä¸ªå…¬å…±è®¿é—®ç‚¹å¤–ï¼Œä¸èƒ½é€šè¿‡å…¶ä»–è®¿é—®ç‚¹è®¿é—®è¯¥å®ä¾‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚</p><p>å•ä¾‹æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹å°±æ˜¯èŠ‚çº¦ç³»ç»Ÿèµ„æºã€æé«˜äº†ç³»ç»Ÿæ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿä¸¥æ ¼æ§åˆ¶å®¢æˆ·å¯¹å®ƒçš„è®¿é—®ã€‚ä¹Ÿè®¸å°±æ˜¯å› ä¸ºç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ ·å°±å¯¼è‡´äº†å•ä¾‹ç±»çš„èŒè´£è¿‡é‡ï¼Œè¿èƒŒäº† â€œå•ä¸€èŒè´£åŸåˆ™â€ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æ‰©å±•èµ·æ¥æœ‰ä¸€å®šçš„å›°éš¾ã€‚å…¶ UML ç»“æ„å›¾éå¸¸ç®€å•ï¼Œå°±åªæœ‰ä¸€ä¸ªç±»ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/20/5c91dbf433523.png" alt="Design Patterns - Singleton.png" title="">                </div>                <div class="image-caption">Design Patterns - Singleton.png</div>            </figure><h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p>ä½œä¸ºæŠ½è±¡å·¥å‚æ¨¡å¼çš„å­ªç”Ÿå…„å¼Ÿï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´å·¥å‚æ–¹æ³•æ¨¡å¼è®©å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ã€‚</p><p>å·¥å‚æ–¹æ³•æ¨¡å¼éå¸¸ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ï¼Œå½“éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“çš„äº§å“ç±»å’Œä¸ä¹‹å¯¹åº”çš„å…·ä½“å·¥å‚å³å¯ï¼Œæ— éœ€ä¿®æ”¹åŸæœ‰ç³»ç»Ÿã€‚åŒæ—¶åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ç”¨æˆ·åªéœ€è¦çŸ¥é“ç”Ÿäº§äº§å“çš„å…·ä½“å·¥å‚å³å¯ï¼Œæ— éœ€å…³ç³»äº§å“çš„åˆ›å»ºè¿‡ç¨‹ï¼Œç”šè‡³è¿å…·ä½“çš„äº§å“ç±»åç§°éƒ½ä¸éœ€è¦çŸ¥é“ã€‚è™½ç„¶ä»–å¾ˆå¥½çš„ç¬¦åˆäº†â€œå¼€é—­åŸåˆ™â€ï¼Œä½†æ˜¯ç”±äºæ¯æ–°å¢ä¸€ä¸ªæ–°äº§å“å°±éœ€è¦å¢åŠ ä¸¤ä¸ªç±»ï¼Œè¿™æ ·åŠ¿å¿…ä¼šå¯¼è‡´ç³»ç»Ÿçš„å¤æ‚åº¦å¢åŠ ã€‚å…¶ UML ç»“æ„å›¾ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/20/5c91db7799896.png" alt="Design Patterns - Factory.png" title="">                </div>                <div class="image-caption">Design Patterns - Factory.png</div>            </figure><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>æ‰€è°“æŠ½è±¡å·¥å‚æ¨¡å¼å°±æ˜¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–è€…ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œä¸éœ€è¦æ˜ç¡®æŒ‡å®šå…·ä½“ç±»ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯ä½¿ç”¨æŠ½è±¡çš„æ¥å£æ¥åˆ›å»ºä¸€ç»„ç›¸å…³çš„äº§å“ï¼Œè€Œä¸éœ€è¦å…³ç³»å®é™…äº§å‡ºçš„å…·ä½“äº§å“æ˜¯ä»€ä¹ˆã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·å°±å¯ä»¥ä»å…·ä½“çš„äº§å“ä¸­è¢«è§£è€¦ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯éš”ç¦»äº†å…·ä½“ç±»çš„ç”Ÿæˆï¼Œä½¿å¾—å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“ä»€ä¹ˆè¢«åˆ›å»ºäº†ï¼Œè€Œç¼ºç‚¹å°±åœ¨äºæ–°å¢æ–°çš„è¡Œä¸ºä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºå½“æ·»åŠ ä¸€ä¸ªæ–°çš„äº§å“å¯¹è±¡æ—¶ï¼Œéœ€è¦æ›´æ”¹æ¥å£åŠå…¶ä¸‹æ‰€æœ‰å­ç±»ã€‚å…¶ UML ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/20/5c91db77aeffe.png" alt="Design Patterns - AbstractFactory.png" title="">                </div>                <div class="image-caption">Design Patterns - AbstractFactory.png</div>            </figure><h2 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h2><p>å¯¹äºå»ºé€ è€…æ¨¡å¼ï¼Œå®ƒä¸»è¦æ˜¯å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚é€‚ç”¨äºé‚£äº›äº§å“å¯¹è±¡çš„å†…éƒ¨ç»“æ„æ¯”è¾ƒå¤æ‚ã€‚</p><p>å»ºé€ è€…æ¨¡å¼å°†å¤æ‚äº§å“çš„æ„å»ºè¿‡ç¨‹å°è£…åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹éå¸¸æ¸…æ™°ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬æ›´åŠ ç²¾ç¡®çš„æ§åˆ¶å¤æ‚äº§å“å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒåŒæ—¶å®ƒéš”ç¦»äº†å¤æ‚äº§å“å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹èƒ½å¤Ÿåˆ›å»ºä¸åŒçš„äº§å“ã€‚ä½†æ˜¯å¦‚æœæŸä¸ªäº§å“çš„å†…éƒ¨ç»“æ„è¿‡äºå¤æ‚ï¼Œå°†ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå˜å¾—éå¸¸åºå¤§ï¼Œä¸åˆ©äºæ§åˆ¶ï¼ŒåŒæ—¶è‹¥å‡ ä¸ªäº§å“ä¹‹é—´å­˜åœ¨è¾ƒå¤§çš„å·®å¼‚ï¼Œåˆ™ä¸é€‚ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œæ¯•ç«Ÿè¿™ä¸ªä¸–ç•Œä¸Šå­˜åœ¨ç›¸åŒç‚¹å¤šçš„ä¸¤ä¸ªäº§å“ä¸æ˜¯å¾ˆå¤šï¼Œæ‰€ä»¥å®ƒçš„ä½¿ç”¨èŒƒå›´æœ‰é™ã€‚å…¶ UML ç»“æ„å›¾ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/20/5c91db779984e.png" alt="Design Patterns - Builder.png" title="">                </div>                <div class="image-caption">Design Patterns - Builder.png</div>            </figure><h2 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h2><p>åœ¨æˆ‘ä»¬åº”ç”¨ç¨‹åºå¯èƒ½æœ‰æŸäº›å¯¹è±¡çš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰éœ€è¦é¢‘ç¹çš„ä½¿ç”¨å®ƒä»¬ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ¥ä¸æ–­çš„æ–°å»ºè¿™ä¸ªå¯¹è±¡åŠ¿å¿…ä¼šå¤§å¤§æŸè€—ç³»ç»Ÿå†…å­˜çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨åŸå‹æ¨¡å¼æ¥å¯¹è¿™ä¸ªç»“æ„å¤æ‚åˆè¦é¢‘ç¹ä½¿ç”¨çš„å¯¹è±¡è¿›è¡Œå…‹éš†ã€‚æ‰€ä»¥åŸå‹æ¨¡å¼å°±æ˜¯ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡å¤åˆ¶è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p><p>å®ƒä¸»è¦åº”ç”¨äºé‚£äº›åˆ›å»ºæ–°å¯¹è±¡çš„æˆæœ¬è¿‡å¤§æ—¶ã€‚å®ƒçš„ä¸»è¦ä¼˜ç‚¹å°±æ˜¯ç®€åŒ–äº†æ–°å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæé«˜äº†æ•ˆç‡ï¼ŒåŒæ—¶åŸå‹æ¨¡å¼æä¾›äº†ç®€åŒ–çš„åˆ›å»ºç»“æ„ã€‚UML ç»“æ„å›¾ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/20/5c91db77a1c73.png" alt="Design Patterns - Prototype.png" title="">                </div>                <div class="image-caption">Design Patterns - Prototype.png</div>            </figure><p> <strong>æ¨¡å¼ç»“æ„</strong><br>åŸå‹æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š<br>Prototypeï¼šæŠ½è±¡åŸå‹ç±»<br>ConcretePrototypeï¼šå…·ä½“åŸå‹ç±»<br>Clientï¼šå®¢æˆ·ç±»</p><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p>åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦å°†ä¸¤ä¸ªä¸åŒæ¥å£çš„ç±»æ¥è¿›è¡Œé€šä¿¡ï¼Œåœ¨ä¸ä¿®æ”¹è¿™ä¸¤ä¸ªçš„å‰æä¸‹æˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦æŸä¸ªä¸­é—´ä»¶æ¥å®Œæˆè¿™ä¸ªè¡”æ¥çš„è¿‡ç¨‹ã€‚è¿™ä¸ªä¸­é—´ä»¶å°±æ˜¯é€‚é…å™¨ã€‚æ‰€è°“é€‚é…å™¨æ¨¡å¼å°±æ˜¯å°†ä¸€ä¸ªç±»çš„æ¥å£ï¼Œè½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚å®ƒå¯ä»¥è®©åŸæœ¬ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£èƒ½å¤Ÿæ— ç¼å®Œæˆå¯¹æ¥ã€‚</p><p>ä½œä¸ºä¸­é—´ä»¶çš„é€‚é…å™¨å°†ç›®æ ‡ç±»å’Œé€‚é…è€…è§£è€¦ï¼Œå¢åŠ äº†ç±»çš„é€æ˜æ€§å’Œå¯å¤ç”¨æ€§ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/20/5c91db77bb492.png" alt="Design Patterns - Adapter.png" title="">                </div>                <div class="image-caption">Design Patterns - Adapter.png</div>            </figure><p>é€‚é…å™¨æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š<br>Targetï¼šç›®æ ‡æŠ½è±¡ç±»<br>Adapterï¼šé€‚é…å™¨ç±»<br>Adapteeï¼šé€‚é…è€…ç±»<br>Clientï¼šå®¢æˆ·ç±»</p><h2 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h2><p>åˆ«åï¼šæŸ„ä½“æ¨¡å¼</p><ul><li>å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚<br>å¦‚æœè¯´æŸä¸ªç³»ç»Ÿèƒ½å¤Ÿä»å¤šä¸ªè§’åº¦æ¥è¿›è¡Œåˆ†ç±»ï¼Œä¸”æ¯ä¸€ç§åˆ†ç±»éƒ½å¯èƒ½ä¼šå˜åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯è®²è¿™å¤šä¸ªè§’åº¦åˆ†ç¦»å‡ºæ¥ï¼Œä½¿å¾—ä»–ä»¬èƒ½ç‹¬ç«‹å˜åŒ–ï¼Œå‡å°‘ä»–ä»¬ä¹‹é—´çš„è€¦åˆï¼Œè¿™ä¸ªåˆ†ç¦»è¿‡ç¨‹å°±ä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼ã€‚æ‰€è°“æ¡¥æ¥æ¨¡å¼å°±æ˜¯è®²æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†éš”ç¦»å¼€æ¥ï¼Œä½¿å¾—ä»–ä»¬èƒ½å¤Ÿç‹¬ç«‹å˜åŒ–ã€‚</li></ul><p>æ¡¥æ¥æ¨¡å¼å°†ç»§æ‰¿å…³ç³»è½¬åŒ–æˆå…³è”å…³ç³»ï¼Œå°è£…äº†å˜åŒ–ï¼Œå®Œæˆäº†è§£è€¦ï¼Œå‡å°‘äº†ç³»ç»Ÿä¸­ç±»çš„æ•°é‡ï¼Œä¹Ÿå‡å°‘äº†ä»£ç é‡ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/20/5c91e6dac4806.png" alt="Design Patterns - Handle-Body.png" title="">                </div>                <div class="image-caption">Design Patterns - Handle-Body.png</div>            </figure><p>æ¡¥æ¥æ¨¡å¼åŒ…æ‹¬å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li>æŠ½è±¡ï¼ˆAbstractionï¼‰ï¼šæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¯¥æŠ½è±¡ç±»å«æœ‰ Implementor å£°æ˜çš„å˜é‡ï¼Œå³ç»´æŠ¤ä¸€ä¸ª Implementor ç±»å‹å¯¹è±¡ã€‚</li><li>å®ç°è€…ï¼ˆImplementorï¼‰ï¼šå®ç°è€…è§’è‰²æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰ï¼Œè¯¥æ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰ä¸­çš„æ–¹æ³•ä¸ä¸€å®šä¸ Abstraction ç±»ä¸­çš„æ–¹æ³•ä¸€è‡´ã€‚Implementor æ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰è´Ÿè´£å®šä¹‰åŸºæœ¬æ“ä½œï¼Œè€Œ Abstraction ç±»è´Ÿè´£å®šä¹‰åŸºäºæ“ä½œçš„è¾ƒé«˜å±‚æ¬¡çš„æ“ä½œã€‚</li><li>ç»†åŒ–æŠ½è±¡ï¼ˆRefined Abstractionï¼‰ï¼šç»†åŒ–æŠ½è±¡æ˜¯æŠ½è±¡è§’è‰²çš„ä¸€ä¸ªå­ç±»ï¼Œè¯¥å­ç±»åœ¨é‡å†™ï¼ˆè¦†ç›–ï¼‰æŠ½è±¡è§’è‰²ä¸­çš„æŠ½è±¡æ–¹æ³•æ—¶ï¼Œåœ¨ç»™å‡ºä¸€äº›å¿…è¦çš„æ“ä½œåï¼Œå°†å§”æ‰˜æ‰€ç»´æŠ¤ Implementor ç±»å‹å¯¹è±¡è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</li><li>å…·ä½“å®ç°è€…ï¼ˆConcrete Implementorï¼‰ï¼šå…·ä½“å®ç°è€…æ˜¯å®ç°ï¼ˆæ‰©å±•ï¼‰Implementor æ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰çš„ç±»ã€‚</li></ul><blockquote><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p></blockquote><hr><h1 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h1><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/19/5c90a189cccd1.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h2><h3 id="ç›´æ¥æ’å…¥æ’åº"><a href="#ç›´æ¥æ’å…¥æ’åº" class="headerlink" title="ç›´æ¥æ’å…¥æ’åº"></a>ç›´æ¥æ’å…¥æ’åº</h3><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(n^2)$</td><td>$O(1)$</td><td>âˆš</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="keyword">int</span>[] array)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;array.length;i++)&#123;<span class="comment">//ç¬¬0ä½ç‹¬è‡ªä½œä¸ºæœ‰åºæ•°åˆ—ï¼Œä»ç¬¬1ä½å¼€å§‹å‘åéå†</span></div><div class="line">        <span class="keyword">if</span>(array[i]&lt;array[i-<span class="number">1</span>])(&#123;<span class="comment">//0~i-1ä½ä¸ºæœ‰åºï¼Œè‹¥ç¬¬iä½å°äºi-1ä½ï¼Œç»§ç»­å¯»ä½å¹¶æ’å…¥ï¼Œå¦åˆ™è®¤ä¸º0~iä½ä¹Ÿæ˜¯æœ‰åºçš„ï¼Œå¿½ç•¥æ­¤æ¬¡å¾ªç¯ï¼Œç›¸å½“äºcontinue</span></div><div class="line">            <span class="keyword">int</span> temp=array[i];<span class="comment">//ä¿å­˜ç¬¬iä½çš„å€¼</span></div><div class="line">            <span class="keyword">int</span> k = i - <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=k;j&gt;=<span class="number">0</span> &amp;&amp; temp&lt;array[j];j--)&#123;<span class="comment">//ä»ç¬¬i-1ä½å‘å‰éå†å¹¶ç§»ä½ï¼Œç›´è‡³æ‰¾åˆ°å°äºç¬¬iä½å€¼åœæ­¢</span></div><div class="line">                array[j+<span class="number">1</span>]=array[j];</div><div class="line">                k--;</div><div class="line">            &#125;</div><div class="line">            array[k+<span class="number">1</span>]=temp;<span class="comment">//æ’å…¥ç¬¬iä½çš„å€¼</span></div><div class="line">        &#125;</div><div class="line">    &#125; </div><div class="line">&#125;</div><div class="line"><span class="comment">//æ—¶é—´å¤æ‚åº¦O(n*n) æ€§èƒ½ä¸Šä¼˜äºå†’æ³¡æ’åºå’Œé€‰æ‹©æ’åº</span></div></pre></td></tr></table></figure><h3 id="æŠ˜åŠæ’å…¥æ’åº"><a href="#æŠ˜åŠæ’å…¥æ’åº" class="headerlink" title="æŠ˜åŠæ’å…¥æ’åº"></a>æŠ˜åŠæ’å…¥æ’åº</h3><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(n^2)$</td><td>$O(1)$</td><td>âˆš</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">binaryInsertSort</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; array.length; i++) &#123;</div><div class="line">        <span class="keyword">int</span> temp = array[i];</div><div class="line">        <span class="keyword">int</span> low = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> high = i - <span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> (low &lt;= high) &#123;</div><div class="line">            <span class="keyword">int</span> mid = (low + high) / <span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (temp &lt; array[mid]) &#123;</div><div class="line">                high = mid - <span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                low = mid + <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt;= low + <span class="number">1</span>; j--) &#123;</div><div class="line">            array[j] = array[j - <span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        array[low] = temp;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="Shell-æ’åº"><a href="#Shell-æ’åº" class="headerlink" title="Shell æ’åº"></a>Shell æ’åº</h3><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(n^{1.3})$ ~ $O(n^2)$</td><td>$O(1)$</td><td>Ã—</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * å¸Œå°”æ’åºçš„åŸç†:æ ¹æ®éœ€æ±‚ï¼Œå¦‚æœä½ æƒ³è¦ç»“æœä»å°åˆ°å¤§æ’åˆ—ï¼Œå®ƒä¼šé¦–å…ˆå°†æ•°ç»„è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå°†è¾ƒå°å€¼ç§»åˆ°å‰é¢ï¼Œè¾ƒå¤§å€¼</div><div class="line"> * ç§»åˆ°åé¢ï¼Œæœ€åå°†æ•´ä¸ªæ•°ç»„è¿›è¡Œæ’å…¥æ’åºï¼Œè¿™æ ·æ¯”èµ·ä¸€å¼€å§‹å°±ç”¨æ’å…¥æ’åºå‡å°‘äº†æ•°æ®äº¤æ¢å’Œç§»åŠ¨çš„æ¬¡æ•°ï¼Œ</div><div class="line"> * å¯ä»¥è¯´å¸Œå°”æ’åºæ˜¯åŠ å¼º ç‰ˆçš„æ’å…¥æ’åº æ‹¿æ•°ç»„5, 2,8, 9, 1, 3ï¼Œ4æ¥è¯´ï¼Œæ•°ç»„é•¿åº¦ä¸º7ï¼Œå½“incrementä¸º3æ—¶ï¼Œæ•°ç»„åˆ†ä¸ºä¸¤ä¸ªåºåˆ—</div><div class="line"> * 5ï¼Œ2ï¼Œ8å’Œ9ï¼Œ1ï¼Œ3ï¼Œ4ï¼Œç¬¬ä¸€æ¬¡æ’åºï¼Œ9å’Œ5æ¯”è¾ƒï¼Œ1å’Œ2æ¯”è¾ƒï¼Œ3å’Œ8æ¯”è¾ƒï¼Œ4å’Œæ¯”å…¶ä¸‹æ ‡å€¼å°incrementçš„æ•°ç»„å€¼ç›¸æ¯”è¾ƒ</div><div class="line"> * æ­¤ä¾‹å­æ˜¯æŒ‰ç…§ä»å°åˆ°å¤§æ’åˆ—ï¼Œæ‰€ä»¥å°çš„ä¼šæ’åœ¨å‰é¢ï¼Œç¬¬ä¸€æ¬¡æ’åºåæ•°ç»„ä¸º5, 1, 3, 4, 2, 8ï¼Œ9</div><div class="line"> * ç¬¬ä¸€æ¬¡åincrementçš„å€¼å˜ä¸º3/2=1,æ­¤æ—¶å¯¹æ•°ç»„è¿›è¡Œæ’å…¥æ’åºï¼Œ å®ç°æ•°ç»„ä»å¤§åˆ°å°æ’</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="keyword">int</span>[] data)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line">    <span class="comment">// æ¯æ¬¡å°†æ­¥é•¿ç¼©çŸ­ä¸ºåŸæ¥çš„ä¸€åŠ</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> increment = data.length / <span class="number">2</span>; increment &gt; <span class="number">0</span>; increment /= <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = increment; i &lt; data.length; i++) &#123;</div><div class="line">            temp = data[i];</div><div class="line">            <span class="keyword">for</span> (j = i; j &gt;= increment; j -= increment) &#123;</div><div class="line">                <span class="keyword">if</span> (temp &lt; data[j - increment])<span class="comment">// ä»å°åˆ°å¤§æ’</span></div><div class="line">                &#123;</div><div class="line">                    data[j] = data[j - increment];</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            data[j] = temp;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="äº¤æ¢æ’åº"><a href="#äº¤æ¢æ’åº" class="headerlink" title="äº¤æ¢æ’åº"></a>äº¤æ¢æ’åº</h2><h3 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h3><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(n^2)$</td><td>$O(1)$</td><td>Ã—</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>[] numbers)</span></span>&#123;</div><div class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> size = numbers.length;</div><div class="line"><span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; size-<span class="number">1</span>&amp;&amp;flag; i++)&#123;</div><div class="line">flag = <span class="keyword">false</span>;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size-<span class="number">1</span>-i; j++)&#123;</div><div class="line"><span class="keyword">if</span>(numbers[j] &gt;numbers[j+<span class="number">1</span>])&#123;</div><div class="line">temp = numbers[j];</div><div class="line">numbers[j] = numbers[j + <span class="number">1</span>];</div><div class="line">numbers[j + <span class="number">1</span>] = temp;</div><div class="line">flag = <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h3><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(nlogn)$</td><td>$O(log_2n)$ ~ $O(n)$</td><td>Ã—</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * å¿«é€Ÿæ’åº</div><div class="line"> * </div><div class="line"> * <span class="doctag">@param</span> numbers</div><div class="line"> *            å¸¦æ’åºæ•°ç»„</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quick</span><span class="params">(<span class="keyword">int</span>[] numbers)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (numbers.length &gt; <span class="number">0</span>) <span class="comment">// æŸ¥çœ‹æ•°ç»„æ˜¯å¦ä¸ºç©º</span></div><div class="line">    &#123;</div><div class="line">        quickSort(numbers, <span class="number">0</span>, numbers.length - <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * </div><div class="line"> * <span class="doctag">@param</span> numbers</div><div class="line"> *            å¸¦æ’åºæ•°ç»„</div><div class="line"> * <span class="doctag">@param</span> low</div><div class="line"> *            å¼€å§‹ä½ç½®</div><div class="line"> * <span class="doctag">@param</span> high</div><div class="line"> *            ç»“æŸä½ç½®</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (low &gt;= high) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> middle = getMiddle(numbers, low, high); <span class="comment">// å°†numbersæ•°ç»„è¿›è¡Œä¸€åˆ†ä¸ºäºŒ</span></div><div class="line">    quickSort(numbers, low, middle - <span class="number">1</span>); <span class="comment">// å¯¹ä½å­—æ®µè¡¨è¿›è¡Œé€’å½’æ’åº</span></div><div class="line">    quickSort(numbers, middle + <span class="number">1</span>, high); <span class="comment">// å¯¹é«˜å­—æ®µè¡¨è¿›è¡Œé€’å½’æ’åº</span></div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * æŸ¥æ‰¾å‡ºä¸­è½´ï¼ˆé»˜è®¤æ˜¯æœ€ä½ä½lowï¼‰çš„åœ¨numbersæ•°ç»„æ’åºåæ‰€åœ¨ä½ç½®</div><div class="line"> * </div><div class="line"> * <span class="doctag">@param</span> numbers</div><div class="line"> *            å¸¦æŸ¥æ‰¾æ•°ç»„</div><div class="line"> * <span class="doctag">@param</span> low</div><div class="line"> *            å¼€å§‹ä½ç½®</div><div class="line"> * <span class="doctag">@param</span> high</div><div class="line"> *            ç»“æŸä½ç½®</div><div class="line"> * <span class="doctag">@return</span> ä¸­è½´æ‰€åœ¨ä½ç½®</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMiddle</span><span class="params">(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> temp = numbers[low]; <span class="comment">// æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½œä¸ºä¸­è½´</span></div><div class="line">    <span class="keyword">while</span> (low &lt; high) &#123;</div><div class="line">        <span class="keyword">while</span> (low &lt; high &amp;&amp; numbers[high] &gt; temp) &#123;</div><div class="line">            high--;</div><div class="line">        &#125;</div><div class="line">        numbers[low] = numbers[high];<span class="comment">// æ¯”ä¸­è½´å°çš„è®°å½•ç§»åˆ°ä½ç«¯</span></div><div class="line">        <span class="keyword">while</span> (low &lt; high &amp;&amp; numbers[low] &lt; temp) &#123;</div><div class="line">            low++;</div><div class="line">        &#125;</div><div class="line">        numbers[high] = numbers[low]; <span class="comment">// æ¯”ä¸­è½´å¤§çš„è®°å½•ç§»åˆ°é«˜ç«¯</span></div><div class="line">    &#125;</div><div class="line">    numbers[low] = temp; <span class="comment">// ä¸­è½´è®°å½•åˆ°å°¾</span></div><div class="line">    <span class="keyword">return</span> low; <span class="comment">// è¿”å›ä¸­è½´çš„ä½ç½®</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//æ—¶é—´å¤æ‚åº¦O(nlognï¼‰</span></div></pre></td></tr></table></figure><h2 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h2><h3 id="ç®€å•é€‰æ‹©æ’åº"><a href="#ç®€å•é€‰æ‹©æ’åº" class="headerlink" title="ç®€å•é€‰æ‹©æ’åº"></a>ç®€å•é€‰æ‹©æ’åº</h3><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(n^2)$</td><td>$O(1)$</td><td>Ã—</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSort</span><span class="params">(<span class="keyword">int</span>[] numbers)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> size = numbers.length; <span class="comment">// æ•°ç»„é•¿åº¦</span></div><div class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>; <span class="comment">// ä¸­é—´å˜é‡</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size-<span class="number">1</span>; i++) &#123;</div><div class="line">        <span class="keyword">int</span> k = i; <span class="comment">// å¾…ç¡®å®šçš„ä½ç½®</span></div><div class="line">        <span class="comment">// é€‰æ‹©å‡ºåº”è¯¥åœ¨ç¬¬iä¸ªä½ç½®çš„æ•°</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = size - <span class="number">1</span>; j &gt; i; j--) &#123;</div><div class="line">            <span class="keyword">if</span> (numbers[j] &lt; numbers[k]) &#123;</div><div class="line">                k = j;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// äº¤æ¢ä¸¤ä¸ªæ•°</span></div><div class="line">        temp = numbers[i];</div><div class="line">        numbers[i] = numbers[k];</div><div class="line">        numbers[k] = temp;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//æ—¶é—´å¤æ‚åº¦O(n*n) æ€§èƒ½ä¸Šä¼˜äºå†’æ³¡æ’åº äº¤æ¢æ¬¡æ•°å°‘</span></div></pre></td></tr></table></figure><h3 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h3><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(nlog_2n)$</td><td>$O(1)$</td><td>Ã—</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span>[] a)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> arrayLength = a.length;</div><div class="line">    <span class="comment">// å¾ªç¯å»ºå †</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arrayLength - <span class="number">1</span>; i++) &#123;</div><div class="line">        <span class="comment">// å»ºå †</span></div><div class="line">        buildMaxHeap(a, arrayLength - <span class="number">1</span> - i);</div><div class="line">        <span class="comment">// äº¤æ¢å †é¡¶å’Œæœ€åä¸€ä¸ªå…ƒç´ </span></div><div class="line">        swap(a, <span class="number">0</span>, arrayLength - <span class="number">1</span> - i);</div><div class="line">        System.out.println(Arrays.toString(a));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// å¯¹dataæ•°ç»„ä»0åˆ°lastIndexå»ºå¤§é¡¶å †</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">buildMaxHeap</span><span class="params">(<span class="keyword">int</span>[] data, <span class="keyword">int</span> lastIndex)</span> </span>&#123;</div><div class="line">    <span class="comment">// ä»lastIndexå¤„èŠ‚ç‚¹ï¼ˆæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼‰çš„çˆ¶èŠ‚ç‚¹å¼€å§‹</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = (lastIndex - <span class="number">1</span>) / <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="comment">// kä¿å­˜æ­£åœ¨åˆ¤æ–­çš„èŠ‚ç‚¹</span></div><div class="line">        <span class="keyword">int</span> k = i;</div><div class="line">        <span class="comment">// å¦‚æœå½“å‰kèŠ‚ç‚¹çš„å­èŠ‚ç‚¹å­˜åœ¨</span></div><div class="line">        <span class="keyword">while</span> (k * <span class="number">2</span> + <span class="number">1</span> &lt;= lastIndex) &#123;</div><div class="line">            <span class="comment">// kèŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹çš„ç´¢å¼•</span></div><div class="line">            <span class="keyword">int</span> biggerIndex = <span class="number">2</span> * k + <span class="number">1</span>;</div><div class="line">            <span class="comment">// å¦‚æœbiggerIndexå°äºlastIndexï¼Œå³biggerIndex+1ä»£è¡¨çš„kèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹å­˜åœ¨</span></div><div class="line">            <span class="keyword">if</span> (biggerIndex &lt; lastIndex) &#123;</div><div class="line">                <span class="comment">// è‹¥æœå³å­èŠ‚ç‚¹çš„å€¼è¾ƒå¤§</span></div><div class="line">                <span class="keyword">if</span> (data[biggerIndex] &lt; data[biggerIndex + <span class="number">1</span>]) &#123;</div><div class="line">                    <span class="comment">// biggerIndexæ€»æ˜¯è®°å½•è¾ƒå¤§å­èŠ‚ç‚¹çš„ç´¢å¼•</span></div><div class="line">                    biggerIndex++;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// å¦‚æœkèŠ‚ç‚¹çš„å€¼å°äºå…¶è¾ƒå¤§çš„å­èŠ‚ç‚¹çš„å€¼</span></div><div class="line">            <span class="keyword">if</span> (data[k] &lt; data[biggerIndex]) &#123;</div><div class="line">                <span class="comment">// äº¤æ¢ä»–ä»¬</span></div><div class="line">                swap(data, k, biggerIndex);</div><div class="line">                <span class="comment">// å°†biggerIndexèµ‹äºˆkï¼Œå¼€å§‹whileå¾ªç¯çš„ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œé‡æ–°ä¿è¯kèŠ‚ç‚¹çš„å€¼å¤§äºå…¶å·¦å³å­èŠ‚ç‚¹çš„å€¼</span></div><div class="line">                k = biggerIndex;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// äº¤æ¢</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] data, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> tmp = data[i];</div><div class="line">    data[i] = data[j];</div><div class="line">    data[j] = tmp;</div><div class="line">&#125;</div><div class="line"><span class="comment">//æ—¶é—´å¤æ‚åº¦O(nlognï¼‰ä¸é€‚åˆå¾…æ’åºåºåˆ—è¾ƒå°‘çš„æƒ…å†µ</span></div></pre></td></tr></table></figure><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(nlog_2n)$</td><td>$O(n)$</td><td>âˆš</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * å½’å¹¶æ’åº</div><div class="line"> * ç®€ä»‹:å°†ä¸¤ä¸ªï¼ˆæˆ–ä¸¤ä¸ªä»¥ä¸Šï¼‰æœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºè¡¨ å³æŠŠå¾…æ’åºåºåˆ—åˆ†ä¸ºè‹¥å¹²ä¸ªå­åºåˆ—ï¼Œæ¯ä¸ªå­åºåˆ—æ˜¯æœ‰åºçš„ã€‚ç„¶åå†æŠŠæœ‰åºå­åºåˆ—åˆå¹¶ä¸ºæ•´ä½“æœ‰åºåºåˆ—</div><div class="line"> * æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)</div><div class="line"> * ç¨³å®šæ’åºæ–¹å¼</div><div class="line"> * <span class="doctag">@param</span> nums å¾…æ’åºæ•°ç»„</div><div class="line"> * <span class="doctag">@return</span> è¾“å‡ºæœ‰åºæ•°ç»„</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] sort(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> low, <span class="keyword">int</span> high) &#123;</div><div class="line">    <span class="keyword">int</span> mid = (low + high) / <span class="number">2</span>;</div><div class="line">    <span class="keyword">if</span> (low &lt; high) &#123;</div><div class="line">        <span class="comment">// å·¦è¾¹</span></div><div class="line">        sort(nums, low, mid);</div><div class="line">        <span class="comment">// å³è¾¹</span></div><div class="line">        sort(nums, mid + <span class="number">1</span>, high);</div><div class="line">        <span class="comment">// å·¦å³å½’å¹¶</span></div><div class="line">        merge(nums, low, mid, high);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> nums;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * å°†æ•°ç»„ä¸­lowåˆ°highä½ç½®çš„æ•°è¿›è¡Œæ’åº</div><div class="line"> * <span class="doctag">@param</span> nums å¾…æ’åºæ•°ç»„</div><div class="line"> * <span class="doctag">@param</span> low å¾…æ’çš„å¼€å§‹ä½ç½®</div><div class="line"> * <span class="doctag">@param</span> mid å¾…æ’ä¸­é—´ä½ç½®</div><div class="line"> * <span class="doctag">@param</span> high å¾…æ’ç»“æŸä½ç½®</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> low, <span class="keyword">int</span> mid, <span class="keyword">int</span> high)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>[] temp = <span class="keyword">new</span> <span class="keyword">int</span>[high - low + <span class="number">1</span>];</div><div class="line">    <span class="keyword">int</span> i = low;<span class="comment">// å·¦æŒ‡é’ˆ</span></div><div class="line">    <span class="keyword">int</span> j = mid + <span class="number">1</span>;<span class="comment">// å³æŒ‡é’ˆ</span></div><div class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</div><div class="line">    <span class="comment">// æŠŠè¾ƒå°çš„æ•°å…ˆç§»åˆ°æ–°æ•°ç»„ä¸­</span></div><div class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= high) &#123;</div><div class="line">        <span class="keyword">if</span> (nums[i] &lt; nums[j]) &#123;</div><div class="line">            temp[k++] = nums[i++];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            temp[k++] = nums[j++];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æŠŠå·¦è¾¹å‰©ä½™çš„æ•°ç§»å…¥æ•°ç»„</span></div><div class="line">    <span class="keyword">while</span> (i &lt;= mid) &#123;</div><div class="line">        temp[k++] = nums[i++];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æŠŠå³è¾¹è¾¹å‰©ä½™çš„æ•°ç§»å…¥æ•°ç»„</span></div><div class="line">    <span class="keyword">while</span> (j &lt;= high) &#123;</div><div class="line">        temp[k++] = nums[j++];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// æŠŠæ–°æ•°ç»„ä¸­çš„æ•°è¦†ç›–numsæ•°ç»„</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k2 = <span class="number">0</span>; k2 &lt; temp.length; k2++) &#123;</div><div class="line">        nums[k2 + low] = temp[k2];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//æ—¶é—´å¤æ‚åº¦O(nlognï¼‰</span></div></pre></td></tr></table></figure><h2 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h2><table><thead><tr><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>ç¨³å®šæ€§</th></tr></thead><tbody><tr><td>$O(d(n+r))$</td><td>$O(r)$</td><td>âˆš</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ&lt;/h1&gt;&lt;p&gt; è®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£
      
    
    </summary>
    
    
      <category term="Java" scheme="https://edward7zhang.github.io/tags/Java/"/>
    
      <category term="Algorithm" scheme="https://edward7zhang.github.io/tags/Algorithm/"/>
    
      <category term="Design Pattern" scheme="https://edward7zhang.github.io/tags/Design-Pattern/"/>
    
  </entry>
  
  <entry>
    <title>Androidå„ç‰ˆæœ¬æ–°ç‰¹æ€§ã€æŒç»­æ›´æ–°...ã€‘</title>
    <link href="https://edward7zhang.github.io/2019/03/18/Android%E5%90%84%E7%89%88%E6%9C%AC%E6%96%B0%E7%89%B9%E6%80%A7%E3%80%90%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%E3%80%91/"/>
    <id>https://edward7zhang.github.io/2019/03/18/Androidå„ç‰ˆæœ¬æ–°ç‰¹æ€§ã€æŒç»­æ›´æ–°ã€‘/</id>
    <published>2019-03-18T04:07:14.000Z</published>
    <updated>2019-03-18T03:16:04.306Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Android-å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€"><a href="#Android-å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€" class="headerlink" title="Android å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€"></a>Android å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€</h1><blockquote><p>æŒç»­æ›´æ–°ä¸­â€¦</p></blockquote><h2 id="Android-9-0"><a href="#Android-9-0" class="headerlink" title="Android 9.0"></a>Android 9.0</h2><ul><li><p>å®¤å†… WIFI RTT  å®šä½</p><p>  Android P ä¸º IEEE 802.11mc WiFi åè®®æ·»åŠ äº†å¹³å°æ”¯æŒ (ä¹Ÿç§°ä¸º WiFi å¾€è¿”æ—¶é—´ï¼ŒRTT)ï¼Œè¿™å¯ä»¥è®©æ‚¨åœ¨åº”ç”¨ä¸­ä½¿ç”¨å®¤å†…å®šä½ã€‚<br>  æ‹¥æœ‰ç¡¬ä»¶æ”¯æŒçš„ Android P è®¾å¤‡å¯ä»¥è®©æ‚¨çš„åº”ç”¨ä½¿ç”¨ RTT API æµ‹é‡ä¸é™„è¿‘ WiFi æ¥å…¥ç‚¹ (AP) çš„è·ç¦»ï¼Œè®¾å¤‡ä¸éœ€è¦è¿æ¥åˆ° AP ä¾¿å¯ä»¥ä½¿ç”¨ RTTã€‚ä¸ºäº†ä¿æŒéšç§ï¼Œåªæœ‰æ‰‹æœºèƒ½å¤Ÿç¡®å®šè·ç¦»ï¼ŒAP æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚<br>  é€šè¿‡æµ‹é‡ä»è®¾å¤‡åˆ°ä¸‰ä¸ªæˆ–æ›´å¤š AP çš„è·ç¦»ï¼Œæ‚¨å¯ä»¥ä»¥ 1 åˆ° 2 ç±³çš„ç²¾åº¦ç¡®å®šè®¾å¤‡ä½ç½®ã€‚è¿™ç§ç²¾ç¡®åº¦å…è®¸æ‚¨åˆ›å»ºæ›´å¤šæ–°çš„ä½“éªŒï¼šå®¤å†…å¯¼èˆªã€åŸºäºä½ç½®çš„ç»†ç²’åº¦æœåŠ¡ï¼Œä¾‹å¦‚ï¼Œæ¨¡ç³Šè¯­éŸ³æ§åˆ¶ ( â€œæ‰“å¼€è¿™é‡Œçš„ç¯â€ ) ï¼›åŸºäºä½ç½®çš„èµ„è®¯æœåŠ¡ ( â€œè¿™äº›ä¼˜æƒ æ˜¯é’ˆå¯¹è¿™ä¸ªäº§å“çš„å—ï¼Ÿâ€ )ã€‚</p></li><li><p>â€œåˆ˜æµ·â€å±å¹•æ”¯æŒ</p><p> ç°åœ¨åº”ç”¨å¯ä»¥å……åˆ†åˆ©ç”¨æœ€æ–°çš„å…¨é¢å±è®¾å¤‡æ¥å±•ç¤ºå†…å®¹ã€‚æˆ‘ä»¬åœ¨ Android å¹³å°åŠ å…¥äº†å¯¹å‡¹å£å±å¹•çš„æ”¯æŒï¼Œä¸¦æä¾› API ä¾›æ‚¨ä½¿ç”¨ï¼Œä»è€Œç®¡ç†å†…å®¹å±•ç¤ºæ–¹å¼ã€‚<br> æœ¬åŠŸèƒ½å¯ä»¥åœ¨åº”ç”¨ä¸­æ— ç¼å·¥ä½œï¼Œç³»ç»Ÿä¼šç®¡ç†çŠ¶æ€æ çš„é«˜åº¦ä»è€Œå°†æ‚¨çš„å†…å®¹ä¸è£åˆ‡åŒºåŸŸåˆ†å¼€ã€‚å¦‚æœæ‚¨æ‹¥æœ‰é‡è¦çš„æ²‰æµ¸å¼å†…å®¹ï¼Œåˆ™è¿˜å¯ä»¥ä½¿ç”¨æ–°çš„ API æŸ¥çœ‹è£åˆ‡å½¢çŠ¶å¹¶åˆ›å»ºå…¨å±å¸ƒå±€ã€‚æ‚¨å¯ä»¥è°ƒç”¨ getDisplayCutout() æ¥åˆ¤æ–­æœ¬åœ°è®¾å¤‡æ˜¯å¦å…·æœ‰å‡¹å£å±å¹•ï¼Œç„¶åå†ç¡®å®šè£åˆ‡åŒºåŸŸçš„ä½ç½®å’Œå½¢çŠ¶ã€‚å¹³å°æ·»åŠ äº†ä¸€ä¸ªæ–°çš„çª—å£å¸ƒå±€å±æ€§ layoutInDisplayCutoutMode è®©æ‚¨å‘Šè¯‰ç³»ç»Ÿå¦‚ä½•ä»¥åŠä½•æ—¶å°†æ‚¨çš„å†…å®¹ç›¸å¯¹äºè£å‰ªåŒºåŸŸè¿›è¡Œå¸ƒå±€ã€‚</p></li><li><p>é€šçŸ¥</p><ul><li>å¢å¼ºä½“éªŒ</li><li>é€šé“è®¾ç½®ã€å¹¿æ’­ä»¥åŠå…æ‰“æ‰°</li></ul></li><li>å¤šç›¸æœºæ”¯æŒå’Œç›¸æœºæ›´æ–°</li><li>æ–°çš„å›¾ç‰‡è§£ç </li><li>åŠ¨ç”»</li><li>HDR VP9è§†é¢‘ï¼ŒHEIFå›¾åƒå‹ç¼©å’Œåª’ä½“API</li><li>JobSchedulerä¸­çš„æ•°æ®æˆæœ¬æ•æ„Ÿåº¦</li><li>ç¥ç»ç½‘ç»œAPI 1.1</li><li>æ”¹è¿›è¡¨å•è‡ªåŠ¨å¡«å……</li><li>å®‰å…¨å¢å¼º</li><li>Android å¤‡ä»½åŠ å¯†</li><li>ç”¨äº NFC æ”¯ä»˜å’Œå®‰å…¨äº¤æ˜“çš„ Open Mobile API</li></ul><h2 id="Android-8-1"><a href="#Android-8-1" class="headerlink" title="Android 8.1"></a>Android 8.1</h2><ul><li><strong>Android Go ç®€ä»‹</strong></li><li><strong>äººå·¥æ™ºèƒ½ç¥ç»ç½‘ç»œ API</strong>(å¦‚ï¼šTensorFlow)</li><li>è‡ªåŠ¨å¡«å……æ¡†æ¶æ›´æ–°</li><li>Notification é€šçŸ¥å˜æ›´</li><li>EditText æ›´æ–°</li><li>WebView å®‰å…¨æµè§ˆæ›´æ–°</li><li>è§†é¢‘ç¼©ç•¥å›¾æå–å™¨æ›´æ–°</li><li>å…±äº«å†…å­˜API</li><li>WallpaperColors API</li><li>æŒ‡çº¹æ›´æ–°</li></ul><h2 id="Android-8-0"><a href="#Android-8-0" class="headerlink" title="Android 8.0"></a>Android 8.0</h2><ul><li>APPâ€œå®‰è£…æœªçŸ¥åº”ç”¨â€åŠŸèƒ½é»˜è®¤è¢«é™åˆ¶</li><li><strong>ä¼˜åŒ–é€šçŸ¥</strong><ul><li>é€šçŸ¥æ¸ é“ Notification Channel</li><li>é€šçŸ¥æ ‡å¿—</li><li>ä¼‘çœ </li><li>é€šçŸ¥è¶…æ—¶</li><li>é€šçŸ¥è®¾ç½®</li><li>é€šçŸ¥æ¸…é™¤</li></ul></li><li>è‡ªåŠ¨å¡«å……æ¡†æ¶</li><li>ç”»ä¸­ç”»æ¨¡å¼ï¼šæ¸…å•ä¸­Activityè®¾ç½®android:supportsPictureInPicture</li><li><strong>å¯ä¸‹è½½å­—ä½“</strong>ï¼š<a href="https://link.jianshu.com/?t=https://developer.android.google.cn/reference/android/provider/FontsContract.html" target="_blank" rel="external">FontRequest</a></li><li>XML ä¸­çš„å­—ä½“</li><li><strong>è‡ªåŠ¨è°ƒæ•´ TextView çš„å¤§å°</strong></li><li><a href="https://link.jianshu.com/?t=https://developer.android.google.cn/guide/practices/ui_guidelines/icon_design_adaptive.html" target="_blank" rel="external">è‡ªé€‚åº”å›¾æ ‡</a></li><li>é¢œè‰²ç®¡ç†</li><li><a href="https://link.jianshu.com/?t=https://developer.android.google.cn/guide/webapps/managing-webview.html" target="_blank" rel="external">WebView API</a></li><li>å¤šæ˜¾ç¤ºå™¨æ”¯æŒ</li><li>ç»Ÿä¸€çš„å¸ƒå±€å¤–è¾¹è·å’Œå†…è¾¹è·</li><li>æŒ‡é’ˆæ•è·</li><li>åº”ç”¨ç±»åˆ«</li><li>Android TV å¯åŠ¨å™¨</li><li>AnimatorSet</li><li>æ–°çš„ StrictMode æ£€æµ‹ç¨‹åº</li><li>ç¼“å­˜æ•°æ®</li><li>findViewById() ç­¾åå˜æ›´</li><li>æƒé™</li><li>æ›´æ–°çš„ Java æ”¯æŒ</li></ul><h2 id="Android-7-1"><a href="#Android-7-1" class="headerlink" title="Android 7.1"></a>Android 7.1</h2><ul><li>åŠ å…¥é‡å¯æŒ‰é’®</li><li>Appåœ†å½¢å›¾æ ‡</li><li>æ·»åŠ æ–°çš„Emoji</li></ul><h2 id="Android-7-0"><a href="#Android-7-0" class="headerlink" title="Android 7.0"></a>Android 7.0</h2><ul><li><p><strong>åˆ†å±å¤šä»»åŠ¡</strong></p><p>è¿›å…¥åå°å¤šä»»åŠ¡ç®¡ç†é¡µé¢ï¼Œç„¶åæŒ‰ä½å…¶ä¸­ä¸€ä¸ªå¡ç‰‡ï¼Œç„¶åå‘ä¸Šæ‹–åŠ¨è‡³é¡¶éƒ¨å³å¯å¼€å¯åˆ†å±å¤šä»»åŠ¡ï¼Œæ”¯æŒä¸Šä¸‹åˆ†æ å’Œå·¦å³åˆ†æ ï¼Œå…è®¸æ‹–åŠ¨ä¸­é—´çš„åˆ†å‰²çº¿è°ƒæ•´ä¸¤ä¸ªAPPæ‰€å çš„æ¯”ä¾‹ã€‚</p></li><li><p>å…¨æ–°ä¸‹æ‹‰å¿«æ·å¼€å…³é¡µ</p><p>Android 7.0ä¸­ï¼Œä¸‹æ‹‰æ‰“å¼€é€šçŸ¥æ é¡¶éƒ¨å³å¯æ˜¾ç¤º5ä¸ªç”¨æˆ·å¸¸ç”¨çš„å¿«æ·å¼€å…³ï¼Œæ”¯æŒå•å‡»å¼€å…³ä»¥åŠé•¿æŒ‰è¿›å…¥å¯¹åº”è®¾ç½®ã€‚å¦‚æœç»§ç»­ä¸‹æ‹‰é€šçŸ¥æ å³å¯æ˜¾ç¤ºå…¨éƒ¨å¿«æ·å¼€å…³ï¼Œæ­¤å¤–åœ¨å¿«æ·å¼€å…³é¡µå³ä¸‹è§’ä¹Ÿä¼šæ˜¾ç¤ºä¸€ä¸ªç¼–è¾‘æŒ‰é’®ï¼Œç‚¹å‡»ä¹‹åå³å¯è‡ªå®šä¹‰æ·»åŠ /åˆ é™¤å¿«æ·å¼€å…³ï¼Œæˆ–æ‹–åŠ¨è¿›è¡Œæ’åºã€‚</p></li><li><p><strong>æ–°é€šçŸ¥æ¶ˆæ¯</strong></p><p><strong>é€šçŸ¥æ¶ˆæ¯å¿«æ·å›å¤</strong></p><p>åŠ å…¥äº†å…¨æ–°çš„APIï¼Œæ”¯æŒç¬¬ä¸‰æ–¹åº”ç”¨é€šçŸ¥çš„å¿«æ·æ“ä½œå’Œå›å¤ï¼Œä¾‹å¦‚æ¥ç”µä¼šä»¥æ¨ªå¹…æ–¹å¼åœ¨å±å¹•é¡¶éƒ¨å‡ºç°ï¼Œæä¾›æ¥å¬/æŒ‚æ–­ä¸¤ä¸ªæŒ‰é’®ï¼›ä¿¡æ¯/ç¤¾äº¤ç±»åº”ç”¨é€šçŸ¥ï¼Œè¿˜å¯ä»¥ç›´æ¥æ‰“å¼€é”®ç›˜ï¼Œåœ¨è¾“å…¥æ é‡Œè¿›è¡Œå¿«æ·å›å¤ã€‚</p><p><strong>é€šçŸ¥æ¶ˆæ¯å½’æ‹¢</strong></p><p>Android7.0ä¼šå°†åŒä¸€åº”ç”¨çš„å¤šæ¡é€šçŸ¥æç¤ºæ¶ˆæ¯å½’æ‹¢ä¸ºä¸€é¡¹ï¼Œç‚¹å‡»è¯¥é¡¹å³å¯å±•å¼€æ­¤å‰çš„å…¨éƒ¨é€šçŸ¥ï¼Œå…è®¸ç”¨æˆ·å¯¹æ¯ä¸ªé€šçŸ¥æ‰§è¡Œå•ç‹¬æ“ä½œã€‚</p></li><li><p>æµé‡ä¿æŠ¤æ¨¡å¼</p><p>æ–°å¢çš„æµé‡ä¿æŠ¤æ¨¡å¼ä¸ä»…å¯ä»¥ç¦æ­¢åº”ç”¨åœ¨åå°ä½¿ç”¨æµé‡ï¼Œè¿˜ä¼šè¿›ä¸€æ­¥å‡å°‘è¯¥åº”ç”¨åœ¨å‰å°æ—¶çš„æµé‡ä½¿ç”¨ã€‚æ¨æµ‹å…¶æœ‰å¯èƒ½ä½¿ç”¨äº†ç±»ä¼¼Chromeæµè§ˆå™¨çš„æ•°æ®å‹ç¼©æŠ€æœ¯ã€‚æ­¤å¤–ï¼Œè°·æ­Œè¿˜æ‰©å±•äº†ConnectivityManager APIçš„èƒ½åŠ›ï¼Œä½¿å¾—åº”ç”¨å¯ä»¥æ£€æµ‹ç³»ç»Ÿæ˜¯å¦å¼€å¯äº†æµé‡ä¿æŠ¤æ¨¡å¼ï¼Œæˆ–è€…æ£€æµ‹è‡ªå·±æ˜¯å¦åœ¨ç™½åå•ä¸­ã€‚Android7.0å…è®¸ç”¨æˆ·å•ç‹¬é’ˆå¯¹æ¯ä¸ªåº”ç”¨ï¼Œé€‰æ‹©æ˜¯å¦å¼€å¯æ•°æ®ä¿æŠ¤æ¨¡å¼ã€‚</p></li><li><p>èœå•é”®å¿«é€Ÿåº”ç”¨åˆ‡æ¢</p></li><li><p><strong>æ”¯æŒVR</strong></p></li><li><p>å¼•å…¥JITç¼–è¯‘å™¨</p><p>ä½¿å¾—Appå®‰è£…é€Ÿåº¦å¿«äº†75%ï¼Œç¼–è¯‘ä»£ç çš„è§„æ¨¡å‡å°‘äº†50%</p></li><li><p><strong>ç”»ä¸­ç”»</strong></p></li><li><p>Project Svelte: åå°ä¼˜åŒ–</p></li></ul><h2 id="Android-6-x"><a href="#Android-6-x" class="headerlink" title="Android 6.x"></a>Android 6.x</h2><ul><li><p><strong>åŠ¨æ€æƒé™ç®¡ç†</strong></p><p>Android 6.0å¼•å…¥äº†åŠ¨æ€æƒé™ç®¡ç†ï¼Œå°†æ ‡è®°ä¸ºå±é™©çš„æƒé™ä»å®‰è£…æ—¶æƒé™æ¨¡å‹ç§»åŠ¨åˆ°è¿è¡Œæ—¶æƒé™æ¨¡å‹ã€‚</p><blockquote><p>å®‰è£…æ—¶æƒé™æ¨¡å‹(Android5.1ä»¥åŠæ›´æ—©)ï¼šç”¨æˆ·åœ¨åº”ç”¨å®‰è£…å’Œæ›´æ–°æ—¶ï¼Œå¯¹å±é™©æƒé™æˆæƒã€‚ä½†æ˜¯OEMå’Œè¿è¡Œå•†é¢„è£…çš„åº”ç”¨å°†è‡ªåŠ¨é¢„æˆæƒã€‚</p><p>è¿è¡Œæ—¶æƒé™(Android6.0åŠä»¥å)ï¼šç”¨æˆ·åœ¨åº”ç”¨è¿è¡Œæ—¶ï¼Œå¯¹åº”ç”¨æˆäºˆå±é™©æƒé™ã€‚ç”±åº”ç”¨å†³å®šä½•æ—¶å»ç”³è¯·æƒé™ï¼ˆä¾‹å¦‚ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶æˆ–è€…ç”¨æˆ·è®¿é—®æŸä¸ªç‰¹æ€§æ—¶ï¼‰ï¼Œä½†å¿…é¡»å®¹è®¸ç”¨æˆ·æ¥æˆäºˆæˆ–è€…æ‹’ç»åº”ç”¨å¯¹ç‰¹å®šæƒé™ç»„çš„è®¿é—®ã€‚OEMå’Œè¿è¥å•†å¯ä»¥é¢„è£…åº”ç”¨ï¼Œä½†æ˜¯ä¸èƒ½å¯¹æƒé™è¿›è¡Œé¢„æˆæƒã€‚</p><p>è¿è¡Œæ—¶æƒé™æä¾›ç»™ç”¨æˆ·å…³äºåº”ç”¨æ‰€éœ€æƒé™æ›´å¤šçš„ç›¸å…³ä¸Šä¸‹æ–‡å’Œå¯è§†æ€§ï¼Œè¿™ä¹Ÿè®©å¼€å‘è€…å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„ç†è§£ï¼šä¸ºä»€ä¹ˆåº”ç”¨éœ€è¦æ‰€è¯·æ±‚çš„æƒé™ï¼Œæˆæƒå°†æœ‰ä»€ä¹ˆæ ·çš„å¥½å¤„ï¼Œæ‹’ç»å°†æœ‰ä½•ç§ä¸ä¾¿ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è®¾ç½®ä¸­çš„èœå•æ¥æ’¤é”€åº”ç”¨çš„æƒé™ã€‚</p></blockquote></li><li><p>æŒ‡çº¹è¯†åˆ«Finger Support</p><p>è¯´åˆ°æŒ‡çº¹è¯†åˆ«ï¼Œå¾ˆå¤šç”¨æˆ·éƒ½ä¼šè§‰å¾—ç°åœ¨çš„ä¸­é«˜ç«¯androidæ‰‹æœºéƒ½æ”¯æŒï¼Œä½†äº‹å®ä¸Šè¿™äº›androidæ‰‹æœºçš„æŒ‡çº¹è¯†åˆ«éƒ½æ˜¯å„ä¸ªå‚å•†è‡ªè¡Œå¼€å‘çš„å¹¶æ²¡æœ‰ç³»ç»Ÿåº•å±‚çš„æ”¯æŒã€‚Android 6.0åˆ™åœ¨ç³»ç»Ÿå±‚é¢åŠ å…¥æŒ‡çº¹è¯†åˆ«ï¼Œèƒ½æä¾›åŸç”ŸæŒ‡çº¹è¯†åˆ«APIï¼Œè¿™ä¸ä½†é™ä½äº†å‚å•†å¼€å‘æŒ‡çº¹è¯†åˆ«æ¨¡å—çš„æˆæœ¬ï¼Œæœ€é‡è¦çš„æ˜¯åŸç”ŸæŒ‡çº¹è¯†åˆ«å°†ä¼šå¤§å¤§æå‡androidæ‰‹æœºçš„æŒ‡çº¹è¯†åˆ«æ”¯ä»˜å®‰å…¨æ€§</p></li><li><p>ç”µæ± ç®¡ç†</p><p>Android 6.0ä½¿ç”¨ä¸‹åˆ—ç‰¹æ€§æ¥å»¶é•¿ç”µæ± ä½¿ç”¨æ—¶é—´ï¼š</p><blockquote><p>App Standbyï¼ˆåº”ç”¨å¾…æœºï¼‰: ç³»ç»Ÿå¯ä»¥å°†æœªä½¿ç”¨çš„åº”ç”¨ç½®ä¸ºAppStandbyæ¨¡å¼ï¼Œä¸´æ—¶é™åˆ¶è¿™äº›åº”ç”¨çš„ç½‘ç»œè®¿é—®ï¼Œå»¶è¿ŸåŒæ­¥å’Œåå°job</p><p>Dozeï¼ˆçŒç¡ï¼‰: å¦‚æœç”¨æˆ·åœ¨æŸä¸ªæ—¶é—´æœŸé™å†…æœªä¸»åŠ¨ä½¿ç”¨è®¾å¤‡ï¼ˆå±å¹•å…³é—­ã€è®¾å¤‡é™æ­¢ï¼‰ï¼Œå¹³å°å°†è¿›å…¥æ·±åº¦ç¡çœ çŠ¶æ€ã€‚å› ä¸ºè¯¥ç‰¹æ€§è¦æ±‚å¹³å°æ£€æµ‹é™æ­¢çŠ¶æ€ï¼Œå› æ­¤åªæœ‰é‚£äº›åœ¨Sensor HALä¸­å®ç°äº†æ˜¾å¼ç§»åŠ¨æ£€æµ‹APIçš„è®¾å¤‡ä¸­æ‰æœ‰æ•ˆã€‚</p><p>Exemptionsï¼ˆè±å…ï¼‰: é¢„è£…åœ¨è®¾å¤‡ä¸Šçš„ç³»ç»Ÿåº”ç”¨å’Œäº‘æ¶ˆæ¯æœåŠ¡ï¼Œé»˜è®¤é€šå¸¸è¢«è±å…ã€‚åº”ç”¨å¼€å‘è€…å¯ä»¥è¦æ±‚å…¶åº”ç”¨ä½¿ç”¨è¿™ç§è®¾å®šã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨è®¾ç½®ä¸­æ¥è±å…æŸäº›åº”ç”¨ã€‚</p></blockquote></li><li><p>Android Pay</p><p>Androidæ”¯ä»˜ç»Ÿä¸€æ ‡å‡†ã€‚æ–°çš„Mç³»ç»Ÿä¸­é›†æˆäº†Android Payã€‚å…¶ç‰¹æ€§åœ¨äºç®€æ´ã€å®‰å…¨ã€å¯é€‰æ€§ã€‚Android Payæ˜¯ä¸€ä¸ªå¼€æ”¾æ€§å¹³å°ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è°·æ­Œçš„æœåŠ¡æˆ–è€…ä½¿ç”¨é“¶è¡Œçš„APPæ¥ä½¿ç”¨å®ƒï¼ŒAndroid Payæ”¯æŒ4.4ä»¥åçš„ç³»ç»Ÿè®¾å¤‡ï¼ŒGoogleå®£å¸ƒAndroid Payå·²ç»ä¸ç¾å›½ä¸‰å¤§è¿è¥å•†700å¤šå®¶å•†åº—è¾¾æˆåˆä½œï¼Œæ”¯ä»˜åŠŸèƒ½å¯ä»¥ä½¿ç”¨æŒ‡çº¹æ”¯ä»˜ã€‚</p></li><li><p>å­˜å‚¨</p><p>åœ¨ä¹‹å‰ï¼Œå®‰å“ç³»ç»Ÿè™½ç„¶å¯ä»¥æ”¯æŒTFå¡æ‰©å±•ï¼Œä½†TFå¡æ‰©å±•çš„å®¹é‡åªèƒ½å½“æˆå¤–ç½®å­˜å‚¨ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥æŠŠç…§ç‰‡ã€éŸ³ä¹ç­‰å†…å®¹æ”¾è¿›å»ï¼Œä½†Appä¸èƒ½å®‰è£…åˆ°å…¶ä¸­ã€‚åœ¨å®‰å“6.0ä¸­ï¼Œå½“é¦–æ¬¡æ’å…¥TFå¡çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè¯¢é—®ä¼šå°†TFå¡ä½œä¸ºå¤–ç½®è¿˜æ˜¯å†…ç½®å‚¨å­˜ã€‚å¦‚æœé€‰æ‹©ä½œä¸ºå†…ç½®å­˜å‚¨ï¼Œç³»ç»Ÿåˆ™ä¼šå¯¹TFå¡æ ¼å¼åŒ–å¹¶åŠ å¯†â€”â€”æ³¨æ„ï¼Œè¿™ä¼šä¸¢å¤±æ•°æ®ï¼ç„¶åï¼ŒTFå¡çš„å®¹é‡å°±å’Œè®¾å¤‡çš„å†…ç½®å­˜å‚¨èåˆäº†ã€‚</p></li><li><p><strong>å–æ¶ˆæ”¯æŒ Apache HTTP å®¢æˆ·ç«¯</strong></p></li><li><p>BoringSSL</p></li><li><p>ç¡¬ä»¶æ ‡è¯†ç¬¦è®¿é—®æƒ</p></li><li><p>é€šçŸ¥</p></li><li><p>éŸ³é¢‘ç®¡ç†å™¨å˜æ›´</p></li><li><p><strong>æ”¯æŒæ–‡æœ¬é€‰æ‹©</strong></p></li><li><p>Android å¯†é’¥åº“ä¸å†æ”¯æŒ DSAã€‚ä½†ä»æ”¯æŒ ECDSA</p></li><li><p>WLAN å’Œç½‘ç»œè¿æ¥å˜æ›´</p></li><li><p>ç›¸æœºæœåŠ¡å˜æ›´</p></li><li><p>APK éªŒè¯</p></li><li><p>USB è¿æ¥</p></li></ul><h2 id="Android-5-0"><a href="#Android-5-0" class="headerlink" title="Android 5.0"></a>Android 5.0</h2><ul><li><p><strong>Android Runtime (ART)é»˜è®¤è¿è¡Œå¹³å°è®¾ç½®</strong></p><p>æ”¯æŒ64ä½ARTè™šæ‹Ÿæœºã€‚æ–°ç³»ç»Ÿæ”¾å¼ƒäº†ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„Dalvikè™šæ‹Ÿæœºï¼Œæ”¹ç”¨äº†ARTæ¨¡å¼ï¼Œå®ç°äº†çœŸæ­£çš„è·¨å¹³å°ç¼–è¯‘ã€‚ARTè™šæ‹Ÿæœºç¼–è¯‘å™¨åœ¨å†…å­˜å ç”¨åŠåº”ç”¨ç¨‹åºåŠ è½½æ—¶é—´ä¸Šè¿›è¡Œäº†å¤§å¹…æå‡ï¼Œè°·æ­Œæ‰¿è¯ºæ‰€æœ‰æ€§èƒ½éƒ½ä¼šæ¯”åŸæ¥æå‡ä¸€å€ã€‚å¦å¤–ï¼Œå¯¹64ä½çš„æ”¯æŒä¹Ÿè®©ARTè™šæ‹Ÿæœºå¦‚é±¼å¾—æ°´ï¼Œå¼€å‘è€…å¯ä»¥é’ˆå¯¹åƒART Cortex-A57è¿™æ ·çš„64ä½æ¶æ„æ ¸å¿ƒå¼€å‘åº”ç”¨ç¨‹åºã€‚ Android Læ”¯æŒæ›´å¤§çš„å¯„å­˜å™¨ï¼Œæ”¯æŒæ–°çš„æŒ‡ä»¤é›†ï¼Œæå‡äº†å†…å­˜å¯»å€ç©ºé—´ï¼Œæœªæ¥Androidæ™ºèƒ½æ‰‹æœºå°†æ”¯æŒ4GBä»¥ä¸Šçš„å†…å­˜ã€‚</p></li><li><p><strong>å…¨æ–°é€šçŸ¥ä¸­å¿ƒè®¾è®¡</strong></p><ul><li>Material Design æ ·å¼</li><li>å£°éŸ³å’ŒæŒ¯åŠ¨</li><li>é”å®šå±å¹•å¯è§æ€§</li><li>åª’ä½“æ’­æ”¾</li></ul><ul><li>æµ®åŠ¨é€šçŸ¥</li></ul><p>Googleåœ¨android Lä¸­åŠ å…¥äº†å…¨æ–°é£æ ¼çš„é€šçŸ¥ç³»ç»Ÿã€‚æ”¹è¿›åçš„é€šçŸ¥ç³»ç»Ÿä¼šä¼˜å…ˆæ˜¾ç¤ºå¯¹ç”¨æˆ·æ¥è¯´æ¯”è¾ƒé‡è¦çš„ä¿¡æ¯ï¼Œè€Œå°†ä¸å¤ªç´§æ€¥çš„å†…å®¹éšè—èµ·æ¥ã€‚ç”¨æˆ·åªéœ€è½»è½»å‘ä¸‹æ»‘åŠ¨å°±å¯ä»¥æŸ¥çœ‹å…¨éƒ¨çš„é€šçŸ¥å†…å®¹ã€‚</p><p>æ–°çš„é€šçŸ¥ç³»ç»Ÿå¦å¤–ä¸€ä¸ªå¾ˆé…·çš„æ–°åŠŸèƒ½æ˜¯åœ¨é”å±ç•Œé¢ä¹Ÿå¯ä»¥ç›´æ¥æŸ¥çœ‹é€šçŸ¥æ¶ˆæ¯äº†ã€‚ä¸ä»…å¦‚æ­¤ï¼Œç”¨æˆ·è¿˜å¯ä»¥ç›´æ¥åœ¨é”å±çš„æƒ…å†µä¸‹å›å¤æˆ–è¿›å…¥åº”ç”¨ã€‚å¦å¤–ï¼Œå¦‚æœåœ¨æ“ä½œæ‰‹æœºçš„è¿‡ç¨‹ä¸­æœ‰ç”µè¯è¿›å…¥ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œå…¨ç”»é¢çš„åˆ‡æ¢ï¼Œè€Œæ˜¯åŒæ ·ä»¥é€šçŸ¥çš„æ–¹å¼å‘ŠçŸ¥ç”¨æˆ·ã€‚</p></li><li><p><strong>å¼•å…¥Material Designè®¾è®¡</strong></p><p><strong>æ‰å¹³åŒ–çš„è®¾è®¡ç†å¿µï¼Œæ–°çš„è§†è§‰è¯­è¨€ï¼Œåœ¨åŸºæœ¬å…ƒç´ çš„å¤„ç†ä¸Šï¼Œå‡ ä»¶äº†ä¼ ç»Ÿçš„å°åˆ·è®¾è®¡ï¼Œå­—ä½“ç‰ˆå¼ã€ç½‘æ ¼ç³»ç»Ÿã€ç©ºé—´ã€æ¯”ä¾‹ã€è°ƒè‰²ã€å›¾åƒä½¿ç”¨ç­‰è¿™äº›åŸºç¡€çš„å¹³é¢è®¾è®¡è§„èŒƒã€‚</strong><br>ä½œä¸ºæˆ‘ä»¬å¼€å‘è€…ï¼Œæœ€å…³å¿ƒçš„è¿˜æ˜¯å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Material Designé£æ ¼ï¼š<br>è®¾ç½®åº”ç”¨çš„ targetSdkVersion å’Œ targetSdkVersion ä¸º21<br>åœ¨valuesç›®å½•ä¸‹çš„styleèµ„æºæ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªstyleï¼Œè®©å…¶ç»§æ‰¿è‡ª android:Theme.Material<br>åœ¨AndroidManifestä¸­æŒ‡å®šåº”ç”¨çš„ä¸»é¢˜æˆ–è€…Activityçš„ä¸»é¢˜ä¸ºæˆ‘ä»¬è®¾å®šçš„æ ·å¼<br>è°·æ­Œå®˜æ–¹æˆ‘ä»¬æä¾›äº†ä¸‰ç§é…è‰²é£æ ¼çš„Material Designæ ·å¼ï¼š</p><pre><code>é»‘è‰²ä¸»é¢˜ Theme.Materialæ˜äº®ä¸»é¢˜ Theme.Material.Lightæ˜äº®ä¸»é¢˜é»‘è‰²ActionBar Theme.Material.Light.DarkActionBaræˆ‘ä»¬ä¹Ÿå¯ä»¥ç»§æ‰¿ç³»ç»Ÿæä¾›çš„Material Designæ ·å¼ï¼Œè¿›è¡Œé…è‰²ä¿®æ”¹ï¼šthemecolor</code></pre></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">android:colorPrimaryDarkåº”ç”¨çš„ä¸»è¦æš—è‰²è°ƒï¼ŒstatusBarColoré»˜è®¤ä½¿ç”¨è¯¥é¢œè‰²</div><div class="line">android:statusBarColorçŠ¶æ€æ é¢œè‰²ï¼Œé»˜è®¤ä½¿ç”¨colorPrimaryDark</div><div class="line">android:colorPrimaryåº”ç”¨çš„ä¸»è¦è‰²è°ƒï¼ŒactionBaré»˜è®¤ä½¿ç”¨è¯¥é¢œè‰²</div><div class="line">android:windowBackgroundçª—å£èƒŒæ™¯é¢œè‰²</div><div class="line">android:navigationBarColoråº•éƒ¨æ é¢œè‰²</div><div class="line">android:colorForegroundåº”ç”¨çš„å‰æ™¯è‰²ï¼ŒListViewçš„åˆ†å‰²çº¿ï¼Œswitchæ»‘åŠ¨åŒºé»˜è®¤ä½¿ç”¨è¯¥é¢œè‰²</div><div class="line">android:colorBackgroundåº”ç”¨çš„èƒŒæ™¯è‰²ï¼ŒpopMenuçš„èƒŒæ™¯é»˜è®¤ä½¿ç”¨è¯¥é¢œè‰²</div><div class="line">android:colorAccent ä¸€èˆ¬æ§ä»¶çš„é€‰ç§æ•ˆæœé»˜è®¤é‡‡ç”¨è¯¥é¢œè‰²</div><div class="line">android:colorControlNormal æ§ä»¶çš„é»˜è®¤è‰²è°ƒã€€</div><div class="line">android:colorControlHighlightæ§ä»¶æŒ‰å‹æ—¶çš„è‰²è°ƒ</div><div class="line">android:colorControlActivatedæ§ä»¶é€‰ä¸­æ—¶çš„é¢œè‰²ï¼Œé»˜è®¤ä½¿ç”¨colorAccent</div><div class="line">android:colorButtonNormalé»˜è®¤æŒ‰é’®çš„èƒŒæ™¯é¢œè‰²</div><div class="line">android:textColor Buttonï¼ŒtextViewçš„æ–‡å­—é¢œè‰²</div><div class="line">android:textColorPrimaryDisableOnly RadioButton checkboxç­‰æ§ä»¶çš„æ–‡å­—</div><div class="line">android:textColorPrimary åº”ç”¨çš„ä¸»è¦æ–‡å­—é¢œè‰²ï¼ŒactionBarçš„æ ‡é¢˜æ–‡å­—é»˜è®¤ä½¿ç”¨è¯¥é¢œè‰²</div></pre></td></tr></table></figure><p>ä¸»é¢˜ä¸ä»…å¯ä»¥å¯¹Applicationå’ŒActivityä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å¯¹æŸä¸€ä¸ªæ§ä»¶å•ä½¿ç”¨ï¼Œæˆ–è€…æ˜¯åœ¨xmlå¸ƒå±€ä¸­ç»™ä¸€ä¸ªæ ¹èŠ‚ç‚¹æ§ä»¶è®¾ç½®Android:themeå±æ€§ï¼Œæ¥ä¿®æ”¹å®ƒå’Œå®ƒæ‰€æœ‰å­æ§ä»¶çš„ä¸»é¢˜ã€‚<br>å¦‚æœæˆ‘ä»¬è¦å¯¹ç‰¹å®šæ§ä»¶å®ä¾‹åšè‡ªå®šä¹‰ä¿®æ”¹ï¼Œæ›´å»ºè®®å¤§å®¶å¯ä»¥é€šè¿‡æ§ä»¶è‡ªèº«çš„APIè¿›è¡Œè®¾ç½®ä¿®æ”¹ã€‚</p><ul><li><p><strong>Project Voltaç”µæ± ç»­èˆªæ”¹è¿›è®¡åˆ’</strong></p><p>Project Voltaè®¡åˆ’å¢åŠ äº†æ–°å·¥å…·å¯ä»¥è®©å¼€å‘è€…èƒ½å¤Ÿæ›´å®¹æ˜“çš„æ‰¾å‡ºä¸ºä½•è‡ªå·±çš„åº”ç”¨ç¨‹åºä¼šå¯¹ç”µé‡äº§ç”Ÿæ¯”è¾ƒå¤§çš„å½±å“ï¼ŒåŒæ—¶ç¡®ä¿åœ¨æ‰§è¡ŒæŸäº›ä»»åŠ¡æ—¶å°†æ‰‹æœºç”µé‡çš„å½±å“é™è‡³æœ€ä½ã€‚é¦–å…ˆï¼ŒBattery Historianå¯ä»¥åˆ—å‡ºæ‰‹æœºç”µé‡æ¶ˆè€—çš„è¯¦ç»†æƒ…å†µï¼Œå¸®åŠ©å¼€å‘è€…è¯†åˆ«ç”µé‡æ¶ˆè€—çš„åŸå› æˆ–è€…æ˜¯å“ªä¸ªç¡¬ä»¶æˆ–ä»»åŠ¡å¯¹ç”µæ± å¯¿å‘½çš„å½±å“æ¯”è¾ƒå¤§ï¼›è€ŒJob Scheduler APIåˆ™å¯ä»¥è®©å¼€å‘è€…æ›´å®¹æ˜“çš„é€‰æ‹©åˆé€‚çš„æ—¶æœºè§¦å‘ç”µé‡æ¶ˆè€—æ¯”è¾ƒé«˜çš„ä»»åŠ¡ï¼Œé¿å…åœ¨ä½ç”µé‡æˆ–æœªå®Œæˆå……ç”µæ—¶æ›´æ–°åº”ç”¨ç¨‹åºã€‚</p><p>è€Œå¯¹äºç”¨æˆ·å±‚é¢ä¸Šï¼ŒAndroid L å¢åŠ äº†Battery Saveræ¨¡å¼ï¼Œåœ¨ä½ç”µé‡æ—¶ç³»ç»Ÿä¼šè°ƒæ•´æŸäº›è€—ç”µè®¾ç½®ï¼Œå¦‚é™ä½å±å¹•äº®åº¦ã€é™åˆ¶è‡ªåŠ¨æ›´æ¢èƒŒæ™¯ç­‰ã€‚</p></li><li><p>å…¨æ–°çš„â€æœ€è¿‘åº”ç”¨ç¨‹åºâ€œ</p><p>é™¤äº†ç•Œé¢é£æ ¼è®¾è®¡çš„æ”¹å˜ä¹‹å¤–ï¼Œæ–°çš„æœ€è¿‘åº”ç”¨ç•Œé¢è¿˜å€Ÿé‰´äº†Chromeæµè§ˆå™¨çš„ç†å¿µï¼Œé‡‡ç”¨å•ç‹¬çš„æ ‡ç­¾å±•ç¤ºæ–¹å¼ã€‚è€Œä¸”ï¼Œè°·æ­Œå·²ç»å‘å¼€å‘è€…å¼€æ”¾äº†APIï¼Œæ‰€ä»¥ç¬¬ä¸‰æ–¹å¼€å‘äººå‘˜å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ”¹è¿›ä¸ºç‰¹å®šçš„åº”ç”¨å¢åŠ å…¨æ–°çš„åŠŸèƒ½ã€‚getAppTasks()</p></li><li><p>æ”¹è¿›å®‰å…¨æ€§</p></li><li><p>æ”¯æŒå¤šç§è®¾å¤‡</p><p>å¯ä»¥åœ¨æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€ç¬”è®°æœ¬ç”µè„‘ã€æ™ºèƒ½ç”µè§†ã€æ±½è½¦ã€æ™ºèƒ½æ‰‹è¡¨ç”šè‡³æ˜¯å„ç§å®¶ç”¨ç”µå­äº§å“ç­‰è®¾å¤‡ä¸Šä½¿ç”¨Androidç³»ç»Ÿã€‚</p></li><li><p>æ”¯æŒOpenGL ES3.1</p></li><li><p>åª’ä½“æ§ä»¶å’Œ RemoteControlClient</p></li><li><p><strong>æ”¯æŒAndroid NDKä¸­çš„64ä½</strong></p></li><li><p><strong>åªèƒ½æ˜¾ç¤ºç»‘å®šåˆ°æœåŠ¡ï¼Œå–æ¶ˆéšè—ç»‘å®šæœåŠ¡</strong></p></li><li><p>WebView APIä¿®æ”¹</p></li><li><p>è‡ªå®šä¹‰æƒé™å”¯ä¸€æ€§è¦æ±‚</p></li><li><p><strong>TLS/SSL é»˜è®¤é…ç½®å˜æ›´</strong></p><ul><li>æœåŠ¡å™¨ä¸æ”¯æŒä»»ä½•å·²å¯ç”¨çš„åŠ å¯†å¥—ä»¶</li><li>åº”ç”¨å¯¹ç”¨äºè¿æ¥æœåŠ¡å™¨çš„åŠ å¯†å¥—ä»¶åšå‡ºé”™è¯¯çš„å‡è®¾</li><li>æœåŠ¡å™¨ä¸æ”¯æŒ TLSv1.1ã€TLSv1.2 æˆ–æ–°çš„ TLS æ‰©å±•</li></ul></li><li>æ”¯æŒæ‰˜ç®¡é…ç½®æ–‡ä»¶</li></ul><h2 id="Android-4-4"><a href="#Android-4-4" class="headerlink" title="Android 4.4"></a>Android 4.4</h2><ul><li><strong>æ”¯æŒAndroid Beam</strong></li><li><strong>æ·»åŠ æ‰“å°æ¡†æ¶</strong></li><li>å­˜å‚¨è®¿é—®æ¡†æ¶</li><li>ä½åŠŸè€—ä¼ æ„Ÿå™¨</li><li>æ·»åŠ çŸ­ä¿¡æä¾›ç¨‹åº</li><li><strong>æ·»åŠ å…¨å±æ²‰æµ¸æ¨¡å¼</strong><ul><li>Android æ²‰æµ¸å¼çŠ¶æ€æ çš„ä¸‰ç§å®ç°æ–¹å¼</li><li>å…¼å®¹åº“SystemBarTint</li></ul></li><li><strong>æ·»åŠ é€æ˜ç³»ç»Ÿ UI æ ·å¼</strong></li><li>æ·»åŠ æ–°çš„åª’ä½“åŠŸèƒ½</li><li>RenderScript Compute<ul><li>æŒç»­æ€§èƒ½æå‡</li><li><strong>GPU åŠ é€Ÿ</strong></li><li>Android NDK ä¸­çš„ RenderScript</li></ul></li><li>å›¾å½¢<ul><li>GLES2.0 SurfaceFlinge</li><li>æ–°çš„ç¡¬ä»¶åˆæˆå™¨æ”¯æŒè™šæ‹Ÿæ˜¾ç¤º</li></ul></li><li>æ”¯æŒæ–°çš„è¿æ¥ç±»å‹<ul><li>æ–°çš„è“ç‰™é…ç½®æ–‡ä»¶</li><li>çº¢å¤–å‘å°„å™¨</li><li>Wi-Fi TDLS æ”¯æŒ</li></ul></li><li>æ— éšœç¢åŠŸèƒ½</li><li>å®‰å…¨å¢å¼ºåŠŸèƒ½</li><li>å†…å­˜ä½¿ç”¨ç‡åˆ†æå·¥å…·<ul><li>Procstats</li></ul></li></ul><h2 id="Android-4-0-4-1-4-2-4-3"><a href="#Android-4-0-4-1-4-2-4-3" class="headerlink" title="Android 4.0,4.1,4.2,4.3"></a>Android 4.0,4.1,4.2,4.3</h2><ul><li>æ”¯æŒOpenGL ES 3.0</li><li>å¢å¼ºè“ç‰™è¿æ¥</li><li>ä¼˜åŒ–ä½ç½®å’Œä¼ æ„Ÿå™¨</li><li><strong>æ·»åŠ è½¬åœºåŠ¨ç”»</strong></li><li>æ”¯æŒDaydream</li><li><strong>äººè„¸è¯†åˆ«è§£é”</strong></li><li><strong>Photo Sphere å…¨æ™¯ç›¸ç‰‡</strong></li></ul><h1 id="Android-API-å¯¹ç…§è¡¨"><a href="#Android-API-å¯¹ç…§è¡¨" class="headerlink" title="Android API å¯¹ç…§è¡¨"></a>Android API å¯¹ç…§è¡¨</h1><p>Android Betaï¼Œå‘å¸ƒäº2007å¹´11æœˆ5æ—¥ï¼ŒåŒæ—¶çš„è½¯ä»¶å¼€å‘å¥—ä»¶(SDK)ï¼Œå‘å¸ƒäº2007å¹´11æœˆ12æ—¥ã€‚ 11æœˆ5æ—¥è¢«è®¤ä¸ºæ˜¯Androidçš„â€ç”Ÿæ—¥â€ã€‚</p><p>Androidæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ä¸ªAPI Levelï¼Œå¯¹åº”ç€æŸä¸ªAndroidå‘å¸ƒç‰ˆæœ¬çš„åç§°ã€‚</p><table><thead><tr><th>Androidç‰ˆæœ¬åç§°Code name</th><th>Androidç‰ˆæœ¬</th><th>ç‰ˆæœ¬å‘å¸ƒæ—¶é—´</th><th>å¯¹åº”API</th></tr></thead><tbody><tr><td>(no code name)</td><td>1.0</td><td>2008å¹´9æœˆ23æ—¥</td><td>API level 1</td></tr><tr><td>(no code name)</td><td>1.1</td><td>2009å¹´2æœˆ9æ—¥</td><td>API level 2</td></tr><tr><td>Cupcake çº¸æ¯è›‹ç³•</td><td>1.5</td><td>2009å¹´4æœˆ27æ—¥</td><td>API level 3,NDK 1</td></tr><tr><td>Donut ç”œç”œåœˆ</td><td>1.6</td><td>2009å¹´9æœˆ15æ—¥</td><td>API level 4,NDK 2</td></tr><tr><td>Eclair æ³¡èŠ™</td><td>2</td><td>2009å¹´10æœˆ26æ—¥</td><td>API level 5</td></tr><tr><td>Eclair</td><td>2.0.1</td><td>2009å¹´12æœˆ3æ—¥</td><td>API level 6</td></tr><tr><td>Eclair</td><td>2.1</td><td>2010å¹´1æœˆ12æ—¥</td><td>API level 7,NDK3</td></tr><tr><td>Froyo å†»é…¸å¥¶</td><td>2.2.x</td><td>2010å¹´5æœˆ20æ—¥</td><td>API level 8,NDK 4</td></tr><tr><td>Gingerbread å§œé¥¼</td><td>2.3 â€“ 2.3.2</td><td>2010å¹´12æœˆ6æ—¥</td><td>API level 9,NDK5</td></tr><tr><td>Gingerbread</td><td>2.3.3 â€“ 2.3.7</td><td>2011å¹´2æœˆ9æ—¥</td><td>API level 10</td></tr><tr><td>Honeycomb èœ‚å·¢</td><td>3.0</td><td>2011å¹´2æœˆ22æ—¥</td><td>API level 11</td></tr><tr><td>Honeycomb</td><td>3.1</td><td>2011å¹´5æœˆ10æ—¥</td><td>API level 12,NDK 6</td></tr><tr><td>Honeycomb</td><td>3.2.x</td><td>2011å¹´7æœˆ15æ—¥</td><td>API level 13</td></tr><tr><td>Ice Cream Sandwich</td><td>4.0.1 â€“ 4.0.2</td><td>2011å¹´10æœˆ18æ—¥</td><td>API level 14,NDK 7</td></tr><tr><td>Ice Cream Sandwich</td><td>4.0.3 â€“ 4.0.4</td><td>2011å¹´12æœˆ16æ—¥</td><td>API level 15,NDK 8</td></tr><tr><td>Jelly Bean æœå†»è±†</td><td>4.1.x</td><td>2012å¹´7æœˆ9æ—¥</td><td>API level 16</td></tr><tr><td>Jelly Bean</td><td>4.2.x</td><td>2012å¹´11æœˆ13æ—¥</td><td>API level 17</td></tr><tr><td>Jelly Bean</td><td>4.3.x</td><td>2013å¹´7æœˆ24æ—¥</td><td>API level 18</td></tr><tr><td>KitKat å¥‡å·§</td><td>4.4.x</td><td>2013å¹´10æœˆ31æ—¥</td><td>API level 19</td></tr><tr><td>KitKat</td><td>4.4W.x</td><td>2014å¹´6æœˆ25æ—¥</td><td>API level 20</td></tr><tr><td>Lollipop(Android L) æ£’æ£’ç³–</td><td>5.0 â€“ 5.0.2</td><td>2014å¹´11æœˆ12æ—¥</td><td>API level 21</td></tr><tr><td>Lollipop(Android L)</td><td>5.1 â€“ 5.1.1</td><td>2015å¹´3æœˆ9æ—¥</td><td>API level 22</td></tr><tr><td>Marshmallow(Android M)</td><td>6.0 â€“ 6.0.1</td><td>2015å¹´10æœˆ5æ—¥</td><td>API level 23</td></tr><tr><td>Nougat(Android N) ç‰›è½§ç³–</td><td>7.0</td><td>2016å¹´8æœˆ22æ—¥</td><td>API level 24</td></tr><tr><td>Nougat(Android N)</td><td>7.1.1</td><td>2016å¹´10æœˆ</td><td>API level 25</td></tr><tr><td>Oreo(Android O) å¥¥åˆ©å¥¥</td><td>8.0</td><td>2017å¹´3æœˆ21æ—¥</td><td>API level 26</td></tr><tr><td>Oreo(Android O) Android Go</td><td>8.1</td><td>2017å¹´12æœˆ6æ—¥</td><td>API level 27</td></tr><tr><td>Pistachio Ice Cream(Android P)</td><td>9</td><td>2018å¹´8æœˆ6æ—¥</td><td>API level 28</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Android-å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€&quot;&gt;&lt;a href=&quot;#Android-å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€&quot; class=&quot;headerlink&quot; title=&quot;Android å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€&quot;&gt;&lt;/a&gt;Android å„ç‰ˆæœ¬ç‰¹æ€§æ€»ç»“ã€&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æŒ
      
    
    </summary>
    
    
      <category term="Android" scheme="https://edward7zhang.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Androidä¸­çš„å†…å­˜æ³„æ¼æ€»ç»“</title>
    <link href="https://edward7zhang.github.io/2019/03/11/Android%E4%B8%AD%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%80%BB%E7%BB%93/"/>
    <id>https://edward7zhang.github.io/2019/03/11/Androidä¸­çš„å†…å­˜æ³„æ¼æ€»ç»“/</id>
    <published>2019-03-11T04:07:14.000Z</published>
    <updated>2019-03-12T07:21:37.394Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å†…å­˜ç®¡ç†çš„ç›®çš„å°±æ˜¯è®©æˆ‘ä»¬åœ¨å¼€å‘ä¸­æ€ä¹ˆæœ‰æ•ˆçš„é¿å…æˆ‘ä»¬çš„åº”ç”¨å‡ºç°å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚å†…å­˜æ³„æ¼å¤§å®¶éƒ½ä¸é™Œç”Ÿäº†ï¼Œç®€å•ç²—ä¿—çš„è®²ï¼Œå°±æ˜¯è¯¥è¢«é‡Šæ”¾çš„å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼Œä¸€ç›´è¢«æŸä¸ªæˆ–æŸäº›å®ä¾‹æ‰€æŒæœ‰å´ä¸å†è¢«ä½¿ç”¨å¯¼è‡´ GC ä¸èƒ½å›æ”¶ã€‚<br>æˆ‘ä¼šä» Java å†…å­˜æ³„æ¼çš„åŸºç¡€çŸ¥è¯†å¼€å§‹ï¼Œå¹¶ä¸”é€šè¿‡å…·ä½“ä¾‹å­æ¥è¯´æ˜ Android å¼•èµ·å†…å­˜æ³„æ¼çš„å„ç§åŸå› ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨å·¥å…·æ¥åˆ†æåº”ç”¨å†…å­˜æ³„æ¼ï¼Œæœ€åå†åšæ€»ç»“ã€‚<br>ç¯‡å¹…ç•¥é•¿ï¼Œå¤§å®¶å¯ä»¥åˆ†å‡ èŠ‚æ¥çœ‹ï¼</p></blockquote><h1 id="Java-å†…å­˜åˆ†é…ç­–ç•¥"><a href="#Java-å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="Java å†…å­˜åˆ†é…ç­–ç•¥"></a>Java å†…å­˜åˆ†é…ç­–ç•¥</h1><p>Java ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜åˆ†é…ç­–ç•¥æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯é™æ€åˆ†é…ã€æ ˆå¼åˆ†é…ã€å †å¼åˆ†é…ï¼Œå¯¹åº”çš„ä¸‰ç§å­˜å‚¨ç­–ç•¥ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸»è¦åˆ†åˆ«æ˜¯é™æ€å­˜å‚¨åŒºï¼ˆä¹Ÿç§°æ–¹æ³•åŒºï¼‰ã€æ ˆåŒºå’Œå †åŒºã€‚</p><ul><li>é™æ€å­˜å‚¨åŒº(æ–¹æ³•åŒº)ï¼šä¸»è¦å­˜æ”¾é™æ€æ•°æ®ã€å…¨å±€ static æ•°æ®å’Œå¸¸é‡ã€‚è¿™å—å†…å­˜åœ¨ç¨‹åºç¼–è¯‘æ—¶å°±å·²ç»åˆ†é…å¥½ï¼Œå¹¶ä¸”åœ¨ç¨‹åºæ•´ä¸ªè¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ã€‚</li><li>æ ˆåŒºï¼šå½“æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œæ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡éƒ½åœ¨æ ˆä¸Šåˆ›å»ºï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶è¿™äº›å±€éƒ¨å˜é‡æ‰€æŒæœ‰çš„å†…å­˜å°†ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾ã€‚å› ä¸ºæ ˆå†…å­˜åˆ†é…è¿ç®—å†…ç½®äºå¤„ç†å™¨çš„æŒ‡ä»¤é›†ä¸­ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯åˆ†é…çš„å†…å­˜å®¹é‡æœ‰é™ã€‚</li><li>å †åŒºï¼šåˆç§°åŠ¨æ€å†…å­˜åˆ†é…ï¼Œé€šå¸¸å°±æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œæ—¶ç›´æ¥ new å‡ºæ¥çš„å†…å­˜ã€‚è¿™éƒ¨åˆ†å†…å­˜åœ¨ä¸ä½¿ç”¨æ—¶å°†ä¼šç”± Java åƒåœ¾å›æ”¶å™¨æ¥è´Ÿè´£å›æ”¶ã€‚</li></ul><h2 id="æ ˆä¸å †çš„åŒºåˆ«ï¼š"><a href="#æ ˆä¸å †çš„åŒºåˆ«ï¼š" class="headerlink" title="æ ˆä¸å †çš„åŒºåˆ«ï¼š"></a>æ ˆä¸å †çš„åŒºåˆ«ï¼š</h2><p>åœ¨æ–¹æ³•ä½“å†…å®šä¹‰çš„ï¼ˆå±€éƒ¨å˜é‡ï¼‰ä¸€äº›åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡éƒ½æ˜¯åœ¨æ–¹æ³•çš„æ ˆå†…å­˜ä¸­åˆ†é…çš„ã€‚æŒ¡åœ¨ä¸€æ®µæ–¹æ³•å—ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJava å°±ä¼šåœ¨æ ˆä¸­ä¸ºè¯¥å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå½“è¶…è¿‡è¯¥å˜é‡çš„ä½œç”¨åŸŸåï¼Œè¯¥å˜é‡ä¹Ÿå°±æ— æ•ˆäº†ï¼Œåˆ†é…ç»™å®ƒçš„å†…å­˜ç©ºé—´ä¹Ÿå°†è¢«é‡Šæ”¾æ‰ï¼Œè¯¥å†…å­˜ç©ºé—´å¯ä»¥è¢«é‡æ–°ä½¿ç”¨ã€‚<br>å †å†…å­˜ç”¨æ¥å­˜æ”¾æ‰€æœ‰ç”± new åˆ›å»ºçš„å¯¹è±¡ï¼ˆåŒ…æ‹¬è¯¥å¯¹è±¡å…¶ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼‰å’Œæ•°ç»„ã€‚åœ¨å †ä¸­åˆ†é…çš„å†…å­˜ï¼Œå°†ç”± Java åƒåœ¾å›æ”¶å™¨æ¥è‡ªåŠ¨ç®¡ç†ã€‚åœ¨å †ä¸­äº§ç”Ÿäº†ä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡åï¼Œè¿˜å¯ä»¥åœ¨æ ˆä¸­å®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å–å€¼ç­‰äºæ•°ç»„æˆ–è€…å¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„é¦–åœ°å€ï¼Œè¿™ä¸ªç‰¹æ®Šçš„å˜é‡å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„å¼•ç”¨å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¼•ç”¨å˜é‡æ¥è®¿é—®å †ä¸­çš„å¯¹è±¡æˆ–è€…æ•°ç»„ã€‚<br>ä¸¾ä¸ªğŸŒ°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Sample</span><span class="params">()</span></span>&#123;</div><div class="line">  <span class="keyword">int</span> s1 = <span class="number">0</span>;</div><div class="line">  Sample mSample1 = <span class="keyword">new</span> Sample();</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> s2 = <span class="number">1</span>;</div><div class="line">    Sample mSample2 = <span class="keyword">new</span> Sample();</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Sample mSample3 = <span class="keyword">new</span> Sample();</div></pre></td></tr></table></figure></p><p>Sample ç±»çš„å±€éƒ¨å˜é‡ s2 å’Œå¼•ç”¨å˜é‡ mSample2 éƒ½æ˜¯å­˜åœ¨äºæ ˆä¸­ï¼Œä½† mSample2 æŒ‡å‘çš„å¯¹è±¡æ˜¯å­˜åœ¨äºå †ä¸Šçš„ã€‚mSample3 æŒ‡å‘çš„å¯¹è±¡å®ä½“å­˜æ”¾åœ¨å †ä¸Šï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡ s1 å’Œ mSample1ï¼Œè€Œå®ƒè‡ªå·±å­˜åœ¨äºæ ˆä¸­ã€‚<br>ç»“è®ºï¼š</p><ul><li>å±€éƒ¨å˜é‡çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨å­˜å‚¨äºæ ˆä¸­ï¼Œå¼•ç”¨çš„å¯¹è±¡å®ä½“å­˜å‚¨äºå †ä¸­ã€‚å› ä¸ºå®ƒä»¬å±äºæ–¹æ³•ä¸­çš„å˜é‡ï¼Œç”Ÿå‘½å‘¨æœŸéšæ–¹æ³•è€Œç»“æŸã€‚</li><li>æˆå‘˜å˜é‡å…¨éƒ¨å­˜å‚¨äºå †ä¸­ï¼ˆåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¼•ç”¨å’Œå¼•ç”¨çš„å¯¹è±¡å®ä½“ï¼‰ã€‚å› ä¸ºå®ƒä»¬å±äºç±»ï¼Œç±»å¯¹è±¡ç»ˆç©¶æ˜¯è¦è¢« new å‡ºæ¥ä½¿ç”¨çš„ã€‚</li></ul><p>äº†è§£äº† Java çš„å†…å­˜åˆ†é…ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ Java æ˜¯æ€ä¹ˆç®¡ç†å†…å­˜çš„ã€‚</p><h1 id="Java-æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜"><a href="#Java-æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜" class="headerlink" title="Java æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜"></a>Java æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜</h1><p>Java çš„å†…å­˜ç®¡ç†å°±æ˜¯å¯¹è±¡çš„åˆ†é…å’Œé‡Šæ”¾é—®é¢˜ã€‚åœ¨ Java ä¸­ï¼Œç¨‹åºå‘˜éœ€è¦é€šè¿‡å…³é”®å­— new ä¸ºæ¯ä¸ªå¯¹è±¡ç”³è¯·å†…å­˜ï¼ˆåŸºæœ¬ç±»å‹é™¤å¤–ï¼‰ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨å †ï¼ˆHeapï¼‰ä¸­åˆ†é…ç©ºé—´ã€‚å¦å¤–ï¼Œå¯¹è±¡çš„é‡Šæ”¾æ˜¯ç”± GC å†³å®šå’Œæ‰§è¡Œçš„ã€‚åœ¨ Java ä¸­ï¼Œå†…å­˜çš„åˆ†é…æ˜¯ç”±ç¨‹åºå®Œæˆçš„ï¼Œè€Œå†…å­˜çš„é‡Šæ”¾æ˜¯ç”± GC å®Œæˆçš„ï¼Œè¿™ç§æ”¶æ”¯ä¸¤æ¡çº¿çš„æ–¹æ³•ç¡®å®ç®€åŒ–äº†ç¨‹åºå‘˜çš„å·¥ä½œã€‚ä½†åŒæ—¶ï¼Œå®ƒä¹ŸåŠ é‡äº† JVM çš„å·¥ä½œã€‚è¿™ä¹Ÿæ˜¯ Java ç¨‹åºè¿è¡Œé€Ÿåº¦è¾ƒæ…¢çš„åŸå› ä¹‹ä¸€ã€‚å› ä¸ºï¼ŒGC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼ŒGC å¿…é¡»ç›‘æ§æ¯ä¸€ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬å¯¹è±¡çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰ï¼ŒGC éƒ½éœ€è¦è¿›è¡Œç›‘æ§ã€‚</p><p>ç›‘è§†å¯¹è±¡çŠ¶æ€æ˜¯ä¸ºäº†æ›´åŠ å‡†ç¡®åœ°ã€åŠæ—¶åœ°é‡Šæ”¾å¯¹è±¡ï¼Œè€Œé‡Šæ”¾å¯¹è±¡çš„æ ¹æœ¬åŸåˆ™å°±æ˜¯è¯¥å¯¹è±¡ä¸å†è¢«å¼•ç”¨ã€‚</p><p>ä¸ºäº†æ›´å¥½ç†è§£ GC çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡è€ƒè™‘ä¸ºæœ‰å‘å›¾çš„é¡¶ç‚¹ï¼Œå°†å¼•ç”¨å…³ç³»è€ƒè™‘ä¸ºå›¾çš„æœ‰å‘è¾¹ï¼Œæœ‰å‘è¾¹ä»å¼•ç”¨è¿™æŒ‡å‘è¢«å¼•ç”¨å¯¹è±¡ã€‚å¦å¤–ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹è±¡å¯ä»¥ä½œä¸ºä¸€ä¸ªå›¾çš„èµ·å§‹é¡¶ç‚¹ï¼Œä¾‹å¦‚å¤§å¤šç¨‹åºä» main è¿›ç¨‹å¼€å§‹æ‰§è¡Œï¼Œé‚£ä¹ˆè¯¥å›¾å°±æ˜¯ä»¥ main è¿›ç¨‹é¡¶ç‚¹å¼€å§‹çš„ä¸€æ£µæ ¹æ ‘ã€‚åœ¨è¿™ä¸ªæœ‰å‘å›¾ä¸­ï¼Œæ ¹é¡¶ç‚¹ç§‘å¤§çš„å¯¹è±¡éƒ½æ˜¯æœ‰æ•ˆå¯¹è±¡ï¼ŒGC å°†ä¸å›æ”¶è¿™äº›å¯¹è±¡ã€‚å¦‚æœæŸä¸ªå¯¹è±¡ï¼ˆè¿é€šå­å›¾ï¼‰ä¸è¿™ä¸ªæ ¹é¡¶ç‚¹ä¸å¯è¾¾ï¼ˆæ³¨æ„ï¼Œè¯¥å›¾ä¸ºæœ‰å‘å›¾ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªï¼ˆè¿™äº›ï¼‰å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢« GC å›æ”¶ã€‚ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­è¯´æ˜ JVM çš„å†…å­˜åˆ†é…æƒ…å†µã€‚ä»¥ä¸‹å³å›¾ï¼Œå°±æ˜¯å·¦è¾¹ç¨‹åºè¿è¡Œåˆ°ç¬¬ 6 è¡Œçš„ç¤ºæ„å›¾ã€‚<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/11/5c8674f523b99.jpg" alt="1552315574(1).jpg" title="">                </div>                <div class="image-caption">1552315574(1).jpg</div>            </figure><br>Java ä½¿ç”¨æœ‰å‘å›¾çš„æ–¹å¼è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå¯ä»¥æ¶ˆé™¤å¼•ç”¨å¾ªç¯çš„é—®é¢˜ï¼Œä¾‹å¦‚æœ‰ä¸‰ä¸ªå¯¹è±¡ï¼Œç›¸äº’å¼•ç”¨ï¼Œåªè¦å®ƒä»¬å’Œæ ¹è¿›ç¨‹ä¸å¯è¾¾çš„ï¼Œé‚£ä¹ˆ GC ä¹Ÿæ˜¯å¯ä»¥å›æ”¶å®ƒä»¬çš„ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ç®¡ç†å†…å­˜çš„ç²¾åº¦å¾ˆé«˜ï¼Œä½†æ˜¯æ•ˆç‡è¾ƒä½ã€‚å¦å¤–ä¸€ç§å¸¸ç”¨çš„å†…å­˜ç®¡ç†æŠ€æœ¯æ˜¯ä½¿ç”¨è®¡æ•°å™¨ï¼Œä¾‹å¦‚ COM æ¨¡å‹é‡‡ç”¨è®¡æ•°å™¨æ–¹å¼ç®¡ç†æ„å»ºï¼Œå®ƒä¸æœ‰å‘å›¾ç›¸æ¯”ï¼Œç²¾åº¦å¾ˆä½ï¼ˆå¾ˆéš¾å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼‰ï¼Œä½†æ‰§è¡Œæ•ˆç‡å¾ˆé«˜ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯-Java-ä¸­çš„å†…å­˜æ³„æ¼"><a href="#ä»€ä¹ˆæ˜¯-Java-ä¸­çš„å†…å­˜æ³„æ¼" class="headerlink" title="ä»€ä¹ˆæ˜¯ Java ä¸­çš„å†…å­˜æ³„æ¼"></a>ä»€ä¹ˆæ˜¯ Java ä¸­çš„å†…å­˜æ³„æ¼</h1><p>åœ¨ Java ä¸­ï¼Œå†…å­˜æ³„æ¼å°±æ˜¯å­˜åœ¨ä¸€äº›è¢«åˆ†é…çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹ç‚¹ï¼Œé¦–å…ˆï¼Œè¿™äº›å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œå³åœ¨æœ‰å‘å›¾ä¸­ï¼Œå­˜åœ¨é€šè·¯å¯ä»¥ä¸å…¶ç›¸è¿ï¼›å…¶æ¬¡ï¼Œè¿™äº›å¯¹è±¡æ˜¯æ— ç”¨çš„ï¼Œå³ ç¨‹åºä»¥åä¸ä¼šå†ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œè¿™äº›å¯¹è±¡å°±å¯ä»¥åˆ¤å®šä¸º Java ä¸­çš„å†…å­˜æ³„æ¼ï¼Œè¿™äº›å¯¹è±¡ä¸ä¼šè¢« GC æ‰€å›æ”¶ï¼Œç„¶è€Œå®ƒå´å ç”¨å†…å­˜ã€‚<br>åœ¨ C++ ä¸­ï¼Œå†…å­˜æ³„æ¼çš„èŒƒå›´æ›´å¤§ä¸€äº›ã€‚æœ‰äº›å¯¹è±¡è¢«åˆ†é…äº†å†…å­˜ç©ºé—´ï¼Œç„¶åå´ä¸å¯è¾¾ï¼Œç”±äº C++ ä¸­æ²¡æœ‰ GCï¼Œè¿™äº›å†…å­˜å°†æ°¸è¿œå›æ”¶ä¸å›æ¥ã€‚åœ¨ Java ä¸­ï¼Œè¿™äº›ä¸å¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯ç”± GC è´Ÿè´£å›æ”¶ï¼Œå› æ­¤ç¨‹åºå‘˜ä¸éœ€è¦è€ƒè™‘è¿™éƒ¨åˆ†çš„å†…å­˜æ³„æ¼ã€‚<br>é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼Œå¯¹äº C++ï¼Œç¨‹åºå‘˜éœ€è¦è‡ªå·±ç®¡ç†è¾¹å’Œé¡¶ç‚¹ï¼Œè€Œå¯¹äº Java ç¨‹åºå‘˜åªè¦ç®¡ç†è¾¹å°±å¯ä»¥äº†ï¼ˆä¸éœ€è¦ç®¡ç†é¡¶ç‚¹çš„é‡Šæ”¾ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒJava æé«˜äº†ç¼–ç¨‹çš„æ•ˆç‡ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/12/5c871a5d9d98d.jpg" alt="1552357959(1).jpg" title="">                </div>                <div class="image-caption">1552357959(1).jpg</div>            </figure><p>å› æ­¤ï¼Œé€šè¿‡ä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ Java ä¸­ä¹Ÿæœ‰å†…å­˜æ³„æ¼ï¼Œä½†èŒƒå›´æ¯” C++ è¦å°ä¸€äº›ã€‚å› ä¸º Java ä»è¯­è¨€ä¸Šä¿è¯ï¼Œä»»ä½•å¯¹è±¡éƒ½æ˜¯å¯è¾¾ï¼Œæ‰€æœ‰çš„ä¸å¯è¾¾å¯¹è±¡éƒ½æ˜¯ç”± GC ç®¡ç†ã€‚</p><p>å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼ŒGC åŸºæœ¬æ˜¯é€æ˜çš„ï¼Œä¸å¯è§çš„ã€‚è™½ç„¶æˆ‘ä»¬åªæœ‰å‡ ä¸ªå‡½æ•°å¯ä»¥è®¿é—® GCï¼Œä¾‹å¦‚è¿è¡Œ GC çš„å‡½æ•° System.gc()ï¼Œä½†æ˜¯æ ¹æ® Java è¯­è¨€è§„èŒƒå®šä¹‰ï¼Œè¯¥å‡½æ•°ä¸ä¿è¯ JVM çš„åƒåœ¾æ”¶é›†å™¨ä¸€å®šä¼šæ‰§è¡Œã€‚å› ä¸ºï¼Œä¸åŒçš„ JVM å®ç°è€…å¯èƒ½ä½¿ç”¨ä¸åŒçš„ç®—æ³•ç®¡ç† GCã€‚é€šå¸¸ï¼ŒGC çš„çº¿ç¨‹çš„ä¼˜å…ˆçº§åˆ«è¾ƒä½ã€‚JVM è°ƒç”¨ GC çš„ç­–ç•¥ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œæœ‰çš„æ˜¯å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼ŒGC æ‰å¼€å§‹å·¥ä½œï¼Œä¹Ÿæœ‰å®šæ—¶æ‰§è¡Œçš„ï¼Œæœ‰çš„æ˜¯å¹³ç¼“æ‰§è¡Œ GCï¼Œæœ‰çš„æ˜¯ä¸­æ–­å¼æ‰§è¡Œ GCã€‚ä½†é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè¿™äº›ã€‚é™¤éåœ¨ä¸€äº›ç‰¹å®šçš„åœºåˆï¼ŒGC çš„æ‰§è¡Œå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œä¾‹å¦‚å¯¹äºåŸºæœ¬ Web çš„å®æ—¶ç³»ç»Ÿï¼Œå¦‚ç½‘ç»œæ¸¸æˆç­‰ï¼Œç”¨æˆ·ä¸å¸Œæœ› GC çªç„¶ä¸­æ–­åº”ç”¨ç¨‹åºæ‰§è¡Œè€Œè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è°ƒæ•´ GC çš„å‚æ•°ï¼Œè®© GC èƒ½å¤Ÿé€šè¿‡å¹³ç¼“çš„æ–¹å¼é‡Šæ”¾å†…å­˜ï¼Œä¾‹å¦‚å°†åƒåœ¾å›æ”¶åˆ†è§£ä¸ºä¸€ç³»åˆ—çš„å°æ­¥éª¤æ‰§è¡Œï¼ŒSun æä¾›çš„ HotSpot JVM å°±æ”¯æŒè¿™ä¸€ç‰¹æ€§ã€‚<br>åŒæ ·ç»™å‡ºä¸€ä¸ª Java å†…å­˜æ³„æ¼çš„å…¸å‹ä¾‹å­ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Vector v = <span class="keyword">new</span> Vector(<span class="number">10</span>);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100</span>; i++)&#123;</div><div class="line">  Object o = <span class="keyword">new</span> Object();</div><div class="line">  v.add</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¾ªç¯ç”³è¯· Object å¯¹è±¡ï¼Œå¹¶å°†æ‰€ç”³è¯·çš„å¯¹è±¡æ”¾å…¥ä¸€ä¸ª Vector ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä»…ä»…é‡Šæ”¾å¼•ç”¨æœ¬èº«ï¼Œé‚£ä¹ˆ Vector ä»ç„¶å¼•ç”¨è¯¥å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªå¯¹è±¡å¯¹ GC æ¥è¯´æ˜¯ä¸å¯å›æ”¶çš„ã€‚å› æ­¤ï¼Œå¦‚æœå¯¹è±¡åŠ å…¥åˆ° Vector åï¼Œè¿˜å¿…é¡»ä» Vector ä¸­åˆ é™¤ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°† Vector å¯¹è±¡è®¾ç½®ä¸º nullã€‚</p><h1 id="Android-ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»"><a href="#Android-ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»" class="headerlink" title="Android ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»"></a>Android ä¸­å¸¸è§çš„å†…å­˜æ³„æ¼æ±‡æ€»</h1><ul><li><p>é›†åˆç±»æ³„æ¼<br>é›†åˆç±»å¦‚æœä»…ä»…æœ‰æ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œè€Œæ²¡æœ‰ç›¸åº”çš„åˆ é™¤æœºåˆ¶ï¼Œå¯¼è‡´å†…å­˜è¢«å ç”¨ã€‚å¦‚æœè¿™ä¸ªé›†åˆç±»æ˜¯å…¨å±€æ€§çš„å˜é‡ï¼ˆæ¯”å¦‚ç±»ä¸­çš„é™æ€å±æ€§ï¼Œå…¨å±€æ€§çš„ map ç­‰å³æœ‰é™æ€å¼•ç”¨æˆ– final ä¸€ç›´æŒ‡å‘å®ƒï¼‰ï¼Œé‚£ä¹ˆæ²¡æœ‰ç›¸åº”çš„åˆ é™¤æœºåˆ¶ï¼Œå¾ˆå¯èƒ½å¯¼è‡´é›†åˆé”å ç”¨çš„å†…å­˜åªå¢ä¸å‡ã€‚æ¯”å¦‚ä¸Šé¢çš„å…¸å‹ä¾‹å­å°±æ˜¯å…¶ä¸­ä¸€ç§æƒ…å†µï¼Œå½“ç„¶å®é™…ä¸Šæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è‚¯å®šä¸ä¼šå†™è¿™ä¹ˆ 2B çš„ä»£ç ï¼Œä½†ç¨ä¸æ³¨æ„è¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºç°è¿™ç§æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬éƒ½å–œæ¬¢é€šè¿‡ HashMap åšä¸€äº›ç¼“å­˜ä¹‹ç±»çš„äº‹ï¼Œè¿™ç§æƒ…å†µè¦å¤šç•™ä¸€äº›å¿ƒçœ¼ã€‚</p></li><li><p>å•ä¾‹é€ æˆçš„å†…å­˜æ³„æ¼<br>ç”±äºå•ä¾‹çš„é™æ€ç‰¹æ€§ä½¿å¾—å…¶ç”Ÿå‘½å‘¨æœŸè·Ÿåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ä¸æ°å½“çš„è¯ï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ä¸‹é¢ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</div><div class="line">  <span class="keyword">private</span> Context context;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span><span class="params">(Context context)</span></span>&#123;</div><div class="line">    <span class="keyword">this</span>.context = context;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppManager <span class="title">getInstance</span><span class="params">(Context context)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</div><div class="line">      instance = <span class="keyword">new</span> AppManager(context);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„å•ä¾‹æ¨¡å¼ï¼Œå½“åˆ›å»ºè¿™ä¸ªå•ä¾‹çš„æ—¶å€™ï¼Œç”±äºéœ€è¦ä¼ å…¥ä¸€ä¸ª Contextï¼Œæ‰€ä»¥è¿™ä¸ª Context çš„ç”Ÿå‘½å‘¨æœŸçš„é•¿çŸ­è‡³å…³é‡è¦ï¼š</p><ol><li>å¦‚æœæ­¤æ—¶ä¼ å…¥çš„æ˜¯ Application çš„ Contextï¼Œå› ä¸º Application çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯æ•´ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥è¿™å°†æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</li><li>å¦‚æœæ­¤æ—¶ä¼ å…¥çš„æ˜¯ Activity çš„ Contextï¼Œå½“è¿™ä¸ª Context æ‰€å¯¹åº”çš„ Activity é€€å‡ºæ—¶ï¼Œç”±äºè¯¥ Context çš„å¼•ç”¨è¢«å•ä¾‹å¯¹è±¡æ‰€æŒæœ‰ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸç­‰äºæ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå‹è°Šå½“å‰ Activity é€€å‡ºæ—¶å®ƒçš„å†…å­˜å¹¶ä¸ä¼šè¢«å›æ”¶ï¼Œè¿™å°±é€ æˆæ³„æ¼äº†ã€‚</li></ol><p>æ­£ç¡®çš„æ–¹å¼åº”è¯¥æ”¹ä¸ºä¸‹é¢è¿™ç§æ–¹å¼ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</div><div class="line">  <span class="keyword">private</span> Context context;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span><span class="params">(Context context)</span></span>&#123;</div><div class="line">    <span class="keyword">this</span>.context = context.getApplicationContext();<span class="comment">//ä½¿ç”¨Applicationçš„context</span></div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppManager <span class="title">getInstance</span><span class="params">(Context context)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</div><div class="line">      instance = <span class="keyword">new</span> AppManager(context);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>æˆ–è€…è¿™æ ·å†™ï¼Œè¿ Context éƒ½ä¸ç”¨ä¼ è¿‡æ¥äº†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//åœ¨ä½ çš„Applicationä¸­æ·»åŠ ä¸€ä¸ªé™æ€æ–¹æ³•ï¼ŒgetContext() è¿”å› Application çš„ context</span></div><div class="line">Â·Â·Â·</div><div class="line">context = getApplicationContext();</div><div class="line">Â·Â·Â·</div><div class="line"><span class="comment">/** </span></div><div class="line">  * è·å–å…¨å±€çš„context </div><div class="line">  * <span class="doctag">@return</span> è¿”å›å…¨å±€contextå¯¹è±¡ </div><div class="line">  */</div><div class="line">  <span class="function">pulic <span class="keyword">static</span> Context <span class="title">getContext</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> context;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppManager</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> AppManager instance;</div><div class="line">  <span class="keyword">private</span> Context context;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">AppManager</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">this</span>.context = MyApplication.getContext();<span class="comment">//ä½¿ç”¨Applicationçš„context</span></div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppManager <span class="title">getInstance</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</div><div class="line">      instance = <span class="keyword">new</span> AppManager();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><ul><li>åŒ¿åå†…éƒ¨ç±»/éé™æ€å†…éƒ¨ç±»å’Œå¼‚æ­¥çº¿ç¨‹<ul><li>éé™æ€å†…éƒ¨ç±»åˆ›å»ºé™æ€å®ä¾‹é€ æˆçš„å†…å­˜æ³„æ¼<br>æœ‰æ—¶å€™æˆ‘ä»¬ä¸ºäº†é¿å…å¯èƒ½ä¼šåœ¨å¯åŠ¨é¢‘ç¹çš„ Activity ä¸­ï¼Œä¸ºäº†é¿å…é‡å¤åˆ›å»ºç›¸åŒçš„æ•°æ®èµ„æºï¼Œå¯èƒ½ä¼šå‡ºç°è¿™ç§å†™æ³•ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span></span>&#123;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> TestResource mResource = <span class="keyword">null</span>;</div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>&#123;</div><div class="line">     <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">     setContentView(R.layout.activity_main);</div><div class="line">     <span class="keyword">if</span>(mManager == <span class="keyword">null</span>)&#123;</div><div class="line">       mManager = <span class="keyword">new</span> TestResource();</div><div class="line">     &#125;</div><div class="line">     <span class="comment">//Â·Â·Â·</span></div><div class="line">   &#125;</div><div class="line">   <span class="class"><span class="keyword">class</span> <span class="title">TestResource</span></span>&#123;</div><div class="line">   <span class="comment">//Â·Â·Â·</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul></li></ul><p>è¿™æ ·å°±åœ¨ Activity å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªéé™æ€å†…éƒ¨ç±»çš„å•ä¾‹ï¼Œæ¯æ¬¡å¯åŠ¨ Activity æ—¶éƒ½ä¼šä½¿ç”¨è¯¥å•ä¾‹çš„æ•°æ®ï¼Œè¿™æ ·è™½ç„¶é¿å…äº†èµ„æºçš„é‡å¤åˆ›å»ºï¼Œä¸è¿‡è¿™ç§å†™æ³•ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œå› ä¸ºéé™æ€å†…éƒ¨ç±»é»˜è®¤ä¼šæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œè€Œè¯¥éé™æ€å†…éƒ¨ç±»åˆåˆ›å»ºäº†ä¸€ä¸ªé™æ€å®ä¾‹ï¼Œè¯¥å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨çš„ä¸€æ ·é•¿ï¼Œè¿™å°±å¯¼è‡´äº†è¯¥é™æ€å®ä¾‹ä¸€ç›´ä¼šæŒæœ‰è¯¥ Activity çš„å¼•ç”¨ï¼Œå¯¼è‡´ Activity çš„å†…å­˜èµ„æºä¸èƒ½æ­£å¸¸å›æ”¶ã€‚æ­£ç¡®çš„åšæ³•ä¸ºï¼š<br>å°†è¯¥å†…éƒ¨ç±»è®¾ä¸ºé™æ€å†…éƒ¨ç±»æˆ–è€…å°†è¯¥å†…éƒ¨ç±»æŠ½å–å‡ºæ¥å°è£…æˆä¸€ä¸ªå•ä¾‹ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ Contextï¼Œè¯·æŒ‰ç…§ä¸Šé¢æ¨èçš„ä½¿ç”¨ Application çš„ contextã€‚å½“ç„¶ï¼ŒApplication çš„ context ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½éšä¾¿ä¹±ç”¨ï¼Œå¯¹äºæœ‰äº›åœ°æ–¹åˆ™å¿…é¡»ä½¿ç”¨ Activity çš„ Contextï¼Œå¯¹äº Applicationï¼ŒServiceï¼ŒActivity ä¸‰è€…çš„ Context çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åŠŸèƒ½</th><th>Application</th><th style="text-align:right">Service</th><th style="text-align:right">Acativity</th></tr></thead><tbody><tr><td>Start an Activity</td><td>NO1</td><td style="text-align:right">NO1</td><td style="text-align:right">YES</td></tr><tr><td>Show a Dialog</td><td>NO</td><td style="text-align:right">NO</td><td style="text-align:right">YES</td></tr><tr><td>Layout Inflation</td><td>YES</td><td style="text-align:right">YES</td><td style="text-align:right">YES</td></tr><tr><td>Start a Service</td><td>YES</td><td style="text-align:right">YES</td><td style="text-align:right">YES</td></tr><tr><td>Bind to a Service</td><td>YES</td><td style="text-align:right">YES</td><td style="text-align:right">YES</td></tr><tr><td>Send a Broadcast</td><td>YES</td><td style="text-align:right">YES</td><td style="text-align:right">YES</td></tr><tr><td>Register BroadcastReceiver</td><td>YES</td><td style="text-align:right">YES</td><td style="text-align:right">YES</td></tr><tr><td>Load Resource Values</td><td>YES</td><td style="text-align:right">YES</td><td style="text-align:right">YES</td></tr></tbody></table><p>  å…¶ä¸­ï¼šNO1 è¡¨ç¤º Application å’Œ Service å¯ä»¥å¯åŠ¨ä¸€ä¸ª Activityï¼Œä¸è¿‡éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ task ä»»åŠ¡é˜Ÿåˆ—ã€‚è€Œå¯¹äº Dialog è€Œè¨€ï¼Œåªæœ‰åœ¨ Activity ä¸­æ‰èƒ½åˆ›å»º</p><ul><li>åŒ¿åå†…éƒ¨ç±»<br>Android å¼€å‘ç»å¸¸ä¼šç»§æ‰¿å®ç° Activity/Fragment/View,æ­¤æ—¶å¦‚æœä½ ä½¿ç”¨äº†åŒ¿åç±»ï¼Œå¹¶è¢«å¼‚æ­¥çº¿ç¨‹æŒæœ‰äº†ï¼Œé‚£è¦å°å¿ƒäº†ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æªæ–½è¿™æ ·ä¸€å®šä¼šå¯¼è‡´æ³„æ¼<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</div><div class="line">  Â·Â·Â·</div><div class="line">  Runnable ref1 = <span class="keyword">new</span> MyRunnable();</div><div class="line">  Runnable ref2 = <span class="keyword">new</span> Runnable()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">  Â·Â·Â·</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>ref1 å’Œ ref2 çš„åŒºåˆ«æ˜¯ï¼Œref2 ä½¿ç”¨äº†åŒ¿åå†…éƒ¨ç±»ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹è¿è¡Œæ—¶è¿™ä¸¤ä¸ªå¼•ç”¨çš„å†…å­˜ï¼š<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2019/03/12/5c874d760fdfd.png" alt="1552370991(1).png" title="">                </div>                <div class="image-caption">1552370991(1).png</div>            </figure><br>å¯ä»¥çœ‹åˆ°ï¼Œref1 æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚ä½† ref2 è¿™ä¸ªåŒ¿åç±»çš„å®ç°å¯¹è±¡é‡Œé¢å¤šäº†ä¸€ä¸ªå¼•ç”¨ï¼š<br>this$0 è¿™ä¸ªå¼•ç”¨æŒ‡å‘ MainActivity.thisï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰çš„ MainActivity å®ä¾‹ä¼šè¢« ref2 æŒæœ‰ï¼Œå¦‚æœå°†è¿™ä¸ªå¼•ç”¨å†ä¼ å…¥ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ï¼Œæ­¤çº¿ç¨‹å’Œæ­¤ Activity ç”Ÿå‘½å‘¨æœŸä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå°±é€ æˆäº† Activity çš„æ³„æ¼ã€‚</p><ul><li>Handler é€ æˆçš„å†…å­˜æ³„æ¼<br>Handler çš„ä½¿ç”¨é€ æˆçš„å†…å­˜æ³„æ¼é—®é¢˜åº”è¯¥è¯´æ˜¯æœ€ä¸ºå¸¸è§äº†ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸ºäº†é¿å… ANR è€Œä¸åœ¨ä¸»çº¿ç¨‹è¿›è¡Œè€—æ—¶æ“ä½œï¼Œåœ¨å¤„ç†ç½‘ç»œä»»åŠ¡æˆ–è€…å°è£…ä¸€äº›è¯·æ±‚å›è°ƒç­‰ api éƒ½å€ŸåŠ© Handler æ¥å¤„ç†ï¼Œä½† Handler ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¯¹äº Handler çš„ä½¿ç”¨ä»£ç ç¼–å†™ä¸€ä¸è§„èŒƒå³æœ‰å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ã€‚å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ Handlerã€Message å’Œ MessageQueue éƒ½æ˜¯ç›¸äº’å…³è”åœ¨ä¸€èµ·çš„ï¼Œä¸‡ä¸€ Handler å‘é€çš„ Message å°šæœªè¢«å¤„ç†ï¼Œåˆ™è¯¥ Message åŠå‘é€å®ƒçš„ Handler å¯¹è±¡è¢«çº¿ç¨‹ MessageQueue ä¸€ç›´æŒæœ‰ã€‚ç”±äº Handler å±äº TLSï¼ˆThread Local Storageï¼‰å˜é‡ï¼Œç”Ÿå‘½å‘¨æœŸå’Œ Activity æ˜¯ä¸ä¸€è‡´çš„ã€‚å› æ­¤è¿™ç§å®ç°æ–¹å¼ä¸€èˆ¬å¾ˆéš¾ä¿è¯è·Ÿ View æˆ–è€… Activity çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ï¼Œæ•…å¾ˆå®¹æ˜“å¯¼è‡´æ— æ³•æ­£å¸¸é‡Šæ”¾ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Handler mLeakyHandler = <span class="keyword">new</span> Handler()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span>&#123;</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    <span class="comment">// Post a message and delay its execution for 10 minutes.</span></div><div class="line">    mLeakyHandler.postDdelayed(<span class="keyword">new</span> Runnable &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;<span class="comment">/** ... */</span>&#125;</div><div class="line">    &#125;, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>);</div><div class="line">    <span class="comment">//Go back to the previous Activity.</span></div><div class="line">    finish();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>åœ¨è¯¥ SampleActivity ä¸­å£°æ˜äº†ä¸€ä¸ªå»¶è¿Ÿ 10 åˆ†é’Ÿæ‰§è¡Œçš„æ¶ˆæ¯ Messageï¼ŒmLeakyHandler å°†å…¶ push è¿›äº†æ¶ˆæ¯é˜Ÿåˆ— MessageQueue é‡Œã€‚å½“è¯¥ Activity è¢« finish()æ‰æ—¶ï¼Œå»¶è¿Ÿæ‰§è¡Œä»»åŠ¡çš„ Message è¿˜ä¼šç»§ç»­å­˜åœ¨äºä¸»çº¿ç¨‹ä¸­ï¼Œå®ƒæŒæœ‰è¯¥ Activity çš„ Handler å¼•ç”¨ï¼Œæ‰€ä»¥æ­¤æ—¶ finish() æ‰çš„ Activity å°±ä¸ä¼šè¢«å›æ”¶äº†ä»è€Œé€ æˆå†…å­˜æ³„æ¼ï¼ˆå›  Handler ä¸ºéé™æ€å†…éƒ¨ç±»ï¼Œå®ƒä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œåœ¨è¿™é‡Œå°±æ˜¯æŒ‡ SampleActivityï¼‰ã€‚<br>ä¿®å¤æ–¹æ³•ï¼šåœ¨ Activity ä¸­é¿å…ä½¿ç”¨éé™æ€å†…éƒ¨ç±»ï¼Œæ¯”å¦‚ä¸Šé¢æˆ‘ä»¬å°† Handler å£°æ˜ä¸ºé™æ€çš„ï¼Œåˆ™å…¶å­˜æ´»æœŸè·Ÿ Activity çš„ç”Ÿå‘½å‘¨æœŸå°±æ— å…³äº†ã€‚åŒæ—¶é€šè¿‡å¼±å¼•ç”¨çš„æ–¹å¼å¼•å…¥ Activityï¼Œé¿å…ç›´æ¥å°† Activity ä½œä¸º context ä¼ è¿›å»ï¼Œè§ä¸‹é¢ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line">    * Instances of static inner classes do not hold an implicit</div><div class="line">    * reference to their outer class</div><div class="line">    */</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;SampleActivity&gt; mActivity;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyHandler</span><span class="params">(SampleActivity activity)</span></span>&#123;</div><div class="line">      mActivity = <span class="keyword">new</span> WeakReference&lt;SampleActivity&gt;(activity);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span>&#123;</div><div class="line">      SampleActivity activity = mActivity.get();</div><div class="line">      <span class="keyword">if</span>(activity != <span class="keyword">null</span>)&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> MyHandler mHandler = <span class="keyword">new</span> MyHandler(<span class="keyword">this</span>);</div><div class="line">  <span class="comment">/**</span></div><div class="line">    * Instances of anonymous classes do not hold an implicit</div><div class="line">    * reference to their outer class when they are "static"</div><div class="line">    */</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Runnable sRunnable = <span class="keyword">new</span> Runnable()&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;<span class="comment">/*...*/</span>&#125;</div><div class="line">  &#125;;</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;å†…å­˜ç®¡ç†çš„ç›®çš„å°±æ˜¯è®©æˆ‘ä»¬åœ¨å¼€å‘ä¸­æ€ä¹ˆæœ‰æ•ˆçš„é¿å…æˆ‘ä»¬çš„åº”ç”¨å‡ºç°å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚å†…å­˜æ³„æ¼å¤§å®¶éƒ½ä¸é™Œç”Ÿäº†ï¼Œç®€å•ç²—ä¿—çš„è®²ï¼Œå°±æ˜¯è¯¥è¢«é‡Šæ”¾çš„å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼Œä¸€ç›´è¢«æŸä¸ªæˆ–æŸäº›å®ä¾‹æ‰€æŒæœ‰å´ä¸å†è¢«ä½¿ç”¨å¯¼è‡´ GC ä¸èƒ½å›æ”¶ã€‚&lt;br&gt;æˆ‘ä¼šä» Java å†…å­˜æ³„æ¼çš„åŸºç¡€çŸ¥è¯†å¼€
      
    
    </summary>
    
    
      <category term="Android" scheme="https://edward7zhang.github.io/tags/Android/"/>
    
      <category term="Interview" scheme="https://edward7zhang.github.io/tags/Interview/"/>
    
      <category term="Java" scheme="https://edward7zhang.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Javaæ·±å…¥æºç </title>
    <link href="https://edward7zhang.github.io/2019/03/10/Java%E6%B7%B1%E5%85%A5%E6%BA%90%E7%A0%81/"/>
    <id>https://edward7zhang.github.io/2019/03/10/Javaæ·±å…¥æºç /</id>
    <published>2019-03-10T04:07:14.000Z</published>
    <updated>2019-03-10T12:38:51.793Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†æ‰ï¼Ÿ"><a href="#ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†æ‰ï¼Ÿ" class="headerlink" title="ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†æ‰ï¼Ÿ"></a>ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†æ‰ï¼Ÿ</h1><p>åˆ©ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œè™šæ‹Ÿæœºä¼šå°†ä¸€äº›å¯¹è±¡å®šä¹‰ä¸º GC Rootsï¼Œä» GC Roots å‡ºå‘æ²¿ç€å¼•ç”¨é“¾å‘ä¸‹å¯»æ‰¾ï¼Œå¦‚æœæŸä¸ªå¯¹è±¡ä¸èƒ½é€šè¿‡ GC Roots å¯»æ‰¾åˆ°ï¼Œè™šæ‹Ÿæœºå°±è®¤ä¸ºè¯¥å¯¹è±¡å¯ä»¥è¢«å›æ”¶æ‰ã€‚</p><h2 id="é‚£äº›å¯¹è±¡å¯ä»¥è¢«çœ‹åšæ˜¯-GC-Roots-å‘¢ï¼Ÿ"><a href="#é‚£äº›å¯¹è±¡å¯ä»¥è¢«çœ‹åšæ˜¯-GC-Roots-å‘¢ï¼Ÿ" class="headerlink" title="é‚£äº›å¯¹è±¡å¯ä»¥è¢«çœ‹åšæ˜¯ GC Roots å‘¢ï¼Ÿ"></a>é‚£äº›å¯¹è±¡å¯ä»¥è¢«çœ‹åšæ˜¯ GC Roots å‘¢ï¼Ÿ</h2><ol><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼›</li><li>æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œå¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼›</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆNative æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ï¼›</li></ol><h2 id="å¯¹è±¡ä¸å¯è¾¾ï¼Œä¸€å®šä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ä¹ˆï¼Ÿ"><a href="#å¯¹è±¡ä¸å¯è¾¾ï¼Œä¸€å®šä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ä¹ˆï¼Ÿ" class="headerlink" title="å¯¹è±¡ä¸å¯è¾¾ï¼Œä¸€å®šä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ä¹ˆï¼Ÿ"></a>å¯¹è±¡ä¸å¯è¾¾ï¼Œä¸€å®šä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ä¹ˆï¼Ÿ</h2><p>å³ä½¿ä¸å¯è¾¾ï¼Œå¯¹è±¡ä¹Ÿä¸ä¸€å®šä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚</p><ol><li>å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize()æ–¹æ³•ï¼Œå¯¹è±¡å¿…é¡»é‡å†™ finalize()æ–¹æ³•ä¸”æ²¡æœ‰è¢«è¿è¡Œè¿‡ã€‚</li><li>è‹¥æœ‰å¿…è¦æ‰§è¡Œï¼Œä¼šæŠŠå¯¹è±¡æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼ŒJVM ä¼šå¼€ä¸€ä¸ªçº¿ç¨‹å»å›æ”¶å®ƒä»¬ï¼Œè¿™æ˜¯å¯¹è±¡æœ€åä¸€æ¬¡å¯ä»¥é€ƒé€¸æ¸…ç†çš„æœºä¼šã€‚</li></ol><h1 id="è®²ä¸€ä¸‹å¸¸è§çš„ç¼–ç æ–¹å¼ï¼Ÿ"><a href="#è®²ä¸€ä¸‹å¸¸è§çš„ç¼–ç æ–¹å¼ï¼Ÿ" class="headerlink" title="è®²ä¸€ä¸‹å¸¸è§çš„ç¼–ç æ–¹å¼ï¼Ÿ"></a>è®²ä¸€ä¸‹å¸¸è§çš„ç¼–ç æ–¹å¼ï¼Ÿ</h1><p>ç¼–ç çš„æ„ä¹‰ï¼šè®¡ç®—æœºä¸­å­˜å‚¨çš„æœ€å°å•å…ƒæ˜¯ä¸€ä¸ªå­—èŠ‚å³ 8bitï¼Œæ‰€èƒ½è¡¨ç¤ºçš„è‡ªä»˜èŒƒå›´æ˜¯ 255 ä¸ªï¼Œè€Œäººç±»è¦è¡¨ç¤ºçš„ç¬¦å·å¤ªå¤šï¼Œæ— æ³•ç”¨ä¸€ä¸ªå­—èŠ‚æ¥å®Œå…¨è¡¨ç¤ºï¼Œæ•…éœ€è¦å°†ç¬¦å·ç¼–ç ï¼Œå°†å„ç§è¯­è¨€ç¿»è¯‘æˆæœºå™¨è¯­è¨€ã€‚</p><ol><li>ASCII ç ï¼šæ€»å…± 128 ä¸ªï¼Œç”¨ä¸€ä¸ªå­—èŠ‚çš„ä½ 7 ä½è¡¨ç¤ºï¼Œ0 ~ 31 æ§åˆ¶å­—ç¬¦å¦‚æ¢å›è½¦åˆ é™¤ç­‰ï¼›32 ~ 126 æ˜¯æ‰“å°å­—ç¬¦ï¼Œå¯é€šè¿‡é”®ç›˜è¾“å…¥å¹¶æ˜¾ç¤ºå‡ºæ¥ï¼›</li><li>ISO-8859-1ï¼Œç”¨æ¥æ‰©å±• ASCII ç¼–ç ï¼Œ256 ä¸ªå­—ç¬¦ï¼Œæ¶µç›–äº†å¤§å¤šæ•°è¥¿æ¬§è¯­è¨€å­—ç¬¦ï¼›</li><li>GB2312:åŒå­—èŠ‚ç¼–ç ï¼Œæ€»ç¼–ç èŒƒå›´æ˜¯ A1-A7,A1-A9 æ˜¯ç¬¦å·åŒºï¼ŒåŒ…å« 682 ä¸ªå­—ç¬¦ï¼ŒB0-B7 æ˜¯æ±‰å­—åŒºï¼ŒåŒ…å« 6763 ä¸ªæ±‰å­—ï¼›</li><li>GBK ä¸ºäº†æ‰©å±• GB2312ï¼ŒåŠ å…¥äº†æ›´å¤šçš„æ±‰å­—ï¼Œç¼–ç èŒƒå›´æ˜¯ 8140~FEFEï¼Œæœ‰ 23940 ä¸ªç ä½ï¼Œèƒ½è¡¨ç¤º 21003 ä¸ªæ±‰å­—ï¼›</li><li>UTF-16: ISOè¯•å›¾æƒ³åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„è¶…è¯­è¨€å­—å…¸ï¼Œä¸–ç•Œä¸Šæ‰€æœ‰è¯­è¨€éƒ½å¯é€šè¿‡è¿™æœ¬å­—å…¸Unicodeæ¥ç›¸äº’ç¿»è¯‘ï¼Œè€ŒUTF-16å®šä¹‰äº†Unicodeå­—ç¬¦åœ¨è®¡ç®—æœºä¸­å­˜å–æ–¹æ³•ï¼Œç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºUnicodeè½¬åŒ–æ ¼å¼ã€‚ä¸è®ºä»€ä¹ˆå­—ç¬¦éƒ½å¯ç”¨ä¸¤å­—èŠ‚è¡¨ç¤ºï¼Œå³16bitï¼Œæ•…å«UTF-16ã€‚</li><li>UTF-8ï¼šUTF-16ç»Ÿä¸€é‡‡ç”¨ä¸¤å­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œä½†æœ‰äº›å­—ç¬¦åªç”¨ä¸€ä¸ªå­—èŠ‚å°±å¯è¡¨ç¤ºï¼Œæµªè´¹å­˜å‚¨ç©ºé—´ï¼Œè€ŒUTF-8é‡‡ç”¨ä¸€ç§å˜é•¿æŠ€æœ¯ï¼Œæ¯ä¸ªç¼–ç åŒºåŸŸæœ‰ä¸åŒçš„å­—ç é•¿åº¦ã€‚ ä¸åŒç±»å‹çš„å­—ç¬¦å¯ä»¥ç”±1~6ä¸ªå­—èŠ‚ç»„æˆã€‚</li></ol><h1 id="utf-8-ç¼–ç ä¸­çš„ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚ï¼Ÿint-å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿ"><a href="#utf-8-ç¼–ç ä¸­çš„ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚ï¼Ÿint-å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿ" class="headerlink" title="utf-8 ç¼–ç ä¸­çš„ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚ï¼Ÿint å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿ"></a>utf-8 ç¼–ç ä¸­çš„ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚ï¼Ÿint å‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿ</h1><p>utf-8 æ˜¯ä¸€ç§å˜é•¿ç¼–ç æŠ€æœ¯ï¼Œutf-8 ç¼–ç ä¸­çš„ä¸­æ–‡å ç”¨çš„å­—èŠ‚ä¸ç¡®å®šï¼Œå¯èƒ½æ˜¯ 2 ä¸ªã€3 ä¸ªã€4 ä¸ªï¼Œint å‹å  4 ä¸ªå­—èŠ‚ã€‚</p><h1 id="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ"><a href="#é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ" class="headerlink" title="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ"></a>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯ä½¿ç”¨ï¼Ÿ</h1><p>ä»£ç†æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œç›®çš„æ˜¯ï¼šä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹æŸä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå°†ä¸¤ä¸ªç±»çš„å…³ç³»è§£è€¦ã€‚ä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½è¦å®ç°ç›¸åŒçš„æ¥å£ï¼Œå› ä¸ºä»£ç†çœŸæ­£è°ƒç”¨çš„æ˜¯å§”æ‰˜ç±»çš„æ–¹æ³•ã€‚<br>åŒºåˆ«ï¼š</p><ol><li>é™æ€ä»£ç†ï¼šç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–æ˜¯ç”±ç‰¹å®šå·¥å…·ç”Ÿæˆï¼Œåœ¨ä»£ç ç¼–è¯‘æ—¶å°±ç¡®å®šäº†è¢«ä»£ç†çš„ç±»å“ªä¸€ä¸ªæ˜¯é™æ€ä»£ç†ã€‚é™æ€ä»£ç†é€šå¸¸åªä»£ç†ä¸€ä¸ªç±»ï¼›</li><li>åŠ¨æ€ä»£ç†ï¼šåœ¨ä»£ç è¿è¡ŒæœŸé—´ï¼Œè¿ç”¨åå°„æœºåˆ¶åŠ¨æ€åˆ›å»ºç”Ÿæˆã€‚åŠ¨æ€ä»£ç†ä»£ç†çš„æ˜¯ä¸€ä¸ªæ¥å£ä¸‹çš„å¤šä¸ªå®ç°ç±»ï¼›<br>å®ç°æ­¥éª¤ï¼ša. å®ç° InvocationHandler æ¥å£åˆ›å»ºè‡ªå·±çš„è°ƒç”¨å¤„ç†å™¨ï¼›b. ç»™ Proxy ç±»æä¾› ClassLoader å’Œä»£ç†æ¥å£ç±»å‹æ•°ç»„åˆ›å»ºåŠ¨æ€ä»£ç†ç±»ï¼›c. åˆ©ç”¨åå°„æœºåˆ¶å¾—åˆ°åŠ¨æ€ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼›d. åˆ©ç”¨åŠ¨æ€ä»£ç†ç±»çš„æ„é€ å‡½æ•°åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ï¼›<br>ä½¿ç”¨åœºæ™¯ï¼šRetrofit ä¸­ç›´æ¥è°ƒç”¨æ¥å£çš„æ–¹æ³•ï¼›</li></ol><h1 id="Java-çš„å¼‚å¸¸ä½“ç³»"><a href="#Java-çš„å¼‚å¸¸ä½“ç³»" class="headerlink" title="Java çš„å¼‚å¸¸ä½“ç³»"></a>Java çš„å¼‚å¸¸ä½“ç³»</h1><p>Java ä¸­ Throwable æ˜¯æ‰€æœ‰å¼‚å¸¸å’Œé”™è¯¯çš„è¶…ç±»ï¼Œä¸¤ä¸ªç›´æ¥å­ç±»æ˜¯ Error(é”™è¯¯)å’Œ Exception(å¼‚å¸¸)ï¼š</p><ol><li>Error æ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œç”± JVM äº§ç”Ÿå’ŒæŠ›å‡ºï¼Œå¦‚ OOMã€ThreadDeath ç­‰ã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJVM ä¸€èˆ¬ä¼šé€‰æ‹©ç»ˆæ­¢ç¨‹åºã€‚</li><li>Exception æ˜¯ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œåˆåˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸(RuntimeException)(ä¹Ÿå« CheckedException)å’Œéè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆä¸æ£€æŸ¥å¼‚å¸¸ Unchecked Exceptionï¼‰ã€‚è¿è¡Œæ—¶å¼‚å¸¸åˆ NullPointerExceptionã€IndexOutOfBoundsException ç­‰ï¼Œè¿™äº›å¼‚å¸¸ä¸€èˆ¬æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¼•èµ·çš„ï¼Œåº”å°½å¯èƒ½é¿å…ã€‚éè¿è¡Œæ—¶å¼‚å¸¸æœ‰ IOExceptionã€SQLExceptionã€FileNotFoundException ä»¥åŠç”±ç”¨æˆ·è‡ªå®šä¹‰çš„ Exception å¼‚å¸¸ç­‰ã€‚</li></ol><h1 id="è°ˆè°ˆä½ å¯¹è§£æä¸åˆ†æ´¾çš„è®¤è¯†"><a href="#è°ˆè°ˆä½ å¯¹è§£æä¸åˆ†æ´¾çš„è®¤è¯†" class="headerlink" title="è°ˆè°ˆä½ å¯¹è§£æä¸åˆ†æ´¾çš„è®¤è¯†"></a>è°ˆè°ˆä½ å¯¹è§£æä¸åˆ†æ´¾çš„è®¤è¯†</h1><p><strong>è§£æ</strong>æŒ‡æ–¹æ³•åœ¨è¿è¡Œå‰ï¼Œå³ç¼–è¯‘æœŸé—´å°±å¯çŸ¥çš„ï¼Œæœ‰ä¸€ä¸ªç¡®å®šçš„ç‰ˆæœ¬ï¼Œè¿è¡ŒæœŸé—´ä¹Ÿä¸ä¼šæ”¹å˜ã€‚è§£ææ˜¯é™æ€çš„ï¼Œåœ¨ç±»åŠ è½½çš„è§£æé˜¶æ®µå°±å¯å°†ç¬¦å·å¼•ç”¨è½¬å˜æˆç›´æ¥å¼•ç”¨ã€‚<br><strong>åˆ†æ´¾</strong>å¯åˆ†ä¸ºé™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾ï¼Œé‡è½½å±äºé™æ€åˆ†æ´¾ï¼Œé‡è½½å±äºé™æ€åˆ†æ´¾ï¼Œè¦†ç›–å±äºåŠ¨æ€åˆ†æ´¾ã€‚é™æ€åˆ†æ´¾æ˜¯æŒ‡åœ¨é‡è½½æ—¶é€šè¿‡å‚æ•°çš„é™æ€ç±»å‹è€Œéå®é™…ç±»å‹ä½œä¸ºåˆ¤æ–­ä¾æ®ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨å¯æ ¹æ®å‚æ•°çš„é™æ€ç±»å‹å†³å®šä½¿ç”¨å“ªä¸€ä¸ªé‡è½½ç‰ˆæœ¬ã€‚åŠ¨æ€åˆ†æ´¾åˆ™éœ€è¦æ ¹æ®å®é™…ç±»å‹æ¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</p><h1 id="ä¿®æ”¹å¯¹è±¡-A-çš„-equals-æ–¹æ³•çš„ç­¾åï¼Œé‚£ä¹ˆä½¿ç”¨-HashMap-å­˜æ”¾è¿™ä¸ªå¯¹è±¡å®ä¾‹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å“ªä¸ª-equals-æ–¹æ³•ï¼Ÿ"><a href="#ä¿®æ”¹å¯¹è±¡-A-çš„-equals-æ–¹æ³•çš„ç­¾åï¼Œé‚£ä¹ˆä½¿ç”¨-HashMap-å­˜æ”¾è¿™ä¸ªå¯¹è±¡å®ä¾‹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å“ªä¸ª-equals-æ–¹æ³•ï¼Ÿ" class="headerlink" title="ä¿®æ”¹å¯¹è±¡ A çš„ equals æ–¹æ³•çš„ç­¾åï¼Œé‚£ä¹ˆä½¿ç”¨ HashMap å­˜æ”¾è¿™ä¸ªå¯¹è±¡å®ä¾‹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å“ªä¸ª equals æ–¹æ³•ï¼Ÿ"></a>ä¿®æ”¹å¯¹è±¡ A çš„ equals æ–¹æ³•çš„ç­¾åï¼Œé‚£ä¹ˆä½¿ç”¨ HashMap å­˜æ”¾è¿™ä¸ªå¯¹è±¡å®ä¾‹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å“ªä¸ª equals æ–¹æ³•ï¼Ÿ</h1><p>ä¼šè°ƒç”¨å¯¹è±¡çš„ equals æ–¹æ³•ï¼Œå¦‚æœå¯¹è±¡çš„ equals æ–¹æ³•æ²¡æœ‰è¢«é‡å†™ï¼Œequals æ–¹æ³•å’Œ == éƒ½æ˜¯æ¯”è¾ƒæ ˆå†…å±€éƒ¨å˜é‡è¡¨ä¸­æŒ‡å‘å †å†…å­˜åœ°å€å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p><h1 id="Java-ä¸­å®ç°å¤šæ€çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Java-ä¸­å®ç°å¤šæ€çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Java ä¸­å®ç°å¤šæ€çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Java ä¸­å®ç°å¤šæ€çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p><strong>å¤šæ€</strong>æ˜¯æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹å’Œé€šè¿‡è¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åœ¨ç¼–è¯‘æ—¶ä¸ç¡®å®šï¼Œåœ¨è¿è¡ŒæœŸé—´æ‰ç¡®å®šï¼Œä¸€ä¸ªå¼•ç”¨å˜é‡åˆ°åº•ä¼šæŒ‡å‘å“ªä¸ªç±»çš„å®ä¾‹ã€‚è¿™æ ·å°±å¯ä»¥ä¸ç”¨ä¿®æ”¹æºä»£ç ï¼Œå°±å¯ä»¥è®©å¼•ç”¨å˜é‡ç»‘å®šåˆ°å„ç§ä¸åŒçš„ç±»å®ç°ä¸Šã€‚Java å®ç°å¤šæ€å¤šä¸‰ä¸ªå¿…è¦æ¡ä»¶ï¼šç»§æ‰¿ã€é‡å®šã€å‘ä¸Šè½¬å‹ï¼Œåœ¨å¤šæ€ä¸­éœ€è¦å°†å­ç±»çš„å¼•ç”¨èµ‹å€¼ç»™çˆ¶ç±»å¯¹è±¡ï¼Œåªæœ‰è¿™æ ·è¯¥å¼•ç”¨æ‰èƒ½å¤Ÿå…·å¤‡è°ƒç”¨çˆ¶ç±»æ–¹æ³•å’Œå­ç±»çš„æ–¹æ³•ã€‚</p><h1 id="å¦‚ä½•å°†ä¸€ä¸ª-Java-å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶é‡Œï¼Ÿ"><a href="#å¦‚ä½•å°†ä¸€ä¸ª-Java-å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶é‡Œï¼Ÿ" class="headerlink" title="å¦‚ä½•å°†ä¸€ä¸ª Java å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶é‡Œï¼Ÿ"></a>å¦‚ä½•å°†ä¸€ä¸ª Java å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶é‡Œï¼Ÿ</h1><p>ObjectOutputStream.writeObject()è´Ÿè´£å°†æŒ‡å®šçš„æµå†™å…¥ï¼ŒObjectInputStream.readObject()ä»æŒ‡å®š æµè¯»å–åºåˆ—åŒ–æ•°æ®ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å†™å…¥</span></div><div class="line"><span class="keyword">try</span>&#123;</div><div class="line">    ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream</div><div class="line">    os.writeObject(studentList);</div><div class="line">    os.close();</div><div class="line">&#125;<span class="keyword">catch</span>(FileNotFoundException e)&#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;<span class="keyword">catch</span>(IOException e)&#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h1 id="è¯´è¯´ä½ å¯¹-Java-åå°„çš„ç†è§£"><a href="#è¯´è¯´ä½ å¯¹-Java-åå°„çš„ç†è§£" class="headerlink" title="è¯´è¯´ä½ å¯¹ Java åå°„çš„ç†è§£"></a>è¯´è¯´ä½ å¯¹ Java åå°„çš„ç†è§£</h1><p>åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹ä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ã€‚è¿™ç§èƒ½åŠ¨æ€è·å–ä¿¡æ¯åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º Java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚<br>åå°„çš„ä½œç”¨ï¼šå¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°æŸä¸ªç±»çš„æŸä¸ªæˆå‘˜å˜é‡ã€æ–¹æ³•æˆ–å±æ€§æ˜¯ç§æœ‰çš„ï¼Œæˆ–åªå¯¹ç³»ç»Ÿåº”ç”¨å¼€æ”¾ï¼Œè¿™é‡Œå°±å¯ä»¥åˆ©ç”¨ Java çš„åå°„æœºåˆ¶é€šè¿‡åå°„æ¥è·å–æ‰€éœ€çš„ç§æœ‰æˆå‘˜æˆ–æ˜¯æ–¹æ³•ã€‚</p><ol><li>è·å–ç±»çš„ Class å¯¹è±¡å®ä¾‹ Class clz = Class.forName(â€œcom.zhenai.api.Appleâ€);</li><li>æ ¹æ® Class å¯¹è±¡å®ä¾‹è·å– Constructor å¯¹è±¡ Constructor appConstructor = clz.getConstructor();</li><li>ä½¿ç”¨ Constructor å¯¹è±¡çš„ newInstance æ–¹æ³•è·å–åå°„ç±»å¯¹è±¡ Object appleObj = appConstructor.newInstance();</li><li>è·å–æ–¹æ³•çš„ Method å¯¹è±¡ Method setPriceMethod = clz.getMethod(â€œsetPriceâ€,int.class);</li><li>åˆ©ç”¨ invoke æ–¹æ³•è°ƒç”¨æ–¹æ³• setPriceMethod.invoke(appleObj, 14);</li><li>é€šè¿‡ getFields() å¯ä»¥è·å– Class ç±»çš„å±æ€§ï¼Œä½†æ— æ³•è·å–ç§æœ‰å±æ€§ï¼Œè€Œ getDeclareFields()å¯ä»¥è·å–åˆ°åŒ…æ‹¬ç§æœ‰å±æ€§åœ¨å†…çš„æ‰€æœ‰å±æ€§ã€‚å¸¦æœ‰ Declared ä¿®é¥°çš„æ–¹æ³•å¯ä»¥åå°„åˆ°ç§æœ‰çš„æ–¹æ³•ï¼Œæ²¡æœ‰ Declared ä¿®é¥°çš„åªèƒ½ç”¨æ¥åå°„å…¬æœ‰çš„æ–¹æ³•ï¼Œå…¶ä»–å¦‚ Annotation\Field\Constructor ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</li></ol><h1 id="è¯´è¯´ä½ å¯¹-Java-æ³¨è§£çš„ç†è§£"><a href="#è¯´è¯´ä½ å¯¹-Java-æ³¨è§£çš„ç†è§£" class="headerlink" title="è¯´è¯´ä½ å¯¹ Java æ³¨è§£çš„ç†è§£"></a>è¯´è¯´ä½ å¯¹ Java æ³¨è§£çš„ç†è§£</h1><p>æ³¨è§£æ˜¯é€šè¿‡@interface å…³é”®å­—æ¥è¿›è¡Œå®šä¹‰çš„ï¼Œå½¢å¼å’Œæ¥å£å·®ä¸å¤šï¼Œåªæ˜¯å‰é¢å¤šäº†ä¸€ä¸ª@<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TestAnnotation&#123;&#125;</div></pre></td></tr></table></figure></p><p>ä½¿ç”¨æ—¶@TestAnnotation æ¥å¼•ç”¨ï¼Œè¦ä½¿æ³¨è§£èƒ½æ­£å¸¸å·¥ä½œï¼Œè¿˜éœ€è¦ä½¿ç”¨å…ƒæ³¨è§£ï¼Œå®ƒæ˜¯å¯ä»¥æ³¨è§£åˆ°æ³¨è§£ä¸Šçš„æ³¨è§£ã€‚å…ƒæ ‡ç­¾æœ‰@Retention @Documented @Target @Inherited @Repeatable äº”ç§</p><p>@Retention è¯´æ˜æ³¨è§£çš„å­˜æ´»æ—¶é—´ï¼Œå–å€¼æœ‰ RetentionPolicy.SOURCE æ³¨è§£æ—¨åœ¨æºç é˜¶æ®µä¿ç•™ï¼Œåœ¨ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶è¢«ä¸¢å¼ƒï¼›RetentionPolicy.CLASS æ³¨è§£åªä¿ç•™åˆ°ç¼–è¯‘è¿›è¡Œçš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šè¢«åŠ è½½åˆ° JVM ä¸­ã€‚RetentionPolicy.RUNTIME å¯ä»¥ç•™åˆ°ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šè¢«åŠ è½½è¿›å…¥åˆ° JVM ä¸­ï¼Œæ‰€ä»¥å†ç¨‹åºè¿è¡Œæ—¶å¯ä»¥è·å–åˆ°å®ƒä»¬ã€‚</p><p>@Documented æ³¨è§£ä¸­çš„å…ƒç´ åŒ…å«åˆ° javadoc ä¸­å»ï¼›</p><p>@Target é™å®šæ³¨è§£çš„åº”ç”¨åœºæ™¯ï¼ŒElementType.FIELD ç»™å±æ€§è¿›è¡Œæ³¨è§£ï¼›ElemenType.LOCAL_VARIABLE å¯ä»¥ç»™å±€éƒ¨å˜é‡è¿›è¡Œæ³¨è§£ï¼›ElementType.METHOD å¯ä»¥ç»™æ–¹æ³•è¿›è¡Œæ³¨è§£ï¼›ElementType.PACKAGE å¯ä»¥ç»™ä¸€ä¸ªåŒ…è¿›è¡Œæ³¨è§£ ElementType.TYPE å¯ä»¥ç»™ä¸€ä¸ªç±»å‹è¿›è¡Œæ³¨è§£ï¼Œå¦‚ç±»ã€æ¥å£ã€æšä¸¾ï¼›</p><p>@Inherited è‹¥ä¸€ä¸ªè¶…ç±»è¢«@Inherited æ³¨è§£è¿‡çš„æ³¨è§£è¿›è¡Œæ³¨è§£ï¼Œå®ƒçš„å­ç±»æ²¡æœ‰è¢«ä»»ä½•æ³¨è§£åº”ç”¨çš„è¯ï¼Œè¯¥å­ç±»å°±å¯ç»§æ‰¿è¶…ç±»çš„æ³¨è§£ï¼›</p><p><strong>æ³¨è§£çš„ä½œç”¨ï¼š</strong></p><ol><li>æä¾›ä¿¡æ¯ç»™ç¼–è¯‘å™¨ï¼šç¼–è¯‘å™¨å¯ä»¥åˆ©ç”¨æ³¨è§£æ¥æ¢æµ‹é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯  </li><li>ç¼–è¯‘é˜¶æ®µï¼šè½¯ä»¶å·¥å…·å¯ä»¥åˆ©ç”¨æ³¨è§£ä¿¡æ¯æ¥ç”Ÿæˆä»£ç ã€html æ–‡æ¡£æˆ–åšå…¶å®ƒç›¸åº”å¤„ç†ï¼›</li><li>è¿è¡Œé˜¶æ®µï¼šç¨‹åºè¿è¡Œæ—¶å¯åˆ©ç”¨æ³¨è§£æå–ä»£ç ï¼›<br>æ³¨è§£æ˜¯é€šè¿‡åå°„è·å–çš„ï¼Œå¯ä»¥é€šè¿‡ Class å¯¹è±¡çš„ isAnnotationPresent()æ–¹æ³•åˆ¤æ–­å®ƒæ˜¯å¦åº”ç”¨äº†æŸä¸ªæ³¨è§£ï¼Œåœ¨é€šè¿‡ getAnnotation()æ–¹æ³•è·å– Annotation å¯¹è±¡ã€‚</li></ol><h1 id="è¯´ä¸€ä¸‹æ³›å‹åŸç†ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜"><a href="#è¯´ä¸€ä¸‹æ³›å‹åŸç†ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="è¯´ä¸€ä¸‹æ³›å‹åŸç†ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜"></a>è¯´ä¸€ä¸‹æ³›å‹åŸç†ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜</h1><p>æ³›å‹å°±æ˜¯å°†ç±»å‹å˜æˆå‚æ•°ä¼ å…¥ï¼Œä½¿å¾—å¯ä»¥ä½¿ç”¨çš„ç±»å‹å¤šæ ·åŒ–ï¼Œä»è€Œå®ç°è§£è€¦ã€‚Javaæ³›å‹æ˜¯åœ¨Java1.5ä»¥åå‡ºç°çš„ï¼Œä¸ºä¿æŒå¯¹ä»¥å‰ç‰ˆæœ¬çš„å…¼å®¹ï¼Œä½¿ç”¨äº†æ“¦é™¤çš„æ–¹æ³•å®ç°æ³›å‹ã€‚æ“¦é™¤æ˜¯æŒ‡åœ¨ä¸€å®šç¨‹åº¦æ— è§†ç±»å‹å‚æ•°Tï¼Œç›´æ¥ä»Tæ‰€åœ¨çš„ç±»å¼€å§‹å‘ä¸ŠTçš„çˆ¶ç±»å»æ“¦é™¤ï¼Œå¦‚è°ƒç”¨æ³›å‹æ–¹æ³•ï¼Œä¼ å…¥ç±»å‹å‚æ•°Tè¿›å…¥æ–¹æ³•å†…éƒ¨ï¼Œè‹¥æ²¡åœ¨å£°æ˜æ—¶åšç±»ä¼¼public T methodName(T extends Father t){}ï¼ŒJavaå°±è¿›è¡Œäº†å‘ä¸Šç±»å‹çš„æ“¦é™¤ï¼Œç›´æ¥æŠŠå‚æ•°tå½“åšObjectç±»æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯ä¼ è¿›å»çš„Tã€‚å³åœ¨æœ‰æ³›å‹çš„ä»»ä½•ç±»å’Œæ–¹æ³•å†…éƒ¨ï¼Œå®ƒéƒ½æ— æ³•çŸ¥é“è‡ªå·±çš„æ³›å‹å‚æ•°ï¼Œæ“¦é™¤å’Œè½¬å‹éƒ½æ˜¯åœ¨è¾¹ç•Œä¸Šå‘ç”Ÿï¼Œå³ä¼ è¿›å»çš„å‚åœ¨è¿›å…¥ç±»æˆ–æ–¹æ³•æ—¶è¢«æ“¦é™¤æ‰ï¼Œä½†ä¼ å‡ºæ¥çš„æ—¶å€™åˆè¢«è½¬æˆäº†æˆ‘ä»¬è®¾ç½®çš„Tã€‚åœ¨æ³›å‹ç±»æˆ–æ–¹æ³•å†…ï¼Œä»»ä½•æ¶‰åŠåˆ°å…·ä½“ç±»å‹ï¼ˆå³æ“¦é™¤åçš„ç±»å‹çš„å­ç±»ï¼‰æ“ä½œéƒ½ä¸èƒ½è¿›è¡Œï¼Œå¦‚new T()ï¼Œæˆ–è€…T.play()ï¼ˆplayä¸ºæŸå­ç±»çš„æ–¹æ³•è€Œä¸æ˜¯æ“¦é™¤åçš„ç±»çš„æ–¹æ³•ï¼‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†æ‰ï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†æ‰ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†æ‰ï¼Ÿ&quot;&gt;&lt;/a&gt;ä¸‹é¢é‚£äº›æƒ…å†µä¸‹çš„å¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†
      
    
    </summary>
    
    
      <category term="Interview" scheme="https://edward7zhang.github.io/tags/Interview/"/>
    
      <category term="Java" scheme="https://edward7zhang.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>è®ºï¼šçº¿ç¨‹ã€å¤šçº¿ç¨‹å’Œçº¿ç¨‹æ± </title>
    <link href="https://edward7zhang.github.io/2019/03/06/%E8%AE%BA%EF%BC%9A%E7%BA%BF%E7%A8%8B%E3%80%81%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    <id>https://edward7zhang.github.io/2019/03/06/è®ºï¼šçº¿ç¨‹ã€å¤šçº¿ç¨‹å’Œçº¿ç¨‹æ± /</id>
    <published>2019-03-06T04:07:14.000Z</published>
    <updated>2019-03-09T15:09:41.815Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…³äº Javaå¤šçº¿ç¨‹ï¼Œåœ¨é¢è¯•çš„æ—¶å€™ï¼Œé—®çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯â‘ æ‚²è§‚é”å’Œä¹è§‚é”ã€â‘¡synchronizedå’ŒlockåŒºåˆ«ä»¥åŠvolatileå’Œsynchronizedçš„åŒºåˆ«ï¼Œâ‘¢å¯é‡å…¥é”ä¸éå¯é‡å…¥é”çš„åŒº åˆ«ã€â‘£å¤šçº¿ç¨‹æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„ã€â‘¤çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜ã€â‘¥çº¿ç¨‹æ± çš„åŸç†ã€â‘¦çº¿ç¨‹æ± ä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹ã€â‘§AQSåŸ ç†ã€â‘¨ReentranLockæºç ï¼Œè®¾è®¡åŸç†ï¼Œæ•´ä½“è¿‡ç¨‹ ç­‰ç­‰é—®é¢˜ã€‚ </p></blockquote><h1 id="å¼€å¯çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ï¼Ÿ"><a href="#å¼€å¯çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="å¼€å¯çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ï¼Ÿ"></a>å¼€å¯çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ï¼Ÿ</h1><ul><li><p>ç»§æ‰¿ Thread ç±»ï¼Œé‡å†™ run()æ–¹æ³•ï¼Œåœ¨ run()æ–¹æ³•ä¸­ç¼–å†™è¦å®Œæˆçš„ä»»åŠ¡ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Thread().start();</div></pre></td></tr></table></figure></li><li><p>å®ç° Runnable æ¥å£ï¼Œå®ç° run()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable()).start();</div></pre></td></tr></table></figure></li><li><p>å®ç° Callable æ¥å£ MyCallable ç±»ï¼Œå®ç° call()æ–¹æ³•ï¼Œä½¿ç”¨ FutureTask ç±»æ¥åŒ…è£… Callable å¯¹è±¡ï¼Œä½¿ç”¨ FutureTask å¯¹è±¡ä½œä¸º Thread å¯¹è±¡çš„ target åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹ï¼›è°ƒç”¨ FutureTask å¯¹è±¡çš„ get() æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> MyCallable());</div><div class="line"><span class="keyword">new</span> Thread(ft).start();</div></pre></td></tr></table></figure></li></ul><h1 id="run-å’Œ-start-æ–¹æ³•çš„åŒºåˆ«"><a href="#run-å’Œ-start-æ–¹æ³•çš„åŒºåˆ«" class="headerlink" title="run() å’Œ start() æ–¹æ³•çš„åŒºåˆ«"></a>run() å’Œ start() æ–¹æ³•çš„åŒºåˆ«</h1><p>run()æ–¹æ³•åªæ˜¯çº¿ç¨‹çš„ä¸»æ–¹æ³•ä½“ï¼Œå’Œæ™®é€šæ–¹æ³•ä¸€æ ·ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚åªæœ‰è°ƒç”¨ start()æ–¹æ³•ï¼Œæ‰ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹æ‰ä¼šè°ƒç”¨ run()æ–¹æ³•ï¼Œçº¿ç¨‹æ‰ä¼šå¼€å§‹æ‰§è¡Œã€‚</p><h1 id="å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•°ï¼Ÿ"><a href="#å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•°ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•°ï¼Ÿ"></a>å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•°ï¼Ÿ</h1><p>åˆ›å»º Semaphore å˜é‡ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">5</span>, <span class="keyword">true</span>);</div></pre></td></tr></table></figure></p><p>å½“æ–¹æ³•è¿›å…¥æ—¶ï¼Œè¯·æ±‚ä¸€ä¸ªä¿¡å·ï¼Œå¦‚æœä¿¡å·è¢«ç”¨å®Œåˆ™ç­‰å¾…ï¼Œæ–¹æ³•è¿è¡Œå®Œï¼Œé‡Šæ”¾ä¸€ä¸ªä¿¡å·ï¼Œé‡Šæ”¾çš„ä¿¡å·æ–°çš„çº¿ç¨‹å°±å¯ä»¥ä½¿ç”¨ã€‚</p><h1 id="åœ¨-Java-ä¸­-wait-å’Œ-sleep-æ–¹æ³•çš„ä¸åŒ"><a href="#åœ¨-Java-ä¸­-wait-å’Œ-sleep-æ–¹æ³•çš„ä¸åŒ" class="headerlink" title="åœ¨ Java ä¸­ wait å’Œ sleep æ–¹æ³•çš„ä¸åŒ"></a>åœ¨ Java ä¸­ wait å’Œ sleep æ–¹æ³•çš„ä¸åŒ</h1><ul><li>wait()æ–¹æ³•å±äº Object ç±»ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œåªæœ‰è¯¥å¯¹è±¡è°ƒç”¨ notify()æ–¹æ³•åæœ¬çº¿ç¨‹æ‰è¿›å…¥å¯¹è±¡é”å®šæ± å‡†å¤‡è·å–å¯¹è±¡é”è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚</li><li>sleep()æ–¹æ³•å±äº Thread ç±»ï¼Œsleep å¯¼è‡´ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œè®©å‡º CPUï¼Œä½†ä»–çš„ç›‘æ§çŠ¶æ€ä¾ç„¶ä¿å­˜ç€ï¼Œå½“æŒ‡å®šæ—¶é—´åˆ°äº†åˆä¼šå›åˆ°è¿è¡ŒçŠ¶æ€ï¼Œsleep()æ–¹æ³•ä¸­çº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚<h1 id="è°ˆè°ˆ-wait-notfiy-æ–¹æ³•çš„ç†è§£"><a href="#è°ˆè°ˆ-wait-notfiy-æ–¹æ³•çš„ç†è§£" class="headerlink" title="è°ˆè°ˆ wait()/notfiy() æ–¹æ³•çš„ç†è§£"></a>è°ˆè°ˆ wait()/notfiy() æ–¹æ³•çš„ç†è§£</h1></li><li>notify()ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹</li><li>notifyAll()ï¼šé€šçŸ¥æ‰€æœ‰ç­‰å¾…ç«äº‰è¯¥èµ„æºçš„çº¿ç¨‹</li><li>wait()ï¼šé‡Šæ”¾ obj çš„é”ï¼Œå¯¼è‡´å½“å‰çš„çº¿ç¨‹ç­‰å¾…ï¼Œç›´æ¥å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify()æˆ– notifyAll();</li><li>å½“è¦è°ƒç”¨ wait()æˆ– notify()/notifyAll()æ–¹æ³•æ—¶ï¼Œä¸€å®šè¦å¯¹ç«äº‰èµ„æºè¿›è¡ŒåŠ é”ï¼Œä¸€èˆ¬æ”¾åˆ° synchronized(obj)ä»£ç ä¸­ã€‚å½“è°ƒç”¨ obj.notify/notifyAll åï¼Œè°ƒç”¨çº¿ç¨‹ä¾æ—§æŒæœ‰ obj é”ï¼Œå› æ­¤ç­‰å¾…çº¿ç¨‹è™½è¢«å”¤é†’ï¼Œä½†ä»æ— æ³•è·å¾— obj é”ï¼ŒçŸ¥é“è°ƒç”¨çº¿ç¨‹é€€å‡º synchronized å—ï¼Œé‡Šæ”¾ obj é”åï¼Œå…¶ä»–ç­‰å¾…çº¿ç¨‹æ‰æœ‰æœºä¼šè·å¾—é”ç»§ç»­æ‰§è¡Œã€‚<h1 id="ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ"><a href="#ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ"></a>ä»€ä¹ˆå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Ÿ</h1></li><li>çº¿ç¨‹æ‰§è¡Œäº† Thread.sleep(int millsecond)æ–¹æ³•ï¼Œæ”¾å¼ƒ CPUï¼Œç¡çœ ä¸€æ®µæ—¶é—´ï¼Œä¸€æ®µæ—¶é—´è¿‡åæ¢å¤æ‰§è¡Œï¼›</li><li>çº¿ç¨‹æ‰§è¡Œä¸€æ®µåŒæ­¥ä»£ç ï¼Œä½†æ— æ³•è·å¾—ç›¸å…³çš„åŒæ­¥é”ï¼Œåªèƒ½è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç­‰åˆ°è·å–åŒæ­¥é”ï¼Œæ‰èƒ½æ¢å¤æ‰§è¡Œï¼›</li><li>çº¿ç¨‹æ‰§è¡Œäº†ä¸€ä¸ªå¯¹è±¡çš„ wait()æ–¹æ³•ï¼Œç›´æ¥è¿›å…¥é˜»å¡æ€ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œ notify()/notifyAll()æ“ä½œï¼›</li><li>çº¿ç¨‹æ‰§è¡ŒæŸäº› IO æ“ä½œï¼Œå› ä¸ºç­‰å¾…ç›¸å…³èµ„æºè€Œè¿›å…¥äº†é˜»å¡æ€ï¼Œå¦‚ System.inï¼Œä½†æ²¡æœ‰æ”¶åˆ°é”®ç›˜çš„è¾“å…¥ï¼Œåˆ™è¿›å…¥é˜»å¡æ€ã€‚</li><li>çº¿ç¨‹ç¤¼è®©ï¼ŒThread.yield()æ–¹æ³•ï¼Œæš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ï¼ŒæŠŠæ‰§è¡Œæœºä¼šè®©ç»™ç›¸åŒæˆ–è€…æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ï¼Œä½†å¹¶ä¸ä¼šä½¿çº¿ç¨‹è¿›å…¥é˜»å¡æ€ï¼Œçº¿ç¨‹ä»å¤„äºå¯æ‰§è¡Œæ€ï¼Œéšæ—¶å¯èƒ½å†æ¬¡åˆ†å¾— CPU æ—¶é—´ã€‚çº¿ç¨‹è‡ªé—­ï¼Œjoin()æ–¹æ³•ï¼Œåœ¨å½“å‰çº¿ç¨‹è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join()æ–¹æ³•ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡æ€ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œç»“æŸï¼Œå½“å‰çº¿ç¨‹å†ç”±é˜»å¡è½¬ä¸ºå°±ç»ªæ€ã€‚</li><li>çº¿ç¨‹æ‰§è¡Œ suspend()ä½¿çº¿ç¨‹è¿›å…¥é˜»å¡æ€ï¼Œå¿…é¡» resume()æ–¹æ³•è¢«è°ƒç”¨ï¼Œæ‰èƒ½ä½¿çº¿ç¨‹é‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚<h1 id="çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ"><a href="#çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ" class="headerlink" title="çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ"></a>çº¿ç¨‹å¦‚ä½•å…³é—­ï¼Ÿ</h1></li><li>ä½¿ç”¨æ ‡å¿—ä½</li><li>ä½¿ç”¨ stop() æ–¹æ³•ï¼Œä½†è¯¥æ–¹æ³•å°±åƒå…³æ‰ç”µè„‘ç”µæºä¸€æ ·ï¼Œå¯èƒ½ä¼šå‘ç”Ÿé¢„æ–™ä¸åˆ°çš„é—®é¢˜</li><li>ä½¿ç”¨ä¸­æ–­ interrupt()<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread</span></span>&#123;</div><div class="line">    <span class="comment">//ä¸­æ–­å½“å‰çº¿ç¨‹</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interrupt</span><span class="params">()</span></span>;</div><div class="line">    <span class="comment">//åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInterrupt</span><span class="params">()</span></span>;</div><div class="line">    <span class="comment">//æ¸…é™¤å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¹¶è¿”å›ä¹‹å‰çš„å€¼</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> boolen <span class="title">interrupted</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>ä½†è°ƒç”¨ interrupt()æ–¹æ³•åªæ˜¯ä¼ é€’ä¸­æ–­è¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶ä¸ä»£è¡¨è¦ç«‹é©¬åœæ­¢ç›®æ ‡çº¿ç¨‹</p><h1 id="è®²ä¸€ä¸‹-Java-ä¸­çš„åŒæ­¥çš„æ–¹æ³•"><a href="#è®²ä¸€ä¸‹-Java-ä¸­çš„åŒæ­¥çš„æ–¹æ³•" class="headerlink" title="è®²ä¸€ä¸‹ Java ä¸­çš„åŒæ­¥çš„æ–¹æ³•"></a>è®²ä¸€ä¸‹ Java ä¸­çš„åŒæ­¥çš„æ–¹æ³•</h1><p>ä¹‹æ‰€ä»¥éœ€è¦åŒæ­¥ï¼Œå› ä¸ºåœ¨å¤šçº¿ç¨‹å¹¶å‘æ§åˆ¶ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå¯å…±äº«çš„èµ„æºæ—¶ï¼Œå¦‚æœæ²¡æœ‰é‡‡å–åŒæ­¥æœºåˆ¶ï¼Œå°†ä¼šå¯¼è‡´æ•°æ®ä¸å‡†ç¡®ï¼Œå› æ­¤éœ€è¦åŠ å…¥åŒæ­¥é”ï¼Œç¡®ä¿åœ¨è¯¥çº¿ç¨‹æ²¡æœ‰å®Œæˆæ“ä½œå‰è¢«å…¶ä»–çº¿ç¨‹è°ƒç”¨ï¼Œä»è€Œä¿è¯è¯¥å˜é‡çš„å”¯ä¸€æ€§å’Œå‡†ç¡®æ€§ã€‚</p><h2 id="synchronized-ä¿®é¥°åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•"><a href="#synchronized-ä¿®é¥°åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•" class="headerlink" title="synchronized ä¿®é¥°åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•"></a>synchronized ä¿®é¥°åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•</h2><p>ç”±äº Java çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…ç½®é”ï¼Œç”¨æ­¤å…³é”®å­—ä¿®é¥°æ–¹æ³•æ—¶ï¼Œå†…ç½®é”ä¼šä¿æŠ¤æ•´ä¸ªæ–¹æ³•ã€‚åœ¨è°ƒç”¨è¯¥æ–¹æ³•å‰ï¼Œéœ€è·å¾—å†…ç½®é”ï¼Œå¦åˆ™å°±å¤„äºé˜»å¡çŠ¶æ€</p><h2 id="volatile-ä¿®é¥°å˜é‡"><a href="#volatile-ä¿®é¥°å˜é‡" class="headerlink" title="volatile ä¿®é¥°å˜é‡"></a>volatile ä¿®é¥°å˜é‡</h2><p>ä¿è¯å˜é‡åœ¨çº¿ç¨‹é—´çš„å¯è§æ€§æ¯æ¬¡çº¿ç¨‹è¦è®¿é—® volatile ä¿®é¥°çš„å˜é‡æ—¶éƒ½ä»ä¸»å­˜ä¸­è¯»å–ï¼Œè€Œä¸æ˜¯ç¼“å­˜ä¸­ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹è®¿é—®åˆ°çš„å˜é‡éƒ½æ˜¯ä¸€æ ·çš„ã€‚ä¸”ä½¿ç”¨å†…å­˜å±éšœã€‚</p><h2 id="ReentrantLock-é‡å…¥é”ï¼Œå®ƒå¸¸ç”¨çš„æ–¹æ³•æœ‰-ReentrantLock-ï¼šåˆ›å»ºä¸€ä¸ª-ReentrantLock-å®ä¾‹"><a href="#ReentrantLock-é‡å…¥é”ï¼Œå®ƒå¸¸ç”¨çš„æ–¹æ³•æœ‰-ReentrantLock-ï¼šåˆ›å»ºä¸€ä¸ª-ReentrantLock-å®ä¾‹" class="headerlink" title="ReentrantLock é‡å…¥é”ï¼Œå®ƒå¸¸ç”¨çš„æ–¹æ³•æœ‰ ReentrantLock()ï¼šåˆ›å»ºä¸€ä¸ª ReentrantLock å®ä¾‹"></a>ReentrantLock é‡å…¥é”ï¼Œå®ƒå¸¸ç”¨çš„æ–¹æ³•æœ‰ ReentrantLock()ï¼šåˆ›å»ºä¸€ä¸ª ReentrantLock å®ä¾‹</h2><p>lock()è·å¾—é” unlock()é‡Šæ”¾é”</p><h2 id="ä½¿ç”¨å±€éƒ¨å˜é‡-ThreadLocal-å®ç°çº¿ç¨‹åŒæ­¥"><a href="#ä½¿ç”¨å±€éƒ¨å˜é‡-ThreadLocal-å®ç°çº¿ç¨‹åŒæ­¥" class="headerlink" title="ä½¿ç”¨å±€éƒ¨å˜é‡ ThreadLocal å®ç°çº¿ç¨‹åŒæ­¥"></a>ä½¿ç”¨å±€éƒ¨å˜é‡ ThreadLocal å®ç°çº¿ç¨‹åŒæ­¥</h2><p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šä¿å­˜ä¸€ä»½è¯¥å˜é‡çš„å‰¯æœ¬ï¼Œå‰¯æœ¬ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥éšæ„ä¿®æ”¹è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸å½±å“å…¶ä»–çº¿ç¨‹ã€‚<br>å¸¸ç”¨æ–¹æ³•ï¼š</p><ul><li>ThreadLocal()åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æœ¬åœ°å˜é‡ï¼›</li><li>get()è¿”å›æ­¤çº¿ç¨‹å°±ä¸æ‡‚å½“å‰çº¿ç¨‹å‰¯æœ¬å˜é‡ï¼›</li><li>initialValue()è¿”å›æ¬¡çº¿ç¨‹å±€éƒ¨å˜é‡çš„å½“å‰çº¿ç¨‹çš„å‡ºäº‹å€¼ï¼›</li><li>set(T value)å°†æ­¤çº¿ç¨‹å˜é‡çš„å½“å‰çº¿ç¨‹å‰¯æœ¬ä¸­çš„å€¼è®¾ç½®ä¸º value<h2 id="ä½¿ç”¨åŸå­å˜é‡"><a href="#ä½¿ç”¨åŸå­å˜é‡" class="headerlink" title="ä½¿ç”¨åŸå­å˜é‡"></a>ä½¿ç”¨åŸå­å˜é‡</h2>å¦‚ AtomicInteger<br>å¸¸ç”¨æ–¹æ³•ï¼š</li><li>AtomicInteger(int value)åˆ›å»ºä¸ªæœ‰ç»™å®šåˆè¯•å€¼çš„ AtomicInteger æ•´æ•°ï¼›</li><li>addAndGet(int data)ä»¥åŸå­æ–¹å¼å°†ç»™å®šå€¼ä¸å½“å‰å€¼ç›¸åŠ <h2 id="ä½¿ç”¨é˜»å¡é˜Ÿåˆ—å®ç°çº¿ç¨‹åŒæ­¥"><a href="#ä½¿ç”¨é˜»å¡é˜Ÿåˆ—å®ç°çº¿ç¨‹åŒæ­¥" class="headerlink" title="ä½¿ç”¨é˜»å¡é˜Ÿåˆ—å®ç°çº¿ç¨‹åŒæ­¥"></a>ä½¿ç”¨é˜»å¡é˜Ÿåˆ—å®ç°çº¿ç¨‹åŒæ­¥</h2>LinkedBlockingQueue<e></e></li></ul><h1 id="å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h1><p><strong>çº¿ç¨‹å®‰å…¨æ€§ä½“ç°çš„ä¸‰æ–¹æ³•ï¼š</strong></p><ol><li>åŸå­æ€§ï¼šæä¾›äº’æ–¥è®¿é—®ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚JDK ä¸­æä¾›äº†å¾ˆå¤š atomic ç±»ï¼Œå¦‚ AtomicInteger\AtomicBoolean\AtomicLongï¼Œå®ƒä»¬æ˜¯é€šè¿‡ CAS å®ŒæˆåŸå­æ€§ã€‚JDK æä¾›é”åˆ†ä¸ºä¸¤ç§ï¼šsynchronized ä¾èµ– JVM å®ç°é”ï¼Œè¯¥å…³é”®å­—å¯¹å¯¹è±¡çš„ä½œç”¨èŒƒå›´å†…åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ“ä½œã€‚å¦ä¸€ç§æ˜¯ LOCKï¼Œæ˜¯ JDK æä¾›çš„ä»£ç å±‚é¢çš„é”ï¼Œä¾èµ– CPU æŒ‡ä»¤ï¼Œä»£è¡¨æ€§æ˜¯ ReentrantLockã€‚</li><li>å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹ä¸»å†…å­˜çš„ä¿®æ”¹åŠæ—¶è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ã€‚JVM æä¾›äº† synchronized å’Œ volatileï¼Œvolatile çš„å¯è§æ€§æ˜¯é€šè¿‡å†…å­˜å±éšœå’Œç¦æ­¢é‡æ’åºå®ç°çš„ï¼Œvolatile ä¼šåœ¨å†™æ“ä½œæ—¶ï¼Œåœ¨å†™æ“ä½œååŠ ä¸€æ¡ store å±éšœæŒ‡ä»¤ï¼Œå°†æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼›ä¼šåœ¨è¯»æ“ä½œæ—¶ï¼Œåœ¨è¯»æ“ä½œå‰åŠ ä¸€æ¡ load æŒ‡ä»¤ï¼Œä»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚</li><li>æœ‰åºæ€§ï¼šæŒ‡ä»¤æ²¡æœ‰è¢«ç¼–è¯‘å™¨é‡æ’åºã€‚å¯é€šè¿‡ volatileã€synchronizedã€Lock ä¿è¯æœ‰åºæ€§ 4. </li></ol><h1 id="static-synchronized-æ–¹æ³•çš„å¤šçº¿ç¨‹è®¿é—®å’Œä½œç”¨"><a href="#static-synchronized-æ–¹æ³•çš„å¤šçº¿ç¨‹è®¿é—®å’Œä½œç”¨" class="headerlink" title="static synchronized æ–¹æ³•çš„å¤šçº¿ç¨‹è®¿é—®å’Œä½œç”¨"></a>static synchronized æ–¹æ³•çš„å¤šçº¿ç¨‹è®¿é—®å’Œä½œç”¨</h1><p>static synchronized æ§åˆ¶çš„æ˜¯ç±»çš„æ‰€æœ‰å®ä¾‹è®¿é—®ï¼Œä¸ç®¡ new äº†å¤šå°‘å¯¹è±¡ï¼Œåªæœ‰ä¸€ä»½ï¼Œæ‰€ä»¥å¯¹è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½åŠ äº†é”ã€‚é™åˆ¶å¤šçº¿ç¨‹ä¸­è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹åŒæ—¶è®¿é—® JVM ä¸­è¯¥ç±»å¯¹åº”çš„ä»£ç ã€‚</p><h1 id="é¢è¯•ä¸­å…³äº-synchronized-å…³é”®å­—çš„-5-è¿å‡»"><a href="#é¢è¯•ä¸­å…³äº-synchronized-å…³é”®å­—çš„-5-è¿å‡»" class="headerlink" title="é¢è¯•ä¸­å…³äº synchronized å…³é”®å­—çš„ 5 è¿å‡»"></a>é¢è¯•ä¸­å…³äº synchronized å…³é”®å­—çš„ 5 è¿å‡»</h1><h2 id="è¯´ä¸€è¯´è‡ªå·±å¯¹äº-synchronized-å…³é”®å­—çš„äº†è§£"><a href="#è¯´ä¸€è¯´è‡ªå·±å¯¹äº-synchronized-å…³é”®å­—çš„äº†è§£" class="headerlink" title="è¯´ä¸€è¯´è‡ªå·±å¯¹äº synchronized å…³é”®å­—çš„äº†è§£"></a>è¯´ä¸€è¯´è‡ªå·±å¯¹äº synchronized å…³é”®å­—çš„äº†è§£</h2><p>synchronized å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œsynchronized å…³é”®å­—å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚<br>å¦å¤–ï¼Œåœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronized å±äºé‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ Mutex Lock æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™æ¥å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ—©æœŸçš„ synchronized æ•ˆç‡ä½çš„åŸå› ã€‚åº†å¹¸çš„æ˜¯åœ¨ Java 6 ä¹‹å Java å®˜æ–¹å¯¹ä» JVM å±‚é¢å¯¹ synchronized è¾ƒå¤§ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨çš„ synchronized é”æ•ˆç‡ä¹Ÿä¼˜åŒ–å¾—å¾ˆä¸é”™äº†ã€‚JDK1.6 å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚</p><h2 id="è¯´ä¸€è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨-synchronized-å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—ï¼Ÿ"><a href="#è¯´ä¸€è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨-synchronized-å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—ï¼Ÿ" class="headerlink" title="è¯´ä¸€è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨ synchronized å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—ï¼Ÿ"></a>è¯´ä¸€è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨ synchronized å…³é”®å­—ï¼Œåœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†å—ï¼Ÿ</h2><p>synchronized å…³é”®å­—æœ€ä¸»è¦çš„ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ul><li>ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œä½œç”¨äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å¯¹è±¡å®ä¾‹çš„é”</li><li>ä¿®é¥°é™æ€æ–¹æ³•ï¼Œä½œç”¨äºå½“å‰ç±»å¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰ç±»å¯¹è±¡çš„é”ã€‚ä¹Ÿæ˜¯ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ï¼Œå› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ï¼ˆstatic è¡¨æ˜è¿™æ˜¯è¯¥ç±»çš„ä¸€ä¸ªé™æ€èµ„æºï¼Œä¸ç®¡ new äº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œåªæœ‰ä¸€ä»½ï¼Œæ‰€ä»¥å¯¹è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½åŠ äº†é”ï¼‰ã€‚æ‰€ä»¥å¦‚æœä¸€ä¸ªçº¿ç¨‹ A è°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€ synchronized æ–¹æ³•ï¼Œè€Œ B çº¿ç¨‹éœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ synchronized æ–¹æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œå› ä¸ºè®¿é—®é™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼Œè€Œè®¿é—®éé™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”ã€‚</li><li>ä¿®é¥°ä»£ç å—ï¼ŒæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚å’Œ synchronized æ–¹æ³•ä¸€æ ·ï¼Œsynchronized(this)ä»£ç å—ä¹Ÿæ˜¯é”å®šå½“å‰å¯¹è±¡çš„ã€‚synchronized å…³é”®å­—åŠ åˆ° static é™æ€æ–¹æ³•å’Œ synchronized(class)ä»£ç å—ä¸Šéƒ½æ˜¯ç»™ Class ç±»ä¸Šé”ã€‚è¿™é‡Œå†æé†’ä¸€ä¸‹ï¼šsynchronized å…³é”®å­—åŠ åˆ° static é™æ€æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå°½é‡ä¸è¦ä½¿ç”¨ synchronized(String a)å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å†²åŠŸèƒ½ã€‚<br>ä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ä¸ºä¾‹è®²è§£ä¸€ä¸‹ synchronized å…³é”®å­—çš„å…·ä½“ä½¿ç”¨ã€‚<br>é¢è¯•ä¸­é¢è¯•å®˜ç»å¸¸ä¼šè¯´ï¼šâ€œå•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿæ¥ç»™æˆ‘æ‰‹å†™ä¸€ä¸‹ï¼ç»™æˆ‘è§£é‡Šä¸€ä¸‹åŒé‡æ£€éªŒé”æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„åŸç†å‘—ï¼â€<br>åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹(çº¿ç¨‹å®‰å…¨)<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton uniqueInstance;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getUniqueInstance</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç </span></div><div class="line">    <span class="keyword">if</span>(uniqueInstance == <span class="keyword">null</span>)&#123;</div><div class="line">      <span class="comment">//ç±»å¯¹è±¡åŠ é”</span></div><div class="line">      <span class="keyword">synchronized</span>(Singleton.class)&#123;</div><div class="line">        <span class="keyword">if</span>(uniqueInstance == <span class="keyword">null</span>)&#123;</div><div class="line">          uniqueInstance = <span class="keyword">new</span> Singleton();</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> uniqueInstance;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>å¦å¤–ï¼Œéœ€è¦æ³¨æ„ uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦ã€‚<br>uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ uniqueInstance = new Singleton(); è¿™æ®µä»£ç å…¶å®æ˜¯åˆ† ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š </p><ol><li>ä¸º uniqueInstance åˆ†é…å†…å­˜ç©ºé—´ </li><li>åˆå§‹åŒ– uniqueInstance </li><li>å°† uniqueInstance æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ </li></ol><p>ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1-&gt;3-&gt;2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getUniqueInstance() åå‘ç° uniqueInstance ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å›uniqueInstanceï¼Œä½†æ­¤æ—¶ uniqueInstance è¿˜æœªè¢« åˆå§‹åŒ–ã€‚<br>ä½¿ç”¨ volatile å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚</p><h2 id="è®²ä¸€ä¸‹-synchronized-å…³é”®å­—çš„åº•å±‚åŸç†"><a href="#è®²ä¸€ä¸‹-synchronized-å…³é”®å­—çš„åº•å±‚åŸç†" class="headerlink" title="è®²ä¸€ä¸‹ synchronized å…³é”®å­—çš„åº•å±‚åŸç†"></a>è®²ä¸€ä¸‹ synchronized å…³é”®å­—çš„åº•å±‚åŸç†</h2><p>synchronized å…³é”®å­—åº•å±‚åŸç†å±äº JVM å±‚é¢ã€‚</p><ol><li>synchronized åŒæ­¥è¯­å¥å—çš„æƒ…å†µ <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedDemo</span></span>&#123;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> methodï¼ˆï¼‰&#123;</div><div class="line">    <span class="keyword">synchronized</span>ï¼ˆ<span class="keyword">this</span>ï¼‰&#123;</div><div class="line">      System.out.println(<span class="string">"synchronized ä»£ç å—"</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p>é€šè¿‡ JDK è‡ªå¸¦çš„ javap å‘½ä»¤æŸ¥çœ‹ SynchronizedDemo ç±»çš„ç›¸å…³å­—èŠ‚ç ä¿¡æ¯ï¼šé¦–å…ˆåˆ‡æ¢åˆ°ç±»çš„å¯¹åº”ç›®å½•æ‰§è¡Œ <code>javac SynchronizedDemo.java</code> å‘½ä»¤ç”Ÿæˆç¼–è¯‘åçš„.class æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ <code>javap -c -s -v -l SynchronizedDemo.class</code>ã€‚<br>synchronized åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­ monitorenter æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œmonitorexit æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚å½“æ‰§è¡Œ monitorenter æŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯†å›¾è·å–é”ä¹Ÿæ˜¯è·å– monitor(monitor å¯¹è±¡å­˜åœ¨äºæ¯ä¸ª Java å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ï¼Œsynchronized é”ä¾¿æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–é”çš„ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Java ä¸­ä»»æ„å¯¹è±¡å¯ä»¥ä½œä¸ºé”çš„åŸå› )çš„æŒæœ‰æƒã€‚å½“è®¡æ•°å™¨ä¸º 0 åˆ™å¯ä»¥æˆåŠŸè·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ä¸º 1 ä¹Ÿå°±æ˜¯åŠ  1.ç›¸åº”çš„åœ¨æ‰§è¡Œ monitorexit æŒ‡ä»¤åï¼Œå°†é”è®¡æ•°å™¨è®¾ä¸º 0ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ã€‚å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚</p><ol><li>synchronized ä¿®é¥°æ–¹æ³•çš„æƒ…å†µ <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedDemo2</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>&#123;</div><div class="line">    System.out.println(<span class="string">"synchronized æ–¹æ³•"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p>synchronized ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ monitorenter æŒ‡ä»¤å’Œ monitorexit æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„å´æ˜¯ ACC_SYNCHRONIZED æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼ŒJVM é€šè¿‡è¯¥ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ¥ è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚</p><h2 id="è¯´ä¸€è¯´-JDK1-6-ä¹‹åçš„-synchronized-å…³é”®å­—åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–ï¼Œå¯ä»¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™äº›ä¼˜åŒ–å—ï¼Ÿ"><a href="#è¯´ä¸€è¯´-JDK1-6-ä¹‹åçš„-synchronized-å…³é”®å­—åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–ï¼Œå¯ä»¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™äº›ä¼˜åŒ–å—ï¼Ÿ" class="headerlink" title="è¯´ä¸€è¯´ JDK1.6 ä¹‹åçš„ synchronized å…³é”®å­—åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–ï¼Œå¯ä»¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™äº›ä¼˜åŒ–å—ï¼Ÿ"></a>è¯´ä¸€è¯´ JDK1.6 ä¹‹åçš„ synchronized å…³é”®å­—åº•å±‚åšäº†å“ªäº›ä¼˜åŒ–ï¼Œå¯ä»¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™äº›ä¼˜åŒ–å—ï¼Ÿ</h2><p>JDK1.6 å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ã€è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ç­‰æŠ€æœ¯æ¥å‡ å°‘é”æ“ä½œçš„å¼€é”€ã€‚<br>é”ä¸»è¦å­˜åœ¨å››ç§çŠ¶æ€ï¼Œä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼Œä»–ä»¬ä¼šéšç€ç«äº‰çš„æ¿€çƒˆè€Œé€ æ¸å‡çº§ã€‚<br>æ³¨æ„é”å¯ä»¥å‡çº§ä¸å¯é™çº§ï¼Œè¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚<br>å…³äºè¿™å‡ ç§ä¼˜åŒ–çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ï¼šsynchronized å…³é”®å­—ä½¿ç”¨ã€åº•å±‚åŸç†ã€JDK1.6 ä¹‹åçš„åº•å±‚ä¼˜åŒ–ä»¥åŠ å’Œ ReenTrantLock çš„å¯¹æ¯”</p><h2 id="è°ˆè°ˆ-synchronized-å’Œ-ReenTrantLock-çš„åŒºåˆ«"><a href="#è°ˆè°ˆ-synchronized-å’Œ-ReenTrantLock-çš„åŒºåˆ«" class="headerlink" title="è°ˆè°ˆ synchronized å’Œ ReenTrantLock çš„åŒºåˆ«"></a>è°ˆè°ˆ synchronized å’Œ ReenTrantLock çš„åŒºåˆ«</h2><p>â‘  ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é” ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”ã€‚<br>â€œå¯é‡å…¥é”â€æ¦‚å¿µæ˜¯ï¼šè‡ªå·±å¯ä»¥å†æ¬¡è·å–è‡ªå·±çš„å†…éƒ¨é”ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†æŸä¸ªå¯¹è±¡çš„é”ï¼Œæ­¤æ—¶ è¿™ä¸ªå¯¹è±¡é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå½“å…¶å†æ¬¡æƒ³è¦è·å–è¿™ä¸ªå¯¹è±¡çš„é”çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥è·å–çš„ï¼Œå¦‚æœä¸å¯é”é‡å…¥çš„è¯ï¼Œå°±ä¼šé€ æˆæ­» é”ã€‚åŒä¸€ä¸ªçº¿ç¨‹æ¯æ¬¡è·å–é”ï¼Œé”çš„è®¡æ•°å™¨éƒ½è‡ªå¢1ï¼Œæ‰€ä»¥è¦ç­‰åˆ°é”çš„è®¡æ•°å™¨ä¸‹é™ä¸º0æ—¶æ‰èƒ½é‡Šæ”¾é”ã€‚<br>â‘¡ synchronized ä¾èµ–äº JVM è€Œ ReenTrantLock ä¾èµ–äº API<br>synchronized æ˜¯ä¾èµ–äº JVM å®ç°çš„ï¼Œå‰é¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº† è™šæ‹Ÿæœºå›¢é˜Ÿåœ¨ JDK1.6 ä¸º synchronized å…³é”®å­—è¿›è¡Œäº†å¾ˆå¤š ä¼˜åŒ–ï¼Œä½†æ˜¯è¿™äº›ä¼˜åŒ–éƒ½æ˜¯åœ¨è™šæ‹Ÿæœºå±‚é¢å®ç°çš„ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æš´éœ²ç»™æˆ‘ä»¬ã€‚ReenTrantLock æ˜¯ JDK å±‚é¢å®ç°çš„ï¼ˆä¹Ÿå°± æ˜¯ API å±‚é¢ï¼Œéœ€è¦ lock() å’Œ unlock æ–¹æ³•é…åˆ try/finally è¯­å¥å—æ¥å®Œæˆï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å®ƒçš„æºä»£ç ï¼Œæ¥çœ‹ å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚<br>â‘¢ ReenTrantLock æ¯” synchronized å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ ç›¸æ¯”synchronizedï¼ŒReenTrantLockå¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚ä¸»è¦æ¥è¯´ä¸»è¦æœ‰ä¸‰ç‚¹ï¼šâ‘ ç­‰å¾…å¯ä¸­æ–­ï¼›â‘¡å¯å®ç°å…¬å¹³é”ï¼› â‘¢å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ï¼ˆé”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼‰</p><ul><li>ReenTrantLockæä¾›äº†ä¸€ç§èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œé€šè¿‡lock.lockInterruptibly()æ¥å®ç°è¿™ä¸ªæœºåˆ¶ã€‚ä¹Ÿ å°±æ˜¯è¯´æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚ </li><li>ReenTrantLockå¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ã€‚è€Œsynchronizedåªèƒ½æ˜¯éå…¬å¹³é”ã€‚æ‰€è°“çš„å…¬å¹³é”å°±æ˜¯å…ˆç­‰ å¾…çš„çº¿ç¨‹å…ˆè·å¾—é”ã€‚ ReenTrantLocké»˜è®¤æƒ…å†µæ˜¯éå…¬å¹³çš„ï¼Œå¯ä»¥é€šè¿‡ReenTrantLockç±»çš„ ReentrantLock(boolean fair) æ„é€ æ–¹æ³•æ¥åˆ¶å®šæ˜¯å¦æ˜¯å…¬å¹³çš„ã€‚ </li><li>synchronizedå…³é”®å­—ä¸wait()å’Œnotify/notifyAll()æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼ŒReentrantLockç±»å½“ç„¶ä¹Ÿ å¯ä»¥å®ç°ï¼Œä½†æ˜¯éœ€è¦å€ŸåŠ©äºConditionæ¥å£ä¸newCondition() æ–¹æ³•ã€‚Conditionæ˜¯JDK1.5ä¹‹åæ‰æœ‰çš„ï¼Œå®ƒå…·æœ‰å¾ˆ å¥½çš„çµæ´»æ€§ï¼Œæ¯”å¦‚å¯ä»¥å®ç°å¤šè·¯é€šçŸ¥åŠŸèƒ½ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªLockå¯¹è±¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªConditionå®ä¾‹ï¼ˆå³å¯¹è±¡ç›‘è§† å™¨ï¼‰ï¼Œçº¿ç¨‹å¯¹è±¡å¯ä»¥æ³¨å†Œåœ¨æŒ‡å®šçš„Conditionä¸­ï¼Œä»è€Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥ï¼Œåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šæ›´åŠ çµ æ´»ã€‚ åœ¨ä½¿ç”¨notify/notifyAll()æ–¹æ³•è¿›è¡Œé€šçŸ¥æ—¶ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹æ˜¯ç”± JVM é€‰æ‹©çš„ï¼Œç”¨ReentrantLockç±»ç»“åˆ Conditionå®ä¾‹å¯ä»¥å®ç°â€œé€‰æ‹©æ€§é€šçŸ¥â€ ï¼Œè¿™ä¸ªåŠŸèƒ½éå¸¸é‡è¦ï¼Œè€Œä¸”æ˜¯Conditionæ¥å£é»˜è®¤æä¾›çš„ã€‚è€Œ synchronizedå…³é”®å­—å°±ç›¸å½“äºæ•´ä¸ªLockå¯¹è±¡ä¸­åªæœ‰ä¸€ä¸ªConditionå®ä¾‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ³¨å†Œåœ¨å®ƒä¸€ä¸ªèº«ä¸Šã€‚å¦‚æœ æ‰§è¡ŒnotifyAll()æ–¹æ³•çš„è¯å°±ä¼šé€šçŸ¥æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è¿™æ ·ä¼šé€ æˆå¾ˆå¤§çš„æ•ˆç‡é—®é¢˜ï¼Œè€ŒConditionå®ä¾‹çš„ signalAll()æ–¹æ³• åªä¼šå”¤é†’æ³¨å†Œåœ¨è¯¥Conditionå®ä¾‹ä¸­çš„æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚<br>å¦‚æœä½ æƒ³ä½¿ç”¨ä¸Šè¿°åŠŸèƒ½ï¼Œé‚£ä¹ˆé€‰æ‹©ReenTrantLockæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li><li>æ€§èƒ½å·²ä¸æ˜¯é€‰æ‹©æ ‡å‡†<h1 id="é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„-2-è¿å‡»"><a href="#é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„-2-è¿å‡»" class="headerlink" title="é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„ 2 è¿å‡»"></a>é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„ 2 è¿å‡»</h1><h2 id="è®²ä¸€ä¸‹-Java-å†…å­˜æ¨¡å‹"><a href="#è®²ä¸€ä¸‹-Java-å†…å­˜æ¨¡å‹" class="headerlink" title="è®²ä¸€ä¸‹ Java å†…å­˜æ¨¡å‹"></a>è®²ä¸€ä¸‹ Java å†…å­˜æ¨¡å‹</h2></li></ul><h2 id="è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«"><a href="#è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«" class="headerlink" title="è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«"></a>è¯´è¯´ synchronized å…³é”®å­—å’Œ volatile å…³é”®å­—çš„åŒºåˆ«</h2><h1 id="é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„-2-è¿å‡»-1"><a href="#é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„-2-è¿å‡»-1" class="headerlink" title="é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„ 2 è¿å‡»"></a>é¢è¯•ä¸­å…³äºçº¿ç¨‹æ± çš„ 2 è¿å‡»</h1><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± "><a href="#ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± " class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± "></a>ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </h2><h2 id="å®ç°-Runnable-æ¥å£å’Œ-Callable-æ¥å£çš„åŒºåˆ«"><a href="#å®ç°-Runnable-æ¥å£å’Œ-Callable-æ¥å£çš„åŒºåˆ«" class="headerlink" title="å®ç° Runnable æ¥å£å’Œ Callable æ¥å£çš„åŒºåˆ«"></a>å®ç° Runnable æ¥å£å’Œ Callable æ¥å£çš„åŒºåˆ«</h2><h2 id="æ‰§è¡Œ-execute-æ–¹æ³•å’Œ-submit-æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ‰§è¡Œ-execute-æ–¹æ³•å’Œ-submit-æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ‰§è¡Œ execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ‰§è¡Œ execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><h2 id="å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± "><a href="#å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± "></a>å¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± </h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;å…³äº Javaå¤šçº¿ç¨‹ï¼Œåœ¨é¢è¯•çš„æ—¶å€™ï¼Œé—®çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯â‘ æ‚²è§‚é”å’Œä¹è§‚é”ã€â‘¡synchronizedå’ŒlockåŒºåˆ«ä»¥åŠvolatileå’Œsynchronizedçš„åŒºåˆ«ï¼Œâ‘¢å¯é‡å…¥é”ä¸éå¯é‡å…¥é”çš„åŒº åˆ«ã€â‘£å¤šçº¿ç¨‹æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„ã€â‘¤çº¿ç¨‹æ± è§£å†³ä»€ä¹ˆé—®é¢˜ã€â‘¥çº¿
      
    
    </summary>
    
    
      <category term="Interview" scheme="https://edward7zhang.github.io/tags/Interview/"/>
    
      <category term="Java" scheme="https://edward7zhang.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Androidç«¯å„ç±»å›¾ç‰‡åŠ è½½æ¡†æ¶å¯¹æ¯”</title>
    <link href="https://edward7zhang.github.io/2019/03/04/Android%E7%AB%AF%E5%90%84%E7%B1%BB%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94/"/>
    <id>https://edward7zhang.github.io/2019/03/04/Androidç«¯å„ç±»å›¾ç‰‡åŠ è½½æ¡†æ¶å¯¹æ¯”/</id>
    <published>2019-03-04T04:07:14.000Z</published>
    <updated>2019-03-04T01:13:13.575Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‰æ®µæ—¶é—´çš„é¢è¯•è¿‡ç¨‹ä¸­è¢«é—®åˆ°ç”¨è¿‡ä»€ä¹ˆå›¾ç‰‡åŠ è½½æ¡†æ¶ï¼Œæˆ‘éšå£è€Œå‡ºGlideï¼Œé¢è¯•å®˜ç»§ç»­è¿½é—®ä¸‹å»æ˜¯åšè¿‡ä»€ä¹ˆæ¯”è¾ƒå¾—å‡ºGlideæ¯”è¾ƒé«˜æ•ˆå—ï¼Ÿæˆ‘å°±é˜»å¡äº†â€¦æ‰€ä»¥åœ¨æ­¤åšä¸€æ¬¡å¤ç›˜ï¼Œé’ˆå¯¹Androidç«¯çš„å„ç§åŠ è½½æ¡†æ¶è¿›è¡Œå¯¹æ¯”</p></blockquote><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote><ul><li>å›¾ç‰‡åŠ è½½æ˜¯Androidå¼€å‘ä¸­æœ€æœ€åŸºç¡€çš„åŠŸèƒ½ï¼ŒåŒæ—¶å›¾ç‰‡åŠ è½½OOMä¹Ÿä¸€ç›´å›°æ‰°ç€å¾ˆå¤šå¼€å‘è€…ï¼Œå› æ­¤ä¸ºäº†é™ä½å¼€å‘å‘¨æœŸå’Œéš¾åº¦ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé€‰ç”¨ä¸€äº›å›¾ç‰‡åŠ è½½çš„å¼€æºåº“ã€‚</li><li>è€ç‰Œçš„æœ‰ImageLoaderï¼ŒUIL,  Volleyï¼Œä¸»æµçš„æœ‰ï¼ŒPicassoï¼ŒGlideï¼ŒFrescoç­‰ç­‰ï¼Œé€‰æ‹©ä¸€æ¬¾å¥½çš„å›¾ç‰‡åŠ è½½è£¤å°±æˆäº†æˆ‘ä»¬çš„é¦–è¦é—®é¢˜ã€‚</li><li>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¸»æµçš„ä¸‰æ¬¾ Picassoï¼ŒGlideï¼ŒFrescoæ¡†æ¶çš„ä¼˜ç¼ºç‚¹ã€‚</li></ul></blockquote><h1 id="Picassoï¼ŒGlideï¼ŒFrescoçš„å‰ä¸–ä»Šç”Ÿ"><a href="#Picassoï¼ŒGlideï¼ŒFrescoçš„å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="Picassoï¼ŒGlideï¼ŒFrescoçš„å‰ä¸–ä»Šç”Ÿ"></a>Picassoï¼ŒGlideï¼ŒFrescoçš„å‰ä¸–ä»Šç”Ÿ</h1><h2 id="åŸºæœ¬é¡¹å¯¹æ¯”"><a href="#åŸºæœ¬é¡¹å¯¹æ¯”" class="headerlink" title="åŸºæœ¬é¡¹å¯¹æ¯”"></a>åŸºæœ¬é¡¹å¯¹æ¯”</h2><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Picasso</th><th>Glide</th><th>Fresco</th></tr></thead><tbody><tr><td>åœ°å€</td><td><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fsquare%2Fpicasso" target="_blank" rel="external">github.com/square/picaâ€¦</a></td><td><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fbumptech%2Fglide" target="_blank" rel="external">github.com/bumptech/glâ€¦</a></td><td><a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Ffresco" target="_blank" rel="external">github.com/facebook/frâ€¦</a></td></tr><tr><td>å‘å¸ƒæ—¶é—´</td><td>2013å¹´5æœˆ</td><td>2014å¹´9æœˆ</td><td>2015å¹´5æœˆ</td></tr><tr><td>æ˜¯å¦æ”¯æŒgif</td><td>false</td><td>true</td><td>true</td></tr><tr><td>æ˜¯å¦æ”¯æŒwebP</td><td>true</td><td>true</td><td>true</td></tr><tr><td>è§†é¢‘ç¼©ç•¥å›¾</td><td>false</td><td>true</td><td>true</td></tr><tr><td>å¤§å°</td><td>100k</td><td>500 KB</td><td>2ï½3M</td></tr><tr><td>åŠ è½½é€Ÿåº¦</td><td>ä¸­</td><td>é«˜</td><td>é«˜</td></tr><tr><td>Disk+Men Cache</td><td>true</td><td>true</td><td>true</td></tr><tr><td>Easy of use</td><td>low</td><td>mediun</td><td>difficult</td></tr><tr><td>star</td><td>13160</td><td>14709</td><td>12444</td></tr><tr><td>å¼€å‘è€…</td><td>Squareä¸»å¯¼</td><td>Googleä¸»å¯¼</td><td>Facebookä¸»å¯¼</td></tr></tbody></table><h2 id="åŠ è½½å›¾ç‰‡è€—æ—¶åŠå†…å­˜å¯¹æ¯”"><a href="#åŠ è½½å›¾ç‰‡è€—æ—¶åŠå†…å­˜å¯¹æ¯”" class="headerlink" title="åŠ è½½å›¾ç‰‡è€—æ—¶åŠå†…å­˜å¯¹æ¯”"></a>åŠ è½½å›¾ç‰‡è€—æ—¶åŠå†…å­˜å¯¹æ¯”</h2><h3 id="without-animations"><a href="#without-animations" class="headerlink" title="without animations"></a>without animations</h3><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Picasso</th><th>Glide</th><th>Fresco</th></tr></thead><tbody><tr><td>java heapï¼native heap/å¹³å‡è€—æ—¶ï¼ˆwithout animationsï¼‰</td><td><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://user-gold-cdn.xitu.io/2018/5/14/1635f4318d4ab13d?imageslim" alt="PicassoåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f4318d2b55e8?imageslim) | ![GlideåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f4318d1496bb?imageslim) | ![FrescoåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡" title="">                </div>                <div class="image-caption">PicassoåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f4318d2b55e8?imageslim) | ![GlideåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f4318d1496bb?imageslim) | ![FrescoåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡</div>            </figure></td></tr><tr><td>max java heap</td><td>12.6MB</td><td>11.1MB</td><td>13.9MB</td></tr><tr><td>max native heap</td><td>43.8MB</td><td>43.8MB</td><td>43.8MB</td></tr><tr><td>avg wait time</td><td>241ms</td><td>34ms</td><td>44ms</td></tr></tbody></table><p>ä»ä¸Šé¢çš„åŠ è½½é™æ€å›¾ç‰‡å¯ä»¥çœ‹å‡ºä¸‰å¤§ä¸»æµæ¡†æ¶æ€§èƒ½éƒ½ä¸é”™ï¼Œä¸è¿‡ç”¨æ•°æ®è¯´è¯æ•´ä½“è€Œè¨€Glideæ›´èƒœä¸€ç­¹ã€‚</p><hr><h3 id="allow-animations"><a href="#allow-animations" class="headerlink" title="allow animations"></a>allow animations</h3><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Picasso</th><th>Glide</th><th>Fresco</th></tr></thead><tbody><tr><td>java heapï¼native heap/å¹³å‡è€—æ—¶ï¼ˆallow animationsï¼‰</td><td><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://user-gold-cdn.xitu.io/2018/5/14/1635f431b88df0e0?imageslim" alt="PicassoåŠ è½½åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f4318d57eddb?imageslim) | ![GlideåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f431b031be09?imageslim) | ![FrescoåŠ è½½åŠ¨ç”»å›¾ç‰‡" title="">                </div>                <div class="image-caption">PicassoåŠ è½½åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f4318d57eddb?imageslim) | ![GlideåŠ è½½æ— åŠ¨ç”»å›¾ç‰‡](https://user-gold-cdn.xitu.io/2018/5/14/1635f431b031be09?imageslim) | ![FrescoåŠ è½½åŠ¨ç”»å›¾ç‰‡</div>            </figure></td></tr><tr><td>max java heap</td><td>6.8MB</td><td>74.8.1MB</td><td>36.1MB</td></tr><tr><td>max native heap</td><td>18.2MB</td><td>66.8MB</td><td>545.3MB</td></tr><tr><td>avg wait time</td><td>1707ms</td><td>33910ms</td><td>15142ms</td></tr></tbody></table><p><em>ä¸Šé¢çš„æ•°æ®æˆ‘ä»¬å¯ä»¥å¿½ç•¥Picassoäº†ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸æ”¯æŒgifï¼Œé‚£ä¹ˆGlideå’ŒFrescoå¯ä»¥çœ‹å‡ºFrescoçš„java heapåŸºæœ¬ä¿æŒè¾ƒä½å¹³ç¨³çŠ¶æ€ï¼Œè€ŒGlideçš„java heapåŸºæœ¬ä¸ºFrescoçš„ä¸€å€ï¼Œæ‰€ä»¥OOMçš„é£é™©ä¹Ÿæ¯”frescoå¤§ä¸€å€ã€‚</em><br><em>ä»æ—¶é—´ä¸Šglideæ˜¯æœ‰ä¸€å®šå·®è·ï¼Œä¸è¿‡frescoæœ‰ä¸¤å¼ å›¾ç‰‡æ²¡åŠ è½½å®Œæˆï¼Œæ‰€ä»¥æ—¶é—´ä¸æ˜¯å®Œå…¨å¯é çš„æ•°æ®</em><br><em>ä»native heapå¯ä»¥çœ‹å‡ºFrescoæœ€é«˜545MBï¼Œè¿™ä¸ªæœ‰ç‚¹ææ€–ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸ªçŸ¥è¯†ç‚¹ã€‚</em></p><p><strong><em>çŸ¥è¯†ç‚¹</em></strong></p><blockquote><ul><li>Java Heapæ˜¯å¯¹äºJava è™šæ‹Ÿæœºè€Œè¯´çš„ï¼Œä¸€èˆ¬çš„å¤§å°ä¸Šé™æ˜¯ 16M 24M 48M 76M å…·ä½“è§†æ‰‹æœºè€Œå®šã€‚</li><li>Native Heapæ˜¯å¯¹äºC/C++ç›´æ¥æ“çºµçš„ç³»ç»Ÿå †å†…å­˜ï¼Œæ‰€ä»¥å®ƒçš„ä¸Šé™ä¸€èˆ¬æ˜¯å…·ä½“RAMçš„2/3å·¦å³ã€‚</li><li>æ‰€ä»¥å¯¹äº2Gçš„æ‰‹æœºè€Œè¨€ï¼ŒJava Heap å¤§æ¦‚76Mï¼Œè€ŒNative Heapæ˜¯760Må·¦å³ï¼Œç›¸å·®10å€ã€‚</li></ul></blockquote><p>æ‰€ä»¥Frescoä¹Ÿæ˜¯å­˜åœ¨ä¸€å®šé£é™©çš„ï¼Œå› ä¸ºnative heapæ•°æ®å®åœ¨æ˜¯å¤ªææ€–äº†ã€‚</p><h2 id="è¯¦ç»†å±æ€§å¯¹æ¯”"><a href="#è¯¦ç»†å±æ€§å¯¹æ¯”" class="headerlink" title="è¯¦ç»†å±æ€§å¯¹æ¯”"></a>è¯¦ç»†å±æ€§å¯¹æ¯”</h2><p>æ¥ä¸‹æ¥åªè¯¦ç»†å¯¹æ¯”Frescoå’ŒGlide<br>Picassoä»å„æ–¹é¢éƒ½æ¯”è¿™ä¸¤ä¸ªå¼±ï¼Œè¿™é‡Œå°±ä¸æµªè´¹æ—¶é—´äº†ã€‚</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Glide</th><th>Fresco</th></tr></thead><tbody><tr><td>é…ç½®</td><td><code>compile &#39;com.github.bumptech.glide:glide:XXX.XXX&#39;</code></td><td><code>compile &#39;com.facebook.fresco:fresco:XXX.XXX</code></td></tr><tr><td>åˆå§‹åŒ–</td><td>ç›´æ¥ä½¿ç”¨</td><td><code>Fresco.initialize(this);</code></td></tr><tr><td>layout</td><td>æ™®é€šImageView</td><td>ç‹¬æœ‰çš„SimpleDraweeView</td></tr><tr><td>åœ†è§’ï¼Œ åœ†å½¢</td><td>éœ€è¦è‡ªå·±å®ç°åœ†è§’ï¼Œç»§æ‰¿è‡ªBitmapTransformationæ“ä½œbitmapå¯¹è±¡å®ç°</td><td>é€šè¿‡RoundingParamsè®¾ç½®å‚æ•°</td></tr><tr><td>ç¼“å­˜</td><td>Glideå†…å­˜å’Œç£ç›˜ç¼“å­˜</td><td>ä¸‰çº§ç¼“å­˜ï¼Œåˆ†åˆ«æ˜¯ Bitmapç¼“å­˜ï¼Œæœªè§£ç å›¾ç‰‡ç¼“å­˜ï¼Œ æ–‡ä»¶ç¼“å­˜ã€‚</td></tr><tr><td>ç¼“å­˜å›¾åƒå¤§å°</td><td>Glideåˆ™ä¼šæ ¹æ®ImageViewæ§ä»¶å°ºå¯¸è·å¾—å¯¹åº”çš„å¤§å°çš„bitmapæ¥å±•ç¤ºï¼Œä»è€Œç¼“å­˜ä¹Ÿå¯ä»¥é’ˆå¯¹ä¸åŒçš„å¯¹è±¡ï¼šåŸå§‹å›¾åƒï¼ˆsourceï¼‰ï¼Œç»“æœå›¾åƒ(result)</td><td>ç¼“å­˜åŸå§‹å›¾åƒ</td></tr><tr><td>åŠ è½½ç­–ç•¥</td><td>Glideåªæœ‰å ä½å›¾</td><td>å…ˆåŠ è½½å°å°ºå¯¸å›¾ç‰‡ï¼Œå†åŠ è½½å¤§å°ºå¯¸çš„</td></tr><tr><td>åŠ è½½è¿›åº¦</td><td>false</td><td>true</td></tr></tbody></table><p>ä»ä¸Šé¢çš„å¯¹æ¯”ä¸­å¯ä»¥çœ‹å‡ºæ¥Frescoè›®å¼ºå¤§çš„ï¼Œä¸è¿‡ä½¿ç”¨èµ·æ¥ç›¸å¯¹Glideè¦å¤æ‚ä¸€ç‚¹ï¼Œè€Œä¸”éœ€è¦è‡ªå·±çš„SimpleDraweeViewï¼Œè¿™ä¸€ç‚¹åœ¨åˆ‡æ¢æ¡†æ¶çš„æ—¶å€™æœ€è®©äººå¤´ç–¼äº†ã€‚è€Œä¸”Glideç›´æ¥ç¼“å­˜ç›¸å¯¹å¤§å°çš„å›¾ç‰‡ï¼ŒèŠ‚çœç©ºé—´çš„åŒæ—¶ä¸‹åœºå¦‚æœæ˜¯åŒæ ·å¤§å°çš„å›¾ç‰‡å°±ä¸è¦å†æ¬¡è¯·æ±‚ï¼Œç›´æ¥å¯ä»¥ä½¿ç”¨ã€‚</p><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><p><strong>Glide</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">repositories &#123;</div><div class="line">  mavenCentral()</div><div class="line">  google()</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">  implementation <span class="string">'com.github.bumptech.glide:glide:4.9.0'</span></div><div class="line">  annotationProcessor <span class="string">'com.github.bumptech.glide:compiler:4.9.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p><strong>Fresco</strong><br>è¦ä½¿ç”¨å®Œæ•´çš„FrescoåŠŸèƒ½å°±è¦å¯¼å…¥å¦‚ä¸‹çš„ä¾èµ–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">  implementation <span class="string">'com.facebook.fresco:fresco:1.12.1'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="bitmapæ“ä½œ"><a href="#bitmapæ“ä½œ" class="headerlink" title="bitmapæ“ä½œ"></a>bitmapæ“ä½œ</h3><p><strong>Glide</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Bitmap myBitmap = Glide.with(ä¸Šä¸‹æ–‡)  </div><div class="line">    .load(url)  </div><div class="line">    .asBitmap() //å¿…é¡»    </div><div class="line">    .get()</div></pre></td></tr></table></figure><p><strong>Fresco</strong><br>Frescoè¦è·å–bitmapæ›´åŠ å¤æ‚ï¼Œ è€Œä¸”ä½¿ç”¨èµ·æ¥ä¹Ÿå¹¶ä¸æ˜¯é‚£ä¹ˆé¡ºç•…ã€‚é¦–å…ˆï¼ŒFrescoä¸ºäº†æ›´å¥½åœ°ç®¡ç†bitmap å¯¹è±¡ï¼ˆbitmapå¯¹è±¡ç”³è¯·å’Œé‡Šæ”¾ä¼šå¼•èµ·é¢‘ç¹çš„GCæ“ä½œï¼Œä»è€Œå¼•èµ·ç•Œé¢å¡é¡¿ï¼‰ï¼Œ å¼•å…¥äº†å¯å…³é—­çš„å¼•ç”¨ï¼ˆCloseableReferenceï¼‰, æŒæœ‰è€…åœ¨ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™éœ€è¦å…³é—­è¯¥å¼•ç”¨ï¼Œè€Œæˆ‘ä»¬è¦è·å–çš„bitmap å¯¹è±¡å°±æ˜¯å¯å…³é—­çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½åƒä¸Šé¢Glideé‚£æ ·æŠŠbitmap å¯¹è±¡å–å‡ºæ¥ä¼ é€’ç»™å…¶å®ƒåœ°æ–¹ä½¿ç”¨ï¼Œ åªèƒ½åœ¨Frescoæä¾›çš„ä½œç”¨åŸŸèŒƒå›´å†…ä½¿ç”¨ã€‚<br>å®é™…é¡¹ç›®ä¸­ä¼šè·å–ç¼“å†²çš„æ–‡ä»¶å¯¹è±¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//åŒæ ·åœ¨DataSubscriberä¸­è·å–</div><div class="line">FileBinaryResource resource = (FileBinaryResource) Fresco.getImagePipelineFactory().getMainFileCache().getResource(new SimpleCacheKey(url));</div><div class="line">if (resource != null &amp;&amp; resource.getFile() != null) &#123;           </div><div class="line">    setImage(ImageSource.uri(Uri.fromFile(resource.getFile())));</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p><strong>Glide</strong></p><blockquote><ul><li>å¤šç§å›¾ç‰‡æ ¼å¼çš„ç¼“å­˜ï¼Œé€‚ç”¨äºæ›´å¤šçš„å†…å®¹è¡¨ç°å½¢å¼ï¼ˆå¦‚Gifã€WebPã€ç¼©ç•¥å›¾ã€Videoï¼‰</li><li>ç”Ÿå‘½å‘¨æœŸé›†æˆï¼ˆæ ¹æ®Activityæˆ–è€…Fragmentçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å›¾ç‰‡åŠ è½½è¯·æ±‚ï¼‰</li><li>é«˜æ•ˆå¤„ç†Bitmapï¼ˆbitmapçš„å¤ç”¨å’Œä¸»åŠ¨å›æ”¶ï¼Œå‡å°‘ç³»ç»Ÿå›æ”¶å‹åŠ›ï¼‰</li><li>é«˜æ•ˆçš„ç¼“å­˜ç­–ç•¥ï¼Œçµæ´»ï¼ˆPicassoåªä¼šç¼“å­˜åŸå§‹å°ºå¯¸çš„å›¾ç‰‡ï¼ŒGlideç¼“å­˜çš„æ˜¯å¤šç§è§„æ ¼ï¼‰ï¼ŒåŠ è½½é€Ÿåº¦å¿«ä¸”å†…å­˜å¼€é”€å°ï¼ˆé»˜è®¤Bitmapæ ¼å¼çš„ä¸åŒï¼Œä½¿å¾—å†…å­˜å¼€é”€æ˜¯Picassoçš„ä¸€åŠï¼‰</li></ul></blockquote><p><strong>Fresco</strong></p><blockquote><ul><li>æœ€å¤§çš„ä¼˜åŠ¿åœ¨äº5.0ä»¥ä¸‹(æœ€ä½2.3)çš„bitmapåŠ è½½ã€‚åœ¨5.0ä»¥ä¸‹ç³»ç»Ÿï¼ŒFrescoå°†å›¾ç‰‡æ”¾åˆ°ä¸€ä¸ªç‰¹åˆ«çš„å†…å­˜åŒºåŸŸ(AshmemåŒº)</li><li>å¤§å¤§å‡å°‘OOMï¼ˆåœ¨æ›´åº•å±‚çš„Nativeå±‚å¯¹OOMè¿›è¡Œå¤„ç†ï¼Œå›¾ç‰‡å°†ä¸å†å ç”¨Appçš„å†…å­˜ï¼‰</li><li>é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½åŠ è½½å¤§é‡å›¾ç‰‡çš„åœºæ™¯</li></ul></blockquote><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p><strong>Glide</strong></p><blockquote><p>-æ²¡æœ‰æ–‡ä»¶ç¼“å­˜ -java heapæ¯”Frescoé«˜</p></blockquote><p><strong>Fresco</strong></p><blockquote><ul><li>åŒ…è¾ƒå¤§ï¼ˆ2~3Mï¼‰</li><li>ç”¨æ³•å¤æ‚</li><li>åº•å±‚æ¶‰åŠc++é¢†åŸŸï¼Œé˜…è¯»æºç æ·±å…¥å­¦ä¹ éš¾åº¦å¤§</li></ul></blockquote><h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><p>Frescoè™½ç„¶å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯åŒ…å¾ˆå¤§ï¼Œä¾èµ–å¾ˆå¤šï¼Œä½¿ç”¨å¤æ‚ï¼Œè€Œä¸”è¿˜è¦åœ¨å¸ƒå±€ä½¿ç”¨SimpleDraweeViewæ§ä»¶åŠ è½½å›¾ç‰‡ã€‚ç›¸å¯¹è€Œè¨€Glideä¼šè½»å¥½å¤šï¼Œä¸Šæ‰‹å¿«ï¼Œä½¿ç”¨ç®€å•ï¼Œé…ç½®æ–¹ä¾¿ï¼Œè€Œä¸”ä»åŠ è½½é€Ÿåº¦å’Œæ€§èƒ½æ–¹é¢ä¸ç›¸ä¸Šä¸‹ã€‚å¯¹äºä¸€èˆ¬çš„APPæ¥è¯´Glideæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå¦‚æœæ˜¯ä¸“ä¸šçš„å›¾ç‰‡APPé‚£ä¹ˆFrescoè¿˜æ˜¯å¿…è¦çš„ã€‚</p><p><em><a href="https://juejin.im/entry/5af9aabf51882542bd69d0c0" target="_blank" rel="external">æ–‡ç« éƒ¨åˆ†è½¬è½½äº</a></em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;å‰æ®µæ—¶é—´çš„é¢è¯•è¿‡ç¨‹ä¸­è¢«é—®åˆ°ç”¨è¿‡ä»€ä¹ˆå›¾ç‰‡åŠ è½½æ¡†æ¶ï¼Œæˆ‘éšå£è€Œå‡ºGlideï¼Œé¢è¯•å®˜ç»§ç»­è¿½é—®ä¸‹å»æ˜¯åšè¿‡ä»€ä¹ˆæ¯”è¾ƒå¾—å‡ºGlideæ¯”è¾ƒé«˜æ•ˆå—ï¼Ÿæˆ‘å°±é˜»å¡äº†â€¦æ‰€ä»¥åœ¨æ­¤åšä¸€æ¬¡å¤ç›˜ï¼Œé’ˆå¯¹Androidç«¯çš„å„ç§åŠ è½½æ¡†æ¶è¿›è¡Œå¯¹æ¯”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 
      
    
    </summary>
    
    
      <category term="Android" scheme="https://edward7zhang.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Retrofit2.0 ä½¿ç”¨æ•™ç¨‹ï¼ˆä¸å¸¸è§ç½‘ç»œè¯·æ±‚åº“å¯¹æ¯”ï¼‰</title>
    <link href="https://edward7zhang.github.io/2019/03/03/Retrofit2.0%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%8E%E5%B8%B8%E8%A7%81%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%BA%93%E5%AF%B9%E6%AF%94%EF%BC%89/"/>
    <id>https://edward7zhang.github.io/2019/03/03/Retrofit2.0 ä½¿ç”¨æ•™ç¨‹ï¼ˆä¸å¸¸è§ç½‘ç»œè¯·æ±‚åº“å¯¹æ¯”ï¼‰/</id>
    <published>2019-03-03T04:07:14.000Z</published>
    <updated>2019-03-03T09:11:48.794Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><ul><li>åœ¨<strong>Android</strong>å¼€å‘ä¸­ï¼Œç½‘ç»œè¯·æ±‚ååˆ†å¸¸ç”¨</li><li>å½“ä¸‹çš„ç½‘ç»œè¯·æ±‚åŠ è½½åº“ä¸­ï¼Œ<strong>Retrofit</strong>åˆ™æ˜¯å½“ä¸‹hottestçš„ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“</li></ul><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-a3109ad0446b0540.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>ç‰¹åˆ«æ³¨æ„ï¼š</p><ul><li>å‡†ç¡®æ¥è¯´ï¼Œ<strong>Retrofitæ˜¯ä¸€ä¸ª RESTful çš„ HTTP ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…</strong></li><li>åŸå› ï¼šç½‘ç»œè¯·æ±‚çš„å·¥ä½œæœ¬è´¨ä¸Šæ˜¯<code>OkHttp</code>å®Œæˆçš„ï¼Œè€Œ<code>Retrofit</code>ä»…è´Ÿè´£ç½‘ç»œè¯·æ±‚æ¥å£çš„å°è£…<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-b5194f1d16673589.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></li><li>Appåº”ç”¨ç¨‹åºé€šè¿‡ Retrofit è¯·æ±‚ç½‘ç»œï¼Œå®é™…ä¸Šæ˜¯ä½¿ç”¨Retrofitæ¥å£å±‚å°è£…è¯·æ±‚å‚æ•°ã€Headerã€Urlç­‰ä¿¡æ¯ï¼Œä¹‹åç”±OkHttpå®Œæˆåç»­çš„è¯·æ±‚æ“ä½œ</li><li>åœ¨æœåŠ¡ç«¯è¿”å›æ•°æ®ä¹‹åï¼ŒOkHttpå°†åŸå§‹çš„ç»“æœäº¤ç»™Retrofitï¼ŒRetrofitæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å¯¹ç»“æœè¿›è¡Œè§£æ</li></ul><h1 id="ä¸å…¶ä»–å¼€æºåº“å¯¹æ¯”"><a href="#ä¸å…¶ä»–å¼€æºåº“å¯¹æ¯”" class="headerlink" title="ä¸å…¶ä»–å¼€æºåº“å¯¹æ¯”"></a>ä¸å…¶ä»–å¼€æºåº“å¯¹æ¯”</h1><p>é™¤äº† Retrofitï¼Œå¦‚ä»Š Android ä¸­ä¸»æµçš„ç½‘ç»œè¯·æ±‚æ¡†æ¶æœ‰ï¼š</p><ul><li>Android-Async-Http</li><li>Volly</li><li>OkHttp<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-3089d23889f04d87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»‹ç»" title="">                </div>                <div class="image-caption">ä»‹ç»</div>            </figure></li></ul><p>å‡ ç§ç½‘ç»œè¯·æ±‚åº“ä¹‹é—´çš„åŒºåˆ«å¯¹æ¯”<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-58819416dfd2767a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></p><p>é™„ï¼šå„ä¸ªä¸»æµç½‘ç»œè¯·æ±‚åº“çš„ Github åœ°å€</p><ul><li><a href="https://github.com/loopj/android-async-http" target="_blank" rel="external">Android-Async-Http</a></li><li><a href="https://github.com/stormzhang/AndroidVolley" target="_blank" rel="external">Volley</a></li><li><a href="https://github.com/square/okhttp" target="_blank" rel="external">OkHttp</a></li><li><a href="https://github.com/square/retrofit" target="_blank" rel="external">Retrofit</a></li></ul><h1 id="Retrofitä½¿ç”¨ä»‹ç»"><a href="#Retrofitä½¿ç”¨ä»‹ç»" class="headerlink" title="Retrofitä½¿ç”¨ä»‹ç»"></a>Retrofitä½¿ç”¨ä»‹ç»</h1><p>ä½¿ç”¨Retrofitçš„æ­¥éª¤å…±æœ‰7ä¸ªï¼š</p><pre><code>æ­¥éª¤1ï¼šæ·»åŠ  Retrofit åº“çš„ä¾èµ–æ­¥éª¤2ï¼šåˆ›å»º æ¥å—æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»æ­¥éª¤3ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£æ­¥éª¤4ï¼šåˆ›å»º Retrofit å®ä¾‹æ­¥éª¤5ï¼šåˆ›å»º ç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹ å¹¶ é…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°æ­¥éª¤6ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥\åŒæ­¥ï¼‰    &gt; å°è£…äº† æ•°æ®è½¬æ¢ã€çº¿ç¨‹åˆ‡æ¢çš„æ“ä½œæ­¥éª¤7ï¼šå¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™äº›æ­¥éª¤è¿›è¡Œåˆ†è§£</p><h2 id="æ­¥éª¤1ï¼šæ·»åŠ -Retrofit-åº“çš„ä¾èµ–"><a href="#æ­¥éª¤1ï¼šæ·»åŠ -Retrofit-åº“çš„ä¾èµ–" class="headerlink" title="æ­¥éª¤1ï¼šæ·»åŠ  Retrofit åº“çš„ä¾èµ–"></a>æ­¥éª¤1ï¼šæ·»åŠ  Retrofit åº“çš„ä¾èµ–</h2><h3 id="1-åœ¨GradleåŠ å…¥Retrofitåº“çš„ä¾èµ–"><a href="#1-åœ¨GradleåŠ å…¥Retrofitåº“çš„ä¾èµ–" class="headerlink" title="1.åœ¨GradleåŠ å…¥Retrofitåº“çš„ä¾èµ–"></a>1.åœ¨<code>Gradle</code>åŠ å…¥<code>Retrofit</code>åº“çš„ä¾èµ–</h3><blockquote><p>ç”±äº<code>Retrofit</code>æ˜¯åŸºäº<code>OkHttp</code>ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ·»åŠ <code>OkHttp</code>åº“ä¾èµ–</p></blockquote><p><em>build.gradle</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dependencies &#123; </div><div class="line">  compile&apos;com.squareup.retrofit2:retrofit:2.0.2&apos;  </div><div class="line">  // Retrofitåº“ </div><div class="line">  compile &apos;com.squareup.okhttp3:okhttp:3.1.2&apos;  </div><div class="line">  // Okhttpåº“ </div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="2-æ·»åŠ -ç½‘ç»œæƒé™"><a href="#2-æ·»åŠ -ç½‘ç»œæƒé™" class="headerlink" title="2.æ·»åŠ  ç½‘ç»œæƒé™"></a>2.æ·»åŠ  ç½‘ç»œæƒé™</h3><p><em>AndroidManifest.xml</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</div></pre></td></tr></table></figure><h2 id="æ­¥éª¤2ï¼šåˆ›å»º-æ¥å—æœåŠ¡å™¨è¿”å›æ•°æ®-çš„ç±»"><a href="#æ­¥éª¤2ï¼šåˆ›å»º-æ¥å—æœåŠ¡å™¨è¿”å›æ•°æ®-çš„ç±»" class="headerlink" title="æ­¥éª¤2ï¼šåˆ›å»º æ¥å—æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»"></a>æ­¥éª¤2ï¼šåˆ›å»º æ¥å—æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»</h2><p><em>Reception.java</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reception</span></span>&#123;</div><div class="line">  ...</div><div class="line">  <span class="comment">//æ ¹æ®è¿”å›æ•°æ®çš„æ ¼å¼å’Œæ•°æ®è§£ææ–¹å¼ï¼ˆJsonã€XMLç­‰ï¼‰å®šä¹‰</span></div><div class="line">  <span class="comment">//ä¸‹é¢ä¼šåœ¨å®ä¾‹ä¸­è¿›è¡Œè¯´æ˜</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h2 id="æ­¥éª¤3ï¼šåˆ›å»º-ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚-çš„æ¥å£"><a href="#æ­¥éª¤3ï¼šåˆ›å»º-ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚-çš„æ¥å£" class="headerlink" title="æ­¥éª¤3ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£"></a>æ­¥éª¤3ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£</h2><ul><li>Retrofitå°†Httpè¯·æ±‚æŠ½è±¡æˆJavaæ¥å£ï¼šé‡‡ç”¨<strong>æ³¨è§£</strong>æè¿°ç½‘ç»œè¯·æ±‚çš„å‚æ•° å’Œ é…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°</li></ul><blockquote><p>1.ç”¨ åŠ¨æ€ä»£ç† åŠ¨æ€ å°†è¯¥æ¥å£çš„æ³¨è§£â€œç¿»è¯‘â€æˆä¸€ä¸ªHttpè¯·æ±‚ï¼Œæœ€åå†æ‰§è¡ŒHttpè¯·æ±‚<br>2.æ³¨ï¼šæ¥å£ä¸­çš„æ¯ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½éœ€è¦ä½¿ç”¨æ³¨è§£æ ‡æ³¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p></blockquote><p>_GetRequest<em>Interface.interface</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GetRequest_Interface</span></span>&#123;</div><div class="line">    <span class="meta">@GET</span>(<span class="string">"openapi.do?keyfrom=Yanzhikai&amp;key=2032414398&amp;type=data&amp;doctype=json&amp;version=1.1&amp;q=car"</span>)</div><div class="line">    <span class="function">Call&lt;Translation&gt; <span class="title">getCall</span><span class="params">()</span></span>;</div><div class="line">    <span class="comment">//@GETæ³¨è§£çš„ä½œç”¨ï¼šé‡‡ç”¨Getæ–¹æ³•å‘é€ç½‘ç»œè¯·æ±‚</span></div><div class="line">    <span class="comment">//getCall() = æ¥å—ç½‘ç»œè¯·æ±‚æ•°æ®çš„æ–¹æ³•</span></div><div class="line">    <span class="comment">//å…¶ä¸­è¿”å›ç±»å‹ä¸ºCall&lt;*&gt;,*æ˜¯æ¥æ”¶æ•°æ®çš„ç±»ï¼ˆå³ä¸Šé¢å®šä¹‰çš„Translationç±»ï¼‰</span></div><div class="line">    <span class="comment">//å¦‚æœæƒ³ç›´æ¥è·å¾—Responsebodyä¸­çš„å†…å®¹ï¼Œå¯ä»¥å®šä¹‰ç½‘ç»œè¯·æ±‚è¿”å›å€¼ä¸ºCall&lt;ResponseBody&gt;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¸‹é¢è¯¦ç»†ä»‹ç»Retrofitç½‘ç»œè¯·æ±‚æ¥å£ çš„æ³¨è§£ç±»å‹<br><strong>æ³¨è§£ç±»å‹</strong><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-ee747d1e331ed5a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br><strong>æ³¨è§£è¯´æ˜</strong></p><h3 id="ç¬¬ä¸€ç±»ï¼šç½‘ç»œè¯·æ±‚æ–¹æ³•"><a href="#ç¬¬ä¸€ç±»ï¼šç½‘ç»œè¯·æ±‚æ–¹æ³•" class="headerlink" title="ç¬¬ä¸€ç±»ï¼šç½‘ç»œè¯·æ±‚æ–¹æ³•"></a>ç¬¬ä¸€ç±»ï¼šç½‘ç»œè¯·æ±‚æ–¹æ³•</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-e97379b8e0942459.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="è¯¦ç»†è¯´æ˜ï¼š"><a href="#è¯¦ç»†è¯´æ˜ï¼š" class="headerlink" title="è¯¦ç»†è¯´æ˜ï¼š"></a>è¯¦ç»†è¯´æ˜ï¼š</h3><h4 id="a-GETã€-POSTã€-PUTã€-DELETEã€-HEAD"><a href="#a-GETã€-POSTã€-PUTã€-DELETEã€-HEAD" class="headerlink" title="a.@GETã€@POSTã€@PUTã€@DELETEã€@HEAD"></a>a.@GETã€@POSTã€@PUTã€@DELETEã€@HEAD</h4><p>ä»¥ä¸Šæ–¹æ³•åˆ†åˆ«å¯¹åº”HTTPä¸­çš„ç½‘ç»œè¯·æ±‚æ–¹å¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">interface</span> <span class="title">GetRequest_Interface</span> </span>&#123; </div><div class="line">  <span class="meta">@GET</span>(<span class="string">"openapi.do?keyfrom=Yanzhikai&amp;key=2032414398&amp;type=data&amp;doctype=json&amp;version=1.1&amp;q=car"</span>) </div><div class="line">  <span class="function">Call&lt;Translation&gt; <span class="title">getCall</span><span class="params">()</span></span>; </div><div class="line">  <span class="comment">// @GETæ³¨è§£çš„ä½œç”¨:é‡‡ç”¨Getæ–¹æ³•å‘é€ç½‘ç»œè¯·æ±‚  </span></div><div class="line">  <span class="comment">// getCall() = æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®çš„æ–¹æ³•  </span></div><div class="line">  <span class="comment">// å…¶ä¸­è¿”å›ç±»å‹ä¸ºCall&lt;*&gt;ï¼Œ*æ˜¯æ¥æ”¶æ•°æ®çš„ç±»ï¼ˆå³ä¸Šé¢å®šä¹‰çš„Translationç±»ï¼‰ </span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p><strong>æ­¤å¤„ç‰¹æ„è¯´æ˜URLçš„ç»„æˆï¼šRetrofitæŠŠ ç½‘ç»œè¯·æ±‚çš„URLåˆ†æˆäº†ä¸¤éƒ¨åˆ†è®¾ç½®ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ç¬¬1éƒ¨åˆ†ï¼šåœ¨ç½‘ç»œè¯·æ±‚æ¥å£çš„æ³¨è§£è®¾ç½®</span></div><div class="line"> <span class="meta">@GET</span>(<span class="string">"openapi.do?keyfrom=Yanzhikai&amp;key=2032414398&amp;type=data&amp;doctype=json&amp;version=1.1&amp;q=car"</span>)</div><div class="line"><span class="function">Call&lt;Translation&gt;  <span class="title">getCall</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// ç¬¬2éƒ¨åˆ†ï¼šåœ¨åˆ›å»ºRetrofitå®ä¾‹æ—¶é€šè¿‡.baseUrl()è®¾ç½®</span></div><div class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">                .baseUrl(<span class="string">"http://fanyi.youdao.com/"</span>) <span class="comment">//è®¾ç½®ç½‘ç»œè¯·æ±‚çš„Urlåœ°å€</span></div><div class="line">                .addConverterFactory(GsonConverterFactory.create()) <span class="comment">//è®¾ç½®æ•°æ®è§£æå™¨</span></div><div class="line">                .build();</div><div class="line"></div><div class="line"><span class="comment">// ä»ä¸Šé¢çœ‹å‡ºï¼šä¸€ä¸ªè¯·æ±‚çš„URLå¯ä»¥é€šè¿‡ æ›¿æ¢å— å’Œ è¯·æ±‚æ–¹æ³•çš„å‚æ•° æ¥è¿›è¡ŒåŠ¨æ€çš„URLæ›´æ–°ã€‚</span></div><div class="line"><span class="comment">// æ›¿æ¢å—æ˜¯ç”± è¢«&#123;&#125;åŒ…è£¹èµ·æ¥çš„å­—ç¬¦ä¸²æ„æˆ</span></div><div class="line"><span class="comment">// å³ï¼šRetrofitæ”¯æŒåŠ¨æ€æ”¹å˜ç½‘ç»œè¯·æ±‚æ ¹ç›®å½•</span></div></pre></td></tr></table></figure></p><ul><li>ç½‘ç»œè¯·æ±‚çš„å®Œæ•´ Url = åœ¨åˆ›å»º Retrofit å®ä¾‹æ—¶é€šè¿‡.baseUrl() è®¾ç½® + ç½‘ç»œè¯·æ±‚æ¥å£çš„æ³¨è§£è®¾ç½®ï¼ˆä¸‹é¢ç§°â€œpathâ€ï¼‰</li><li>å…·ä½“æ•´åˆçš„è§„åˆ™å¦‚ä¸‹ï¼š<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-3dc42017038302d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><blockquote><p>å»ºè®®é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹å¼æ¥é…ç½®ï¼Œå¹¶å°½é‡ä½¿ç”¨åŒä¸€ç§è·¯å¾„å½¢å¼ã€‚</p></blockquote></li></ul><h4 id="b-HTTP"><a href="#b-HTTP" class="headerlink" title="b.@HTTP"></a>b.@HTTP</h4><ul><li>ä½œç”¨ï¼šæ›¿æ¢@GETã€@POSTã€@PUTã€@DELETEã€@HEADæ³¨è§£çš„ä½œç”¨ åŠ æ›´å¤šåŠŸèƒ½æ‹“å±•</li><li>å…·ä½“ä½¿ç”¨ï¼šé€šè¿‡å±æ€§ methodã€pathã€hasBodyè¿›è¡Œè®¾ç½®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GetRequest_Interface</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * methodï¼šç½‘ç»œè¯·æ±‚çš„æ–¹æ³•ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</div><div class="line">     * pathï¼šç½‘ç»œè¯·æ±‚åœ°å€è·¯å¾„</div><div class="line">     * hasBodyï¼šæ˜¯å¦æœ‰è¯·æ±‚ä½“</div><div class="line">     */</div><div class="line">    <span class="meta">@HTTP</span>(method = <span class="string">"GET"</span>, path = <span class="string">"blog/&#123;id&#125;"</span>, hasBody = <span class="keyword">false</span>)</div><div class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">getCall</span><span class="params">(@Path(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id)</span>;</div><div class="line">    <span class="comment">// &#123;id&#125; è¡¨ç¤ºæ˜¯ä¸€ä¸ªå˜é‡</span></div><div class="line">    <span class="comment">// method çš„å€¼ retrofit ä¸ä¼šåšå¤„ç†ï¼Œæ‰€ä»¥è¦è‡ªè¡Œä¿è¯å‡†ç¡®</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="ç¬¬äºŒç±»ï¼šæ ‡è®°"><a href="#ç¬¬äºŒç±»ï¼šæ ‡è®°" class="headerlink" title="ç¬¬äºŒç±»ï¼šæ ‡è®°"></a>ç¬¬äºŒç±»ï¼šæ ‡è®°</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-a6f1fc997c23a2e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="a-FormUrlEncoded"><a href="#a-FormUrlEncoded" class="headerlink" title="a.@FormUrlEncoded"></a>a.@FormUrlEncoded</h4><ul><li>ä½œç”¨ï¼šè¡¨ç¤ºå‘é€form-encoded çš„æ•°æ®<blockquote><p>æ¯ä¸ªé”®å€¼å¯¹éœ€è¦ç”¨ @Filed æ¥æ³¨è§£é”®åï¼Œéšåçš„å¯¹è±¡éœ€è¦æä¾›å€¼ã€‚</p></blockquote></li></ul><h4 id="b-Multipart"><a href="#b-Multipart" class="headerlink" title="b.@Multipart"></a>b.@Multipart</h4><ul><li>ä½œç”¨ï¼šè¡¨ç¤ºå‘é€form-encoded çš„æ•°æ®ï¼ˆé€‚ç”¨äº æœ‰æ–‡ä»¶ ä¸Šä¼ çš„åœºæ™¯ï¼‰<blockquote><p>æ¯ä¸ªé”®å€¼å¯¹éœ€è¦ç”¨ @Part æ¥æ³¨è§£é”®åï¼Œéšåçš„å¯¹è±¡éœ€è¦æä¾›å€¼ã€‚</p></blockquote></li></ul><p>å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š<br>_GetRequest<em>Interface</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GetRequest_Interface</span> </span>&#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         *è¡¨æ˜æ˜¯ä¸€ä¸ªè¡¨å•æ ¼å¼çš„è¯·æ±‚ï¼ˆContent-Type:application/x-www-form-urlencodedï¼‰</div><div class="line">         * &lt;code&gt;Field("username")&lt;/code&gt; è¡¨ç¤ºå°†åé¢çš„ &lt;code&gt;String name&lt;/code&gt; ä¸­nameçš„å–å€¼ä½œä¸º username çš„å€¼</div><div class="line">         */</div><div class="line">        <span class="meta">@POST</span>(<span class="string">"/form"</span>)</div><div class="line">        <span class="meta">@FormUrlEncoded</span></div><div class="line">        <span class="function">Call&lt;ResponseBody&gt; <span class="title">testFormUrlEncoded1</span><span class="params">(@Field(<span class="string">"username"</span>)</span> String name, @<span class="title">Field</span><span class="params">(<span class="string">"age"</span>)</span> <span class="keyword">int</span> age)</span>;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * &#123;<span class="doctag">@link</span> Part&#125; åé¢æ”¯æŒä¸‰ç§ç±»å‹ï¼Œ&#123;<span class="doctag">@link</span> RequestBody&#125;ã€&#123;<span class="doctag">@link</span> okhttp3.MultipartBody.Part&#125; ã€ä»»æ„ç±»å‹</div><div class="line">         * é™¤ &#123;<span class="doctag">@link</span> okhttp3.MultipartBody.Part&#125; ä»¥å¤–ï¼Œå…¶å®ƒç±»å‹éƒ½å¿…é¡»å¸¦ä¸Šè¡¨å•å­—æ®µ(&#123;<span class="doctag">@link</span> okhttp3.MultipartBody.Part&#125; ä¸­å·²ç»åŒ…å«äº†è¡¨å•å­—æ®µçš„ä¿¡æ¯)ï¼Œ</div><div class="line">         */</div><div class="line">        <span class="meta">@POST</span>(<span class="string">"/form"</span>)</div><div class="line">        <span class="meta">@Multipart</span></div><div class="line">        <span class="function">Call&lt;ResponseBody&gt; <span class="title">testFileUpload1</span><span class="params">(@Part(<span class="string">"name"</span>)</span> RequestBody name, @<span class="title">Part</span><span class="params">(<span class="string">"age"</span>)</span> RequestBody age, @Part MultipartBody.Part file)</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å…·ä½“ä½¿ç”¨</span></div><div class="line">       GetRequest_Interface service = retrofit.create(GetRequest_Interface.class);</div><div class="line">        <span class="comment">// @FormUrlEncoded </span></div><div class="line">        Call&lt;ResponseBody&gt; call1 = service.testFormUrlEncoded1(<span class="string">"Carson"</span>, <span class="number">24</span>);</div><div class="line"></div><div class="line">        <span class="comment">//  @Multipart</span></div><div class="line">        RequestBody name = RequestBody.create(textType, <span class="string">"Carson"</span>);</div><div class="line">        RequestBody age = RequestBody.create(textType, <span class="string">"24"</span>);</div><div class="line"></div><div class="line">        MultipartBody.Part filePart = MultipartBody.Part.createFormData(<span class="string">"file"</span>, <span class="string">"test.txt"</span>, file);</div><div class="line">        Call&lt;ResponseBody&gt; call3 = service.testFileUpload1(name, age, filePart);</div></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰ç±»ï¼šç½‘ç»œè¯·æ±‚å‚æ•°"><a href="#ç¬¬ä¸‰ç±»ï¼šç½‘ç»œè¯·æ±‚å‚æ•°" class="headerlink" title="ç¬¬ä¸‰ç±»ï¼šç½‘ç»œè¯·æ±‚å‚æ•°"></a>ç¬¬ä¸‰ç±»ï¼šç½‘ç»œè¯·æ±‚å‚æ•°</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-c547f2344eef630b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p><strong>è¯¦ç»†è¯´æ˜</strong></p><h4 id="a-Header-amp-Headers"><a href="#a-Header-amp-Headers" class="headerlink" title="a.@Header &amp; @Headers"></a>a.@Header &amp; @Headers</h4><ul><li>ä½œç”¨ï¼šæ·»åŠ è¯·æ±‚å¤´ &amp; æ·»åŠ ä¸å›ºå®šçš„è¯·æ±‚å¤´</li><li>å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// @Header</span></div><div class="line"><span class="meta">@GET</span>(<span class="string">"user"</span>)</div><div class="line"><span class="function">Call&lt;User&gt; <span class="title">getUser</span><span class="params">(@Header(<span class="string">"Authorization"</span>)</span> String authorization)</span></div><div class="line"></div><div class="line"><span class="comment">// @Headers</span></div><div class="line">@<span class="title">Headers</span><span class="params">(<span class="string">"Authorization: authorization"</span>)</span></div><div class="line">@<span class="title">GET</span><span class="params">(<span class="string">"user"</span>)</span></div><div class="line">Call&lt;User&gt; <span class="title">getUser</span><span class="params">()</span></div><div class="line"></div><div class="line"><span class="comment">// ä»¥ä¸Šçš„æ•ˆæœæ˜¯ä¸€è‡´çš„ã€‚</span></div><div class="line"><span class="comment">// åŒºåˆ«åœ¨äºä½¿ç”¨åœºæ™¯å’Œä½¿ç”¨æ–¹å¼</span></div><div class="line"><span class="comment">// 1. ä½¿ç”¨åœºæ™¯ï¼š@Headerç”¨äºæ·»åŠ ä¸å›ºå®šçš„è¯·æ±‚å¤´ï¼Œ@Headersç”¨äºæ·»åŠ å›ºå®šçš„è¯·æ±‚å¤´</span></div><div class="line"><span class="comment">// 2. ä½¿ç”¨æ–¹å¼ï¼š@Headerä½œç”¨äºæ–¹æ³•çš„å‚æ•°ï¼›@Headersä½œç”¨äºæ–¹æ³•</span></div></pre></td></tr></table></figure></li></ul><h4 id="b-Body"><a href="#b-Body" class="headerlink" title="b.@Body"></a>b.@Body</h4><ul><li>ä½œç”¨ï¼šä»¥<code>post</code>æ–¹å¼ ä¼ é€’ è‡ªå®šä¹‰æ•°æ®ç±»å‹ç»™æœåŠ¡å™¨</li><li>ç‰¹åˆ«æ³¨æ„ï¼šå¦‚æœæäº¤çš„æ˜¯ä¸€ä¸ªMapï¼Œé‚£ä¹ˆä½œç”¨ç›¸å½“äº<code>@Field</code><blockquote><p>ä¸è¿‡ Map è¦ç»è¿‡<code>FormBody.Builder</code>ç±»å¤„ç†æˆä¸ºç¬¦åˆOkHttpæ ¼å¼çš„è¡¨å•ï¼Œå¦‚ï¼š</p></blockquote></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">FormBody.Builder builder = <span class="keyword">new</span> ForBody.Builder();</div><div class="line">builder.add(<span class="string">"key"</span>,<span class="string">"value"</span>);</div></pre></td></tr></table></figure><h4 id="c-Field-amp-FieldMap"><a href="#c-Field-amp-FieldMap" class="headerlink" title="c.@Field &amp; @FieldMap"></a>c.@Field &amp; @FieldMap</h4><ul><li>ä½œç”¨ï¼šå‘é€ Post è¯·æ±‚ æ—¶æäº¤è¯·æ±‚çš„è¡¨å•å­—æ®µ</li><li>å…·ä½“ä½¿ç”¨ï¼šä¸ @FormUrlEncoded æ³¨è§£é…åˆä½¿ç”¨<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GetRequest_Interface</span> </span>&#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         *è¡¨æ˜æ˜¯ä¸€ä¸ªè¡¨å•æ ¼å¼çš„è¯·æ±‚ï¼ˆContent-Type:application/x-www-form-urlencodedï¼‰</div><div class="line">         * &lt;code&gt;Field("username")&lt;/code&gt; è¡¨ç¤ºå°†åé¢çš„ &lt;code&gt;String name&lt;/code&gt; ä¸­nameçš„å–å€¼ä½œä¸º username çš„å€¼</div><div class="line">         */</div><div class="line">        <span class="meta">@POST</span>(<span class="string">"/form"</span>)</div><div class="line">        <span class="meta">@FormUrlEncoded</span></div><div class="line">        <span class="function">Call&lt;ResponseBody&gt; <span class="title">testFormUrlEncoded1</span><span class="params">(@Field(<span class="string">"username"</span>)</span> String name, @<span class="title">Field</span><span class="params">(<span class="string">"age"</span>)</span> <span class="keyword">int</span> age)</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">         * Mapçš„keyä½œä¸ºè¡¨å•çš„é”®</div><div class="line">         */</div><div class="line">        <span class="meta">@POST</span>(<span class="string">"/form"</span>)</div><div class="line">        <span class="meta">@FormUrlEncoded</span></div><div class="line">        <span class="function">Call&lt;ResponseBody&gt; <span class="title">testFormUrlEncoded2</span><span class="params">(@FieldMap Map&lt;String, Object&gt; map)</span></span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å…·ä½“ä½¿ç”¨</span></div><div class="line">         <span class="comment">// @Field</span></div><div class="line">        Call&lt;ResponseBody&gt; call1 = service.testFormUrlEncoded1(<span class="string">"Carson"</span>, <span class="number">24</span>);</div><div class="line"></div><div class="line">        <span class="comment">// @FieldMap</span></div><div class="line">        <span class="comment">// å®ç°çš„æ•ˆæœä¸ä¸Šé¢ç›¸åŒï¼Œä½†è¦ä¼ å…¥Map</span></div><div class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">        map.put(<span class="string">"username"</span>, <span class="string">"Carson"</span>);</div><div class="line">        map.put(<span class="string">"age"</span>, <span class="number">24</span>);</div><div class="line">        Call&lt;ResponseBody&gt; call2 = service.testFormUrlEncoded2(map);</div></pre></td></tr></table></figure></li></ul><h4 id="d-Part-amp-PartMap"><a href="#d-Part-amp-PartMap" class="headerlink" title="d.@Part &amp; @PartMap"></a>d.@Part &amp; @PartMap</h4><h4 id="e-Query-amp-QueryMap"><a href="#e-Query-amp-QueryMap" class="headerlink" title="e.@Query &amp; @QueryMap"></a>e.@Query &amp; @QueryMap</h4><h4 id="f-Path"><a href="#f-Path" class="headerlink" title="f.@Path"></a>f.@Path</h4><h4 id="g-Url"><a href="#g-Url" class="headerlink" title="g.@Url"></a>g.@Url</h4><h3 id="æ±‡æ€»"><a href="#æ±‡æ€»" class="headerlink" title="æ±‡æ€»"></a>æ±‡æ€»</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://upload-images.jianshu.io/upload_images/944365-f9f8994497df7fd3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ­¥éª¤4ï¼šåˆ›å»º-Retrofit-å®ä¾‹"><a href="#æ­¥éª¤4ï¼šåˆ›å»º-Retrofit-å®ä¾‹" class="headerlink" title="æ­¥éª¤4ï¼šåˆ›å»º Retrofit å®ä¾‹"></a>æ­¥éª¤4ï¼šåˆ›å»º Retrofit å®ä¾‹</h2><h2 id="æ­¥éª¤5ï¼šåˆ›å»º-ç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹-å¹¶-é…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°"><a href="#æ­¥éª¤5ï¼šåˆ›å»º-ç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹-å¹¶-é…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°" class="headerlink" title="æ­¥éª¤5ï¼šåˆ›å»º ç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹ å¹¶ é…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°"></a>æ­¥éª¤5ï¼šåˆ›å»º ç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹ å¹¶ é…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°</h2><h2 id="æ­¥éª¤6ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥-åŒæ­¥ï¼‰"><a href="#æ­¥éª¤6ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥-åŒæ­¥ï¼‰" class="headerlink" title="æ­¥éª¤6ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥\åŒæ­¥ï¼‰"></a>æ­¥éª¤6ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥\åŒæ­¥ï¼‰</h2><h2 id="æ­¥éª¤7ï¼šå¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®"><a href="#æ­¥éª¤7ï¼šå¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®" class="headerlink" title="æ­¥éª¤7ï¼šå¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®"></a>æ­¥éª¤7ï¼šå¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;åœ¨&lt;strong&gt;Android&lt;/strong&gt;å¼€å‘ä¸­ï¼Œç½‘ç»œè¯·æ±‚ååˆ†å¸¸ç”¨&lt;/li&gt;
&lt;li&gt;å½“ä¸‹çš„ç½‘ç»œè¯·æ±‚åŠ è½½åº“ä¸­ï¼Œ&lt;stro
      
    
    </summary>
    
    
      <category term="Android" scheme="https://edward7zhang.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>AndroidStudioç¼–è¯‘è¿‡ç¨‹</title>
    <link href="https://edward7zhang.github.io/2019/03/02/AndroidStudio%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/"/>
    <id>https://edward7zhang.github.io/2019/03/02/AndroidStudioç¼–è¯‘è¿‡ç¨‹/</id>
    <published>2019-03-02T04:07:14.000Z</published>
    <updated>2019-03-04T07:35:29.654Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨æ­¤è®°å½•ä¸€ä¸‹AndroidStudioç¼–è¯‘è¿‡ç¨‹</p></blockquote><p>å…¶ä¸­ä½¿ç”¨åˆ°çš„ç¼–è¯‘å·¥å…·ï¼š<br>aaptã€aidlã€Java Compilerã€dexã€zipalign</p><p>ä¸»è¦æ­¥éª¤æè¿°ï¼š</p><pre><code>1.é€šè¿‡aaptæ‰“åŒ…resèµ„æºæ–‡ä»¶ï¼Œç”ŸæˆR.javaã€resource.arscå’Œresæ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶&amp;éäºŒè¿›åˆ¶å¦‚res/rawå’Œpicä¿æŒåŸæ ·ï¼‰2.å¤„ç†.aidlæ–‡ä»¶ï¼Œç”Ÿæˆå¯¹åº”çš„Javaæ¥å£æ–‡ä»¶3.é€šè¿‡Java Compilerç¼–è¯‘R.javaã€Javaæ¥å£æ–‡ä»¶ã€Javaæºæ–‡ä»¶ï¼Œç”Ÿæˆ.classæ–‡ä»¶4.é€šè¿‡dexå‘½ä»¤ï¼Œå°†.classæ–‡ä»¶å’Œç¬¬ä¸‰æ–¹åº“ä¸­çš„.classæ–‡ä»¶å¤„ç†ç”Ÿæˆclasses.dex5.é€šè¿‡apkbuilderå·¥å…·ï¼Œå°†aaptç”Ÿæˆçš„resource.arscå’Œresæ–‡ä»¶ã€assetsæ–‡ä»¶å’Œclasses.dexä¸€èµ·æ‰“åŒ…ç”Ÿæˆapk6.é€šè¿‡Jarsignerå·¥å…·ï¼Œå¯¹ä¸Šé¢çš„apkè¿›è¡Œdebugæˆ–releaseç­¾å7.é€šè¿‡zipalignå·¥å…·ï¼Œå°†ç­¾ååçš„apkè¿›è¡Œå¯¹é½å¤„ç†</code></pre><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://upload-images.jianshu.io/upload_images/1420866-79b675761018ff57.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/536/format/webp" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://upload-images.jianshu.io/upload_images/1420866-1402494a5225964e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/993/format/webp" alt="link" title="">                </div>                <div class="image-caption">link</div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;åœ¨æ­¤è®°å½•ä¸€ä¸‹AndroidStudioç¼–è¯‘è¿‡ç¨‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶ä¸­ä½¿ç”¨åˆ°çš„ç¼–è¯‘å·¥å…·ï¼š&lt;br&gt;aaptã€aidlã€Java Compilerã€dexã€zipalign&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ­¥éª¤æè¿°ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;co
      
    
    </summary>
    
    
      <category term="Android" scheme="https://edward7zhang.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€é“ç®€å•çš„Javaé¢è¯•é¢˜ã€è½¬è½½è‡ª çŸ¥ä¹â€”â€”æ–¹å¿—å®ã€‘</title>
    <link href="https://edward7zhang.github.io/2019/03/01/%E8%AE%B0%E4%B8%80%E9%81%93%E7%AE%80%E5%8D%95%E7%9A%84Java%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <id>https://edward7zhang.github.io/2019/03/01/è®°ä¸€é“ç®€å•çš„Javaé¢è¯•é¢˜/</id>
    <published>2019-03-01T11:07:14.000Z</published>
    <updated>2019-03-01T08:35:17.911Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å¯èƒ½æ˜¯å†å²ä¸Šæœ€ç®€å•çš„ä¸€é“javaé¢è¯•é¢˜äº†ã€‚</p><p>é¢˜ç›®å¾ˆç®€å•ï¼Œå®Œæˆä»£ç ï¼Œåˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å¥‡æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span></span></div></pre></td></tr></table></figure><p>ç›¸ä¿¡ç›¸å½“æ•°é‡çš„äººéƒ½å·²ç»åœ¨å‡†å¤‡åæ§½äº†ï¼Œåªè¦çœ‹è¿‡ã€Šç¼–ç¨‹ç ç‘ã€‹çš„äººéƒ½çŸ¥é“è¿™é“é¢˜çš„ç­”æ¡ˆå’Œå…¶ä¸­æä¸ºç®€å•çš„é“ç†ã€‚ä¸è¿‡åˆ«ç€æ€¥éª‚è¡—ï¼Œä¸ç®¡ä½ ä¿¡ä¸ä¿¡ï¼Œè¿™é“ç¬”è¯•é¢˜æˆ‘æ‹¿åˆ°çš„ç­”æ¡ˆå¥½å¤šéƒ½é•¿è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) &#123;</div><div class="line">        System.out.println(<span class="string">"æ˜¯å¥‡æ•°"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        System.out.println(<span class="string">"æ˜¯å¶æ•°"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ç„¶åç¼–è¯‘ä¸€ä¸‹ï¼Œå‘ç°é”™è¯¯äº†ï¼ŒæŒ æŒ å¤´ï¼Œé¡¶å¤šæ”¹æˆè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¥½å§ï¼Œæˆ‘æ‰¿è®¤æˆ‘åœ¨ç­›é€‰ç®€å†çš„èƒ½åŠ›å¯èƒ½æœ‰ä¸€äº›é—®é¢˜ï¼Œä¸è¿‡ä¸ç®¡ä½ ä¿¡ä¸ä¿¡ï¼Œå¥½å¤šå¤§å‚å·¥ä½œäº†å‡ å¹´çš„ç¨‹åºå‘˜ï¼Œéƒ½ä¼šå†™å‡ºå¦‚ä¸Šé£æ ¼çš„ä»£ç ã€‚</p><p>äºæ˜¯æˆ‘ç»§ç»­è¿›è¡Œå¼•å¯¼ï¼š</p><p>æˆ‘ï¼šâ€œè¿™ä¸ªå‡½æ•°çš„å®šä¹‰è¦æ±‚è¿”å›ä¸€ä¸ªä»€ä¹ˆç±»å‹çš„å€¼ï¼Ÿâ€</p><p>å€™é€‰äººçœ‹äº†çœ‹é¢˜å¹²ï¼šâ€œå¸ƒå°”ç±»å‹ã€‚â€</p><p>æˆ‘ï¼šâ€œé‚£ä¹ˆï¼Œä½ ifåé¢çš„æ‹¬å·é‡Œé¢çš„è¡¨è¾¾å¼çš„å€¼æ˜¯ä¸€ä¸ªä»€ä¹ˆç±»å‹çš„ï¼Ÿâ€</p><p>å¼•å¯¼åˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œä¾ç„¶æœ‰é«˜è¾¾ä¸¤æˆçš„å€™é€‰äººé€‰æ‹©äº†æ”¾å¼ƒï¼Œè¡¨ç¤ºä»–ä»¬ä¸çŸ¥é“ã€‚å¥½å§ï¼Œæˆ‘çœŸçš„ä¸çŸ¥é“ä½ ä»¬æ¥é¢è¯•è¿™ä¸ªèŒä½çš„ä¿¡å¿ƒä½•åœ¨ã€‚ä¸è¿‡å¤§éƒ¨åˆ†äººæƒ³äº†æƒ³ï¼Œè¿˜ä¼šå›ç­”å‡ºæ­£ç¡®ç­”æ¡ˆï¼š</p><p>å€™é€‰äººï¼šâ€œä¹Ÿæ˜¯å¸ƒå°”ç±»å‹ã€‚â€</p><p>æˆ‘ï¼šâ€œç„¶åå‘¢ï¼Ÿâ€</p><p>æœ‰å°‘é‡å€™é€‰äººè™½ç„¶æ²¡è¯´å‡ºæ¥ï¼Œä½†æ˜¯æˆ‘èƒ½çœ‹å‡ºæ¥ä»–ä»¬è§‰å¾—è¿™åªæ˜¯ä¸€ä¸ªå·§åˆï¼Œå¹¶ä¸çŸ¥é“æ€ä¹ˆè¿›è¡Œä¸‹ä¸€æ­¥ã€‚ä¸è¿‡ï¼Œå¤§å¤šæ•°äººæƒ³äº†æƒ³ä¹‹åï¼Œè¿˜æ˜¯ä¼šä¼˜åŒ–æˆå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> i % <span class="number">2</span> == <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ç»ˆäºè¿‡äº†ç¬¬ä¸€å…³äº†ï¼Œè¿›è¡Œç¬¬äºŒå…³çš„å¼•å¯¼ï¼š</p><p>æˆ‘ï¼šâ€œé‚£æˆ‘ä¼ è¿›æ¥ä¸€ä¸ª-1å‘¢ï¼Ÿâ€</p><p>å°†è¿‘ä¸€åŠçš„äººåœ¨æƒ³äº†æƒ³ä¹‹åä¼šå˜´ç¡¬åœ°è¡¨ç¤ºä»–ä»¬ä»å°è¢«æ•™å¯¼åªæœ‰è‡ªç„¶æ•°æ‰æœ‰å¥‡æ•°å¶æ•°ä¹‹åˆ†ï¼Œè´Ÿæ•°æ²¡æœ‰å¥‡å¶è¿™ä¸€è¯´ã€‚å‰©ä½™çš„äººæ¥å—äº†è¿™ä¸ªè®¾å®šï¼Œæƒ³äº†ä¸€ä¼šå„¿ï¼Œæ”¹æˆè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> i % <span class="number">2</span> == <span class="number">1</span> || i % <span class="number">2</span> == -<span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¹¶ä¸”åœ¨æç¤ºä¹‹åä¼˜åŒ–æˆè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> i % <span class="number">2</span> != <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å¥½å§ï¼Œè¿™æ˜¯è¿„ä»Šä¸ºæ­¢ç¬¬ä¸€ä¸ªèƒ½é€šè¿‡ç¼–è¯‘ä¸”å®Œå…¨æ»¡è¶³äº†éœ€æ±‚çš„ä»£ç å®ç°äº†ã€‚è¯´å®è¯ï¼Œä¸€å¼€å§‹å°±å†™æˆè¿™æ ·çš„äººï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–ä»€ä¹ˆæ˜æ˜¾çš„ç¼ºç‚¹çš„è¯ï¼Œæˆ‘è¿™é‡ŒåŸºæœ¬å°±èƒ½é€šè¿‡äº†ã€‚æˆ‘æ‰¿è®¤æˆ‘çš„è¦æ±‚æ¯”è¾ƒä½ï¼Œä½†æ˜¯æ¥é¢è¯•çš„äººèƒ½ç›´æ¥å†™å‡ºè¿™æ ·çš„çœŸçš„ä¸å¤ªå¤šï¼Œç²—ç•¥åœ°ä¼°è®¡çš„è¯ï¼Œå¤§æ¦‚å ä¸€åˆ°ä¸¤æˆå§ã€‚</p><p>ä½†æ˜¯è¿™é‡Œè¿˜æ²¡å®Œå‘¢ï¼Œè¿˜æœ‰æœ€é‡è¦çš„ç¬¬ä¸‰å…³å‘¢ï¼š</p><p>æˆ‘ï¼šâ€œæœ‰æ›´å¥½çš„åŠæ³•å—ï¼Ÿâ€</p><p>å€™é€‰äººï¼šâ€œï¼Ÿâ€</p><p>æˆ‘ï¼šâ€œæˆ‘è§‰å¾—å–æ¨¡æ“ä½œæ¯”è¾ƒæ…¢ï¼Œæœ‰æ›´å¿«çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿâ€</p><p>é™¤äº†å°‘æ•°äººèƒ½è‡ªå·±æƒ³æƒ³å°±æƒ³å‡ºæ¥äº†ä¹‹å¤–ï¼Œç»å¤§éƒ¨åˆ†ï¼ˆæ¯«ä¸å¤¸å¼ ï¼‰å€™é€‰äººè¡¨ç¤ºæ²¡æœ‰æˆ–è€…ä¸çŸ¥é“ï¼Œäºæ˜¯è¿›è¡Œä¸‹ä¸€æ­¥æç¤ºï¼š</p><p>æˆ‘ï¼šâ€œå¥‡æ•°å’Œå¶æ•°è½¬æ¢æˆäºŒè¿›åˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ€</p><p>ç›¸å½“ä¸€éƒ¨åˆ†å€™é€‰äººè¡¨ç¤ºè‡ªå·±ä¸æ‡‚ä»€ä¹ˆå«äºŒè¿›åˆ¶å’Œä½è¿ç®—ï¼Œæœ‰çš„è¿˜è¡¨ç¤ºjavaä¸æ˜¯cè¯­è¨€ï¼Œä¸ç”¨ç ”ç©¶è¿™äº›ï¼Œå°±è·Ÿå¾ˆå¤šè¯„è®ºä¼šåæ§½æˆ‘åœ¨è£…é€¼ä¸€æ ·ã€‚å°‘éƒ¨åˆ†å€™é€‰äººæƒ³äº†æƒ³ï¼Œä¼šæ€¯æ€¯åœ°å›ç­”ã€‚</p><p>å€™é€‰äººï¼šâ€œå¥‡æ•°æœ€åä¸€ä½æ˜¯1ï¼Œå¶æ•°æœ€åä¸€ä½æ˜¯0ã€‚â€</p><p>æˆ‘ï¼šâ€œç„¶åå‘¢ï¼Ÿâ€</p><p>è¿™é‡Œå¾ˆå¥‡æ€ªçš„ç‚¹æ˜¯ï¼Œå¤§éƒ¨åˆ†èƒ½èŠåˆ°è¿™é‡Œæ¥çš„å€™é€‰äººä¼šæƒ³èµ·æ¥ç§»ä½æ“ä½œï¼Œæˆ‘çœŸçš„ä¸çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆï¼Œè™½ç„¶è¿™é“é¢˜ç¡®å®å¯ä»¥æœ‰è¿™ç§æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> i &gt;&gt; <span class="number">1</span> &lt;&lt; <span class="number">1</span> != i;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ¹æœ¬ä¸æ˜¯é‡ç‚¹å¥½å§ï¼ï¼ï¼</p><p>æ€»ä¹‹ï¼Œæ— è®ºå¦‚ä½•ï¼Œèƒ½åœ¨ç¬¬ä¸‰å…³çš„å„ç§å¼•å¯¼ä¹‹åï¼Œèƒ½å†™å‡ºä¸‹é¢è¿™ä¸ªç»“æœæ¥çš„äººï¼ŒçœŸçš„ä¸å¤šã€‚èƒ½ä¸€å¼€å§‹æ²¡æœ‰ä»»ä½•å¼•å¯¼çš„å°±å†™å‡ºæ¥çš„äººï¼Œè‡³ä»Šåªè§è¿‡ä¸¤ä¸ªï¼Œä¸€ä¸ªæˆ‘å»å“ªå„¿éƒ½å¸¦ç€ï¼Œä¸€ä¸ªæ‹’äº†æˆ‘çš„offerã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOdd</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (i &amp; <span class="number">1</span>) == <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>åˆ«ä»¥ä¸ºè¿™å°±å®Œäº†ï¼ç»ˆæbossæ¥äº†ï¼š</p><p>æˆ‘ï¼šâ€œè¿™æ ·æ˜¯ä¸æ˜¯æ¯”ä¸Šé¢å–æ¨¡è¿ç®—è¦å¿«ï¼Ÿâ€</p><p>å€™é€‰äººï¼šâ€œé‚£å½“ç„¶äº†ï¼Œä½è¿ç®—è‚¯å®šå¿«å•Šã€‚â€</p><p>æˆ‘ï¼šâ€œä½†æ˜¯æˆ‘ä»¬å®é™…ä»£ç æµ‹è¯•è¿‡ï¼Œå‘ç°ä¸Šé¢çš„æŒ‰ä½ä¸æ“ä½œå’Œå–æ¨¡æ“ä½œï¼Œå®é™…è¿è¡Œçš„æ—¶é—´æ˜¯å·®ä¸å¤šçš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿâ€</p><p>å€™é€‰äººå¿ƒé‡Œmmpï¼šâ€œé—¹äº†åŠå¤©ä½ è¿™æ˜¯åœ¨é€—æˆ‘ç©å•Šï¼Ÿï¼Ÿï¼Ÿâ€</p><p>ç„¶è€ŒçœŸæ­£èƒ½å›ç­”å‡ºåŸå› æ¥çš„äººï¼Œé¢è¯•è¿‡ç¨‹ä¸­æˆ‘æ²¡è§è¿‡ï¼Œå¯èƒ½æ˜¯å¤§ç‰›éƒ½çœ‹ä¸ä¸Šæˆ‘æ‰€åœ¨çš„å…¬å¸å§ã€‚åªæœ‰åœ¨æŸå…¬å¸çš„æ—¶å€™ï¼Œä¸€ä¸ªåŒäº‹æƒ³äº†æƒ³ï¼Œç»™å‡ºäº†æˆ‘æ­£ç¡®ç­”æ¡ˆï¼šâ€œç¼–è¯‘å™¨ä¼šå°†å¯¹2çš„æŒ‡æ•°çš„å–æ¨¡æ“ä½œï¼Œä¼˜åŒ–æˆä½è¿ç®—æ“ä½œã€‚â€</p><p>éš¾é“æ˜¯æˆ‘ç»å†çš„å…¬å¸éƒ½å¤ªlowäº†ä¹ˆâ€¦â€¦</p><p>ä½œè€…ï¼šæ–¹å¿—å®<br>é“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/57859872" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/57859872</a><br>æ¥æºï¼šçŸ¥ä¹<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™å¯èƒ½æ˜¯å†å²ä¸Šæœ€ç®€å•çš„ä¸€é“javaé¢è¯•é¢˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;é¢˜ç›®å¾ˆç®€å•ï¼Œå®Œæˆä»£ç ï¼Œåˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å¥‡æ•°ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;l
      
    
    </summary>
    
    
      <category term="Java" scheme="https://edward7zhang.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ByteDanceã€ä¸€é¢æ€»ç»“ã€‘</title>
    <link href="https://edward7zhang.github.io/2019/02/18/ByteDance%E3%80%90%E4%B8%80%E9%9D%A2%E6%80%BB%E7%BB%93%E3%80%91/"/>
    <id>https://edward7zhang.github.io/2019/02/18/ByteDanceã€ä¸€é¢æ€»ç»“ã€‘/</id>
    <published>2019-02-18T11:07:14.000Z</published>
    <updated>2019-03-02T14:28:47.932Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§æ¦‚åœ¨æ•°å¤©å‰æŠ•é€’äº†å­—èŠ‚è·³åŠ¨-æŠ–éŸ³æ–¹å‘çš„å®ä¹ ç”Ÿå²—ä½<br>æ˜¨å¤©æ¥åˆ°äº†é¢è¯•é€šçŸ¥ï¼Œä»Šå¤©é¢è¯•åå¯¹æ¶‰åŠåˆ°çš„é—®é¢˜è¿›è¡Œä¸€ä¸ªå¤ç›˜ã€‚ï¼ˆå­—èŠ‚è·³åŠ¨æœç„¶åä¸è™šä¼ â€¦é¢è¯•å®˜ç›¸å½“äº²åˆ‡ä¸”å–„äºå¾ªå¾ªå–„è¯±æ¥å¼•å¯¼æˆ‘å›ç­”é—®é¢˜ï¼‰</p><h2 id="1-Javaä¸­çš„å¼•ç”¨ç±»å‹æœ‰æ²¡æœ‰ä»€ä¹ˆäº†è§£ï¼Ÿ"><a href="#1-Javaä¸­çš„å¼•ç”¨ç±»å‹æœ‰æ²¡æœ‰ä»€ä¹ˆäº†è§£ï¼Ÿ" class="headerlink" title="1.Javaä¸­çš„å¼•ç”¨ç±»å‹æœ‰æ²¡æœ‰ä»€ä¹ˆäº†è§£ï¼Ÿ"></a>1.Javaä¸­çš„å¼•ç”¨ç±»å‹æœ‰æ²¡æœ‰ä»€ä¹ˆäº†è§£ï¼Ÿ</h2><p>Java.lang.refæ˜¯Javaç±»åº“ä¸­æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ä¸ªåŒ…ï¼Œå®ƒæä¾›äº†ä¸Javaåƒåœ¾å›æ”¶å™¨å¯†åˆ‡ç›¸å…³çš„å¼•ç”¨ç±»ã€‚</p><pre><code>StrongReferenceï¼ˆå¼ºå¼•ç”¨ï¼‰SoftReferenceï¼ˆè½¯å¼•ç”¨ï¼‰WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰PhantomReferenceï¼ˆè™šå¼•ç”¨ï¼‰</code></pre><h3 id="å¼•ç”¨ç±»å‹å¯¹æ¯”"><a href="#å¼•ç”¨ç±»å‹å¯¹æ¯”" class="headerlink" title="å¼•ç”¨ç±»å‹å¯¹æ¯”"></a>å¼•ç”¨ç±»å‹å¯¹æ¯”</h3><table><thead><tr><th>åºå·</th><th>å¼•ç”¨ç±»å‹</th><th>å–å¾—ç›®æ ‡å¯¹è±¡æ–¹å¼</th><th>åƒåœ¾å›æ”¶æ¡ä»¶</th><th>æ˜¯å¦å¯èƒ½å†…å­˜æ³„æ¼</th></tr></thead><tbody><tr><td>1</td><td>å¼ºå¼•ç”¨</td><td>ç›´æ¥è°ƒç”¨</td><td>ä¸å›æ”¶</td><td>å¯èƒ½</td></tr><tr><td>2</td><td>è½¯å¼•ç”¨</td><td>é€šè¿‡ get()æ–¹æ³•</td><td>è§†å†…å­˜æƒ…å†µå›æ”¶</td><td>ä¸å¯èƒ½</td></tr><tr><td>3</td><td>å¼±å¼•ç”¨</td><td>é€šè¿‡ get()æ–¹æ³•</td><td>æ°¸è¿œå›æ”¶</td><td>ä¸å¯èƒ½</td></tr><tr><td>4</td><td>è™šå¼•ç”¨</td><td>æ— æ³•å–å¾—</td><td>ä¸å›æ”¶</td><td>å¯èƒ½</td></tr></tbody></table><h4 id="1-StrongReferenceï¼ˆå¼ºå¼•ç”¨ï¼‰"><a href="#1-StrongReferenceï¼ˆå¼ºå¼•ç”¨ï¼‰" class="headerlink" title="1.StrongReferenceï¼ˆå¼ºå¼•ç”¨ï¼‰"></a>1.StrongReferenceï¼ˆå¼ºå¼•ç”¨ï¼‰</h4><p>å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£åƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJavaè™šæ‹Ÿæœºå®æ„¿æŠ›å‡ºOutOfMemoryErroré”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚</p><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String[] arr = <span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>&#125;;</div></pre></td></tr></table></figure><h4 id="2-SoftReferenceï¼ˆè½¯å¼•ç”¨ï¼‰"><a href="#2-SoftReferenceï¼ˆè½¯å¼•ç”¨ï¼‰" class="headerlink" title="2.SoftReferenceï¼ˆè½¯å¼•ç”¨ï¼‰"></a>2.SoftReferenceï¼ˆè½¯å¼•ç”¨ï¼‰</h4><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œå¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼›å¦‚æœå†…å­˜ç©ºé—´ä¸è¶³ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚<br>è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>ç¤ºä¾‹</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Example1</span></div><div class="line">SoftReference&lt;String[]&gt; softBean = <span class="keyword">new</span> SoftReference&lt;String[]&gt;(<span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>&#125;);</div><div class="line"></div><div class="line"><span class="comment">//Example2</span></div><div class="line">ReferenceQueue&lt;String[]&gt; referenceQueue = <span class="keyword">new</span> ReferenceQueue&lt;String[]&gt;();</div><div class="line">SoftReference&lt;String[]&gt; softBean = <span class="keyword">new</span> SoftReference&lt;String[]&gt;(<span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;, referenceQueue);</div></pre></td></tr></table></figure></p><h4 id="3-WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰"><a href="#3-WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰" class="headerlink" title="3.WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰"></a>3.WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰</h4><p>å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œå› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚<br>â€‚â€‚â€‚â€‚å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚<br>â€‚â€‚â€‚â€‚<br><strong>ç¤ºä¾‹</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Example1</span></div><div class="line">WeakReference&lt;String[]&gt; weakBean = <span class="keyword">new</span> WeakReference&lt;String[]&gt;(<span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;);</div><div class="line"><span class="comment">//Example2</span></div><div class="line">ReferenceQueue&lt;String[]&gt; referenceQueue = <span class="keyword">new</span> ReferenceQueue&lt;String[]&gt;();</div><div class="line">WeakReference&lt;String[]&gt; softBean = <span class="keyword">new</span> WeakReference&lt;String[]&gt;(<span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;, referenceQueue);</div></pre></td></tr></table></figure></p><h4 id="4-PhantomReferenceï¼ˆè™šå¼•ç”¨ï¼‰"><a href="#4-PhantomReferenceï¼ˆè™šå¼•ç”¨ï¼‰" class="headerlink" title="4.PhantomReferenceï¼ˆè™šå¼•ç”¨ï¼‰"></a>4.PhantomReferenceï¼ˆè™šå¼•ç”¨ï¼‰</h4><p>â€œè™šå¼•ç”¨â€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚<br>è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ´»åŠ¨ã€‚è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>ç¤ºä¾‹</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ReferenceQueue&lt;String[]&gt; referenceQueue = <span class="keyword">new</span> ReferenceQueue&lt;String[]&gt;();</div><div class="line">PhantomReference&lt;String[]&gt; referent = <span class="keyword">new</span> PhantomReference&lt;String&gt;(<span class="keyword">new</span> String[]&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;, referenceQueue);</div></pre></td></tr></table></figure></p><h2 id="2-Javaä¸­åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å“ªäº›"><a href="#2-Javaä¸­åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å“ªäº›" class="headerlink" title="2.Javaä¸­åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å“ªäº›"></a>2.Javaä¸­åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å“ªäº›</h2><h3 id="1-ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»"><a href="#1-ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»" class="headerlink" title="1.ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»"></a>1.ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹ç±»</h3><pre><code>(1) å®šä¹‰Threadç±»çš„å­ç±»ï¼Œå¹¶é‡å†™è¯¥ç±»çš„runæ–¹æ³•ï¼Œè¯¥runæ–¹æ³•çš„æ–¹æ³•ä½“å°±ä»£è¡¨äº†çº¿ç¨‹è¦å®Œæˆçš„ä»»åŠ¡ã€‚å› æ­¤æŠŠrun()æ–¹æ³•ç§°ä¸ºæ‰§è¡Œä½“ã€‚(2) åˆ›å»ºThreadå­ç±»çš„å®ä¾‹ï¼Œå³åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ã€‚(3) è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•æ¥å¯ç”¨è¯¥çº¿ç¨‹ã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span>  <span class="title">FirstThreadTest</span>  <span class="keyword">extends</span>  <span class="title">Thread</span> </span>&#123;</div><div class="line"><span class="keyword">int</span>  i  =  <span class="number">0</span>; <span class="comment">//é‡å†™runæ–¹æ³•ï¼Œrunæ–¹æ³•çš„æ–¹æ³•ä½“å°±æ˜¯ç°åœºæ‰§è¡Œä½“</span></div><div class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">for</span> (; i &lt;  <span class="number">100</span>; i++) &#123;</div><div class="line">System.out.println(getName() +  <span class="string">" "</span>  + i);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span>  i  =  <span class="number">0</span>; i &lt;  <span class="number">100</span>; i++) &#123;</div><div class="line">System.out.println(Thread.currentThread().getName() +  <span class="string">" : "</span>  + i);</div><div class="line"><span class="keyword">if</span> (i ==  <span class="number">20</span>) &#123;</div><div class="line"><span class="keyword">new</span>  FirstThreadTest().start();</div><div class="line"><span class="keyword">new</span>  FirstThreadTest().start();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­Thread.currentThread()æ–¹æ³•è¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡ã€‚GetName() æ–¹æ³•è¿”å›è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹çš„åå­—ã€‚</p><h3 id="2-é€šè¿‡Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»"><a href="#2-é€šè¿‡Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»" class="headerlink" title="2.é€šè¿‡Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»"></a>2.é€šè¿‡Runnableæ¥å£åˆ›å»ºçº¿ç¨‹ç±»</h3><pre><code>ï¼ˆ1ï¼‰å®šä¹‰runnableæ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™è¯¥æ¥å£çš„run()æ–¹æ³•ï¼Œè¯¥run()æ–¹æ³•çš„æ–¹æ³• ä½“åŒæ ·æ˜¯è¯¥çº¿ç¨‹çš„çº¿ç¨‹æ‰§è¡Œä½“ã€‚ï¼ˆ2ï¼‰åˆ›å»º Runnableå®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶ä¾æ­¤å®ä¾‹ä½œä¸ºThreadçš„targetæ¥åˆ›å»ºThread å¯¹è±¡ï¼Œè¯¥Threadå¯¹è±¡æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ã€‚ï¼ˆ3ï¼‰è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</code></pre><h3 id="3-é€šè¿‡Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹"><a href="#3-é€šè¿‡Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹" class="headerlink" title="3.é€šè¿‡Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹"></a>3.é€šè¿‡Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹</h3><pre><code>ï¼ˆ1ï¼‰åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°call()æ–¹æ³•ï¼Œè¯¥call()æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œ ä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚ï¼ˆ2ï¼‰åˆ›å»ºCallableå®ç°ç±»çš„å®ä¾‹ï¼Œä½¿ç”¨FutureTaskç±»æ¥åŒ…è£…Callableå¯¹è±¡ï¼Œè¯¥ FutureTaskå¯¹è±¡å°è£…äº†è¯¥Callableå¯¹è±¡çš„call()æ–¹æ³•çš„è¿”å›å€¼ã€‚ï¼ˆ3ï¼‰ä½¿ç”¨FutureTaskå¯¹è±¡ä½œä¸ºThreadå¯¹è±¡çš„targetåˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚ï¼ˆ4ï¼‰è°ƒç”¨FutureTaskå¯¹è±¡çš„get()æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼ï¼Œè°ƒç”¨ get()æ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹ã€‚</code></pre><h3 id="åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼çš„å¯¹æ¯”"><a href="#åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼çš„å¯¹æ¯”" class="headerlink" title="åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼çš„å¯¹æ¯”"></a>åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼çš„å¯¹æ¯”</h3><p>é‡‡ç”¨å®ç°Runnableã€Callableæ¥å£çš„æ–¹å¼åˆ›è§å¤šçº¿ç¨‹æ—¶ï¼Œä¼˜åŠ¿æ˜¯ï¼š çº¿ç¨‹ç±»åªæ˜¯å®ç°äº†Runnableæ¥å£æˆ–Callableæ¥å£ï¼Œè¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ã€‚ åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªtargetå¯¹è±¡ï¼Œæ‰€ä»¥éå¸¸é€‚åˆå¤šä¸ªç›¸åŒçº¿ç¨‹ æ¥å¤„ç†åŒä¸€ä»½èµ„æºçš„æƒ…å†µï¼Œä»è€Œå¯ä»¥å°†CPUã€ä»£ç å’Œæ•°æ®åˆ†å¼€ï¼Œå½¢æˆæ¸…æ™°çš„æ¨¡å‹ï¼Œ è¾ƒå¥½åœ°ä½“ç°äº†é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚ åŠ£åŠ¿æ˜¯ï¼š ç¼–ç¨‹ç¨å¾®å¤æ‚ï¼Œå¦‚æœè¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨Thread.currentThread()æ–¹æ³•ã€‚ ä½¿ç”¨ç»§æ‰¿Threadç±»çš„æ–¹å¼åˆ›å»ºå¤šçº¿ç¨‹æ—¶ä¼˜åŠ¿æ˜¯ï¼š ç¼–å†™ç®€å•ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œåˆ™æ— éœ€ä½¿ç”¨Thread.currentThread()æ–¹æ³•ï¼Œç›´æ¥ ä½¿ç”¨thiså³å¯è·å¾—å½“å‰çº¿ç¨‹ã€‚ åŠ£åŠ¿æ˜¯ï¼š çº¿ç¨‹ç±»å·²ç»ç»§æ‰¿äº†Threadç±»ï¼Œæ‰€ä»¥ä¸èƒ½å†ç»§æ‰¿å…¶ä»–çˆ¶ç±»ã€‚</p><h2 id="3-Objectç±»å¯¹è±¡å«æœ‰çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#3-Objectç±»å¯¹è±¡å«æœ‰çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3.Objectç±»å¯¹è±¡å«æœ‰çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"></a>3.Objectç±»å¯¹è±¡å«æœ‰çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</h2><p>Javaä¸­çš„Objectç±»æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œå®ƒæä¾›äº†ä»¥ä¸‹11ä¸ªæ–¹æ³•ï¼š</p><pre><code>1.public final native Class&lt;?&gt;getClass()2.public native int hashCode()3.public boolean equals(Object obj)4.protected native Object clone() throws CloneNotSupportedException5.public String toString()6.public final native void notify()7.public final native void notifyAll()8.public final native void wait(long timeout) throws InterruptedException9.public final void wait(long timeout,int nanos)throws InterruptedException10.public final void wait() throws InterruptedException11.protected void finalize() throws Throwable{}</code></pre><h2 id="4-Androidä¸­çš„è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿå…·ä½“è¯´è¯´Binder"><a href="#4-Androidä¸­çš„è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿå…·ä½“è¯´è¯´Binder" class="headerlink" title="4.Androidä¸­çš„è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿå…·ä½“è¯´è¯´Binder"></a>4.Androidä¸­çš„è¿›ç¨‹é—´é€šä¿¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿå…·ä½“è¯´è¯´Binder</h2><p>Androidä¸­çš„IPCæ–¹å¼</p><pre><code>ä½¿ç”¨Intentä½¿ç”¨æ–‡ä»¶å…±äº«ä½¿ç”¨Messengerä½¿ç”¨AIDLä½¿ç”¨ContentProviderä½¿ç”¨Socket</code></pre><h3 id="1-ä½¿ç”¨Intent"><a href="#1-ä½¿ç”¨Intent" class="headerlink" title="1.ä½¿ç”¨Intent"></a>1.ä½¿ç”¨Intent</h3><h4 id="1-Activityï¼ŒServiceï¼ŒReceiveréƒ½æ”¯æŒåœ¨Intentä¸­ä¼ é€’Bundleæ•°æ®ï¼Œè€ŒBundleå®ç°äº†Parcelableæ¥å£ï¼Œå¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹é—´è¿›è¡Œä¼ è¾“ã€‚"><a href="#1-Activityï¼ŒServiceï¼ŒReceiveréƒ½æ”¯æŒåœ¨Intentä¸­ä¼ é€’Bundleæ•°æ®ï¼Œè€ŒBundleå®ç°äº†Parcelableæ¥å£ï¼Œå¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹é—´è¿›è¡Œä¼ è¾“ã€‚" class="headerlink" title="1.Activityï¼ŒServiceï¼ŒReceiveréƒ½æ”¯æŒåœ¨Intentä¸­ä¼ é€’Bundleæ•°æ®ï¼Œè€ŒBundleå®ç°äº†Parcelableæ¥å£ï¼Œå¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹é—´è¿›è¡Œä¼ è¾“ã€‚"></a>1.Activityï¼ŒServiceï¼ŒReceiveréƒ½æ”¯æŒåœ¨Intentä¸­ä¼ é€’Bundleæ•°æ®ï¼Œè€ŒBundleå®ç°äº†Parcelableæ¥å£ï¼Œå¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹é—´è¿›è¡Œä¼ è¾“ã€‚</h4><h4 id="2-åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯åŠ¨äº†å¦ä¸€ä¸ªè¿›ç¨‹çš„Activityï¼ŒServiceå’ŒReceiverï¼Œå¯ä»¥åœ¨Bundleä¸­é™„åŠ è¦ä¼ é€’çš„æ•°æ®é€šè¿‡Intentå‘é€å‡ºå»ã€‚"><a href="#2-åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯åŠ¨äº†å¦ä¸€ä¸ªè¿›ç¨‹çš„Activityï¼ŒServiceå’ŒReceiverï¼Œå¯ä»¥åœ¨Bundleä¸­é™„åŠ è¦ä¼ é€’çš„æ•°æ®é€šè¿‡Intentå‘é€å‡ºå»ã€‚" class="headerlink" title="2.åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯åŠ¨äº†å¦ä¸€ä¸ªè¿›ç¨‹çš„Activityï¼ŒServiceå’ŒReceiverï¼Œå¯ä»¥åœ¨Bundleä¸­é™„åŠ è¦ä¼ é€’çš„æ•°æ®é€šè¿‡Intentå‘é€å‡ºå»ã€‚"></a>2.åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯åŠ¨äº†å¦ä¸€ä¸ªè¿›ç¨‹çš„Activityï¼ŒServiceå’ŒReceiverï¼Œå¯ä»¥åœ¨Bundleä¸­é™„åŠ è¦ä¼ é€’çš„æ•°æ®é€šè¿‡Intentå‘é€å‡ºå»ã€‚</h4><h3 id="2-ä½¿ç”¨æ–‡ä»¶å…±äº«"><a href="#2-ä½¿ç”¨æ–‡ä»¶å…±äº«" class="headerlink" title="2.ä½¿ç”¨æ–‡ä»¶å…±äº«"></a>2.ä½¿ç”¨æ–‡ä»¶å…±äº«</h3><h4 id="1-Windowsä¸Šï¼Œä¸€ä¸ªæ–‡ä»¶å¦‚æœè¢«åŠ äº†æ’æ–¥é”ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹æ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®ï¼ŒåŒ…æ‹¬è¯»å’Œå†™ï¼›è€ŒAndroidç³»ç»ŸåŸºäºLinuxï¼Œä½¿å¾—å…¶å¹¶å‘è¯»å–æ–‡ä»¶æ²¡æœ‰é™åˆ¶åœ°è¿›è¡Œï¼Œç”šè‡³å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œalthough-this-may-be-a-problem"><a href="#1-Windowsä¸Šï¼Œä¸€ä¸ªæ–‡ä»¶å¦‚æœè¢«åŠ äº†æ’æ–¥é”ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹æ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®ï¼ŒåŒ…æ‹¬è¯»å’Œå†™ï¼›è€ŒAndroidç³»ç»ŸåŸºäºLinuxï¼Œä½¿å¾—å…¶å¹¶å‘è¯»å–æ–‡ä»¶æ²¡æœ‰é™åˆ¶åœ°è¿›è¡Œï¼Œç”šè‡³å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œalthough-this-may-be-a-problem" class="headerlink" title="1.Windowsä¸Šï¼Œä¸€ä¸ªæ–‡ä»¶å¦‚æœè¢«åŠ äº†æ’æ–¥é”ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹æ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®ï¼ŒåŒ…æ‹¬è¯»å’Œå†™ï¼›è€ŒAndroidç³»ç»ŸåŸºäºLinuxï¼Œä½¿å¾—å…¶å¹¶å‘è¯»å–æ–‡ä»¶æ²¡æœ‰é™åˆ¶åœ°è¿›è¡Œï¼Œç”šè‡³å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œalthough this may be a problem."></a>1.Windowsä¸Šï¼Œä¸€ä¸ªæ–‡ä»¶å¦‚æœè¢«åŠ äº†æ’æ–¥é”ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹æ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®ï¼ŒåŒ…æ‹¬è¯»å’Œå†™ï¼›è€ŒAndroidç³»ç»ŸåŸºäºLinuxï¼Œä½¿å¾—å…¶å¹¶å‘è¯»å–æ–‡ä»¶æ²¡æœ‰é™åˆ¶åœ°è¿›è¡Œï¼Œç”šè‡³å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œalthough this may be a problem.</h4><h4 id="2-å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ååºåˆ—åŒ–æ¢å¤è¿™ä¸ªå¯¹è±¡ï¼ˆAttentionï¼šå¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯å†…å®¹ç›¸åŒï¼‰"><a href="#2-å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ååºåˆ—åŒ–æ¢å¤è¿™ä¸ªå¯¹è±¡ï¼ˆAttentionï¼šå¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯å†…å®¹ç›¸åŒï¼‰" class="headerlink" title="2.å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ååºåˆ—åŒ–æ¢å¤è¿™ä¸ªå¯¹è±¡ï¼ˆAttentionï¼šå¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯å†…å®¹ç›¸åŒï¼‰"></a>2.å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ååºåˆ—åŒ–æ¢å¤è¿™ä¸ªå¯¹è±¡ï¼ˆAttentionï¼šå¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯å†…å®¹ç›¸åŒï¼‰</h4><h4 id="3-SharePreferenceæ˜¯ä¸ªç‰¹ä¾‹ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»-å†™æœ‰ä¸€å®šçš„ç¼“å­˜ç­–ç•¥ï¼Œå³å†…å­˜ä¸­ä¼šæœ‰ä¸€ä»½SharePreferencesæ–‡ä»¶çš„ç¼“å­˜ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»-å†™å°±å˜å¾—ä¸å¯é ï¼Œå½“é¢å¯¹é«˜å¹¶å‘çš„è¯»å†™è®¿é—®ï¼ŒSharePreferencesæœ‰å¾ˆå¤§çš„å‡ ç‡ä¸¢å¤±æ•°æ®ã€‚å› æ­¤ï¼ŒIPCä¸å»ºè®®é‡‡ç”¨SharePreferencesã€‚"><a href="#3-SharePreferenceæ˜¯ä¸ªç‰¹ä¾‹ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»-å†™æœ‰ä¸€å®šçš„ç¼“å­˜ç­–ç•¥ï¼Œå³å†…å­˜ä¸­ä¼šæœ‰ä¸€ä»½SharePreferencesæ–‡ä»¶çš„ç¼“å­˜ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»-å†™å°±å˜å¾—ä¸å¯é ï¼Œå½“é¢å¯¹é«˜å¹¶å‘çš„è¯»å†™è®¿é—®ï¼ŒSharePreferencesæœ‰å¾ˆå¤§çš„å‡ ç‡ä¸¢å¤±æ•°æ®ã€‚å› æ­¤ï¼ŒIPCä¸å»ºè®®é‡‡ç”¨SharePreferencesã€‚" class="headerlink" title="3.SharePreferenceæ˜¯ä¸ªç‰¹ä¾‹ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»/å†™æœ‰ä¸€å®šçš„ç¼“å­˜ç­–ç•¥ï¼Œå³å†…å­˜ä¸­ä¼šæœ‰ä¸€ä»½SharePreferencesæ–‡ä»¶çš„ç¼“å­˜ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»/å†™å°±å˜å¾—ä¸å¯é ï¼Œå½“é¢å¯¹é«˜å¹¶å‘çš„è¯»å†™è®¿é—®ï¼ŒSharePreferencesæœ‰å¾ˆå¤§çš„å‡ ç‡ä¸¢å¤±æ•°æ®ã€‚å› æ­¤ï¼ŒIPCä¸å»ºè®®é‡‡ç”¨SharePreferencesã€‚"></a>3.SharePreferenceæ˜¯ä¸ªç‰¹ä¾‹ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»/å†™æœ‰ä¸€å®šçš„ç¼“å­˜ç­–ç•¥ï¼Œå³å†…å­˜ä¸­ä¼šæœ‰ä¸€ä»½SharePreferencesæ–‡ä»¶çš„ç¼“å­˜ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯»/å†™å°±å˜å¾—ä¸å¯é ï¼Œå½“é¢å¯¹é«˜å¹¶å‘çš„è¯»å†™è®¿é—®ï¼ŒSharePreferencesæœ‰å¾ˆå¤§çš„å‡ ç‡ä¸¢å¤±æ•°æ®ã€‚å› æ­¤ï¼ŒIPCä¸å»ºè®®é‡‡ç”¨SharePreferencesã€‚</h4><h3 id="3-ä½¿ç”¨Messenger"><a href="#3-ä½¿ç”¨Messenger" class="headerlink" title="3.ä½¿ç”¨Messenger"></a>3.ä½¿ç”¨Messenger</h3><p>Messengeræ˜¯ä¸€ç§è½»é‡çº§çš„IPCæ–¹æ¡ˆï¼Œå®ƒçš„åº•å±‚å®ç°æ˜¯AIDLï¼Œå¯ä»¥åœ¨ä¸åŒè¿›ç¨‹ä¸­ä¼ é€’Messageå¯¹è±¡ï¼Œå®ƒä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨æœåŠ¡ç«¯ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ï¼ŒæœåŠ¡ç«¯ä¸å­˜åœ¨å¹¶å‘æ‰§è¡Œçš„æƒ…å½¢</p><ul><li><p>æœåŠ¡ç«¯è¿›ç¨‹ï¼šæœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªServiceæ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒåŒæ—¶é€šè¿‡ä¸€ä¸ªHandlerå¯¹è±¡æ¥å®ä¾‹åŒ–ä¸€ä¸ªMeaaengerå¯¹è±¡ï¼Œç„¶ååœ¨Serviveçš„onBindä¸­è¿”å›è¿™ä¸ªMessengerå¯¹è±¡åº•å±‚çš„Binderå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerSercive</span> <span class="keyword">extends</span> <span class="title">Service</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MessengerSercive.class.getSimpleName();</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>&#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * <span class="doctag">@param</span> msg</div><div class="line">         */</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span>&#123;</div><div class="line">            <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">                <span class="keyword">case</span> Constants.MSG_FROM_CLIENT:</div><div class="line">                    Log.d(TAG, <span class="string">"receive msg from client: msg = ["</span></div><div class="line">                    + msg.getData().getString(Constants.MSG_KEY) + <span class="string">"]"</span>);</div><div class="line">                    Toast.makeText(MessengerService.<span class="keyword">this</span>, <span class="string">"receive msg from client: msg = ["</span> + msg.getData().getString(Constants.MSG_KEY) + <span class="string">"]"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">                    Messenger client = msg.replyTo;</div><div class="line">                    Message replyMsg = Message.obtain(<span class="keyword">null</span>, Constants.MSG_FROM_SERVICE);</div><div class="line">                    Bundle bundle = <span class="keyword">new</span> Bundle();</div><div class="line">                    bundle.putString(Constants.MSG_KEY, <span class="string">"æˆ‘å·²ç»æ”¶åˆ°ä½ çš„æ¶ˆæ¯ï¼Œç¨åå›å¤ä½ ï¼"</span>);</div><div class="line">                    replyMsg.setData(bundle);</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        client.send(replyMsg);</div><div class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    <span class="keyword">super</span>.handleMessage(msg);</div><div class="line">            &#125;</div><div class="line">                </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Messenger mMessenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> MessengerHandler());</div><div class="line"></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> mMessenger.getBinder();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯è¿›ç¨‹ï¼šé¦–å…ˆç»‘å®šæœåŠ¡ç«¯Serviceï¼Œç»‘å®šæˆåŠŸä¹‹åç”¨æœåŠ¡ç«¯çš„IBinderå¯¹è±¡åˆ›å»ºä¸€ä¸ªMessengerï¼Œé€šè¿‡è¿™ä¸ªMessengerå°±å¯ä»¥å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†ï¼Œæ¶ˆæ¯ç±»å‹æ˜¯Messageã€‚å¦‚æœéœ€è¦æœåŠ¡ç«¯å“åº”ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ªHandlerå¹¶é€šè¿‡å®ƒæ¥åˆ›å»ºä¸€ä¸ªMessengerï¼ˆå’ŒæœåŠ¡ç«¯ä¸€æ ·ï¼‰ï¼Œå¹¶é€šè¿‡Messageçš„replyToå‚æ•°ä¼ é€’ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯é€šè¿‡Messageçš„replyToå‚æ•°å°±å¯ä»¥å›åº”å®¢æˆ·ç«¯äº†ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity&#123;</div><div class="line">    private static final String TAG = MainActivity.class.getSimpleName();</div><div class="line">    private Messenger mGetReplyMessenger = new Messenger(new MessageHandler());</div><div class="line">    private Messenger mService;</div><div class="line">    private class MessageHandler extends Handler&#123;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg)&#123;</div><div class="line">            switch(msg.what)&#123;</div><div class="line">                case Constants.MSG_FROM_SERVICE:</div><div class="line">                Log.d(TAG, "received msg form service: msg = </div><div class="line">                [" + msg.getData().getString(Constants.MSG_KEY) + "]");</div><div class="line">                Toast.makeText(MainActivity.this, "received vice: msg = [" + msg.getData().getString(Constants.MSG_KEY) + "]", Toast.LENGTH_SHORT).show();</div><div class="line">                break;</div><div class="line">            default:</div><div class="line">                super.handleMessage(msg);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInsttanceState)&#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">    &#125;</div><div class="line">    public void bindService(View v)&#123;</div><div class="line">        Intent mIntent = new Intent(thia,MessengerService.class);</div><div class="line">        bindService(mIntent, mServiceConnection, Context.BIND_AUTO_CREATE);</div><div class="line">    &#125;</div><div class="line">    public void sendMessage(View v)&#123;</div><div class="line">        Message msg = Message.obtain(null,Constants.MSG_FROM_CLIENT);</div><div class="line">        Bundle data = new Bunle();</div><div class="line">        data.putString(Constants.MSG_KEY, "Hello! This is client.");</div><div class="line">        msg.setData(data);</div><div class="line">        msg.replyTo = mGetReplyMessenger;</div><div class="line">        try&#123;</div><div class="line">            mService.send(mag);</div><div class="line">        &#125;catch(RemoteException e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    protected void onDestroy()&#123;</div><div class="line">        unbindService(mServiceConnection);</div><div class="line">        super.onDestroy();</div><div class="line">    &#125;</div><div class="line">    private ServiceConnection mServiceConnection = new ServiceConnection()&#123;</div><div class="line">        /**</div><div class="line">         * @param name</div><div class="line">         * @param service</div><div class="line">         */</div><div class="line">        @Override</div><div class="line">        public void onServiceConnected(ComponentName name, IBinder service)&#123;</div><div class="line">            mService = new Messenger(service);</div><div class="line">            Message msg = Message.obtain(null, Constants.MSG_FROM_CLIENT);</div><div class="line">            Bundle data = new Bundle();</div><div class="line">            data.putString(Constants.MSG_KEY,"Hello! This is cient.");</div><div class="line">            msg.setData(data);</div><div class="line">            mag.replyTo = mGetReplyMessenger;</div><div class="line">            try&#123;</div><div class="line">                mService.send(msg);</div><div class="line">            &#125;catch(RemoteException e)&#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        /**</div><div class="line">         * @param name</div><div class="line">         */</div><div class="line">        @Override</div><div class="line">        public void onServiceDiscommected(ComponentName name)&#123;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>æ³¨æ„ï¼š å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡é€šè¿‡æ‹¿åˆ°å¯¹æ–¹çš„Messengeræ¥å‘é€Messageçš„ã€‚åªä¸è¿‡å®¢æˆ·ç«¯é€šè¿‡bindService onServiceConnectedè€ŒæœåŠ¡ç«¯é€šè¿‡message.replyToæ¥è·å¾—å¯¹æ–¹çš„Messengerã€‚Messengerä¸­æœ‰ä¸€ä¸ªHanlderä»¥ä¸²è¡Œçš„æ–¹å¼å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ä¸å­˜åœ¨å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬ä¸è€ƒè™‘çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p><h3 id="4-ä½¿ç”¨AIDL"><a href="#4-ä½¿ç”¨AIDL" class="headerlink" title="4.ä½¿ç”¨AIDL"></a>4.ä½¿ç”¨AIDL</h3><p>Messengeræ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯ï¼Œå¦‚æœå¤§é‡æ¶ˆæ¯åŒæ—¶å‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åªèƒ½ä¸€ä¸ªä¸€ä¸ªå¤„ç†ï¼Œæ‰€ä»¥å¤§é‡å¹¶å‘è¯·æ±‚å°±ä¸é€‚åˆç”¨Messengerï¼Œè€Œä¸”Messengeråªé€‚åˆä¼ é€’æ¶ˆæ¯ï¼Œä¸èƒ½è·¨è¿›ç¨‹è°ƒç”¨æ–¹æ³•çš„é—®é¢˜ï¼Œè¦çŸ¥é“Messengeræœ¬è´¨ä¸Šä¹Ÿæ˜¯AIDLï¼Œåªä¸è¿‡ç³»ç»Ÿåšäº†å°è£…æ–¹ä¾¿ä¸Šå±‚çš„è°ƒç”¨è€Œå·²ã€‚</p><p><strong>AIDLæ–‡ä»¶æ”¯æŒçš„æ•°æ®ç±»å‹</strong></p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼›</li><li>Stringå’ŒCharSequenceï¼›</li><li>ArrayListï¼Œé‡Œé¢çš„å…ƒç´ å¿…é¡»èƒ½å¤Ÿè¢«AIDLæ”¯æŒï¼›</li><li>HashMapï¼Œå®ç°Parcelableæ¥å£çš„å¯¹è±¡ï¼›æ³¨æ„ï¼šå¦‚æœAIDLæ–‡ä»¶ä¸­ç”¨åˆ°äº†è‡ªå®šä¹‰çš„Parcelableå¯¹è±¡ï¼Œå¿…é¡»æ–°å»ºä¸€ä¸ªå’Œå®ƒåŒåçš„AIDLæ–‡ä»¶ã€‚</li><li>AIDLï¼ŒAIDLæ¥å£æœ¬èº«ä¹Ÿå¯ä»¥åœ¨AIDLæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚<br><strong>æœåŠ¡ç«¯</strong><br>æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªServiceç”¨æ¥ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªAIDLæ–‡ä»¶ï¼Œå°†æš´éœ²ç»™å®¢æˆ·ç«¯çš„æ¥å£åœ¨è¿™ä¸ªAIDLæ–‡ä»¶ä¸­å£°æ˜ï¼Œæœ€ååœ¨Serviceä¸­å®ç°è¿™ä¸ªAIDLæ¥å£å³å¯ã€‚<br><strong>å®¢æˆ·ç«¯</strong><br>ç»‘å®šæœåŠ¡ç«¯çš„Serviceï¼Œç»‘å®šæˆåŠŸåï¼Œå°†æœåŠ¡ç«¯è¿”å›çš„Binderå¯¹è±¡è½¬æˆAIDLæ¥å£æ‰€å±çš„ç±»å‹ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨AIDLä¸­çš„æ–¹æ³•äº†ã€‚å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æ–¹æ³•ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•è¿è¡Œåœ¨æœåŠ¡ç«¯çš„Binderçº¿ç¨‹æ± ä¸­ï¼ŒåŒæ—¶å®¢æˆ·ç«¯çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå¦‚æœæœåŠ¡ç«¯æ–¹æ³•æ‰§è¡Œæ¯”è¾ƒè€—æ—¶ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯çº¿ç¨‹é•¿æ—¶é—´é˜»å¡ï¼Œå¯¼è‡´ANRã€‚å®¢æˆ·ç«¯çš„onServiceConnectedå’ŒonServiceDisconnectedæ–¹æ³•éƒ½åœ¨UIçº¿ç¨‹ä¸­ã€‚</li></ul><h2 id="5-Androidä¸­çš„AsyncTaskçš„ä½œç”¨ï¼Ÿ"><a href="#5-Androidä¸­çš„AsyncTaskçš„ä½œç”¨ï¼Ÿ" class="headerlink" title="5.Androidä¸­çš„AsyncTaskçš„ä½œç”¨ï¼Ÿ"></a>5.Androidä¸­çš„AsyncTaskçš„ä½œç”¨ï¼Ÿ</h2><h2 id="6-Androidä¸­çš„æ¶ˆæ¯æœºåˆ¶ï¼Ÿ"><a href="#6-Androidä¸­çš„æ¶ˆæ¯æœºåˆ¶ï¼Ÿ" class="headerlink" title="6.Androidä¸­çš„æ¶ˆæ¯æœºåˆ¶ï¼Ÿ"></a>6.Androidä¸­çš„æ¶ˆæ¯æœºåˆ¶ï¼Ÿ</h2><h2 id="7-Androidä¸­çš„äº‹ä»¶åˆ†å‘æœºåˆ¶äº†è§£å¤šå°‘ï¼Ÿå¦‚ä½•è§£å†³æ»‘åŠ¨å†²çª"><a href="#7-Androidä¸­çš„äº‹ä»¶åˆ†å‘æœºåˆ¶äº†è§£å¤šå°‘ï¼Ÿå¦‚ä½•è§£å†³æ»‘åŠ¨å†²çª" class="headerlink" title="7.Androidä¸­çš„äº‹ä»¶åˆ†å‘æœºåˆ¶äº†è§£å¤šå°‘ï¼Ÿå¦‚ä½•è§£å†³æ»‘åŠ¨å†²çª"></a>7.Androidä¸­çš„äº‹ä»¶åˆ†å‘æœºåˆ¶äº†è§£å¤šå°‘ï¼Ÿå¦‚ä½•è§£å†³æ»‘åŠ¨å†²çª</h2><h2 id="8-Javaä¸­çš„æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Ÿ"><a href="#8-Javaä¸­çš„æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="8.Javaä¸­çš„æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Ÿ"></a>8.Javaä¸­çš„æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Ÿ</h2><h3 id="ç†è§£æŠ½è±¡"><a href="#ç†è§£æŠ½è±¡" class="headerlink" title="ç†è§£æŠ½è±¡"></a>ç†è§£æŠ½è±¡</h3><p>abstract class å’Œ interface æ˜¯Javaè¯­è¨€ä¸­å¯¹äºæŠ½è±¡ç±»å®šä¹‰è¿›è¡Œæ”¯æŒçš„ä¸¤ç§æœºåˆ¶ï¼Œæ­£æ˜¯ç”±äºè¿™ä¸¤ç§æœºåˆ¶çš„å­˜åœ¨ï¼Œæ‰èµ‹äºˆäº†Javaå¼ºå¤§çš„é¢å‘å¯¹è±¡èƒ½åŠ›ã€‚abstract calsså’Œinterfaceä¹‹é—´å¯¹äºæŠ½è±¡ç±»å®šä¹‰çš„æ”¯æŒæ–¹é¢å…·æœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§ï¼Œç”šè‡³å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œå› æ­¤å¾ˆå¤šå¼€å‘è€…åœ¨è¿›è¡ŒæŠ½è±¡ç±»å®šä¹‰æ—¶å¯¹äºabstract classå’Œinterfaceçš„é€‰æ‹©æ˜¾å¾—æ¯”è¾ƒéšæ„ã€‚</p><p>å…¶å®ï¼Œä¸¤è€…ä¹‹é—´è¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œå¯¹äºå®ƒä»¬çš„é€‰æ‹©ç”šè‡³åæ˜ å‡ºå¯¹äºé—®é¢˜é¢†åŸŸæœ¬è´¨çš„ç†è§£ã€å¯¹äºè®¾è®¡æ„å›¾çš„ç†è§£æ˜¯å¦æ­£ç¡®ã€åˆç†ã€‚</p><h3 id="è¯­æ³•å®šä¹‰ç†è§£"><a href="#è¯­æ³•å®šä¹‰ç†è§£" class="headerlink" title="è¯­æ³•å®šä¹‰ç†è§£"></a>è¯­æ³•å®šä¹‰ç†è§£</h3><h4 id="1-æŠ½è±¡ç±»"><a href="#1-æŠ½è±¡ç±»" class="headerlink" title="1.æŠ½è±¡ç±»"></a>1.æŠ½è±¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>;</div><div class="line">  <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span></span>;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="2-æ¥å£"><a href="#2-æ¥å£" class="headerlink" title="2.æ¥å£"></a>2.æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Demo</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span></span>;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>åœ¨abstract classæ–¹å¼ä¸­ï¼ŒDemoå¯ä»¥æœ‰è‡ªå·±çš„æ•°æ®æˆå‘˜ï¼Œä¹Ÿå¯ä»¥æœ‰éabstarctçš„æˆå‘˜æ–¹æ³•ï¼Œè€Œåœ¨interfaceæ–¹å¼çš„å®ç°ä¸­ï¼ŒDemoåªèƒ½å¤Ÿæœ‰é™æ€çš„ä¸èƒ½è¢«ä¿®é¥°çš„æ•°æ®æˆå‘˜ï¼ˆä¹Ÿå°±æ˜¯å¿…é¡»æ˜¯<strong>static final</strong>çš„ï¼Œä¸è¿‡åœ¨interfaceä¸­ä¸€èˆ¬ä¸å®šä¹‰æ•°æ®æˆå‘˜ï¼‰ï¼Œæ‰€æœ‰çš„æˆå‘˜æ–¹æ³•éƒ½æ˜¯abstractçš„ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œinterfaceæ˜¯ä¸€ç§ç‰¹æ®Šå½¢å¼çš„abstract calssã€‚</p><h3 id="ç¼–ç¨‹è§’åº¦ç†è§£"><a href="#ç¼–ç¨‹è§’åº¦ç†è§£" class="headerlink" title="ç¼–ç¨‹è§’åº¦ç†è§£"></a>ç¼–ç¨‹è§’åº¦ç†è§£</h3><p>é¦–å…ˆï¼Œabstract classåœ¨Javaè¯­è¨€ä¸­è¡¨ç¤ºçš„æ˜¯ä¸€ç§ç»§æ‰¿å…³ç³»ï¼Œä¸€ä¸ªç±»åªèƒ½ä½¿ç”¨ä¸€æ¬¡ç»§æ‰¿å…³ç³»ã€‚ä½†æ˜¯ï¼Œä¸€ä¸ªç±»å´å¯ä»¥å®ç°å¤šä¸ªinterfaceã€‚ä¹Ÿè®¸ï¼Œè¿™æ˜¯Javaè¯­è¨€çš„è®¾è®¡è€…åœ¨è€ƒè™‘Javaå¯¹äºå¤šç»§æ‰¿çš„æ”¯æŒæ–¹é¢çš„ä¸€ç§æŠ˜ä¸­è€ƒè™‘å§ã€‚</p><p>å…¶æ¬¡ï¼Œåœ¨abstract classçš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥èµ‹äºˆæ–¹æ³•çš„é»˜è®¤è¡Œä¸ºã€‚</p><p>ä½†æ˜¯åœ¨interfaceçš„å®šä¹‰ä¸­ï¼Œæ–¹æ³•å´ä¸èƒ½æ‹¥æœ‰é»˜è®¤è¡Œä¸ºï¼Œä¸è¿‡åœ¨JDK1.8ä¸­å¯ä»¥ä½¿ç”¨<strong>default</strong>å…³é”®å­—å®ç°é»˜è®¤æ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InterfaceA</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;</div><div class="line">    System.out.println(<span class="string">"InterfaceA foo"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>åœ¨ Java 8 ä¹‹å‰ï¼Œæ¥å£ä¸å…¶å®ç°ç±»ä¹‹é—´çš„<strong>è€¦åˆåº¦</strong>å¤ªé«˜äº†ï¼ˆtightly coupledï¼‰ï¼Œå½“éœ€è¦ä¸ºä¸€ä¸ªæ¥å£æ·»åŠ æ–¹æ³•æ—¶ï¼Œæ‰€æœ‰çš„å®ç°ç±»éƒ½å¿…é¡»éšä¹‹ä¿®æ”¹ã€‚é»˜è®¤æ–¹æ³•è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥ä¸ºæ¥å£æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œè€Œä¸ä¼šç ´åå·²æœ‰çš„æ¥å£çš„å®ç°ã€‚è¿™åœ¨lambdaè¡¨è¾¾å¼ä½œä¸ºJava8è¯­è¨€çš„é‡è¦ç‰¹æ€§è€Œå‡ºç°ä¹‹é™…ï¼Œä¸ºå‡çº§æ—§æ¥å£ä¸”ä¿æŒå‘åå…¼å®¹ï¼ˆbackward compatibilityï¼‰æä¾›äº†é€”å¾„ã€‚</p><h3 id="ä¸€èˆ¬æ€§ç†è§£"><a href="#ä¸€èˆ¬æ€§ç†è§£" class="headerlink" title="ä¸€èˆ¬æ€§ç†è§£"></a>ä¸€èˆ¬æ€§ç†è§£</h3><p>æ¥å£å’ŒæŠ½è±¡ç±»çš„æ¦‚å¿µä¸ä¸€æ ·ã€‚æ¥å£æ˜¯å¯¹åŠ¨ä½œçš„æŠ½è±¡ï¼ŒæŠ½è±¡ç±»æ˜¯å¯¹æ ¹æºçš„æŠ½è±¡ã€‚ä»è®¾è®¡ç†å¿µä¸Šï¼Œæ¥å£åæ˜ çš„æ˜¯â€œlike-aâ€å…³ç³»ï¼ŒæŠ½è±¡ç±»åæ˜ çš„æ˜¯â€œis-aâ€å…³ç³»ã€‚æŠ½è±¡ç±»è¡¨ç¤ºçš„æ˜¯ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆã€‚æ¥å£è¡¨ç¤ºçš„æ˜¯ï¼Œè¿™ä¸ªå¯¹è±¡èƒ½åšä»€ä¹ˆã€‚æ¯”å¦‚ï¼Œç”·äººï¼Œå¥³äººï¼Œè¿™ä¸¤ä¸ªç±»ï¼ˆif they are classï¼‰ï¼Œä»–ä»¬çš„æŠ½è±¡ç±»æ˜¯äººã€‚è¯´æ˜ï¼Œä»–ä»¬éƒ½æ˜¯äººã€‚äººå¯ä»¥åƒä¸œè¥¿ï¼Œç‹—ä¹Ÿå¯ä»¥åƒä¸œè¥¿ï¼Œä½ å¯ä»¥æŠŠâ€œåƒä¸œè¥¿â€å®šä¹‰æˆä¸€ä¸ªæ¥å£ï¼Œç„¶åè®©è¿™äº›ç±»å»å®ç°å®ƒï¼Œæ‰€ä»¥ï¼Œåœ¨é«˜çº§è¯­è¨€ä¸Šï¼Œä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼ˆæŠ½è±¡ç±»ï¼‰ï¼ˆæ­£å¦‚äººä¸å¯èƒ½åŒæ—¶æ˜¯ç”Ÿç‰©å’Œéç”Ÿç‰©ï¼‰ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼ˆåƒé¥­æ¥å£ã€èµ°è·¯æ¥å£ï¼‰ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><pre><code>1.æŠ½è±¡ç±»å’Œæ¥å£éƒ½ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œå¦‚æœè¦å®ä¾‹åŒ–ï¼ŒæŠ½è±¡ç±»å˜é‡å¿…é¡»æŒ‡å‘å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•çš„å­ç±»å¯¹è±¡ï¼Œæ¥å£å˜é‡å¿…é¡»æŒ‡å‘å®ç°æ‰€æœ‰æ¥å£æ–¹æ³•çš„ç±»å¯¹è±¡ã€‚2.æŠ½è±¡ç±»è¦è¢«å­ç±»ç»§æ‰¿ï¼Œæ¥å£è¦è¢«ç±»å®ç°ã€‚3.æ¥å£é‡Œå®šä¹‰çš„å˜é‡åªèƒ½æ˜¯å…¬å…±çš„é™æ€çš„å¸¸é‡ï¼ŒæŠ½è±¡ç±»ä¸­çš„å˜é‡æ˜¯æ™®é€šå˜é‡ã€‚4.æŠ½è±¡ç±»é‡Œå¯ä»¥æ²¡æœ‰æŠ½è±¡æ–¹æ³•ã€‚5.æ¥å£å¯ä»¥è¢«ç±»å¤šå®ç°ï¼ˆè¢«å…¶ä»–æ¥å£å¤šç»§æ‰¿ï¼‰ï¼ŒæŠ½è±¡ç±»åªèƒ½è¢«å•ç»§æ‰¿ã€‚6.æ¥å£ä¸­æ²¡æœ‰ this æŒ‡é’ˆï¼Œæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä¸èƒ½æ‹¥æœ‰å®ä¾‹å­—æ®µï¼ˆå®ä¾‹å˜é‡ï¼‰æˆ–å®ä¾‹æ–¹æ³•ã€‚7.æŠ½è±¡ç±»ä¸èƒ½åœ¨Java 8çš„ lambda è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚</code></pre><h2 id="9-Javaè®¾è®¡æ¨¡å¼äº†è§£å¤šå°‘ï¼Ÿè§‚å¯Ÿè€…æ¨¡å¼åœ¨å“ªé‡Œä½¿ç”¨è¿‡ï¼Ÿ"><a href="#9-Javaè®¾è®¡æ¨¡å¼äº†è§£å¤šå°‘ï¼Ÿè§‚å¯Ÿè€…æ¨¡å¼åœ¨å“ªé‡Œä½¿ç”¨è¿‡ï¼Ÿ" class="headerlink" title="9.Javaè®¾è®¡æ¨¡å¼äº†è§£å¤šå°‘ï¼Ÿè§‚å¯Ÿè€…æ¨¡å¼åœ¨å“ªé‡Œä½¿ç”¨è¿‡ï¼Ÿ"></a>9.Javaè®¾è®¡æ¨¡å¼äº†è§£å¤šå°‘ï¼Ÿè§‚å¯Ÿè€…æ¨¡å¼åœ¨å“ªé‡Œä½¿ç”¨è¿‡ï¼Ÿ</h2><h2 id="10-æœ‰æ²¡æœ‰ç”¨è¿‡MVC-MVP-MVVMï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸMVPæ˜¯å¦‚ä½•ä½¿modelä¸viewè¿›è¡Œäº’é€šçš„ï¼Ÿ"><a href="#10-æœ‰æ²¡æœ‰ç”¨è¿‡MVC-MVP-MVVMï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸMVPæ˜¯å¦‚ä½•ä½¿modelä¸viewè¿›è¡Œäº’é€šçš„ï¼Ÿ" class="headerlink" title="10.æœ‰æ²¡æœ‰ç”¨è¿‡MVC\MVP\MVVMï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸMVPæ˜¯å¦‚ä½•ä½¿modelä¸viewè¿›è¡Œäº’é€šçš„ï¼Ÿ"></a>10.æœ‰æ²¡æœ‰ç”¨è¿‡MVC\MVP\MVVMï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸMVPæ˜¯å¦‚ä½•ä½¿modelä¸viewè¿›è¡Œäº’é€šçš„ï¼Ÿ</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¤§æ¦‚åœ¨æ•°å¤©å‰æŠ•é€’äº†å­—èŠ‚è·³åŠ¨-æŠ–éŸ³æ–¹å‘çš„å®ä¹ ç”Ÿå²—ä½&lt;br&gt;æ˜¨å¤©æ¥åˆ°äº†é¢è¯•é€šçŸ¥ï¼Œä»Šå¤©é¢è¯•åå¯¹æ¶‰åŠåˆ°çš„é—®é¢˜è¿›è¡Œä¸€ä¸ªå¤ç›˜ã€‚ï¼ˆå­—èŠ‚è·³åŠ¨æœç„¶åä¸è™šä¼ â€¦é¢è¯•å®˜ç›¸å½“äº²åˆ‡ä¸”å–„äºå¾ªå¾ªå–„è¯±æ¥å¼•å¯¼æˆ‘å›ç­”é—®é¢˜ï¼‰&lt;/p&gt;
&lt;h2 id=&quot;1-Javaä¸­çš„å¼•ç”¨ç±»å‹æœ‰æ²¡æœ‰ä»€ä¹ˆäº†è§£ï¼Ÿ&quot;&gt;&lt;a href=&quot;#
      
    
    </summary>
    
    
      <category term="Interview" scheme="https://edward7zhang.github.io/tags/Interview/"/>
    
  </entry>
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ æ¨¡å‹çš„è½¬æ¢ [å­¦ä¹ &amp;è½¬è½½]</title>
    <link href="https://edward7zhang.github.io/2019/01/26/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BD%AC%E6%8D%A2/"/>
    <id>https://edward7zhang.github.io/2019/01/26/æ·±åº¦å­¦ä¹ æ¨¡å‹çš„è½¬æ¢/</id>
    <published>2019-01-26T11:07:14.000Z</published>
    <updated>2019-01-26T14:04:00.096Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºå„ç§æ·±åº¦å­¦ä¹ æ¡†æ¶çš„å±‚å‡ºä¸ç©·ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œç®—æ³•å¼€å‘åˆ°ç®—æ³•éƒ¨ç½²çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éƒ½éœ€è¦ç”¨åˆ°ä¸åŒçš„æ¡†æ¶ã€‚ä¾‹å¦‚æˆ‘ä»¬å¾ˆæœ‰å¯èƒ½ä½¿ç”¨tensorflow,pytorchç­‰è¿›è¡Œç®—æ³•å¼€å‘å’Œè°ƒè¯•ï¼Œåœ¨æ—©æœŸå·¥ç¨‹inferenceçš„æ—¶å€™æˆ‘ä»¬å¾€å¾€ä½¿ç”¨è¾ƒä¸ºè½»é‡çš„caffeæˆ–è€…é­”æ”¹åçš„caffeã€‚åˆ°äº†ç§»åŠ¨ç«¯éƒ¨ç½²æˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨feather CNN nihuiçš„NCNNæˆ–è€…å°ç±³çš„maceç­‰æ¡†æ¶ã€‚facebook ONNXçš„å‡ºç°ä¸ºæ¨¡å‹çš„è½¬æ¢æä¾›äº†ä¸€ç§æ€è·¯ï¼Œä½†é™¤äº†pytorchç­‰æ¡†æ¶èƒ½å¾ˆå¥½çš„æ”¯æŒONNXã€‚å…¶ä»–ç­‰æ¡†æ¶å¹¶æœªå¾ˆå¥½çš„å¯¹æ¥ONNXã€‚åœ¨<a href="https://github.com/Microsoft/MMdnn" target="_blank" rel="external">MMdnn</a>å‡ºç°ä¹‹å‰ï¼Œå¤§å®¶éƒ½æŠŠcaffemodelä½œä¸ºä¸€ä¸ªä¸­é—´ä½“æ¥è¿›è¡Œè½¬æ¢ã€‚</p><p>å…¶å®å°±æ¨¡å‹è½¬æ¢è€Œè¨€åªæ˜¯ä¸ªå¡«å‚æ•°çš„è¿‡ç¨‹ï¼ŒæŠŠæ¨¡å‹ç»“æ„æ­å¥½ï¼ŒæŠŠå‚æ•°å¡«è¿›å»å°±å³å¯ï¼Œä½†æ˜¯å®è·µè¿‡çš„æœ‹å‹å¤§å®¶ä¸€å®šä¼šçŸ¥é“è¿™å…¶ä¸­å­˜åœ¨ä¸å°‘å‘ï¼Œä½†æ˜¯æˆ‘ä»¬æ›´å¸Œæœ›æœ‰ä¸€ç§è‡ªåŠ¨åŒ–çš„æ¨¡å‹è½¬æ¢æ–¹æ¡ˆæ¥è¿›è¡Œæ¨¡å‹è½¬æ¢ã€‚</p><p><a href="https://github.com/Microsoft/MMdnn" target="_blank" rel="external">MMdnn</a>çš„å‡ºç°ä¸ºæ¨¡å‹è½¬æ¢å¸¦æ¥äº†ä¸å°‘çš„ç¦éŸ³ï¼Œ<a href="https://github.com/Microsoft/MMdnn" target="_blank" rel="external">MMdnn</a>æä¾›äº†ä¸€ç§IR(ä¸­é—´è¡¨ç¤º)æ¥æ¥è¡”æ¥å„ä¸ªæ¨¡å‹ä¹‹é—´çš„è½¬æ¢ã€‚ä»–å›Šæ‹¬å¹¶æ”¯æŒäº†ä¸»æµçš„DNNæ¡†æ¶ã€‚</p><p>ä¸‹é¢æˆ‘å°±ç®€è¦è®²ä¸€ä¸‹å‡ ä¸ªçš„ç®€å•æ¨¡å‹è½¬æ¢</p><p>åœ¨æ­¤æˆ‘æ¨èä¸€ä¸ªæŸ¥çœ‹æ¨¡å‹ç»“æ„çš„å·¥å…·<a href="https://github.com/lutzroeder/Netron" target="_blank" rel="external">Netron</a> æ”¯æŒæ•°ç§ä¸»æµæ·±åº¦å­¦ä¹ æ¡†æ¶(Caffe,Tensorflow,ONNXç­‰)çš„æ¨¡å‹ç»“æ„æŸ¥çœ‹ã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾æ˜¯MTCNN Pnetçš„æ¨¡å‹ç»“æ„å›¾</p><p><img src="https://i.loli.net/2019/01/09/5c35f0ad3eaf1.png" alt="det1.png"></p><h3 id="MMdnnçš„å®‰è£…"><a href="#MMdnnçš„å®‰è£…" class="headerlink" title="MMdnnçš„å®‰è£…"></a>MMdnnçš„å®‰è£…</h3><p><a href="https://github.com/Microsoft/MMdnn" target="_blank" rel="external">MMdnn</a>çš„å®‰è£…éå¸¸ç®€å•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install mmdnn</div></pre></td></tr></table></figure><h4 id="è½¬æ¢ä¸­çš„ä¸€äº›å‘"><a href="#è½¬æ¢ä¸­çš„ä¸€äº›å‘" class="headerlink" title="è½¬æ¢ä¸­çš„ä¸€äº›å‘"></a>è½¬æ¢ä¸­çš„ä¸€äº›å‘</h4><h5 id="1-å¹¶ä¸æ˜¯æ‰€æœ‰Layerå’Œæ‰€æœ‰ç½‘ç»œéƒ½æ”¯æŒè½¬æ¢"><a href="#1-å¹¶ä¸æ˜¯æ‰€æœ‰Layerå’Œæ‰€æœ‰ç½‘ç»œéƒ½æ”¯æŒè½¬æ¢" class="headerlink" title="1.å¹¶ä¸æ˜¯æ‰€æœ‰Layerå’Œæ‰€æœ‰ç½‘ç»œéƒ½æ”¯æŒè½¬æ¢"></a>1.å¹¶ä¸æ˜¯æ‰€æœ‰Layerå’Œæ‰€æœ‰ç½‘ç»œéƒ½æ”¯æŒè½¬æ¢</h5><p>ç”±äºå„ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ä¹‹é—´çš„è®¾è®¡æ¨¡å¼ä¸åŒæœ‰çš„æ˜¯åŸºäºå‘½ä»¤å¼çš„æœ‰çš„æ˜¯åŸºäºç¬¦å·å½¢å¼çš„ã€‚å„ä¸ªæ¡†æ¶ä¹‹é—´çš„opçš„ç²’åº¦ä¸åŒï¼Œåˆç”±äºæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œæ”¯æŒæ‰€æœ‰æ¡†æ¶ä¹‹é—´çš„è½¬æ¢æ˜¯ä¸€ä»¶éå¸¸éš¾çš„äº‹æƒ…ã€‚MMdnnä¹Ÿåªæ˜¯æŠŠä¸€äº›æä¾›çš„å¸¸ç”¨çš„opï¼Œå¦‚conv,poolingç­‰å¸¸è§„opã€‚</p><h5 id="2-Tensorflowä¸caffeçš„paddingæ–¹å¼å¹¶ä¸ç›¸åŒ"><a href="#2-Tensorflowä¸caffeçš„paddingæ–¹å¼å¹¶ä¸ç›¸åŒ" class="headerlink" title="2.Tensorflowä¸caffeçš„paddingæ–¹å¼å¹¶ä¸ç›¸åŒ"></a>2.Tensorflowä¸caffeçš„paddingæ–¹å¼å¹¶ä¸ç›¸åŒ</h5><p>è¿™ä¸ªé—®é¢˜ä¼šå‡ºç°åœ¨MobileNetåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºTensorflowçš„paddingæ–¹å¼å’Œå…¶ä»–æ¡†æ¶æ˜¯ä¸åŒçš„ã€‚Tensorflowæ ‡å‡†çš„å·ç§¯æ“ä½œé€šå¸¸é‡‡ç”¨éå¯¹ç§°çš„paddingï¼Œè€Œcaffeç­‰å…¶ä»–æ¡†æ¶çš„å·ç§¯æ“ä½œåˆ™æ˜¯é‡‡ç”¨å¯¹ç§°çš„paddingã€‚</p><p>å¦‚ä¸‹å›¾ ï¼Œæ¯”å¦‚å½“ å·ç§¯æ ¸çš„å¤§å°ä¸º3x3 strideä¸º2çš„æ—¶å€™ã€‚å°½ç®¡ä»–ä»¬çš„paddingæ–¹å¼ä¸åŒï¼Œä½†å·ç§¯ä¹‹åçš„å°ºå¯¸ç¡®æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://github.com/Microsoft/MMdnn/wiki/image/mobilenet1.png" alt="img" title="">                </div>                <div class="image-caption">img</div>            </figure><h4 id="è½¬æ¢æ­¥éª¤"><a href="#è½¬æ¢æ­¥éª¤" class="headerlink" title="è½¬æ¢æ­¥éª¤"></a>è½¬æ¢æ­¥éª¤</h4><p>ä¾‹å¦‚ç°åœ¨æˆ‘ä»¬æƒ³æŠŠMTCNNçš„Keras Pnetè½¬åŒ–æˆcaffeodelç”¨äºéƒ¨ç½²ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mmtoir -f keras -w pnet.h5 -o pnet</div></pre></td></tr></table></figure><p>æŠŠkerasæ¨¡å‹è½¬åŒ–æˆMMdnn IRä¸­é—´è¡¨ç¤ºï¼Œåœ¨å½“ç„¶ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª.npy çš„weightsæ–‡ä»¶å’Œä¸€ä¸ª.pbæ–‡ä»¶ã€‚æ¥ç€ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mmtomodel -f caffe -in pnet -iw pnet.npy -o pnet</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç”±äºå„ç§æ·±åº¦å­¦ä¹ æ¡†æ¶çš„å±‚å‡ºä¸ç©·ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œç®—æ³•å¼€å‘åˆ°ç®—æ³•éƒ¨ç½²çš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éƒ½éœ€è¦ç”¨åˆ°ä¸åŒçš„æ¡†æ¶ã€‚ä¾‹å¦‚æˆ‘ä»¬å¾ˆæœ‰å¯èƒ½ä½¿ç”¨tensorflow,pytorchç­‰è¿›è¡Œç®—æ³•å¼€å‘å’Œè°ƒè¯•ï¼Œåœ¨æ—©æœŸå·¥ç¨‹inferenceçš„æ—¶å€™æˆ‘ä»¬å¾€å¾€ä½¿ç”¨è¾ƒä¸ºè½»é‡çš„caffeæˆ–è€…é­”æ”¹åçš„caffeã€‚åˆ°äº†ç§»åŠ¨ç«¯
      
    
    </summary>
    
    
      <category term="DeepLearning" scheme="https://edward7zhang.github.io/tags/DeepLearning/"/>
    
  </entry>
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ ç»å…¸å·ç§¯ç¥ç»ç½‘ç»œ [å­¦ä¹ &amp;è½¬è½½]</title>
    <link href="https://edward7zhang.github.io/2019/01/16/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%BB%8F%E5%85%B8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    <id>https://edward7zhang.github.io/2019/01/16/æ·±åº¦å­¦ä¹ ç»å…¸å·ç§¯ç¥ç»ç½‘ç»œ/</id>
    <published>2019-01-16T11:07:14.000Z</published>
    <updated>2019-01-26T14:03:30.420Z</updated>
    
    <content type="html"><![CDATA[<p>éšç€æ·±åº¦å­¦ä¹ çš„å‘å±•ï¼Œç ”ç©¶äººå‘˜æå‡ºäº†å¾ˆå¤šæ¨¡å‹ï¼Œè¿™å…¶ä¸­ä¸€äº›è®¾è®¡æ–¹å¼ï¼Œåœ¨å½“æ—¶å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœï¼Œä¹Ÿä¸ºå…¶ä»–ç§‘ç ”å·¥ä½œè€…æä¾›äº†å¾ˆå¥½çš„æ€è·¯ã€‚CNN çš„ç»å…¸ç»“æ„å§‹äº1998å¹´çš„LeNet-5ï¼Œæˆäº2012å¹´å†å²æ€§çš„AlexNetï¼Œä»æ­¤å¹¿æ³›ç”¨äºå›¾åƒç›¸å…³é¢†åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><pre><code>1.LeNet-5, 1998å¹´2.AlexNet, 2012å¹´3.ZF-Net, 2013å¹´4.GoogleNet, 2014å¹´5.VGG, 2014å¹´6.ResNet, 2015å¹´</code></pre><p>ç»è¿‡ç§‘ç ”å·¥ä½œè€…çš„åå¤éªŒè¯åŠå¹¿æ³›ä½¿ç”¨ï¼Œè¿™äº›æ¨¡å‹é€æ¸æˆä¸ºç»å…¸ï¼Œæˆ‘ä»¬è¿™é‡Œæ”¶é›†äº†ä¸€äº›å¸¸ç”¨çš„æ¨¡å‹è¿›è¡Œä»‹ç»ã€‚</p><h3 id="1-VGG"><a href="#1-VGG" class="headerlink" title="1. VGG"></a>1. VGG</h3><p><a href="https://arxiv.org/abs/1409.1556" target="_blank" rel="external">è®ºæ–‡åœ°å€</a></p><p>VGGNetæ˜¯ç‰›æ´¥å¤§å­¦è®¡ç®—æœºè§†è§‰ç»„ï¼ˆVisual Geometry Groupï¼‰å’Œ Google DeepMind å…¬å¸çš„ç ”ç©¶å‘˜ä¸€èµ·ç ”å‘çš„çš„æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œã€‚VGGNet æ¢ç´¢äº†å·ç§¯ç¥ç»ç½‘ç»œçš„æ·±åº¦ä¸å…¶æ€§èƒ½ä¹‹é—´çš„å…³ç³»ï¼Œä¸€å…±æœ‰å…­ç§ä¸åŒçš„ç½‘ç»œç»“æ„ï¼Œä½†æ˜¯æ¯ç§ç»“æ„éƒ½æœ‰å«æœ‰ï¼•ç»„å·ç§¯ï¼Œæ¯ç»„å·ç§¯éƒ½ä½¿ç”¨ï¼“ï½˜ï¼“çš„å·ç§¯æ ¸ï¼Œæ¯ç»„å·ç§¯åè¿›è¡Œä¸€ä¸ªï¼’ï½˜ï¼’æœ€å¤§æ± åŒ–ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸‰ä¸ªå…¨è¿æ¥å±‚ã€‚åœ¨è®­ç»ƒé«˜çº§åˆ«çš„ç½‘ç»œæ—¶ï¼Œå¯ä»¥å…ˆè®­ç»ƒä½çº§åˆ«çš„ç½‘ç»œï¼Œç”¨å‰è€…è·å¾—çš„æƒé‡åˆå§‹åŒ–é«˜çº§åˆ«çš„ç½‘ç»œï¼Œå¯ä»¥åŠ é€Ÿç½‘ç»œçš„æ”¶æ•›ã€‚VGGNet ç›¸æ¯”ä¹‹å‰state-of-the-artçš„ç½‘ç»œç»“æ„ï¼Œé”™è¯¯ç‡å¤§å¹…ä¸‹é™ï¼Œå¹¶å–å¾—äº†ILSVRC 2014æ¯”èµ›åˆ†ç±»é¡¹ç›®çš„ç¬¬2åå’Œå®šä½é¡¹ç›®çš„ç¬¬1åã€‚åŒæ—¶VGGNetçš„æ‹“å±•æ€§å¾ˆå¼ºï¼Œè¿ç§»åˆ°å…¶ä»–å›¾ç‰‡æ•°æ®ä¸Šçš„æ³›åŒ–æ€§éå¸¸å¥½ã€‚VGGNetçš„ç»“æ„éå¸¸ç®€æ´ï¼Œæ•´ä¸ªç½‘ç»œéƒ½ä½¿ç”¨äº†åŒæ ·å¤§å°çš„å·ç§¯æ ¸å°ºå¯¸ï¼ˆ3<em>3ï¼‰å’Œæœ€å¤§æ± åŒ–å°ºå¯¸ï¼ˆ2</em>2ï¼‰ã€‚<br>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒVGGNetä¾ç„¶ç»å¸¸è¢«ç”¨æ¥æå–å›¾åƒç‰¹å¾ã€‚</p><p><a href="https://blog.csdn.net/marsjhao/article/details/72955935" target="_blank" rel="external">ç»å…¸å·ç§¯ç¥ç»ç½‘ç»œä¹‹VGGNet</a></p><p><a href="https://blog.csdn.net/qq_40027052/article/details/79015827" target="_blank" rel="external">VGGæ¨¡å‹æ ¸å¿ƒæ‹†è§£</a></p><h3 id="2-GoogLeNet"><a href="#2-GoogLeNet" class="headerlink" title="2. GoogLeNet"></a>2. GoogLeNet</h3><p><a href="http://arxiv.org/abs/1409.4842" target="_blank" rel="external">[v1] Going Deeper with Convolutions</a></p><p><a href="http://arxiv.org/abs/1502.03167" target="_blank" rel="external">[v2] Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift</a></p><p><a href="http://arxiv.org/abs/1512.00567" target="_blank" rel="external">[v3] Rethinking the Inception Architecture for Computer Vision</a> </p><p><a href="http://arxiv.org/abs/1602.07261" target="_blank" rel="external">[v4] Inception-v4, Inception-ResNet and the Impact of Residual Connections on Learning</a></p><p>GoogLeNetçš„æœ€æ—©ç‰ˆæœ¬ï¼Œå‡ºç°åœ¨2014å¹´çš„â€ Going deeper with convolutions â€œã€‚ä¹‹æ‰€ä»¥åä¸º â€œGoogLeNetâ€ è€Œé â€œGoogleNetâ€ ,æ–‡ç« è¯´æ˜¯ä¸ºäº†å‘æ—©æœŸçš„LeNetè‡´æ•¬ã€‚GoogleNetæå‡ºäº†ä¸€ä¸ªå…¨æ–°çš„æ·±åº¦ CNN æ¶æ„â€”â€”Inceptionï¼Œæ— å…¨è¿æ¥å±‚ï¼Œå¯ä»¥èŠ‚çœè¿ç®—çš„åŒæ—¶ï¼Œå‡å°‘äº†å¾ˆå¤šå‚æ•°ï¼Œå‚æ•°æ•°é‡æ˜¯AlexNetçš„1/12ï¼Œæ•°é‡åªæœ‰5 millionï¼Œè€Œä¸”åœ¨ImageNetç«èµ›ä¸­å–å¾—äº†å¾ˆå¥½çš„æˆç»©ã€‚</p><p><a href="https://blog.csdn.net/cdknight_happy/article/details/79247280" target="_blank" rel="external">GoogleNetç³»åˆ—è®ºæ–‡å­¦ä¹ </a></p><h3 id="3-Resnet"><a href="#3-Resnet" class="headerlink" title="3. Resnet"></a>3. Resnet</h3><p><a href="https://arxiv.org/abs/1512.03385" target="_blank" rel="external">è®ºæ–‡åœ°å€</a></p><p>ResNetåœ¨2015å¹´è¢«æå‡ºï¼Œåœ¨ImageNetæ¯”èµ›classificationä»»åŠ¡ä¸Šè·å¾—ç¬¬ä¸€åï¼Œå› ä¸ºå®ƒ â€œç®€å•ä¸å®ç”¨â€ å¹¶å­˜ï¼Œä¹‹åå¾ˆå¤šæ–¹æ³•éƒ½å»ºç«‹åœ¨ResNet50æˆ–è€…ResNet101çš„åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œæ£€æµ‹ï¼Œåˆ†å‰²ï¼Œè¯†åˆ«ç­‰é¢†åŸŸéƒ½çº·çº·ä½¿ç”¨ResNetï¼Œå…·æœ‰å¾ˆå¼ºçš„é€‚åº”æ€§ã€‚ResNetçš„ä½œè€…<a href="http://kaiminghe.com/" target="_blank" rel="external">ä½•å‡¯æ˜</a>ä¹Ÿå› æ­¤æ‘˜å¾—CVPR2016æœ€ä½³è®ºæ–‡å¥–ã€‚</p><p><a href="https://blog.csdn.net/lanran2/article/details/79057994" target="_blank" rel="external">ResNetè§£æ</a></p><p><a href="https://blog.csdn.net/xxy0118/article/details/78324256" target="_blank" rel="external">ResNetå­¦ä¹ </a></p><h3 id="4-MobileNet-V1-amp-MobileNet-V2"><a href="#4-MobileNet-V1-amp-MobileNet-V2" class="headerlink" title="4. MobileNet-V1 &amp; MobileNet -V2"></a>4. MobileNet-V1 &amp; MobileNet -V2</h3><p><a href="https://arxiv.org/abs/1704.04861" target="_blank" rel="external">V1è®ºæ–‡åœ°å€</a></p><p><a href="https://arxiv.org/abs/1801.04381" target="_blank" rel="external">V2è®ºæ–‡åœ°å€</a></p><p>MobileNetæ˜¯Googleå›¢é˜Ÿé’ˆå¯¹ç§»åŠ¨ç«¯æå‡ºçš„é«˜æ•ˆå›¾åƒè¯†åˆ«ç½‘ç»œï¼Œæ·±å…¥çš„ç ”ç©¶äº†Depthwise Separable Convolutionsä½¿ç”¨æ–¹æ³•åè®¾è®¡å‡ºMobileNetï¼ŒDepthwise Separable Convolutionsçš„æœ¬è´¨æ˜¯å†—ä½™ä¿¡æ¯æ›´å°‘çš„ç¨€ç–åŒ–è¡¨è¾¾ã€‚åœ¨æ­¤åŸºç¡€ä¸Šç»™å‡ºäº†é«˜æ•ˆæ¨¡å‹è®¾è®¡çš„ä¸¤ä¸ªé€‰æ‹©ï¼šå®½åº¦å› å­(Width Multiplier)å’Œåˆ†è¾¨ç‡å› å­(Resolution Multiplier)ï¼›é€šè¿‡æƒè¡¡å¤§å°ã€å»¶è¿Ÿæ—¶é—´ä»¥åŠç²¾åº¦ï¼Œæ¥æ„å»ºè§„æ¨¡æ›´å°ã€é€Ÿåº¦æ›´å¿«çš„MobileNetã€‚</p><p>MobileNet V2æ˜¯ä¹‹å‰MobileNet V1çš„æ”¹è¿›ç‰ˆã€‚MobileNet V1ä¸­ä¸»è¦æ˜¯å¼•å…¥äº†Depthwise Separable Convolutionä»£æ›¿ä¼ ç»Ÿçš„å·ç§¯æ“ä½œï¼Œç›¸å½“äºå®ç°äº†spatialå’Œchannelä¹‹é—´çš„è§£è€¦ï¼Œè¾¾åˆ°æ¨¡å‹åŠ é€Ÿçš„ç›®çš„ï¼Œæ•´ä½“ç½‘ç»œç»“æ„è¿˜æ˜¯å»¶ç»­äº†VGGç½‘ç»œç›´ä¸Šç›´ä¸‹çš„ç‰¹ç‚¹ã€‚å’ŒMobileNet V1ç›¸æ¯”ï¼ŒMobileNet V2ä¸»è¦çš„æ”¹è¿›æœ‰ä¸¤ç‚¹ï¼š1ã€Linear Bottlenecksã€‚ä¹Ÿå°±æ˜¯å»æ‰äº†å°ç»´åº¦è¾“å‡ºå±‚åé¢çš„éçº¿æ€§æ¿€æ´»å±‚ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚2ã€Inverted Residual blockã€‚è¯¥ç»“æ„å’Œä¼ ç»Ÿresidual blockä¸­ç»´åº¦å…ˆç¼©å‡å†æ‰©å¢æ­£å¥½ç›¸åï¼Œå› æ­¤shotcutä¹Ÿå°±å˜æˆäº†è¿æ¥çš„æ˜¯ç»´åº¦ç¼©å‡åçš„feature mapã€‚</p><p><a href="https://blog.csdn.net/t800ghb/article/details/78879612" target="_blank" rel="external">æ·±åº¦è§£è¯»è°·æ­ŒMobileNet</a></p><p><a href="https://blog.csdn.net/u011995719/article/details/79135818" target="_blank" rel="external">è½»é‡åŒ–ç½‘ç»œï¼šMobileNet-V2</a></p><h3 id="5-U-NET"><a href="#5-U-NET" class="headerlink" title="5. U-NET"></a>5. U-NET</h3><p><a href="http://arxiv.org/abs/1505.04597" target="_blank" rel="external">è®ºæ–‡åœ°å€</a></p><p><a href="https://lmb.informatik.uni-freiburg.de/people/ronneber/u-net/" target="_blank" rel="external">é¡¹ç›®åœ°å€</a></p><p>è¿™æ˜¯Encoder-Decoderç½‘ç»œçš„ä¸€ç§ï¼Œåœ¨æ— ç›‘ç£å­¦ä¹ ä¸­çš„æ¡†æ¶ï¼Œåˆ©ç”¨convä¸deconvé™ç»´å‡ç»´æ¥è¿›è¡Œå­¦ä¹ ï¼Œåˆ†åˆ«å«åšencoderä¸decoderç¼–ç è§£ç ï¼Œä¸€èˆ¬åŸºäºå·ç§¯ç½‘ç»œï¼Œencoderåç›¸å½“äºå­¦ä¹ åˆ°äº†ç‰¹å¾ï¼Œè€Œdecoderåç›¸å½“äºè¿˜åŸäº†å›¾åƒï¼Œæ—¢å¯ä»¥ç”¨è¾“å…¥å›¾åƒè¿›è¡Œè®­ç»ƒï¼Œè®­ç»ƒå¥½ä¸€å±‚åŠ æ·±ä¸€å±‚ã€‚å†å¯ä»¥åˆ©ç”¨æœ‰ç›‘ç£å¾®è°ƒï¼Œä»è€Œè¾¾åˆ°åˆ†ç±»æˆ–è€…å›¾åƒè½¬æ¢çš„ç›®çš„ã€‚</p><h3 id="6-GAN"><a href="#6-GAN" class="headerlink" title="6. GAN"></a>6. GAN</h3><p>æ€»ç»“ï¼šåˆ©ç”¨ä¸¤ä¸ªç½‘ç»œå¯¹æŠ—ç”Ÿæˆæ¨¡å‹ï¼Œç”Ÿæˆå™¨ä¸è¾¨åˆ«å™¨ï¼Œç”Ÿæˆå™¨è¾“å…¥å›¾åƒï¼Œç”Ÿæˆæ‰€éœ€å›¾åƒï¼Œè¾¨åˆ«å™¨è¾¨åˆ«æ‰€éœ€å›¾åƒä¸ç”Ÿæˆå›¾åƒï¼Œä½¿ç”Ÿæˆå™¨çš„ç”Ÿæˆå›¾åƒéª—è¿‡è¾¨åˆ«å™¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;éšç€æ·±åº¦å­¦ä¹ çš„å‘å±•ï¼Œç ”ç©¶äººå‘˜æå‡ºäº†å¾ˆå¤šæ¨¡å‹ï¼Œè¿™å…¶ä¸­ä¸€äº›è®¾è®¡æ–¹å¼ï¼Œåœ¨å½“æ—¶å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœï¼Œä¹Ÿä¸ºå…¶ä»–ç§‘ç ”å·¥ä½œè€…æä¾›äº†å¾ˆå¥½çš„æ€è·¯ã€‚CNN çš„ç»å…¸ç»“æ„å§‹äº1998å¹´çš„LeNet-5ï¼Œæˆäº2012å¹´å†å²æ€§çš„AlexNetï¼Œä»æ­¤å¹¿æ³›ç”¨äºå›¾åƒç›¸å…³é¢†åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;co
      
    
    </summary>
    
    
      <category term="DeepLearning" scheme="https://edward7zhang.github.io/tags/DeepLearning/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸ç”¨æ·±åº¦å­¦ä¹ æ¡†æ¶[å­¦ä¹ &amp;è½¬è½½]</title>
    <link href="https://edward7zhang.github.io/2019/01/09/%E5%B8%B8%E8%A7%81%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6/"/>
    <id>https://edward7zhang.github.io/2019/01/09/å¸¸è§æ·±åº¦å­¦ä¹ æ¡†æ¶/</id>
    <published>2019-01-09T11:07:14.000Z</published>
    <updated>2019-01-09T12:55:52.270Z</updated>
    
    <content type="html"><![CDATA[<p>æ·±åº¦å­¦ä¹ ç ”ç©¶çš„çƒ­æ½®æŒç»­é«˜æ¶¨ï¼Œå„ç§å¼€æºæ·±åº¦å­¦ä¹ æ¡†æ¶ä¹Ÿå±‚å‡ºä¸ç©·ï¼Œå…¶ä¸­åŒ…æ‹¬TensorFlowã€Caffeã€Kerasã€CNTKã€Torch7ã€MXNetã€Leafã€Theanoã€DeepLearning4ã€Lasagneã€Neonç­‰ã€‚æˆ‘ä»¬å‚è€ƒå¼€æºçš„æµ‹è¯•ç»“æœï¼Œç»“åˆè‡ªå·±æ•´ç†çš„æ•°æ®ï¼Œé’ˆå¯¹ä¸»æµçš„æ·±åº¦å­¦ä¹ æ¡†æ¶è¿›è¡Œç®€å•å¯¹æ¯”åŠä»‹ç»ã€‚</p><table><thead><tr><th>æ¡†æ¶</th><th>æœºæ„</th><th>æ”¯æŒè¯­è¨€</th><th>Stars</th><th>Forks</th></tr></thead><tbody><tr><td><a href="https://github.com/BVLC/caffe" target="_blank" rel="external">Caffe</a></td><td>BVLC</td><td>C++/Python/Matlab</td><td>25480</td><td>15560</td></tr><tr><td><a href="https://github.com/Microsoft/CNTK" target="_blank" rel="external">CNTK</a></td><td>Microsoft</td><td>C++</td><td>15083</td><td>4020</td></tr><tr><td><a href="notebooks/Keras_TF_CNN.ipynb">Keras</a></td><td>Fchollet</td><td>Python</td><td>33332</td><td>12563</td></tr><tr><td><a href="https://github.com/tensorflow/tensorflow" target="_blank" rel="external">Tensorflow</a></td><td>Google</td><td>Python/C++/Goâ€¦</td><td>109115</td><td>67339</td></tr><tr><td><a href="https://github.com/apache/incubator-mxnet" target="_blank" rel="external">MXNet</a></td><td>DMLC</td><td>Python/C++/Râ€¦</td><td>15162</td><td>5484</td></tr><tr><td><a href="https://github.com/pytorch/pytorch" target="_blank" rel="external">PyTorch</a></td><td>Facebook</td><td>Python</td><td>18517</td><td>4426</td></tr></tbody></table><h3 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h3><h4 id="1-è®­ç»ƒæ—¶é—´-Network-DenseNet-121-Multi-GPU"><a href="#1-è®­ç»ƒæ—¶é—´-Network-DenseNet-121-Multi-GPU" class="headerlink" title="1. è®­ç»ƒæ—¶é—´: Network DenseNet-121 (Multi-GPU)"></a>1. è®­ç»ƒæ—¶é—´: Network DenseNet-121 (Multi-GPU)</h4><p><strong>è¿è¡Œäº SSD ç¡¬ç›˜</strong></p><table><thead><tr><th>æ¡†æ¶</th><th style="text-align:center">1xV100/CUDA 9/CuDNN 7</th><th style="text-align:center">4xV100/CUDA 9/CuDNN 7</th></tr></thead><tbody><tr><td>Pytorch</td><td style="text-align:center">27min</td><td style="text-align:center">10min</td></tr><tr><td>Keras(TF)</td><td style="text-align:center">38min</td><td style="text-align:center">18min</td></tr><tr><td>Tensorflow</td><td style="text-align:center">33min</td><td style="text-align:center">22min</td></tr><tr><td>MXNet(Gluon)</td><td style="text-align:center">29min</td><td style="text-align:center">10min</td></tr></tbody></table><p><strong>è¿è¡ŒäºRAMå†…å­˜ä¸­</strong></p><table><thead><tr><th>æ¡†æ¶</th><th style="text-align:center">1xV100/CUDA 9/CuDNN 7</th><th style="text-align:center">4xV100/CUDA 9/CuDNN 7</th></tr></thead><tbody><tr><td>Pytorch</td><td style="text-align:center">25min</td><td style="text-align:center">8min</td></tr><tr><td>Keras(TF)</td><td style="text-align:center">36min</td><td style="text-align:center">15min</td></tr><tr><td>Tensorflow</td><td style="text-align:center">25min</td><td style="text-align:center">14min</td></tr><tr><td>MXNet(Gluon)</td><td style="text-align:center">28min</td><td style="text-align:center">8min</td></tr></tbody></table><h4 id="2-1000å¼ å›¾ç‰‡æ¨ç†æ—¶é—´-s-Network-ResNet-50"><a href="#2-1000å¼ å›¾ç‰‡æ¨ç†æ—¶é—´-s-Network-ResNet-50" class="headerlink" title="2. 1000å¼ å›¾ç‰‡æ¨ç†æ—¶é—´(s): Network ResNet-50"></a>2. 1000å¼ å›¾ç‰‡æ¨ç†æ—¶é—´(s): Network ResNet-50</h4><table><thead><tr><th>æ¡†æ¶</th><th style="text-align:center">K80/CUDA 8/CuDNN 6</th><th style="text-align:center">P100/CUDA 8/CuDNN 6</th></tr></thead><tbody><tr><td>CNTK</td><td style="text-align:center">8.5</td><td style="text-align:center">1.6</td></tr><tr><td>Keras(TF)</td><td style="text-align:center">10.2</td><td style="text-align:center">2.9</td></tr><tr><td>Tensorflow</td><td style="text-align:center">6.5</td><td style="text-align:center">1.8</td></tr><tr><td>MXNet</td><td style="text-align:center">7.7</td><td style="text-align:center">1.6</td></tr><tr><td>PyTorch</td><td style="text-align:center">7.7</td><td style="text-align:center">1.9</td></tr></tbody></table><h4 id="3-CPUæ¨ç†æ—¶é—´-s-E5-2630v4-Network-FCN5"><a href="#3-CPUæ¨ç†æ—¶é—´-s-E5-2630v4-Network-FCN5" class="headerlink" title="3. CPUæ¨ç†æ—¶é—´(s): E5-2630v4, Network FCN5"></a>3. CPUæ¨ç†æ—¶é—´(s): E5-2630v4, Network FCN5</h4><table><thead><tr><th>æ¡†æ¶</th><th style="text-align:center">1 Thread</th><th style="text-align:center">2 Threads</th><th style="text-align:center">4 Threads</th><th style="text-align:center">8 Threads</th><th style="text-align:center">16 Threads</th><th style="text-align:center">32 Threads</th></tr></thead><tbody><tr><td>Caffe</td><td style="text-align:center">1887.2ms</td><td style="text-align:center">1316.7ms</td><td style="text-align:center">1051.8ms</td><td style="text-align:center">952.1ms</td><td style="text-align:center">952.3ms</td><td style="text-align:center">834.7ms</td></tr><tr><td>CNTK</td><td style="text-align:center">1238.7ms</td><td style="text-align:center">616.3ms</td><td style="text-align:center">352.7ms</td><td style="text-align:center">229.5ms</td><td style="text-align:center">155.9ms</td><td style="text-align:center">192.4ms</td></tr><tr><td>Tensorflow</td><td style="text-align:center">992.2ms</td><td style="text-align:center">773.6ms</td><td style="text-align:center">419.3ms</td><td style="text-align:center">252.3ms</td><td style="text-align:center">149.7ms</td><td style="text-align:center">124.7ms</td></tr><tr><td>MXNet</td><td style="text-align:center">1386.8ms</td><td style="text-align:center">915.5ms</td><td style="text-align:center">559.0ms</td><td style="text-align:center">499.1ms</td><td style="text-align:center">416.3ms</td><td style="text-align:center">413.9ms</td></tr></tbody></table><h3 id="æ¡†æ¶è¯„ä»·"><a href="#æ¡†æ¶è¯„ä»·" class="headerlink" title="æ¡†æ¶è¯„ä»·"></a>æ¡†æ¶è¯„ä»·</h3><table><thead><tr><th>æ¡†æ¶</th><th style="text-align:center">å®‰è£…æˆæœ¬</th><th style="text-align:center">ä»£ç ç†è§£ç¨‹åº¦</th><th style="text-align:center">APIä¸°å¯Œç¨‹åº¦</th><th style="text-align:center">æ¨¡å‹ä¸°å¯Œç¨‹åº¦</th><th style="text-align:center">æ–‡æ¡£å®Œæ•´ç¨‹åº¦</th><th style="text-align:center">è®­ç»ƒä¸æµ‹è¿‡ç¨‹</th><th style="text-align:center">å­¦ä¹ èµ„æº</th></tr></thead><tbody><tr><td>CNTK</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td></tr><tr><td>Keras</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">è‰¯å¥½</td></tr><tr><td>MXNet</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">ä¼˜ç§€</td></tr><tr><td>Pytorch</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td></tr><tr><td>Tensorflow</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">ä¼˜ç§€</td></tr><tr><td>Caffe</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td><td style="text-align:center">è‰¯å¥½</td><td style="text-align:center">ä¼˜ç§€</td></tr></tbody></table><h3 id="æ¨èæ¡†æ¶"><a href="#æ¨èæ¡†æ¶" class="headerlink" title="æ¨èæ¡†æ¶"></a>æ¨èæ¡†æ¶</h3><p>ç›®å‰ä¼—å¤šçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œä½¿ç”¨è€…åªè¦é€‰æ‹©é€‚åˆè‡ªå·±çš„æ¡†æ¶å³å¯ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œè€ƒè™‘åˆ°è®­ç»ƒçš„å¿«æ·ç¨‹åº¦ï¼Œéƒ¨ç½²éš¾åº¦ä»¥åŠå¯¹CNNã€RNNæ¨¡å‹çš„ç›´æ¥ç¨‹åº¦ï¼Œæ¨èä»¥ä¸‹å‡ æ¬¾æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚</p><h4 id="1-Keras"><a href="#1-Keras" class="headerlink" title="1.Keras"></a>1.Keras</h4><p>Keras æä¾›äº†ç®€å•æ˜“ç”¨çš„ API æ¥å£ï¼Œå…¥é—¨å¿«ï¼Œç‰¹åˆ«é€‚åˆåˆå­¦è€…å…¥é—¨ã€‚å…¶åç«¯é‡‡ç”¨ TensorFlow, CNTKï¼Œä»¥åŠ Theanoã€‚å¦å¤–ï¼ŒDeeplearning4j çš„ Python ä¹Ÿæ˜¯åŸºäº Keras å®ç°çš„ã€‚Keras å‡ ä¹å·²ç»æˆäº† Python ç¥ç»ç½‘ç»œçš„æ¥å£æ ‡å‡†ã€‚</p><h4 id="2-TensorFlow"><a href="#2-TensorFlow" class="headerlink" title="2.TensorFlow"></a>2.TensorFlow</h4><p>è°·æ­Œå‡ºå“ï¼Œè¿½éšè€…ä¼—å¤šã€‚ä»£ç è´¨é‡é«˜ï¼Œæ”¯æŒæ¨¡å‹ä¸°å¯Œï¼Œæ”¯æŒè¯­è¨€å¤šæ ·ï¼Œ TensorBoard å¯è§†åŒ–å·¥å…·ä½¿ç”¨æ–¹ä¾¿ã€‚</p><h4 id="3-MXNet"><a href="#3-MXNet" class="headerlink" title="3.MXNet"></a>3.MXNet</h4><p>å·²è¢«äºšé©¬é€Šé€‰ä¸º AWS ä¸Šçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæ”¯æŒåŠ¨æ€å›¾è®¡ç®—ã€‚MXNet æœ‰è®¸å¤šä¸­å›½å¼€å‘è€…ï¼Œå› è€Œæœ‰éå¸¸è‰¯å¥½çš„ä¸­æ–‡æ–‡æ¡£æ”¯æŒã€‚Gluon æ¥å£ä½¿å¾— MXNet åƒ Keras ä¸€æ ·ç®€å•æ˜“ç”¨ã€‚</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="http://dlbench.comp.hkbu.edu.hk/?v=v8" target="_blank" rel="external">é¦™æ¸¯æµ¸ä¼šå¤§å­¦æ·±åº¦å­¦ä¹ æ¡†æ¶Benchmark</a></li><li><a href="https://github.com/ilkarman/DeepLearningFrameworks" target="_blank" rel="external">DeepLearningFrameworks</a></li><li><a href="http://app.myzaker.com/news/article.php?pk=5a13b55c1bc8e05d71000016" target="_blank" rel="external">åšå®¢</a></li><li><a href="https://www.zhihu.com/question/68114194/answer/465874315" target="_blank" rel="external">å¼€å‘è€…å¦‚ä½•é€‰æ‹©æ·±åº¦å­¦ä¹ æ¡†æ¶?</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ·±åº¦å­¦ä¹ ç ”ç©¶çš„çƒ­æ½®æŒç»­é«˜æ¶¨ï¼Œå„ç§å¼€æºæ·±åº¦å­¦ä¹ æ¡†æ¶ä¹Ÿå±‚å‡ºä¸ç©·ï¼Œå…¶ä¸­åŒ…æ‹¬TensorFlowã€Caffeã€Kerasã€CNTKã€Torch7ã€MXNetã€Leafã€Theanoã€DeepLearning4ã€Lasagneã€Neonç­‰ã€‚æˆ‘ä»¬å‚è€ƒå¼€æºçš„æµ‹è¯•ç»“æœï¼Œç»“åˆè‡ªå·±æ•´ç†çš„æ•°æ®ï¼Œ
      
    
    </summary>
    
    
      <category term="DeepLearning" scheme="https://edward7zhang.github.io/tags/DeepLearning/"/>
    
  </entry>
  
  <entry>
    <title>å›ç¯ï¼Œæœªæ¥å¯æœŸ</title>
    <link href="https://edward7zhang.github.io/2018/08/27/%E5%9B%9E%E7%8E%AF%EF%BC%8C%E6%9C%AA%E6%9D%A5%E5%8F%AF%E6%9C%9F/"/>
    <id>https://edward7zhang.github.io/2018/08/27/å›ç¯ï¼Œæœªæ¥å¯æœŸ/</id>
    <published>2018-08-26T17:42:07.000Z</published>
    <updated>2018-08-26T13:25:57.009Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»Šå¤©ï¼Œæ˜¯æˆ‘21å²çš„ç”Ÿæ—¥ã€‚<br>åœ¨ä¸€ä¸ªåŠæœˆå‰æˆ‘è¾èŒäº†ï¼Œä½†å‡†ç¡®çš„è¯´æ˜¯è¢«åŠ¨å¼è¾èŒã€‚<br>ç°åœ¨çœ‹æ¥è¿™æ˜¯ä¸€ä»¶å¥½äº‹ã€‚</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8176988f43d.jpg" alt="ç¬¬ä¸€å¤©åˆ°å…¬å¸æ¥¼ä¸‹" title="">                </div>                <div class="image-caption">ç¬¬ä¸€å¤©åˆ°å…¬å¸æ¥¼ä¸‹</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173ac7c155.jpg" alt="å·¥ç‰Œ" title="">                </div>                <div class="image-caption">å·¥ç‰Œ</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b81769918ccc.jpg" alt="ç¬¬ä¸€å¤©å®‰é¡¿ä¸‹æ¥" title="">                </div>                <div class="image-caption">ç¬¬ä¸€å¤©å®‰é¡¿ä¸‹æ¥</div>            </figure><h2 id="ä¼¼ä¹äººç”Ÿè¿›å…¥å¼±å† ä¹‹åï¼Œå¾ˆå¤šäº‹æƒ…éƒ½äº‹å‘çªç„¶ï¼Œå¥½åœ¨äº‹æƒ…å‘ç”Ÿè¿‡åï¼Œå†å›å¤´çœ‹ï¼Œä¸å¤±æ˜¯ä¸€ç§ä¸é”™çš„ç»å†"><a href="#ä¼¼ä¹äººç”Ÿè¿›å…¥å¼±å† ä¹‹åï¼Œå¾ˆå¤šäº‹æƒ…éƒ½äº‹å‘çªç„¶ï¼Œå¥½åœ¨äº‹æƒ…å‘ç”Ÿè¿‡åï¼Œå†å›å¤´çœ‹ï¼Œä¸å¤±æ˜¯ä¸€ç§ä¸é”™çš„ç»å†" class="headerlink" title="ä¼¼ä¹äººç”Ÿè¿›å…¥å¼±å† ä¹‹åï¼Œå¾ˆå¤šäº‹æƒ…éƒ½äº‹å‘çªç„¶ï¼Œå¥½åœ¨äº‹æƒ…å‘ç”Ÿè¿‡åï¼Œå†å›å¤´çœ‹ï¼Œä¸å¤±æ˜¯ä¸€ç§ä¸é”™çš„ç»å†"></a>ä¼¼ä¹äººç”Ÿè¿›å…¥å¼±å† ä¹‹åï¼Œå¾ˆå¤šäº‹æƒ…éƒ½äº‹å‘çªç„¶ï¼Œå¥½åœ¨äº‹æƒ…å‘ç”Ÿè¿‡åï¼Œå†å›å¤´çœ‹ï¼Œä¸å¤±æ˜¯ä¸€ç§ä¸é”™çš„ç»å†</h2><p>è¾èŒçš„åŸå› æ˜¯ä¼˜ç§€çš„projectä¸è¢«è®¤å¯â€¦æ‰€ä»¥å’Œæˆ‘çš„ç›´æ¥ä¸»ç®¡å°±ä¸€å¹¶é€‰æ‹©äº†ç¦»èŒâ€¦</p><p>åœ¨å¤–ç•Œäººçœ‹æ¥å¯èƒ½è¿™ç§åšæ³•ç®€ç›´æ˜¯ä¸è§£â€¦</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173aeb88e9.jpg" alt="å—¯ï¼Œå¸Œæœ›è¿™å®¶å…¬å¸å¯ä»¥ä¿æŒåˆå¿ƒ" title="">                </div>                <div class="image-caption">å—¯ï¼Œå¸Œæœ›è¿™å®¶å…¬å¸å¯ä»¥ä¿æŒåˆå¿ƒ</div>            </figure><p>å¯æ˜¯å¯¹äºç¨‹åºçŒ¿è¿™ç±»äººæ¥è¯´ï¼Œèƒ½åšè‡ªå·±æ„Ÿå…´è¶£çš„äº‹æƒ…åº”è¯¥æ˜¯æœ€é«˜çš„è£èª‰â€¦</p><p>å†µä¸”æ˜¯åœ¨ä¸€ä¸ªä¼˜ç§€projectå¹¶ä¸”åœ¨æœ‰è‰¯å¥½å®ç°çš„åŸºç¡€ä¸Šè¢«å¦æ‰â€¦è¿™ç§ç—›è‹¦è«è¿‡äºé¥®é¸©</p><p>æ­£å¦‚æ ‡é¢˜æ‰€è¨€<strong> å›ç¯ </strong>ï¼Œåˆšåˆšæ¥åˆ°æ¶ˆæ¯çš„æ—¶å€™è‡ªå·±è¿˜éƒé—·äº†ä¸€æ•´å¤©ï¼Œç°åœ¨å›å¤´çœ‹è¿™åº”è¯¥æ˜¯ä¸€ç§å›ç¯ï¼Œå°±å¦‚åŒç«‹äº¤æ¡¥çš„è½¬ç¯åŒé“ï¼Œè™½ç„¶åˆç»•å›äº†åŸç‚¹ï¼Œä½†æ˜¯å´æå‡äº†ä¸€ä¸ªç»´åº¦ã€‚</p><p>å¹¸è¿å¦‚æˆ‘ï¼Œåœ¨è¿™çŸ­æš‚çš„å®ä¹ ä¸­é‡åˆ°äº†éå¸¸niceçš„ä¸»ç®¡ï¼Œæ¶¨äº†å¾ˆå¤šè§è¯†ï¼Œæ„è¯†åˆ°æˆ‘ä¹‹å‰æ˜¯å¤šä¹ˆçš„çŸ­è§†â€¦ä»è€Œä¹Ÿçœ‹åˆ°äº†è‡ªå·±æœªæ¥çš„ä¸€äº›å¯èƒ½ï¼Œä½†å‰æè¦åšä¸€äº›ä»˜å‡ºã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173ad848db.jpg" alt="å…¬å¸å¯¹é¢çš„è…¾è®¯&å®Œç¾ä¸–ç•Œ" title="">                </div>                <div class="image-caption">å…¬å¸å¯¹é¢çš„è…¾è®¯&å®Œç¾ä¸–ç•Œ</div>            </figure><h2 id="åœ¨è¿™ä¸¤ä¸ªæœˆçš„å®ä¹ ä¸­ï¼Œé¡¹ç›®è¿›å±•æœ‰å¦‚ç¥åŠ©"><a href="#åœ¨è¿™ä¸¤ä¸ªæœˆçš„å®ä¹ ä¸­ï¼Œé¡¹ç›®è¿›å±•æœ‰å¦‚ç¥åŠ©" class="headerlink" title="åœ¨è¿™ä¸¤ä¸ªæœˆçš„å®ä¹ ä¸­ï¼Œé¡¹ç›®è¿›å±•æœ‰å¦‚ç¥åŠ©"></a>åœ¨è¿™ä¸¤ä¸ªæœˆçš„å®ä¹ ä¸­ï¼Œé¡¹ç›®è¿›å±•æœ‰å¦‚ç¥åŠ©</h2><p>åœ¨å®ä¹ è¿™æ®µæ—¶é—´ï¼Œé¡¹ç›®è¿›å±•é€Ÿåº¦æƒŠäººï¼Œæ¯å¤©éƒ½å¾ˆå……å®ï¼Œæ¯å¤©ä¸€ç»„çš„ä¼™ä¼´ä»¬éƒ½åœ¨ä¸€èµ·æƒ³å¯¹ç­–ï¼Œç°åœ¨å›å¤´æƒ³æƒ³ä¹Ÿè®¸æ˜¯ä¹‹å‰è‡ªå·±åœ¨äººå·¥æ™ºèƒ½æ–¹é¢çš„ä¸€ç‚¹å°å°çš„ç»éªŒåŠ ä¹‹ä¸»ç®¡ä¹‹å‰åœ¨NLPæ–¹é¢çš„ç ”ç©¶çš„å…±äº¤ä½¿å¾—é¡¹ç›®å‘å±•è¿…é€Ÿã€‚</p><p>ä¸¤ä¸ªæœˆçš„æ—¶é—´å®ç°äº†æ¨¡å‹çš„æ­å»ºä»¥åŠdemoçš„å®ç°&amp;é¡¹ç›®é¢„æ¼”â€¦</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173a8e14d3.png" alt="å·¥ä½" title="">                </div>                <div class="image-caption">å·¥ä½</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173ac5d381.jpg" alt="åœ¨å…¬å¸æœ€åä¸€å¤©çš„é¡¹ç›®æ±‡æŠ¥" title="">                </div>                <div class="image-caption">åœ¨å…¬å¸æœ€åä¸€å¤©çš„é¡¹ç›®æ±‡æŠ¥</div>            </figure><p>è‡³äºä¸ºä»€ä¹ˆå¦æ‰æˆ‘ä»¬â€¦å„ç§å› ç´ â€¦ä¸æƒ³æ˜è¯´äº†â€¦æœ‰ç‚¹å®˜å®¦é£æ ¼â€¦å„ä½çœ‹å®¢è‡ªå·±æƒ³è±¡å§â€¦</p><h2 id="ä¸‹ä¸€æ­¥ï¼Œå†è¿›ç«™"><a href="#ä¸‹ä¸€æ­¥ï¼Œå†è¿›ç«™" class="headerlink" title="ä¸‹ä¸€æ­¥ï¼Œå†è¿›ç«™"></a>ä¸‹ä¸€æ­¥ï¼Œå†è¿›ç«™</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173ad86919.jpg" alt="åå°„" title="">                </div>                <div class="image-caption">åå°„</div>            </figure><p>è¿™ä¸€è¶Ÿå®ä¹ ä¸‹æ¥ï¼Œå¯ä»¥è¯´å½»åº•æ”¹å˜äº†æˆ‘æ›¾ç»å¯¹è‡ªå·±çš„çœ‹æ³•â€¦</p><p>æ€»çš„æ¥è¯´ï¼Œè¿‡å»æˆ‘å¸¸å¸¸è§†çº¿è¿‡åº¦çŸ­æµ…â€¦åœ¨å¯¹è‡ªå·±äººç”Ÿçš„è§„åˆ’ä¸Šä¹Ÿè¿‡äºä¿å®ˆå§â€¦</p><p>äº‹å®ä¸Šï¼Œä¸€ä¸ªäººæ‰€çœ‹åˆ°çš„å¾€å¾€æ˜¯ç‹­çª„çš„ï¼Œé€šè¿‡ä¸æ–­çš„æ¥è§¦é«˜å±‚æ¬¡çš„äººå’Œäº‹ç‰©æ‰èƒ½è®©è‡ªå·±å˜å¾—æ›´openã€‚</p><p>å†³å®šäº†è€ƒç ”ï¼Œä¹Ÿçœ‹æ¸…äº†å›½å†…çš„äº’è”ç½‘ç¯å¢ƒçš„è™šå®â€¦å¸Œæœ›è‡ªå·±èƒ½ä»˜æœ‰æ‰€å¾—â€¦</p><p>å¦‚æœæœ‰æœºä¼šï¼Œè¿˜æ˜¯å»æ¥è§¦æ¥è§¦æŠ€æœ¯åŸå§‹åœ°ç†é™¶ç†é™¶å§â€¦</p><h2 id="æœªæ¥å¯æœŸ"><a href="#æœªæ¥å¯æœŸ" class="headerlink" title="æœªæ¥å¯æœŸ"></a>æœªæ¥å¯æœŸ</h2><p>åœ¨å¤§å­¦é‡Œçš„ä¸‰å¹´å†ç®—ä¸Šå®ä¹ çš„ç»å†â€¦å°è¯•äº†äº’è”ç½‘å¼€å‘çš„å¾ˆå¤šæ–¹å‘â€¦</p><p>æœ€ç»ˆå¸å¼•æˆ‘çš„å¹¶ä¸æ˜¯å„ç§æ¡†æ¶ç‚«æŠ€çš„å¼€å‘â€¦è€Œæ˜¯èƒ½èµ‹äºˆåº”ç”¨çµé­‚çš„äººå·¥æ™ºèƒ½æ–¹å‘â€¦</p><p>å¤§æ¦‚æœªæ¥çš„å‘å±•æ–¹å‘ä¹Ÿå°±å®šåœ¨è¿™æ ·çš„è¶‹åŠ¿äº†â€¦</p><p><strong>ç»§ç»­è¡Œèµ°ï¼Œæœªæ¥å¯æœŸã€‚</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173ac9ba83.jpg" alt="ç¦»å¼€é‚£å¤©å¤©æ°”å¾ˆå¥½" title="">                </div>                <div class="image-caption">ç¦»å¼€é‚£å¤©å¤©æ°”å¾ˆå¥½</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2018/08/25/5b8173a5c08cd.jpg" alt="æœªæ¥å¯æœŸ" title="">                </div>                <div class="image-caption">æœªæ¥å¯æœŸ</div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä»Šå¤©ï¼Œæ˜¯æˆ‘21å²çš„ç”Ÿæ—¥ã€‚&lt;br&gt;åœ¨ä¸€ä¸ªåŠæœˆå‰æˆ‘è¾èŒäº†ï¼Œä½†å‡†ç¡®çš„è¯´æ˜¯è¢«åŠ¨å¼è¾èŒã€‚&lt;br&gt;ç°åœ¨çœ‹æ¥è¿™æ˜¯ä¸€ä»¶å¥½äº‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;image-bubble&quot;&gt;
                &lt;div 
      
    
    </summary>
    
    
      <category term="Inspire" scheme="https://edward7zhang.github.io/tags/Inspire/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»</title>
    <link href="https://edward7zhang.github.io/2018/05/20/%E5%9F%BA%E4%BA%8ETensorFlow%E7%9A%84CNN%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <id>https://edward7zhang.github.io/2018/05/20/åŸºäºTensorFlowçš„CNNä¸­æ–‡æ–‡æœ¬åˆ†ç±»/</id>
    <published>2018-05-20T10:00:07.000Z</published>
    <updated>2018-05-20T10:50:21.054Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>CNNåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼ŒåŒæ—¶å®ƒå¯ä»¥åº”ç”¨åœ¨æ–‡æœ¬åˆ†ç±»ä¸Šé¢ï¼Œæ­¤æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨tensorflowå®ç°æ­¤ä»»åŠ¡ã€‚</p></blockquote><h1 id="CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†"><a href="#CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†" class="headerlink" title="CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†"></a>CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†</h1><p>ä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨cnnè¿›è¡Œå¥å­åˆ†ç±»ã€‚è¾“å…¥æ˜¯ä¸€ä¸ªå¥å­ï¼Œä¸ºäº†ä½¿å…¶å¯ä»¥è¿›è¡Œå·ç§¯ï¼Œé¦–å…ˆéœ€è¦å°†å…¶è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºï¼Œé€šå¸¸ä½¿ç”¨word2vecå®ç°ã€‚d=5è¡¨ç¤ºæ¯ä¸ªè¯è½¬åŒ–ä¸º5ç»´çš„å‘é‡ï¼ŒçŸ©é˜µçš„å½¢çŠ¶æ˜¯[sentence_length Ã—Ã— 5]ï¼Œå³[7 Ã—Ã— 5]ã€‚6ä¸ªfilterï¼ˆå·ç§¯æ ¸ï¼‰ï¼Œä¸å›¾åƒä¸­ä½¿ç”¨çš„å·ç§¯æ ¸ä¸åŒçš„æ˜¯ï¼Œnlpä½¿ç”¨çš„å·ç§¯æ ¸çš„å®½ä¸å¥å­çŸ©é˜µçš„å®½ç›¸åŒï¼Œåªæ˜¯é•¿åº¦ä¸åŒã€‚è¿™é‡Œæœ‰ï¼ˆ2ï¼Œ3ï¼Œ4ï¼‰ä¸‰ç§sizeï¼Œæ¯ç§sizeæœ‰ä¸¤ä¸ªfilterï¼Œä¸€å…±æœ‰6ä¸ªfilterã€‚ç„¶åå¼€å§‹å·ç§¯ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œstrideæ˜¯1ï¼Œå› ä¸ºå¯¹äºé«˜æ˜¯4çš„filterï¼Œæœ€åç”Ÿæˆ4ç»´çš„å‘é‡ï¼Œï¼ˆ7-4ï¼‰/1+1=4ã€‚å¯¹äºé«˜æ˜¯3çš„filterï¼Œæœ€åç”Ÿæˆ5ç»´çš„å‘é‡ï¼Œï¼ˆ7-3ï¼‰/1+1=5ã€‚å·ç§¯ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°å¥å­çš„ç‰¹å¾ï¼Œä½¿ç”¨activation functionå’Œ1-max-poolingå¾—åˆ°æœ€åçš„å€¼ï¼Œæ¯ä¸ªfilteræœ€åå¾—åˆ°ä¸¤ä¸ªç‰¹å¾ã€‚å°†æ‰€æœ‰ç‰¹å¾åˆå¹¶åï¼Œä½¿ç”¨softmaxè¿›è¡Œåˆ†ç±»ã€‚å›¾ä¸­æ²¡æœ‰ç”¨åˆ°chanel,ä¸‹æ–‡çš„å®éªŒå°†ä¼šä½¿ç”¨ä¸¤ä¸ªé€šé“ï¼Œstaticå’Œnon-staticï¼Œæœ‰ç›¸å…³çš„å…·ä½“è§£é‡Šã€‚<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-06-at-12.05.40-PM-1024x937.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">                </div>                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>            </figure></p><h1 id="æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹"><a href="#æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹" class="headerlink" title="æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹"></a>æœ¬æ–‡ä½¿ç”¨çš„æ¨¡å‹</h1><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-06-at-8.03.47-AM-1024x413.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">                </div>                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>            </figure><p>ä¸»è¦åŒ…æ‹¬äº”å±‚ï¼Œç¬¬ä¸€å±‚æ˜¯embedding layer,ç¬¬äºŒå±‚æ˜¯convolutional layer,ç¬¬ä¸‰å±‚æ˜¯max-pooling layer,ç¬¬å››å±‚æ˜¯fully connected layerï¼Œæœ€åä¸€å±‚æ˜¯softmax layer.æ¥ä¸‹æ¥ä¾æ¬¡ä»‹ç»ç›¸å…³ä»£ç å®ç°ã€‚</p><h2 id="Input-placeholder"><a href="#Input-placeholder" class="headerlink" title="Input placeholder"></a>Input placeholder</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Placeholders for input, output and dropout</div><div class="line">self.input_x = tf.placeholder(tf.int32, [None, sequence_length], name=&quot;input_x&quot;)</div><div class="line">self.input_y = tf.placeholder(tf.float32, [None, num_classes], name=&quot;input_y&quot;)</div><div class="line">self.dropout_keep_prob = tf.placeholder(tf.float32, name=&quot;dropout_keep_prob&quot;)</div></pre></td></tr></table></figure><p><code>tf.placeholder</code> åˆ›å»ºä¸€ä¸ªå ä½ç¬¦å˜é‡ï¼Œåœ¨è®­ç»ƒæˆ–è€…æµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦å°†å ä½ç¬¦è¾“å…¥åˆ°ç½‘ç»œä¸­è¿›è¡Œè®¡ç®—ï¼Œå…¶ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¾“å…¥å¼ é‡çš„å½¢çŠ¶ã€‚None æ„å‘³ç€å®ƒå¯ä»¥æ˜¯ä»»ä½•ç»´åº¦çš„é•¿åº¦ï¼Œåœ¨æˆ‘ä»¬çš„å®éªŒä¸­å®ƒä»£è¡¨æ‰¹å¤„ç†çš„å¤§å°ï¼ŒNoneä½¿å¾—ç½‘ç»œå¯ä»¥å¤„ç†ä»»æ„é•¿åº¦çš„batchesã€‚<br>å¤±æ´»ç‡åŒæ ·ä¹Ÿæ˜¯è¾“å…¥çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è®­ç»ƒçš„æ—¶å€™ä½¿ç”¨dropout ï¼Œæµ‹è¯•çš„æ—¶å€™ä¸ä½¿ç”¨dropout ã€‚</p><h2 id="EMBEDDING-LAYER"><a href="#EMBEDDING-LAYER" class="headerlink" title="EMBEDDING LAYER"></a>EMBEDDING LAYER</h2><p>è¿™ä¸€å±‚å°†å•è¯ç´¢å¼•æ˜ å°„åˆ°ä½ç»´çš„å‘é‡è¡¨ç¤ºï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæŸ¥æ‰¾è¡¨ï¼Œæˆ‘ä»¬ä»æ•°æ®ä¸­é€šè¿‡å­¦ä¹ å¾—åˆ°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">with tf.device(&apos;/cpu:0&apos;), tf.name_scope(&quot;embedding&quot;):</div><div class="line">    W = tf.Variable(tf.random_uniform([vocab_size, embedding_size], -1.0, 1.0), name=&quot;W&quot;)</div><div class="line">    self.embedded_chars = tf.nn.embedding_lookup(W, self.input_x)</div><div class="line">    self.embedded_chars_expanded = tf.expand_dims(self.embedded_chars, -1)</div></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>W</code> æ˜¯ åœ¨è®­ç»ƒæ—¶å¾—åˆ°çš„embedding matrix.ï¼Œç”¨éšæœºå‡åŒ€åˆ†å¸ƒè¿›è¡Œåˆå§‹åŒ–ã€‚<a href="http://blog.csdn.net/u013713117/article/details/55048040" target="_blank" rel="external">tf.nn.embedding_lookup</a>å®ç°embeddingæ“ä½œï¼Œå¾—åˆ° ä¸€ä¸ª3-dimensional çš„å¼ é‡ï¼Œå½¢çŠ¶æ˜¯ <code>[None, sequence_length, embedding_size].</code> <code>sequence_length</code> æ˜¯æ•°æ®é›†ä¸­æœ€é•¿å¥å­çš„é•¿åº¦ï¼Œå…¶ä»–å¥å­éƒ½é€šè¿‡æ·»åŠ â€œPADâ€è¡¥å……åˆ°è¿™ä¸ªé•¿åº¦ã€‚<code>embedding_size</code> æ˜¯è¯å‘é‡çš„å¤§å°ã€‚</p><p>TensorFlowçš„å·ç§¯å‡½æ•°-<code>conv2d</code> éœ€è¦å››ä¸ªå‚æ•°ï¼Œ åˆ†åˆ«æ˜¯batch, width, height ä»¥åŠchannelã€‚ embeddingä¹‹åä¸åŒ…æ‹¬ channel, æ‰€ä»¥æˆ‘ä»¬äººä¸ºåœ°æ·»åŠ ä¸Šå®ƒï¼Œå¹¶è®¾ç½®ä¸º1ã€‚ç°åœ¨å°±æ˜¯<code>[None, sequence_length, embedding_size, 1]</code></p><h2 id="CONVOLUTION-AND-MAX-POOLING-LAYERS"><a href="#CONVOLUTION-AND-MAX-POOLING-LAYERS" class="headerlink" title="CONVOLUTION AND MAX-POOLING LAYERS"></a>CONVOLUTION AND MAX-POOLING LAYERS</h2><p>ç”±å›¾ä¸­å¯çŸ¥ï¼Œ æˆ‘ä»¬æœ‰ä¸åŒsizeçš„filtersã€‚å› ä¸ºæ¯æ¬¡å·ç§¯éƒ½ä¼šäº§ç”Ÿä¸åŒå½¢çŠ¶çš„å¼ é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦éå†æ¯ä¸ªfilterï¼Œç„¶åå°†ç»“æœåˆå¹¶æˆä¸€ä¸ªå¤§çš„ç‰¹å¾å‘é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">pooled_outputs = []</div><div class="line">for i, filter_size in enumerate(filter_sizes):</div><div class="line">    with tf.name_scope(&quot;conv-maxpool-%s&quot; % filter_size):</div><div class="line">        # Convolution Layer</div><div class="line">        filter_shape = [filter_size, embedding_size, 1, num_filters]</div><div class="line">        W = tf.Variable(tf.truncated_normal(filter_shape, stddev=0.1), name=&quot;W&quot;)</div><div class="line">        b = tf.Variable(tf.constant(0.1, shape=[num_filters]), name=&quot;b&quot;)</div><div class="line">        conv = tf.nn.conv2d(</div><div class="line">            self.embedded_chars_expanded,</div><div class="line">            W,</div><div class="line">            strides=[1, 1, 1, 1],</div><div class="line">            padding=&quot;VALID&quot;,</div><div class="line">            name=&quot;conv&quot;)</div><div class="line">        # Apply nonlinearity</div><div class="line">        h = tf.nn.relu(tf.nn.bias_add(conv, b), name=&quot;relu&quot;)</div><div class="line">        # Max-pooling over the outputs</div><div class="line">        pooled = tf.nn.max_pool(</div><div class="line">            h,</div><div class="line">            ksize=[1, sequence_length - filter_size + 1, 1, 1],</div><div class="line">            strides=[1, 1, 1, 1],</div><div class="line">            padding=&apos;VALID&apos;,</div><div class="line">            name=&quot;pool&quot;)</div><div class="line">        pooled_outputs.append(pooled)</div><div class="line"></div><div class="line"># Combine all the pooled features</div><div class="line">num_filters_total = num_filters * len(filter_sizes)</div><div class="line">self.h_pool = tf.concat(3, pooled_outputs)</div><div class="line">self.h_pool_flat = tf.reshape(self.h_pool, [-1, num_filters_total])</div></pre></td></tr></table></figure><p>è¿™é‡Œ<code>W</code> æ˜¯filter çŸ©é˜µï¼Œ<code>h</code> æ˜¯å¯¹å·ç§¯ç»“æœè¿›è¡Œéçº¿æ€§è½¬æ¢ä¹‹åçš„ç»“æœã€‚æ¯ä¸ª filteréƒ½ä»æ•´ä¸ªembeddingåˆ’è¿‡,ä¸åŒä¹‹å¤„åœ¨äºè¦†ç›–å¤šå°‘å•è¯ã€‚ â€œVALIDâ€ paddingæ„å‘³ç€æ²¡æœ‰å¯¹å¥å­çš„è¾¹ç¼˜è¿›è¡Œpadding,ä¹Ÿå°±æ˜¯ç”¨äº†narrow convolutionï¼Œè¾“å‡ºçš„å½¢çŠ¶æ˜¯ <code>[1, sequence_length - filter_size + 1, 1, 1]</code>ã€‚narrow convolutionä¸ wide convolutionçš„åŒºåˆ«æ˜¯æ˜¯å¦å¯¹è¾¹ç¼˜è¿›è¡Œå¡«å……ã€‚<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/11/Screen-Shot-2015-11-05-at-9.47.41-AM-1024x261.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">                </div>                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>            </figure><br><em>Narrow vs. Wide Convolution. Filter size 5, input size 7. Source: A Convolutional Neural Network for Modelling Sentences (2014)</em><br>å½“ä½ çš„filteræ¯”è¾“å…¥çš„sizeè¿˜å¤§æ—¶ï¼Œä½ å¯ä»¥çœ‹åˆ°wide convolutionæ˜¯å¤šä¹ˆçš„æœ‰ç”¨ï¼Œç”šè‡³è¯´æ˜¯å¿…é¡»çš„ã€‚å¦‚ä¸Šæ‰€ç¤ºï¼Œnarrow convolutionäº§å‡ºçš„å°ºå¯¸æ˜¯ï¼ˆ7-5ï¼‰+1=3ï¼Œè€Œwide convolutionäº§å‡ºå°ºå¯¸æ˜¯ï¼ˆ7+2*4-5ï¼‰+1=11ã€‚é€šå¸¸ï¼Œè¾“å‡ºå°ºå¯¸çš„è§„åˆ™è¡¨è¾¾å¼ä¸ºï¼š<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20161218225721289?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1eXVlbWFpY2hh/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">                </div>                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>            </figure><br>å¯¹è¾“å‡ºè¿›è¡Œmax-poolingåå¾—åˆ°å½¢çŠ¶æ˜¯ <code>[batch_size, 1, 1, num_filters]</code> çš„å¼ é‡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œæœ€åä¸€ä¸ªç»´åº¦æ˜¯ç‰¹å¾ä»£è¡¨æ•°é‡ã€‚æŠŠæ¯ä¸€ä¸ªmax-poolingä¹‹åçš„å¼ é‡åˆå¹¶èµ·æ¥ä¹‹åå¾—åˆ°ä¸€ä¸ªé•¿å‘é‡ <code>[batch_size, num_filters_total]</code>. in <code>tf.reshape</code> ä¸­çš„ -1è¡¨ç¤ºTå°†å‘é‡å±•å¹³ã€‚</p><h2 id="DROPOUT-LAYER"><a href="#DROPOUT-LAYER" class="headerlink" title="DROPOUT LAYER"></a>DROPOUT LAYER</h2><p>Dropoutä¹Ÿè®¸æ˜¯cnnä¸­æœ€æµè¡Œçš„æ­£åˆ™åŒ–æ–¹æ³•ã€‚dropoutçš„æƒ³æ³•å¾ˆç®€å•ï¼Œdropout layeréšæœºåœ°é€‰æ‹©ä¸€äº›ç¥ç»å…ƒï¼Œä½¿å…¶å¤±æ´»ã€‚è¿™æ ·å¯ä»¥é˜»æ­¢co-adapting,è¿«ä½¿å®ƒä»¬æ¯ä¸€ä¸ªéƒ½å­¦ä¹ åˆ°æœ‰ç”¨çš„ç‰¹å¾ã€‚å¤±æ´»çš„ç¥ç»å•å…ƒä¸ªæ•°ç”±<code>dropout_keep_prob</code> å†³å®šã€‚åœ¨è®­ç»ƒçš„æ—¶å€™è®¾ä¸º 0.5 ,æµ‹è¯•çš„æ—¶å€™è®¾ä¸º 1 (disable dropout) .</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Add dropout</div><div class="line">with tf.name_scope(&quot;dropout&quot;):</div><div class="line">    self.h_drop = tf.nn.dropout(self.h_pool_flat, self.dropout_keep_prob)</div></pre></td></tr></table></figure><h2 id="SCORES-AND-PREDICTIONS"><a href="#SCORES-AND-PREDICTIONS" class="headerlink" title="SCORES AND PREDICTIONS"></a>SCORES AND PREDICTIONS</h2><p>åˆ©ç”¨ç‰¹å¾å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨çŸ©é˜µç›¸ä¹˜è®¡ç®—ä¸¤ç±»çš„å¾—åˆ†ï¼Œä¹Ÿå¯ä»¥ç”¨ softmaxå‡½æ•°è®¡ç®—ä¸¤ç±»çš„æ¦‚ç‡å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">with tf.name_scope(&quot;output&quot;):</div><div class="line">    W = tf.Variable(tf.truncated_normal([num_filters_total, num_classes], stddev=0.1), name=&quot;W&quot;)</div><div class="line">    b = tf.Variable(tf.constant(0.1, shape=[num_classes]), name=&quot;b&quot;)</div><div class="line">    self.scores = tf.nn.xw_plus_b(self.h_drop, W, b, name=&quot;scores&quot;)</div><div class="line">    self.predictions = tf.argmax(self.scores, 1, name=&quot;predictions&quot;)</div></pre></td></tr></table></figure><h2 id="LOSS-AND-ACCURACY"><a href="#LOSS-AND-ACCURACY" class="headerlink" title="LOSS AND ACCURACY"></a>LOSS AND ACCURACY</h2><p>å¯ä»¥ç”¨å¾—åˆ†å®šä¹‰æŸå¤±å€¼ã€‚æŸå¤±è®¡ç®—çš„æ˜¯ç½‘ç»œçš„è¯¯å·®ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†å…¶æœ€å°åŒ–ï¼Œåˆ†ç±»é—®é¢˜æ ‡å‡†çš„æŸå¤±å‡½æ•°æ˜¯äº¤å‰ç†µæŸå¤±ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Calculate mean cross-entropy loss</div><div class="line">with tf.name_scope(&quot;loss&quot;):</div><div class="line">    losses = tf.nn.softmax_cross_entropy_with_logits(self.scores, self.input_y)</div><div class="line">    self.loss = tf.reduce_mean(losses)</div></pre></td></tr></table></figure><p>è®¡ç®—æ­£ç¡®ç‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Calculate Accuracy</div><div class="line">with tf.name_scope(&quot;accuracy&quot;):</div><div class="line">    correct_predictions = tf.equal(self.predictions, tf.argmax(self.input_y, 1))</div><div class="line">    self.accuracy = tf.reduce_mean(tf.cast(correct_predictions, &quot;float&quot;), name=&quot;accuracy&quot;)</div></pre></td></tr></table></figure><h2 id="MINIMIZING-THE-LOSS"><a href="#MINIMIZING-THE-LOSS" class="headerlink" title="MINIMIZING THE LOSS"></a>MINIMIZING THE LOSS</h2><p>åˆ©ç”¨TensorFlow å†…ç½®çš„optimizersï¼Œä¾‹å¦‚ Adam optimizerï¼Œä¼˜åŒ–ç½‘ç»œæŸå¤±ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">global_step = tf.Variable(0, name=&quot;global_step&quot;, trainable=False)</div><div class="line">optimizer = tf.train.AdamOptimizer(1e-4)</div><div class="line">grads_and_vars = optimizer.compute_gradients(cnn.loss)</div><div class="line">train_op = optimizer.apply_gradients(grads_and_vars, global_step=global_step)</div></pre></td></tr></table></figure><p><code>train_op</code> æ˜¯ä¸€ä¸ªæ–°å»ºçš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‚æ•°ä¸Šè¿›è¡Œæ¢¯åº¦æ›´æ–°ã€‚æ¯æ‰§è¡Œä¸€æ¬¡ <code>train_op</code> å°±æ˜¯ä¸€æ¬¡è®­ç»ƒæ­¥éª¤ã€‚ TensorFlow å¯ä»¥è‡ªåŠ¨åœ°è®¡ç®—æ‰é‚£äº›å˜é‡æ˜¯â€œå¯è®­ç»ƒçš„â€ç„¶åè®¡ç®—ä»–ä»¬çš„æ¢¯åº¦ã€‚é€šè¿‡<code>global_step</code>è¿™ä¸ªå˜é‡å¯ä»¥è®¡ç®—è®­ç»ƒçš„æ­¥æ•°ï¼Œæ¯è®­ç»ƒä¸€æ¬¡è‡ªåŠ¨åŠ ä¸€ã€‚</p><h2 id="CHECKPOINTING"><a href="#CHECKPOINTING" class="headerlink" title="CHECKPOINTING"></a>CHECKPOINTING</h2><p>TensorFlow ä¸­å¯ä»¥ç”¨checkpointing ä¿å­˜æ¨¡å‹çš„å‚æ•°ã€‚checkpointingä¸­çš„å‚æ•°ä¹Ÿå¯ä»¥ç”¨æ¥ç»§ç»­è®­ç»ƒã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># Checkpointing</div><div class="line">checkpoint_dir = os.path.abspath(os.path.join(out_dir, &quot;checkpoints&quot;))</div><div class="line">checkpoint_prefix = os.path.join(checkpoint_dir, &quot;model&quot;)</div><div class="line"># Tensorflow assumes this directory already exists so we need to create it</div><div class="line">if not os.path.exists(checkpoint_dir):</div><div class="line">    os.makedirs(checkpoint_dir)</div><div class="line">saver = tf.train.Saver(tf.all_variables())</div></pre></td></tr></table></figure><h2 id="DEFINING-A-SINGLE-TRAINING-STEP"><a href="#DEFINING-A-SINGLE-TRAINING-STEP" class="headerlink" title="DEFINING A SINGLE TRAINING STEP"></a>DEFINING A SINGLE TRAINING STEP</h2><p>ç”¨ä¸€ä¸ªbatchçš„æ•°æ®è¿›è¡Œä¸€æ¬¡è®­ç»ƒã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">def train_step(x_batch, y_batch):</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    A single training step</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    feed_dict = &#123;</div><div class="line">      cnn.input_x: x_batch,</div><div class="line">      cnn.input_y: y_batch,</div><div class="line">      cnn.dropout_keep_prob: FLAGS.dropout_keep_prob</div><div class="line">    &#125;</div><div class="line">    _, step, summaries, loss, accuracy = sess.run(</div><div class="line">        [train_op, global_step, train_summary_op, cnn.loss, cnn.accuracy],</div><div class="line">        feed_dict)</div><div class="line">    time_str = datetime.datetime.now().isoformat()</div><div class="line">    print(&quot;&#123;&#125;: step &#123;&#125;, loss &#123;:g&#125;, acc &#123;:g&#125;&quot;.format(time_str, step, loss, accuracy))</div><div class="line">    train_summary_writer.add_summary(summaries, step)</div></pre></td></tr></table></figure><p><code>train_op</code> ä»€ä¹ˆä¹Ÿä¸è¿”å›ï¼Œåªæ˜¯æ›´æ–°ç½‘ç»œä¸­çš„å‚æ•°ã€‚æœ€ç»ˆï¼Œæ‰“å°å‡ºå½“å‰è®­ç»ƒçš„æŸå¤±å€¼ä¸æ­£ç¡®ç‡ã€‚å¦‚æœbatchçš„sizeå¾ˆå°çš„è¯ï¼Œè¿™ä¸¤è€…åœ¨ä¸åŒçš„batchä¸­å·®åˆ«å¾ˆå¤§ã€‚å› ä¸ºä½¿ç”¨äº†dropoutï¼Œè®­ç»ƒçš„metricså¯èƒ½è¦æ¯”æµ‹è¯•çš„metricsç³Ÿç³•ã€‚</p><p>åŒæ ·çš„å‡½æ•°ä¹Ÿå¯ä»¥ç”¨åœ¨æµ‹è¯•æ—¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">def dev_step(x_batch, y_batch, writer=None):</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    Evaluates model on a dev set</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    feed_dict = &#123;</div><div class="line">      cnn.input_x: x_batch,</div><div class="line">      cnn.input_y: y_batch,</div><div class="line">      cnn.dropout_keep_prob: 1.0</div><div class="line">    &#125;</div><div class="line">    step, summaries, loss, accuracy = sess.run(</div><div class="line">        [global_step, dev_summary_op, cnn.loss, cnn.accuracy],</div><div class="line">        feed_dict)</div><div class="line">    time_str = datetime.datetime.now().isoformat()</div><div class="line">    print(&quot;&#123;&#125;: step &#123;&#125;, loss &#123;:g&#125;, acc &#123;:g&#125;&quot;.format(time_str, step, loss, accuracy))</div><div class="line">    if writer:</div><div class="line">        writer.add_summary(summaries, step)</div></pre></td></tr></table></figure><h2 id="TRAINING-LOOP"><a href="#TRAINING-LOOP" class="headerlink" title="TRAINING LOOP"></a>TRAINING LOOP</h2><p>é€šè¿‡è¿­ä»£æ•°æ®è¿›è¡Œè®­ç»ƒã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># Generate batches</div><div class="line">batches = data_helpers.batch_iter(</div><div class="line">    zip(x_train, y_train), FLAGS.batch_size, FLAGS.num_epochs)</div><div class="line"># Training loop. For each batch...</div><div class="line">for batch in batches:</div><div class="line">    x_batch, y_batch = zip(*batch)</div><div class="line">    train_step(x_batch, y_batch)</div><div class="line">    current_step = tf.train.global_step(sess, global_step)</div><div class="line">    if current_step % FLAGS.evaluate_every == 0:</div><div class="line">        print(&quot;\nEvaluation:&quot;)</div><div class="line">        dev_step(x_dev, y_dev, writer=dev_summary_writer)</div><div class="line">        print(&quot;&quot;)</div><div class="line">    if current_step % FLAGS.checkpoint_every == 0:</div><div class="line">        path = saver.save(sess, checkpoint_prefix, global_step=current_step)</div><div class="line">        print(&quot;Saved model checkpoint to &#123;&#125;\n&quot;.format(path))</div></pre></td></tr></table></figure><h2 id="VISUALIZING-RESULTS-IN-TENSORBOARD"><a href="#VISUALIZING-RESULTS-IN-TENSORBOARD" class="headerlink" title="VISUALIZING RESULTS IN TENSORBOARD"></a>VISUALIZING RESULTS IN TENSORBOARD</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/12/Screen-Shot-2015-12-11-at-6.29.14-AM-1024x347.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">                </div>                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/12/Screen-Shot-2015-12-11-at-6.27.48-AM-1024x350.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" title="">                </div>                <div class="image-caption">è¿™é‡Œå†™å›¾ç‰‡æè¿°</div>            </figure><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°:</p><ul><li>æˆ‘ä»¬çš„è®­ç»ƒ metricsä¸å¹³æ»‘ï¼Œå› ä¸ºç”¨çš„batch sizeså¾ˆå°ã€‚å¦‚æœç”¨å¤§çš„batches (æˆ–è€…åœ¨æ•´ä¸ªæµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°)ï¼Œä¼šå¾—åˆ°å¹³æ»‘çš„çº¿ã€‚</li><li>æµ‹è¯•é›†çš„ accuracyæ˜æ˜¾æ¯”è®­ç»ƒé›†çš„ä½ï¼Œè¯´æ˜ç½‘ç»œè¿‡æ‹Ÿåˆäº†ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨æ›´å¤§çš„æ•°æ®é›†ï¼Œæ›´å¼ºçš„æ­£åˆ™åŒ–ï¼Œæ›´å°‘çš„æ¨¡å‹å‚æ•°ã€‚</li><li>è®­ç»ƒé›†ä¸Šçš„ loss å’Œ accuracyæ¯”æµ‹è¯•é›†ä½çš„åŸå› æ˜¯ç”¨äº†dropout.</li></ul><h1 id="å‚è€ƒï¼šhttp-www-wildml-com-2015-12-implementing-a-cnn-for-text-classification-in-tensorflow"><a href="#å‚è€ƒï¼šhttp-www-wildml-com-2015-12-implementing-a-cnn-for-text-classification-in-tensorflow" class="headerlink" title="å‚è€ƒï¼šhttp://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/"></a>å‚è€ƒï¼š<a href="http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/" target="_blank" rel="external">http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/</a></h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;CNNåœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸå–å¾—äº†å¾ˆå¥½çš„ç»“æœï¼ŒåŒæ—¶å®ƒå¯ä»¥åº”ç”¨åœ¨æ–‡æœ¬åˆ†ç±»ä¸Šé¢ï¼Œæ­¤æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨tensorflowå®ç°æ­¤ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†&quot;&gt;&lt;a href=&quot;#CNNå®ç°æ–‡æœ¬åˆ†ç±»çš„åŸç†
      
    
    </summary>
    
    
      <category term="TensorFlow" scheme="https://edward7zhang.github.io/tags/TensorFlow/"/>
    
  </entry>
  
  <entry>
    <title>å®éªŒå®¤æ‹›æ–°é¢˜ç›®â‘¡</title>
    <link href="https://edward7zhang.github.io/2018/05/08/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8B%9B%E6%96%B0%E9%A2%98%E7%9B%AE(2)/"/>
    <id>https://edward7zhang.github.io/2018/05/08/å®éªŒå®¤æ‹›æ–°é¢˜ç›®(2)/</id>
    <published>2018-05-08T10:00:07.000Z</published>
    <updated>2018-05-08T16:09:44.840Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç«è½¦è£…ç®±"><a href="#ç«è½¦è£…ç®±" class="headerlink" title="ç«è½¦è£…ç®±"></a>ç«è½¦è£…ç®±</h1><hr><h2 id="ç°æœ‰ä¸€æ‰¹ç«è½¦è½¦å¢éœ€è¦æŒ‰ç…§æ¯èŠ‚è½¦å¢ä¸­æ‰€å«è´§ç‰©æ•°é‡è¿›è¡Œè¿æ¥å‘è½¦"><a href="#ç°æœ‰ä¸€æ‰¹ç«è½¦è½¦å¢éœ€è¦æŒ‰ç…§æ¯èŠ‚è½¦å¢ä¸­æ‰€å«è´§ç‰©æ•°é‡è¿›è¡Œè¿æ¥å‘è½¦" class="headerlink" title="ç°æœ‰ä¸€æ‰¹ç«è½¦è½¦å¢éœ€è¦æŒ‰ç…§æ¯èŠ‚è½¦å¢ä¸­æ‰€å«è´§ç‰©æ•°é‡è¿›è¡Œè¿æ¥å‘è½¦"></a>ç°æœ‰ä¸€æ‰¹ç«è½¦è½¦å¢éœ€è¦æŒ‰ç…§æ¯èŠ‚è½¦å¢ä¸­æ‰€å«è´§ç‰©æ•°é‡è¿›è¡Œè¿æ¥å‘è½¦</h2><h2 id="è¦æ±‚ï¼š"><a href="#è¦æ±‚ï¼š" class="headerlink" title="è¦æ±‚ï¼š"></a>è¦æ±‚ï¼š</h2><ul><li>å…¶ä¸­æ¯èŠ‚è½¦å¢ä¸­åŒ…å«ä¸¤ç§å…ƒç´  è½¦å¢å·ï¼š<code>TrainNum</code> ä»¥åŠæ‰€è£…è½½è´§ç‰©æ•°é‡ï¼š<code>GoodsNum</code>ï¼›</li><li>å…¶ä¸­æ¯èŠ‚è½¦å¢ä»¥<code>å‰è½¦å¢</code> -&gt; <code>åè½¦å¢</code> çš„å½¢å¼è¿›è¡Œè¿æ¥ï¼›</li><li>æŒ‰ç…§æ¯èŠ‚è½¦å¢çš„<code>GoodsNum</code>çš„é™åºè¿›è¡Œè¿æ¥ï¼›</li><li><p>è‡ªå®šä¹‰ä¸€ä¸ª<code>TrainCabin</code>æ•°æ®ç»“æ„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TrainCabin</span>&#123;</span></div><div class="line"></div><div class="line"><span class="comment">//TODO structure your struct</span></div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure></li><li><p>å†™å‡ºä¸€ä¸ªå‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function">TrainCabin* <span class="title">AssembleTraninCabin</span><span class="params">(TrainCabin* TrainList)</span></span>;</div><div class="line"><span class="comment">//é€‰æ‹©ä½ è®¤ä¸ºæ—¶é—´å¤æ‚åº¦æœ€å°çš„ç®—æ³•è¿›è¡Œç¼–ç </span></div></pre></td></tr></table></figure></li></ul><blockquote><p>è¿”å›å€¼ä¸ºå·²æŒ‰ç…§ä»¥ä¸Šè¦æ±‚æ’å¥½åºåçš„ç«è½¦é“¾è¡¨</p></blockquote><h2 id="è¾“å…¥"><a href="#è¾“å…¥" class="headerlink" title="è¾“å…¥"></a>è¾“å…¥</h2><ul><li>ç¬¬ä¸€ä¸ªå€¼ä¸º<code>TrainNum</code></li><li>ç¬¬äºŒä¸ªå€¼ä¸º<code>GoodsNum</code></li><li>ä¸­é—´ä»¥<code>|</code>åˆ†å‰²</li><li>è¾“å…¥<code>-1</code> ä»¥ç»“æŸè¾“å…¥</li></ul><h3 id="Inputï¼š"><a href="#Inputï¼š" class="headerlink" title="Inputï¼š"></a>Inputï¼š</h3><pre><code>1 | 32 | 53 | 74 | 25 | 0-1</code></pre><h2 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h2><ul><li>åœ¨æ§åˆ¶å°ä¸­æ‰“å°æ’å¥½åºçš„ç«è½¦åˆ—</li><li>æŒ‰ç…§ä»¥ä¸‹ç¤ºä¾‹æ ¼å¼</li></ul><h3 id="Outputï¼š"><a href="#Outputï¼š" class="headerlink" title="Outputï¼š"></a>Outputï¼š</h3><pre><code>| 3 | 7 | -&gt; | 2 | 5 | -&gt; | 1 | 3 | -&gt; | 4 | 2 | -&gt; | 5 | 0 |</code></pre><hr><h1 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h1><p>éå¸¸åŸºç¡€çš„ä¸€é“è€ƒå¯Ÿæ•°æ®æŠ½è±¡ã€æ•°æ®ç»“æ„æ„é€ ã€æ’åºç®—æ³•ã€å•å‘é“¾è¡¨çš„ç®€å•é¢˜â€¦ä½†ä»Šå¤©çš„ç°åœºæƒ…å†µä¸å®¹ä¹è§‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TrainCabin</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">int</span> TrainNum;</div><div class="line"><span class="keyword">int</span> GoodsNum;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TrainCabin</span> *<span class="title">next</span>;</span></div><div class="line">&#125;TrainCabin;</div><div class="line"></div><div class="line"><span class="function">TrainCabin* <span class="title">AssembleTraninCabin</span><span class="params">(TrainCabin *TrainList)</span></span></div><div class="line">&#123;</div><div class="line">TrainCabin *i=TrainList;</div><div class="line">TrainCabin *j;</div><div class="line">TrainCabin *temp=(TrainCabin*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TrainCabin));</div><div class="line">temp-&gt;next=<span class="literal">NULL</span>;</div><div class="line"><span class="keyword">while</span>(i!=<span class="literal">NULL</span>)</div><div class="line">&#123;</div><div class="line">j=i-&gt;next;</div><div class="line"><span class="keyword">while</span>(j!=<span class="literal">NULL</span>)</div><div class="line">&#123;</div><div class="line"><span class="keyword">if</span>((*i).GoodsNum&gt;(*j).GoodsNum)</div><div class="line">&#123;</div><div class="line">(*temp).TrainNum=(*i).TrainNum;</div><div class="line">(*temp).GoodsNum=(*i).GoodsNum;</div><div class="line">(*i).TrainNum=(*j).TrainNum;</div><div class="line">(*i).GoodsNum=(*j).GoodsNum;</div><div class="line">(*j).TrainNum=(*temp).TrainNum;</div><div class="line">(*j).GoodsNum=(*temp).GoodsNum;</div><div class="line">&#125;</div><div class="line">j=j-&gt;next;</div><div class="line">&#125;</div><div class="line">i=i-&gt;next;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> TrainList;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">(<span class="keyword">const</span> TrainCabin *TrainList)</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">while</span>(TrainList-&gt;next!=<span class="literal">NULL</span>)</div><div class="line">&#123;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"|"</span>&lt;&lt;(*TrainList).TrainNum&lt;&lt;<span class="string">"|"</span>&lt;&lt;(*TrainList).GoodsNum&lt;&lt;<span class="string">"| -&gt; "</span>;</div><div class="line">TrainList=TrainList-&gt;next;</div><div class="line">&#125;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"|"</span>&lt;&lt;(*TrainList).TrainNum&lt;&lt;<span class="string">"|"</span>&lt;&lt;(*TrainList).GoodsNum&lt;&lt;<span class="string">"|"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">int</span> TrainNum=<span class="number">0</span>,GoodsNum=<span class="number">0</span>;</div><div class="line">TrainCabin *frist,*last;</div><div class="line">TrainCabin *temp;</div><div class="line">frist=(TrainCabin*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TrainCabin));</div><div class="line">frist-&gt;next=<span class="literal">NULL</span>;</div><div class="line">last=frist;</div><div class="line"><span class="keyword">char</span> input;</div><div class="line"><span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">&#123;</div><div class="line"><span class="built_in">cin</span>&gt;&gt;TrainNum;</div><div class="line"><span class="keyword">if</span>(TrainNum==<span class="number">-1</span>)</div><div class="line"><span class="keyword">break</span>;</div><div class="line"><span class="built_in">cin</span>&gt;&gt;input;</div><div class="line"><span class="built_in">cin</span>&gt;&gt;GoodsNum;</div><div class="line"></div><div class="line">temp=(TrainCabin*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TrainCabin));</div><div class="line">temp-&gt;TrainNum=TrainNum;</div><div class="line">temp-&gt;GoodsNum=GoodsNum;</div><div class="line">temp-&gt;next=<span class="literal">NULL</span>;</div><div class="line"></div><div class="line">last-&gt;next=temp;</div><div class="line">last=temp;</div><div class="line">&#125;</div><div class="line">TrainCabin *result=AssembleTraninCabin((*frist).next);</div><div class="line">display(result);</div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç«è½¦è£…ç®±&quot;&gt;&lt;a href=&quot;#ç«è½¦è£…ç®±&quot; class=&quot;headerlink&quot; title=&quot;ç«è½¦è£…ç®±&quot;&gt;&lt;/a&gt;ç«è½¦è£…ç®±&lt;/h1&gt;&lt;hr&gt;
&lt;h2 id=&quot;ç°æœ‰ä¸€æ‰¹ç«è½¦è½¦å¢éœ€è¦æŒ‰ç…§æ¯èŠ‚è½¦å¢ä¸­æ‰€å«è´§ç‰©æ•°é‡è¿›è¡Œè¿æ¥å‘è½¦&quot;&gt;&lt;a href=&quot;#ç°æœ‰ä¸€æ‰¹ç«è½¦è½¦å¢éœ€è¦æŒ‰
      
    
    </summary>
    
    
      <category term="Lab_Interview" scheme="https://edward7zhang.github.io/tags/Lab-Interview/"/>
    
  </entry>
  
  <entry>
    <title>åç”Ÿå¯ç•</title>
    <link href="https://edward7zhang.github.io/2018/05/06/%E5%90%8E%E7%94%9F%E5%8F%AF%E7%95%8F/"/>
    <id>https://edward7zhang.github.io/2018/05/06/åç”Ÿå¯ç•/</id>
    <published>2018-05-06T15:20:07.000Z</published>
    <updated>2018-05-06T15:44:43.485Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Take-your-Child-to-work-Day-at-Google-2018"><a href="#Take-your-Child-to-work-Day-at-Google-2018" class="headerlink" title="Take your Child to work Day at Google 2018"></a>Take your Child to work Day at Google 2018</h1><iframe width="600" height="337.3" src="https://www.youtube.com/embed/2nWkYwC2XHI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><p>When I heared a kid who Firmly said I will be a video game programmer, I realize that it is extraordinary.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Take-your-Child-to-work-Day-at-Google-2018&quot;&gt;&lt;a href=&quot;#Take-your-Child-to-work-Day-at-Google-2018&quot; class=&quot;headerlink&quot; title=&quot;Take you
      
    
    </summary>
    
    
      <category term="Inspire" scheme="https://edward7zhang.github.io/tags/Inspire/"/>
    
  </entry>
  
</feed>
